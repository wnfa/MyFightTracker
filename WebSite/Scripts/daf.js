/*!
* Data Aquarium Framework - Core
* Copyright 2008-2016 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function c(t){n.touch&&n.touch.busy(t)}function d(n,t,i){for(var u,r=0;r<t.length;r++)u=t[r],n[u]==null&&(n[u]=i)}function tt(n,t){if(!t){var i=Web.Menu.Nodes;for(var r in i)t=i[r]}return $(t).each(function(){var t=this;return n.apply(t)==!1?!1:t.children&&!tt(n,t.children)?!1:void 0}),!0}function it(){var n=!1;return tt(function(){if(this.url&&this.url.match(/\/membership(\.aspx)?$/i))return n=!0,!1}),n}function p(){var n=r.HoverMonitor,t=n&&n._instance;t&&t.close()}function s(n){return parseInt(n,10)}function ct(n){return n&&n.getTimezoneOffset&&!(isNaN(+n)||n<new Date(1753,0)||n>new Date(9999,0))}function rt(n){var t=null;return $(n).each(function(){var n=this;return n.selected?(t=n,!1):n.children&&(t=rt(n.children),t)?!1:void 0}),t}function ut(n,t){$(t).each(function(){var t=this,i=t.url,f,r,e=$("<li/>").appendTo(n),u;i?(r=i.match(/^(_\w+):(.+)$/),r&&(i=r[2],f=r[1]),u=$("<a/>").attr({href:i,title:t.description,target:f})):u=$("<span/>");u.appendTo(e).text(t.title);t.children&&ut($("<ul/>").appendTo(e),t.children)})}function ft(n){for(var i=[],r=0,o=/\$(row|master|context)\s*\.\s*(\w+)(\s*=(=|(\s*([\S\s]+?)\s*;)))?/gm,t,u,f,e;t=o.exec(n);)u=t[1],f=t[2],e=t[6],i.push(n.substr(r,t.index-r)),u=="row"&&(u=null),e?i.push(String.format('this.updateFieldValue("{0}",{1});',f,ft(e))):(i.push(String.format('this.fieldValue("{0}"{1})',f,u?',"'+u+'"':"")),t[4]=="="&&i.push("==")),r=t.index+t[0].length;return r<n.length&&i.push(n.substr(r)),i.join("")}function w(t,i,r){var o=t._pendingUploads,h,s,f,e={Values:[],Errors:[]};if(o||(o=t._pendingUploads=[]),$(o).each(function(n){var t=this;if(t.fieldName==i)return h=!0,r?t.files=r:(t.files=null,o.splice(n,1)),!1}),!h&&r&&o.push({fieldName:i,files:r}),r&&(s=r[0],s)){function u(n,r){return t.findField((r&&i||"")+n)}f=u("FileName",!0)||u("FILENAME",!0)||u("FILE_NAME",!0)||u("filename",!0)||u("file_name",!0)||u("FileName")||u("FILENAME")||u("FILE_NAME")||u("filename")||u("file_name");f&&e.Values.push({Name:f.Name,NewValue:s.name});f=u("ContentType",!0)||u("CONTENTTYPE",!0)||u("CONTENT_TYPE",!0)||u("contenttype",!0)||u("conent_type",!0)||u("ContentType")||u("CONTENTTYPE")||u("CONTENT_TYPE")||u("contenttype")||u("content_type");f&&e.Values.push({Name:f.Name,NewValue:s.type});f=u("Length",!0)||u("LENGTH",!0)||u("length",!0)||u("Length")||u("LENGTH")||u("length");f&&e.Values.push({Name:f.Name,NewValue:s.size});e.Values.length&&(n.mobile?$app.input.execute({dataView:t,values:e.Values}):t._updateCalculatedFields(e))}}function et(t,i){return $(n.touch?n.touch.page(t._id):t._container).find(".drop-box-"+i.Index)}var n,l,y;Type.registerNamespace("Web");var t=window,h=$(t),r=t.Web,e=Sys.Serialization.JavaScriptSerializer,g=/\{([\s\S]+?)\}/,a=r.DataViewResources,b=a.Mobile,u=b.Files,o=a.Validator,k=a.Actions.Scopes,nt=k.Form.Update.WhenLastCommandName.BatchEdit,ot=["AllowQBE","AllowSorting","FormatOnClient","HtmlEncode"],st=["Len","Rows","Columns","Search","ItemsPageSize","Aggregate","OnDemandStyle","TextMode","MaskType","AutoCompletePrefixLength","CategoryIndex"],ht=["Fields","Views","Categories","ActionGroups","Filter"];r.DataViewMode={View:"View",Lookup:"Lookup"};r.DynamicExpressionScope={Field:0,ViewRowStyle:1,CategoryVisibility:2,DataFieldVisibility:3,DefaultValues:4,ReadOnly:5,Rule:6};r.AutoHideMode={Nothing:0,Self:1,Container:2};r.DynamicExpressionType={RegularExpression:0,ClientScript:1,ServerExpression:2,CSharp:3,VisualBasic:4,Any:4};r.DataViewAggregates=["None","Sum","Count","Avg","Max","Min"];r.FieldSearchMode={Default:0,Required:1,Suggested:2,Allowed:3,Forbidden:4};r.PageState={};r.PageState._init=function(){var n=this,i,t;n._state||(i=n._ostate=$("#__COTSTATE"),t=i.val(),n._state=t?e.deserialize(t):{})};r.PageState._save=function(){this._ostate.length&&this._ostate.val(e.serialize(this._state))};r.PageState.read=function(n){return this._init(),this._state[n]};r.PageState.write=function(n,t){this._init();this._state[n]=t;this._save()};Sys.StringBuilder.prototype.appendFormat=function(){this.append(String._toFormattedString(!1,arguments))};String.isNullOrEmpty=function(n){return n==null||n.length==0};String.isBlank=function(t){return t==null||typeof t=="string"&&t.match(n._blankRegex)!=null};String._wordTrimRegex=/(\S{16})\S+/g;String._tagRegex=/<\/?\w.*?>/g;String.trimLongWords=function(n,t){var r,e;if(n==null)return n;if(r=this._wordTrimRegex,t!=null&&(r=new RegExp(String.format("(\\S{{{0}}})\\S+",t),"g")),e=n.replace(r,"$1..."),n.match(String._tagRegex)){for(var u=new Sys.StringBuilder,o=String._tagRegex,i=o.exec(n),f=0;i;)tag=i[0],i.index>0&&u.append(n.substring(f,i.index).replace(r,"$1...")),f=i.index+tag.length,u.append(tag),i=o.exec(n);f<n.length&&u.append(n.substring(f));e=u.toString()}return e};String.htmlEncode=function(t){return typeof t=="string"&&t.match(n._htmlTest)?t:n.htmlEncode(t)};String.isJavaScriptNull=function(n){return n=="%js%null"||n=="null"};String.jsNull="%js%null";r.DataView=function(t){n.initializeBase(this,[t]);this._controller=null;this._viewId=null;this._servicePath=null;this._baseUrl=null;this._pageIndex=-1;this._pageSize=Web.DataViewResources.Pager.PageSizes[0];this._sortExpression=null;this._filter=[];this._externalFilter=[];this._categories=null;this._fields=null;this._allFields=null;this._rows=null;this._totalRowCount=0;this._firstPageButtonIndex=0;this._pageCount=0;this._views=[];this._actionGroups=[];this._selectedKey=[];this._selectedKeyFilter=[];this._lastCommandName=null;this._lastViewId=null;this._lookupField=null;this._filterFields=null;this._filterSource=null;this._mode=Web.DataViewMode.View;this._lookupPostBackExpression=null;this._domFilterSource=null;this._selectedKeyList=[];this._pageSizes=Web.DataViewResources.Pager.PageSizes};n=Web.DataView;n.cache={};t.$app=t.$appfactory=n;RegExp.escape=function(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};n._blankRegex=/^\s*$/;n._fieldMapRegex=/(\w+)\s*=\s*(\w+)/g;n._fieldFilterRegex=/([\w\.\,]+):([\s\S]*)/;n._filterRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)$/;n._filterIteratorRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)/g;n._keepCapitalization=/^\$(month|quarter|true|false)/;n._listRegex=/\$and\$|\$or\$/;n._simpleListRegex=/\s*,\s*/;n._htmlTest=/<\w+.*?>/;n.serializer=e;Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});n.cssToIcon=function(n){var t=n&&n.match(/glyphicon-([\w\-]+)/);return t?"glyphicon "+t[0]:n};n.toHexString=function(n){if(n){var t=["0x"];Array.isArray(n)||(n=n.toString().split($app._simpleListRegex));$(n).each(function(){t.push(parseInt(this).toString(16))});n=t.join("")}return n};n.htmlEncode=function(n){return n!=null&&typeof n!="string"&&(n=n.toString()),n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n};n.htmlAttributeEncode=function(n){return n!=null&&typeof n=="string"?n.replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;"):n};n.isIE6=Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<7;n.prototype={get_controller:function(){return this._controller},set_controller:function(n){this._controller=n},useCase:function(n){return this.get_useCase()==n},get_useCase:function(){return this._useCase},set_useCase:function(n){this._useCase=n},get_survey:function(){return this._survey},set_survey:function(n){this._survey=n},get_viewId:function(){!this._viewId&&this._views.length>0&&(this._viewId=this._views[0].Id);var n=this._viewId;return n||(n=""),n},set_viewId:function(n){this._viewId=n},get_newViewId:function(){return this._newViewId},set_newViewId:function(n){this._newViewId=n},get_servicePath:function(){return this._servicePath||__servicePath},set_servicePath:function(t){this._servicePath=this.resolveClientUrl(t);n._servicePath||(n._servicePath=t)},get_baseUrl:function(){return this._baseUrl||__baseUrl},set_baseUrl:function(t){t=="~"&&(t="/");this._baseUrl=t;n._baseUrl||(n._baseUrl=t)},get_siteUrl:function(){var t=this.get_servicePath(),n=t.match(/(^.+?\/)\w+\/\w+\.asmx/);return n||(n=t.match(/(^.+?\/)appservices\/_invoke$/)),n?n[1]:""},resolveClientUrl:function(n){return n?n.replace(/~\x2f/g,this.get_baseUrl()):null},get_hideExternalFilterFields:function(){return this._hideExternalFilterFields!=!1},set_hideExternalFilterFields:function(n){this._hideExternalFilterFields=n},get_backOnCancel:function(){return this._backOnCancel==!0},set_backOnCancel:function(n){this._backOnCancel=n},get_confirmContext:function(){return this._confirmContext},set_confirmContext:function(n){this._confirmContext=n},get_startPage:function(){return this._startPage},set_startPage:function(n){this._startPage=n},get_startCommandName:function(){return this._startCommandName},set_startCommandName:function(n){this._startCommandName=n},get_startCommandArgument:function(){return this._startCommandArgument},set_startCommandArgument:function(n){this._startCommandArgument=n},get_exitModalStateCommands:function(){return this._exitModalStateCommands},set_exitModalStateCommands:function(n){this._exitModalStateCommands=n},get_showActionBar:function(){var t=this.extension(),n;return t&&(n=t.options(),n.actionBar!=null)?n.actionBar==!0:this._showActionBar!=!1},set_showActionBar:function(n){this._showActionBar=n},get_showActionButtons:function(){var t=this._showActionButtons;return t||(t=n.touch?"Auto":"TopAndBottom",this._showActionButtons=t),t},set_showActionButtons:function(n){this._showActionButtons=n},get_showSearchBar:function(){return this._showSearchBar==!0&&!(__tf!=4)},set_showSearchBar:function(n){this._showSearchBar=n},get_searchOnStart:function(){return this._searchOnStart==!0},set_searchOnStart:function(n){this._searchOnStart=n;n&&this.set_searchBarIsVisible(!0)},get_searchBarIsVisible:function(){return this._searchBarIsVisible==!0},set_searchBarIsVisible:function(n){this._searchBarIsVisible=n},get_showModalForms:function(){return $app.mobile?!0:this._showModalForms==!0},set_showModalForms:function(n){this._showModalForms=n},get_showDescription:function(){var n=this.extension(),t;return n?(t=n.options(),t.description==!0):this._showDescription!=!1},set_showDescription:function(n){this._showDescription=n},get_showFirstLetters:function(){return this._showFirstLetters==!0},set_showFirstLetters:function(n){this._showFirstLetters=n},get_autoSelectFirstRow:function(){return this._autoSelectFirstRow==!0},set_autoSelectFirstRow:function(n){this._autoSelectFirstRow=n},get_autoHighlightFirstRow:function(){return this._autoHighlightFirstRow==!0},set_autoHighlightFirstRow:function(n){this._autoHighlightFirstRow=n},get_refreshInterval:function(){return this._refreshInterval},set_refreshInterval:function(n){this._refreshInterval=(__tf!=4)?0:n},get_showViewSelector:function(){return this._showViewSelector!=!1},set_showViewSelector:function(n){this._showViewSelector=n},get_showPager:function(){var n=this._showPager;return n==null||n==!0?(n="Bottom",this._showPager=n):n==!1&&(n="None"),n},set_showPager:function(n){this._showPager=n},get_showPageSize:function(){return this._showPageSize!=!1},set_showPageSize:function(n){this._showPageSize=n},get_selectionMode:function(){return this._selectionMode},set_selectionMode:function(n){this._selectionMode=n},multiSelect:function(t){var i=this,r=i._multiSelect,u;if(arguments.length)i._multiSelect=t,n.touch&&i.pageProp("selectionMode",t?"Multiple":"Single");else return r==null&&(u=n.touch&&i.pageProp("selectionMode"),r=i._multiSelect=(u||i._selectionMode)=="Multiple"),r},get_cookie:function(){return this._cookie||(this._cookie=this._id+"cookie"),this._cookie},set_cookie:function(n){this._cookie=n},get_pagerButtonCount:function(n){if(!this._pagerButtonCount||n){var t=Web.DataViewResources.Pager.PageButtonCount;this.get_pageCount()>t&&(t=t-3,t<5&&(t=5));this._pagerButtonCount=t}return this._pagerButtonCount},get_pageIndex:function(){return this._pageIndex},set_pageIndex:function(n){if(this._pageIndex=n,n>=0){var t=this.get_pagerButtonCount();n>=this._firstPageButtonIndex+t?this._firstPageButtonIndex=n:n<this._firstPageButtonIndex&&(this._firstPageButtonIndex-=t,n<this._firstPageButtonIndex&&(this._firstPageButtonIndex=n));this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0);this.get_pageCount()-this._firstPageButtonIndex<t&&(this._firstPageButtonIndex=this.get_pageCount()-t);this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0)}n==-2&&(this._pageOffset=0)},get_pageOffset:function(){return this.get_isDataSheet()?this._pageOffset==null?0:this._pageOffset:0},set_pageOffset:function(n){this._pageOffset=n},get_categoryTabIndex:function(){return this._categoryTabIndex},set_categoryTabIndex:function(t){t!=this._categoryTabIndex&&(this._categoryTabIndex=t,n.touch||(this._updateTabbedCategoryVisibility(),t!=-1&&(this._modalPopup&&(this._resizeContainerBounds(),this._modalPopup.show()),_body_performResize(),this.editing()&&(this._focusedFieldName=null,this._focus()))))},get_enabled:function(){return this._enabled==null?!0:this._enabled},set_enabled:function(n){this._enabled=n},get_showInSummary:function(){return this._showInSummary},set_showInSummary:function(n){this._showInSummary=n},get_summaryFieldCount:function(){return this._summaryFieldCount},set_summaryFieldCount:function(n){this._summaryFieldCount=n},get_showLEVs:function(){return this._showLEVs},set_showLEVs:function(n){this._showLEVs=n},get_tags:function(){return this._tag},set_tags:function(n){this._tag=n},get_tag:function(){return this._tag},set_tag:function(n){this._tag=n},get_pageSize:function(){return this._pageSize},set_pageSize:function(n){this._pageSize=n;this._pageOffset=0;delete this._viewColumnSettings;Array.indexOf(this._pageSizes,n)==-1&&(this._pageSizes=Array.clone(this._pageSizes),Array.insert(this._pageSizes,0,n));this._fields!=null&&this.refreshData()},get_groupExpression:function(){return this._groupExpression},set_groupExpression:function(n){this._groupExpression=n;this._checkedSortGroup=!1},get_sortExpression:function(){var t=this._sortExpression,r,u=this._groupExpression,i=0,f,e;if(!this._checkedSortGroup&&u){for(t||(t=""),this._checkedSortGroup=!0,u=u.trim().split(n._simpleListRegex),r=t.trim().split(n._simpleListRegex);i<u.length;)f=u[i],i<r.length?(e=r[i].split(/\s+/),f!=e[0]&&r.splice(i,0,f)):r.splice(i,0,f),i++;t=r.join(",");t.match(/,$/)&&(t=t.substring(0,t.length-1));this._sortExpression=t}return t},set_sortExpression:function(n){if(this._checkedSortGroup=!1,n&&n.length!=0){var t=n.match(/^(\w+)\s*((asc|desc)|$)/i);this._sortExpression=t&&t[2].length==0?String.isNullOrEmpty(this._sortExpression)||this._sortExpression.match(/^(\w+)\s*/)[1]!=t[1]?n+" asc":this._sortExpression.endsWith(" asc")?n+" desc":n+" asc":n}else this._sortExpression=null},set_id:function(n){this._id||(this._id=n)},get_appId:function(){return this._id},set_appId:function(n){$app.mobile&&(this._id=n)},get_appFilterSource:function(){return this._filterSource},set_appFilterSource:function(n){$app.mobile&&(this._filterSource=n)},get_filterSource:function(){return this._filterSource},set_filterSource:function(n){this._filterSource||(this._filterSource=n)},get_filterFields:function(){return this._filterFields},set_filterFields:function(n){this._filterFields=n},get_visibleWhen:function(){return this._visibleWhen},set_visibleWhen:function(n){this._visibleWhen=n},get_showQuickFind:function(){return this._showQuickFind!=!1},get_quickFindText:function(){return String.isNullOrEmpty(this._quickFindText)?Web.DataViewResources.Grid.QuickFindText:this._quickFindText},set_quickFindText:function(n){this._quickFindText=n},get_quickFindElement:function(){return $get(this.get_id()+"_QuickFind")},set_showQuickFind:function(n){this._showQuickFind=n},get_showRowNumber:function(){return this._showRowNumber==!0},set_showRowNumber:function(n){this._showRowNumber=n},get_filter:function(){var u,e,i,r,f,t;if(this.get_lookupField()==null&&(this.get_pageIndex()==-1&&!this._allFields||this._externalFilter.length>0&&this._filter.length==0)){if(this.get_domFilterSource())for(this._externalFilter=[],u=this.get_filterFields().split(n._simpleListRegex),e=this.get_domFilterSource().value.split(n._simpleListRegex),i=0;i<u.length;i++)Array.add(this._externalFilter,{Name:u[i],Value:e[i]});else if(r=n._commandLine.match(/\?([\s\S]+)/),r&&this.get_filterSource()!="None"&&this.get_filterSource()==null&&!this.get_useCase())for(this._externalFilter=[],f=/(\w+)=([\S\s]*?)(&|$)/g,t=f.exec(r[1]);t;)t[1]!="ReturnUrl"&&Array.add(this._externalFilter,{Name:t[1],Value:t[2].length==0?String.jsNull:decodeURIComponent(t[2])}),t=f.exec(r[1]);this.applyExternalFilter(this.get_isModal()||($app.mobile||this.useCase("$app"))&&this._filter)}else this.get_filterSource()=="Context"&&this._externalFilter.length>0&&this.applyExternalFilter(!0);return this._startupFilter&&(this.readContext("disableStartFilter")!=!0&&(Array.addRange(this._filter,this._startupFilter),this.writeContext("disableStartFilter",!0)),this._startupFilter=null),this._filter},set_filter:function(n){this._filter=n},get_startupFilter:function(){return this._startupFilter},set_startupFilter:function(n){this._startupFilter=n},get_externalFilter:function(){return this._externalFilter},set_externalFilter:function(n){this._externalFilter=n?n:[]},get_ditto:function(){return this._ditto},set_ditto:function(n){this._ditto=n},get_modalAnchor:function(){return this._modalAnchor},set_modalAnchor:function(n){this._modalAnchor=n},get_description:function(){return this._description},set_description:function(n){this._description=n},get_isModal:function(){return this._modalPopup!=null||this._isModal},get_categories:function(){return this._categories},get_fields:function(){return this._fields},get_rows:function(){return this._rows},surveyRow:function(){var t=this,i,r;return n.touch?i=t.editRow():(i=[],r=t._collectFieldValues(),t._validateFieldValues(r,!1),$(r).each(function(){var n=this,r=t.findField(n.Name);r&&(i[r.Index]=n.NewValue)})),i},editRow:function(){var t=this,r,i,e,n=t._editRow,u,f;return n||(t.inserting()?(n=(t._newRow||[]).slice(0),$(t._externalFilter).each(function(){var i=this,r;i&&(r=t.findField(i.name||i.Name),!r||r.IsPrimaryKey&&r.ReadOnly||n[r.Index]!=null||(n[r.Index]=i.name?i.value:i.Value))}),r=t.get_master(),r&&(i=r.extension(),i&&i.commandRow&&(f=i.commandRow(),e=t.get_externalFilter(),$(e).each(function(){var e=this,o=!0,i=t.findField(e.Name),u;i&&(i.ItemsDataValueField&&(u=r.findField(i.ItemsDataValueField),u&&(o=!1,n[i.Index]=f[u.Index])),i.Index!=i.AliasIndex&&i.ItemsDataTextField&&(u=r.findField(i.ItemsDataTextField),u&&(n[i.AliasIndex]=f[u.Index])),o&&(n[i.Index]=t.convertStringToFieldValue(i,e.Value)))}))),u=[],$(n).each(function(n){u[n]=null})):(i=t.extension(),n=i&&i.commandRow?i.commandRow():[],n||(n=[]),u=n.slice(0)),n=t._editRow=n.slice(0),t._originalRow=u),n},originalRow:function(){return this._originalRow},get_selectedRow:function(){var n=this.extension();return n?$app.touch?n.commandRow():this._selectedRow:this._rows?this._rows[this._selectedRowIndex!=null?this._selectedRowIndex:0]:[]},get_pageCount:function(){return this._pageCount},get_aggregates:function(){return this._aggregates},get_views:function(){return this._views},actionGroups:function(n){var s=[],h=this._actionGroups,i,r,u,t,e,f,o;for(typeof n=="string"&&(n=[n]),u=0;u<n.length;u++)for(o=n[u],i=0;i<h.length;i++)if(t=h[i],f=null,t.Scope==o||t.Id==o)for(r=0;r<t.Actions.length;r++)e=t.Actions[r],this._isActionAvailable(e)&&(f||s.push(f={Scope:t.Scope,HeaderText:t.HeaderText,Flat:t.Flat,Id:t.Id,Actions:[]}),f.Actions.push(e));return s},actions:function(n){var t=this.actionGroups(n);return t.length?t[0].Actions:null},get_actionGroups:function(n,t){for(var r,u,f,e=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n){if(r=this._actionGroups[i],u=t?r:null,!t)for(f=0;f<r.Actions.length;f++)if(this._isActionAvailable(r.Actions[f])){u=this._actionGroups[i];break}u&&Array.add(e,u)}return e},get_actions:function(n,t){for(var r,u=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n)if(r=this._actionGroups[i],t)Array.addRange(u,r.Actions);else return r.Actions;return u},get_action:function(n){for(var t,i,u,f=n.split(/\//),r=0;r<this._actionGroups.length;r++)if(t=this._actionGroups[r],t.Id==f[0])for(i=0;i<t.Actions.length;i++)if(u=t.Actions[i],u.Id==f[1])return u;return null},get_selectedKey:function(){return this._selectedKey},set_selectedKey:function(n){this._selectedKey=n},get_selectedKeyFilter:function(){return this._selectedKeyFilter},set_selectedKeyFilter:function(n){this._selectedKeyFilter=n},_get_selectedValueElement:function(){var n=this._selectedValueElement;return n||(n=this._selectedValueElement=$(String.format("#{0}_{1}_SelectedValue",this.get_id(),this.get_controller()))),n.length?n[0]:null},get_selectedValue:function(){var t=this.readContext("SelectedValue"),n;return t?t:(n=this._get_selectedValueElement(),n?n.value:"")},set_selectedValue:function(n){if(!this._hasSearchAction){this.writeContext("SelectedValue",n.toString());var t=this._get_selectedValueElement();t&&(t.value=n!=null?n:"")}},get_keyRef:function(){var i=this.get_selectedKey(),t,n;if(!i)return null;for(t="",n=0;n<this._keyFields.length;n++)n>0&&(t+="&"),t=String.format("{0}{1}={2}",t,this._keyFields[n].Name,i[n]);return t},get_showIcons:function(){return this._icons!=null&&this._lookupField==null||this.get_showRowNumber()},get_showMultipleSelection:function(){return this.multiSelect()&&this._hasKey()},get_sysColCount:function(){var n=0;return this.get_showIcons()&&n++,this.get_showMultipleSelection()&&n++,this.get_isDataSheet()&&n++,n},_createRowKey:function(n){for(var u=typeof n=="number"?this._rows[n]:arguments[0],t="",r,i=0;i<this._keyFields.length;i++)r=this._keyFields[i],t.length>0&&(t+=","),t+=u[r.Index].toString();return t},batchEdit:function(t,i){var f=this,h=t||f._viewId,y,p,r,s,c;if(i){var l=[],v=[],u=[],e=[],d={dynamic:!0,text:k.Grid.BatchEdit.HeaderText,description:a.Mobile.MultiSelection,parent:f._id,controller:f._id+"_"+h+"_BatchEdit",context:{controller:f._controller,view:h},topics:[{description:String.format(b.ItemsSelectedMany,f._selectedKeyList.length)+". "+String.format(a.Views.DefaultCategoryDescriptions.$DefaultEditDescription,f.get_view().Label),questions:e}],submit:"batcheditsubmit.dataview.app",submitText:nt.HeaderText};if($(i.fields).each(function(){var n=this,t=n.Tag;n.Hidden||_field_isReadOnly.call(n)||n.OnDemand||(u.push(n),t&&(t.match(/\bbatch\-edit\-disabled\b/)?l.push(n):t.match(/\bbatch\-edit\b/)&&v.push(n)))}),v.length)u=v;else if(l.length)for(r=0;r<u.length;)l.indexOf(u[r])!=-1?u.splice(r,1):r++;if(u.length){y={};p={};$(u).each(function(){var n=this;y[n.Name]=n});function w(t,i){var u=t.ContextFields,f,e=[],r;if(u){while(f=n._fieldMapRegex.exec(u))e.push(f);$(e).each(function(){var n=this;r=y[n[2]];r&&!r._depends&&(r._depends=!0,i.push(r),w(r,i))})}}for($(u.slice(0).reverse()).each(function(){var n=this,t;n.ContextFields&&!n._depends&&(t=p[n.Name]=[],w(n,t),t=t.reverse())}),$(u).each(function(){var n=this,f=n.AllowNulls==!0,u={name:n.Name+"_BatchEdit",type:"bool",value:!1,required:!0,text:n.HeaderText||n.Label,items:{style:"CheckBox"}},r={name:n.Name,type:n.Type,len:n.Len,placeholder:f?o.Optional:o.Required,text:!1,columns:n.Columns,rows:n.Rows,visibleWhen:"$row."+n.Name+"_BatchEdit == true",extended:{allowNulls:f},format:n.DataFormatString,context:n.ContextFields},s=n.ItemsStyle,t;s&&(t={},t.style=s,n.ItemsDataController?(t.controller=n.ItemsDataController,t.view=n.ItemsDataView,t.dataValueField=n.ItemsDataValueField,t.dataTextField=n.ItemsDataTextField,t.newView=n.ItemsNewDataView,t.targetController=n.ItemsTargetController):(t.values=[],$(n.Items).each(function(){var n=this;t.values.push({value:n[0],text:n[1]})})),r.items=t,n.AliasName&&$(i.fields).each(function(){var t=this;if(t.Name==n.AliasName)return u.text=t.Label||t.HeaderText,!1}));n._depends?(r.placeholder=u.text,n._question=r):e.push(u,r)}),r=1;r<e.length;)s=e[r],c=p[s.name],c&&(s.placeholder=e[r-1].text,s.text=!1,s.extended.dependency=c,$(c).each(function(){var n=this._question;n.visibleWhen=s.visibleWhen;n.text="";e.splice(r++,0,n)})),r+=2;n.survey("show",d)}}else $app.execute({controller:f._controller,view:h,requiresMetadata:!0,requiresData:!1,success:function(n){f.batchEdit(h,n)}})},toggleSelectedRow:function(n){for(var s=n!=null?n:0,h=n!=null?n:this._rows.length-1,c=$get(this.get_id()+"_ToggleButton"),f,e,u,i,t,o,r=s;r<=h;r++)if(e=this._createRowKey(r),f=Array.indexOf(this._selectedKeyList,e),f!=-1&&Array.removeAt(this._selectedKeyList,f),u=n==null?c.checked:f==-1,u&&Array.add(this._selectedKeyList,e),i=$get(this.get_id()+"_CheckBox"+r),i){for(i.checked=u,u?$(i).addClass("Selected"):$(i).removeClass("Selected"),t=i;t&&t.tagName!="TR";)t=t.parentNode;u?$(t).addClass("MultiSelectedRow"):$(t).removeClass("MultiSelectedRow")}this._skipCellFocus=this.get_isDataSheet();this.set_selectedValue(this._selectedKeyList.join(";"));o=$get(this.get_id()+"$SelectionInfo");o&&(o.innerHTML=this._selectedKeyList.length==0?"":String.format(Web.DataViewResources.Pager.SelectionInfo,this._selectedKeyList.length));n>=0?this.executeRowCommand(n,"Select"):this.delayedRefresh()},delayedRefresh:function(t,i){if(i||(i=1e3),t)delete this._delayedRefreshTimer,this._isBusy||n._navigated||Sys.Application._disposing||this.refresh(!0);else{this._delayedRefreshTimer&&clearTimeout(this._delayedRefreshTimer);var r=this;this._delayedRefreshTimer=setTimeout(function(){r.delayedRefresh(!0)},i)}},get_view:function(n){if(n||(n=this.get_viewId()),!this._view||this._view.Id!=n)for(var t=0;t<this._views.length;t++)if(this._views[t].Id==n){this._view=this._views[t];break}return this._view},get_viewType:function(n){var t=this.get_view(n),i;return this._viewTypes&&(i=this._viewTypes[t?t.Id:n],i!=null)?i:t?t.Type:null},get_isGrid:function(n){var t=this.get_viewType(n);return t=="Grid"||t=="DataSheet"},get_isForm:function(n){var t=this.get_viewType(n);return t=="Form"},get_isDataSheet:function(n){var i=this.get_viewType(n),t;return __tf!=4?!1:(this._viewTypes&&(t=this._viewTypes[this.get_viewId()],t!=null&&(i=t)),i=="DataSheet")},get_isChart:function(){return this.get_viewType()=="Chart"},get_lastViewId:function(){return this._lastViewId},set_lastViewId:function(n){this._lastViewId=n},get_lastCommandName:function(){return this._lastCommandName},set_lastCommandName:function(n){this._lastCommandName=n;this._lastCommandArgument=null;$closeHovers()},get_lastCommandArgument:function(){return this._lastCommandArgument},set_lastCommandArgument:function(n){this._lastCommandArgument=n},get_isEditing:function(){return this.editing()},editing:function(){var t=this,n=t._lastCommandName,i=t._editing;return i==null&&(n=="Edit"||n=="New"||n=="Duplicate")||i==!0},get_isInserting:function(){return this.inserting()},inserting:function(){var n=this._lastCommandName;return this._lastCommandName=="New"||this._lastCommandName=="Duplicate"},get_lookupField:function(){return this.get_mode()==Web.DataViewMode.View?this._lookupField:this._fields[0]},set_lookupField:function(n){this._lookupField=n},get_lookupContext:function(){var n=this,i=n._lookupContext,t=n._lookupInfo?n._lookupInfo.field:n.get_lookupField();return i?i:t?{FieldName:t.Name,Controller:t._dataView.get_controller(),View:t._dataView.get_viewId()}:null},get_mode:function(){return this._mode},set_mode:function(n){this._mode=n},get_lookupValue:function(){return this._lookupValue},set_lookupValue:function(n){this._lookupValue=n},get_lookupText:function(){return this._lookupText},set_lookupText:function(n){this._lookupText=n},get_lookupPostBackExpression:function(){return this._lookupPostBackExpression},set_lookupPostBackExpression:function(n){this._lookupPostBackExpression=n},get_domFilterSource:function(){return this._domFilterSource},set_domFilterSource:function(n){this._domFilterSource=n},get_showDetailsInListMode:function(){return this._showDetailsInListMode!=!1},set_showDetailsInListMode:function(n){this._showDetailsInListMode=n},get_autoHide:function(){return!String.isNullOrEmpty(this.get_visibleWhen())&&this._autoHide==Web.AutoHideMode.Nothing?Web.AutoHideMode.Self:this._autoHide==null?Web.AutoHideMode.Nothing:this._autoHide},set_autoHide:function(n){this._autoHide=n},get_transaction:function(){return this._transaction},set_transaction:function(n){this._transaction=n},initialize:function(){n.callBaseMethod(this,"initialize");this._bodyKeydownHandler=Function.createDelegate(this,this._bodyKeydown);this._filterSourceSelectedHandler=Function.createDelegate(this,this._filterSourceSelected);this._quickFindHandlers={focus:this._quickFind_focus,blur:this._quickFind_blur,keydown:this._quickFind_keydown};this._checkMaxLengthHandler=function(n){var t=s(this.getAttribute("maxlength"));this.value.length>t&&(this.value=this.value.substr(0,t),n.preventDefault(),n.stopPropagation())}},dispose:function(){var t=this,i=t._survey,r;t._disposePendingUploads();Sys.Application._disposing||($(t._element).find("iframe").remove(),t._detachBehaviors());(t._container||n.touch)&&(r=this.extension(),r&&r.dispose&&r.dispose());t._wsRequest=null;t._stopInputListener();t._disposeModalPopup();t._disposeFieldFilter();t._disposeSearchBarExtenders();t._disposeImport();t._disposeFields();t._lookupField=null;t._parentDataView=null;t._bodyKeydownHandler=null;t._filterSourceSelectedHandler=null;t._restoreEmbeddedViews();delete t._container;t._cancelCallback=null;t._doneCallback=null;i&&(i.init=null,i.submit=null,i.cancel=null);clearTimeout(t._valueChangedTimeout);n.callBaseMethod(t,"dispose")},get_master:function(){var t=this.get_filterSource();return t?n.find(t):null},tag:function(n){this._tag=(this._tag||"")+","+n;this._tagList=null},untag:function(n){if(this._tag){this.get_isTagged("");var t=this._tagList,i=Array.indexOf(t,n);i>=0&&t.splice(i,1);this._tag=t.join()}this._tagList=null},get_isTagged:function(n){var t=this,i=t._tagList;return i||(i=t._tagList=t._tag?t._tag.replace(/,/g," ").split(/\s+/):[]),Array.contains(i,n)},tagged:function(n){var i=this,t;if(arguments.length==1)return n.match(/\-$/)?(i._tag||"").match(new RegExp(n))!=null:i.get_isTagged(n);for(t=0;t<n.length;t++)if(i.get_isTagged(n[t]))return!0;return!1},updated:function(){var u,o,f,t,l,i,r,e,s,h,c;if(n.callBaseMethod(this,"updated"),this._controller){if(this.get_servicePath().startsWith("http")&&this.set_baseUrl(this.get_siteUrl()),u=this.get_selectedValue(),u.length>0&&(this.set_autoHighlightFirstRow(!1),this.set_autoSelectFirstRow(!1),this.multiSelect()?this._selectedKeyList=u.split(";"):(this._selectedKey=u.split(","),this._pendingSelectedEvent=!0)),this._container||n.touch||(this.get_element().innerHTML="",this._container=document.createElement("div"),this.get_element().appendChild(this._container),$(this._container).addClass("DataViewContainer"),o=this._element.id,f=o.split(/_/),Sys.UI.DomElement.addCssClass(this._container,f?f[f.length-1]:o),this.get_showActionBar()||$(this._container).addClass("ActionBarHidden"),this.get_showDescription()||$(this._container).addClass("DescriptionHidden")),this.get_filterSource()&&this.get_filterSource()!="Context"?(t=this.get_master(),t?(this._hasParent=!0,t.add_selected(this._filterSourceSelectedHandler),this.get_transaction()=="Supported"&&(String.isNullOrEmpty(t.get_transaction())||(this.set_transaction(t.get_transaction()!="Supported"?t.get_transaction():null),this._forceVisible=this.get_transaction()&&t.inserting())),t._pendingSelectedEvent&&!$app.mobile?(this._source=t,l=this,this._afterUpdateTimerId=setInterval(function(){l._afterUpdate()},250)):this._forceVisible||(this._hidden=!0)):(t=$get(this.get_filterSource()),t&&$addHandler(t,"change",this._filterSourceSelectedHandler),this.set_domFilterSource(t)),this._externalFilter.length==0&&this._createExternalFilter(),this._filter.length==0&&(this._source||this.applyExternalFilter())):(this._hidden=!this._evaluateVisibility(),this._hidden&&this._updateLayoutContainerVisibility(!1)),this.get_transaction()=="Supported"&&this.set_transaction(null),$app.mobile||!this.get_modalAnchor()||this.get_isModal()||this._initializeModalPopup(),t!=null&&this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!1),this.get_startCommandName()=="UseTransaction"&&(this._usesTransaction=!0,this.set_startCommandName(null)),this.get_startCommandName()=="DetectTransaction")if(this.get_transaction())this.set_startCommandName(null);else{t&&n.isInstanceOfType(t)&&(t.remove_selected(this._filterSourceSelectedHandler),clearInterval(this._afterUpdateTimerId));return}(i=(n.get_commandLine()||"").replace(/#.+?$/,""),r=i.match(/_commandName=(.+?)&_commandArgument=(.*?)(&|$)/),r||(r=i.match(/_command=(.+?)&_argument=(.*?)(&|$)/)),!r||!(String.isNullOrEmpty(this.get_startCommandName())||__designer())||this.get_filterSource()||this.get_isModal()||this.get_lookupField()||(e=i.match(/_controller=(\w+)/),s=i.match(/_view=(\w+)/),e&&e[1]!=this.get_controller()||s&&s[1]!=this.get_view()?this._filterSource||(this._visibleWhen="false",this._updateLayoutContainerVisibility(!1)):(this._trySecondCommand=!String.isNullOrEmpty(e),this.set_startCommandName(r[1]),this.set_startCommandArgument(r[2]),String.isNullOrEmpty(this._viewId)||(this._replaceTriggerViewId=this._viewId),this._skipTriggeredView=!0,h=i.match(/\b_sync=(.+?)(&|$)/),h&&(this._syncKey=h[1].split(",")))),this.useCase("$app"))||(c=$app.mobile,this.get_startCommandName()?(this.set_searchOnStart(!1),this.set_lastCommandName(this.get_startCommandName()),this.set_lastCommandArgument(this.get_startCommandArgument()),this.get_startCommandName().match(/New|Edit|Select/)&&this.set_viewId(this.get_startCommandArgument()),this.set_startCommandName(null),this.set_startCommandArgument(null),this._rows=[],c||this._survey||this._loadPage()):this.loadPage(),c&&this.mobileUpdated())}},_afterUpdate:function(){if((!this._delayedLoading||!this._source._pendingSelectedEvent)&&!this._source._isBusy){clearInterval(this._afterUpdateTimerId);var n=this._source;this._source=null;this._filterSourceSelected(n,Sys.EventArgs.Empty,!0)}},dataAttr:function(n,t,i){var r=$(n),u="data-"+t;if(i)r.attr(u,i);else return i=r.attr(u),i||(i=r.attr("factory:"+t)),i},_updateLayoutContainerVisibility:function(t){var i,u,f,e,r,o,s,c,v,l,a,h;if($app.mobile){this._hidden=!t;return}if(this._forceVisible&&(t=!0),i=this._element.parentNode,String.isNullOrEmpty(i.getAttribute("data-visibility-controller"))&&i.setAttribute("data-visibility-controller",this.get_id()),u=String.isNullOrEmpty(this.dataAttr(i,"activator"))?null:this.dataAttr(i,"activator").match(/^\s*(\w+)\s*\|\s*(.+?)\s*(\|\s*(.+)\s*)?$/),this.get_autoHide()==Web.AutoHideMode.Self){for(this._element.style.display=t?"":"none",t||(t=$(this._element).siblings().is(":visible")),f=i.parentNode.childNodes[0];f.tagName!="DIV";)f=f.nextSibling;if(u&&u[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(f,"TabBar")){if(i.getAttribute("data-visibility-controller")==this.get_id()){for(e=-1,r=0;r<i.parentNode.childNodes.length;r++)if(o=i.parentNode.childNodes[r],o.className&&Sys.UI.DomElement.containsCssClass(o,"TabBody")&&e++,i==o)break;if(e!=-1&&(s=f.getElementsByTagName("td"),c=s[e],c.style.display=t?"":"none",!t&&Sys.UI.DomElement.containsCssClass(c,"Selected")))for(v=f.getElementsByTagName("a"),r=0;r<s.length;r++)if($common.getVisible(s[r])){$find(i.parentNode.id+"$ActivatorMenu").select(r,v[r]);break}}}else this.dataAttr(i,"hidden",!t)}else for(u&&u[1]=="SideBarTask"&&this.dataAttr(i,"hidden",!0);i;){if(!String.isNullOrEmpty(this.dataAttr(i,"flow"))){i.style.display=t?"":"none";break}i=i.parentNode}if(l=$get("PageContentSideBar"),l&&u)for(a=l.getElementsByTagName("a"),r=0;r<a.length;r++)if(h=a[r],Sys.UI.DomElement.containsCssClass(h.parentNode,"Task")&&h.innerHTML==u[2]){h.parentNode.style.display=t?"":"none";break}n._loaded&&_body_resize()},loadPage:function(){if(!$app.mobile){var n=this.get_isDisplayed();this._showWait(!n);this.get_mode()==Web.DataViewMode.View&&!this.get_lookupField()&&(this._delayedLoading=!n)?Array.contains($app._delayedLoadingViews,this)||(Array.add($app._delayedLoadingViews,this),$app._startDelayedLoading()):this._source||this._loadPage()}},get_isDisplayed:function(){if(this._hidden)return!1;var t=this.get_element(),n;if(!t)return!1;for(n=t&&t.parentNode;n!=null;){if(n.getAttribute&&n.tagName!="TABLE"&&this.dataAttr(n,"activator")&&!n._activated||n.style&&n.style.display=="none")return!1;n=n.parentNode}return!0},goToPage:function(n,t){this._isBusy||(t&&(this._pageOffset=0),this.set_pageIndex(n),this._loadPage())},sort:function(n){this._isBusy||(this._clearCache(),this.get_sortExpression()==n&&(n=""),this.set_sortExpression(n),this.get_selectedKey().length>0?(this._saveViewVitals(),this._sync()):(this.set_pageIndex(0),this._loadPage()))},groupExpression:function(){var n=this.get_groupExpression();return n?n.trim().split($app._simpleListRegex):null},groupBy:function(){var n=this;$(n.groupExpression()).each(function(){var t=n.findField(this);t&&(t.GroupBy=!0)})},applyFilterByIndex:function(n,t){if(t==-1)this.removeFromFilterByIndex(n);else{var i=this._allFields[n],r=this.findFieldUnderAlias(i);this.applyFilter(i,t>=0?"=":null,t>=0?r._listOfValues[t]:null)}},findFieldUnderAlias:function(n){if(typeof n=="string"&&(n=this.findField(n)),n.Hidden)for(var t=0;t<this._allFields.length;t++)if(this._allFields[t].AliasIndex==n.Index)return this._allFields[t];return n},removeFromFilterByIndex:function(n){n==-1?this.removeQuickFind():(field=this._allFields[n],this.removeFromFilter(field));this.sync()},removeQuickFind:function(){var n=this;$(n._filter).each(function(t){this.match(/^_quickfind_\:\~/)&&n._filter.splice(t,1)})},removeFromFilter:function(n){for(var t=0;t<this._filter.length;t++)if(this._filter[t].match(/^(\w+):/)[1]==n.Name){Array.removeAt(this._filter,t);break}},clearFilter:function(){for(var n,r,i,t=0;t<this._allFields.length;t++)n=this._allFields[t],r=this.findFieldUnderAlias(n),this.filterOf(n)==null||this.filterIsExternal(n.Name)||this.removeFromFilter(n);i=this.get_quickFindElement();i!=null?(i.value="",this.quickFind()):(this.set_quickFindText(null),this._executeQuickFind(null))},beginFilter:function(){this._filtering=!0},endFilter:function(){this._filtering=!1;this.refreshData()},applyFilter:function(n,t,i){var u,r;for(this._clearCache(),this.removeFromFilter(n),t==":"?i&&this._filter.push(n.Name+":"+i):t&&this._filter.push((t=="~"?"_quickfind_":n.Name)+":"+t+this.convertFieldValueToString(n,i)),u=this._filter.length==1&&this._filter[0].match(/(\w+):/)[1]==n.Name,n=this.findFieldUnderAlias(n),r=0;r<this._allFields.length;r++)u&&this._allFields[r].Name==n.Name||(this._allFields[r]._listOfValues=null);this._filtering!=!0&&this._sync()},applyExternalFilter:function(n){var i,r,t;for(n&&this._filter||(this._filter=[]),this._selectedRowIndex=null,i=0;i<this._externalFilter.length;i++){if(r=this._externalFilter[i],n)for(t=0;t<this._filter.length;t++)if(this._filter[t].startsWith(r.Name+":=")){Array.removeAt(this._filter,t);break}Array.add(this._filter,r.Name+":="+r.Value)}},applyFieldFilter:function(n,t,i,r){var u,f,e;if(n==null&&(n=this._filterFieldIndex),t||(t=this._filterFieldFunc),u=this._allFields[n],this.removeFromFilter(u),$(this._allFields).each(function(){this._listOfValues=null}),f=String.format("{0}:",u.Name,u.Type),i&&i[0]==Web.DataViewResources.HeaderFilter.EmptyValue&&(i[0]=String.jsNull),i)if(t=="$between")f+="$between$"+this.convertFieldValueToString(u,i[0])+"$and$"+this.convertFieldValueToString(u,i[1])+'\0';else for(e=0;e<i.length;e++)f+=t+(t.startsWith("$")?"$":"")+this.convertFieldValueToString(u,i[e])+'\0';else f+=t+'$\0';f.indexOf('\0')>0&&Array.add(this._filter,f);r||this.refreshData();this._forgetSelectedRow(!0)},get_fieldFilter:function(n,t){for(var u,i,r=0;r<this._filter.length;r++)if(u=this._filter[r].match(/(\w+):(\*|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*)/),u[1]==n.Name)return t?(i=u[2],i.startsWith("$")?i.substring(0,i.length-1):i):u[4];return null},_createFieldInputExtender:function(n,t,i,r){var u=null;return t.Type.startsWith("DateTime")?(u=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",this.get_id(),n,t.Index,r),button:i.nextSibling},null,null,i),u.set_format(t.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])):t.AllowQBE&&t.Type=="String"&&t.AllowAutoComplete!=!1&&(u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",n,this.get_id(),t.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",this.get_id(),n,t.Index,r),minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:this.get_servicePath(),useContextKey:!0,enableCaching:n!="SearchBar",typeCssClass:n},null,null,i),u._updateClearButton()),u},showFieldFilter:function(t,i,r){var f,u,c,e,o,l,h,s,v,a;for(this._filterExtenders||(this._filterExtenders=[]),f=this._allFields[t],u=this.get_fieldFilter(f),u&&(c=u.match(/^([\s\S]*?)(\0|$)/),c&&(u=c[1])),u=u&&!String.isJavaScriptNull(u)?u.split(n._listRegex):[""],this._filterFieldIndex=t,this._filterFieldFunc=i,e=this._filterElement=document.createElement("div"),e.id=this.get_id()+"$FieldFilter",e.className="FieldFilter",o=new Sys.StringBuilder,l=f.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",o.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}<\/span> <span class="Function">{1}<\/span><\/div><div class="Value"><input type="text" value="{2}"/>{3}<\/div><\/div>',f.HeaderText,r.toLowerCase(),n.htmlAttributeEncode(f.format(this.convertStringToFieldValue(f,u[0]))),l),i=="$between"&&o.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}<\/span><\/div><div class="Value"><input type="text" value="{1}"/>{2}<\/div><\/div>',Web.DataViewResources.Data.Filters.Labels.And,n.htmlAttributeEncode(u[1]?f.format(this.convertStringToFieldValue(f,u[1])):""),l),o.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true);return false">{1}<\/button><button onclick="$find(\'{0}\').closeFieldFilter(false);return false">{2}<\/button><\/div>',this.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton),e.innerHTML=o.toString(),this._appendModalPanel(e),this._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$FilterPopup",PopupControlID:e.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]),h=e.getElementsByTagName("input"),s=0;s<h.length;s++)v=h[s],a=this._createFieldInputExtender("Filter",f,v,s),a&&Array.add(this._filterExtenders,a);this._saveTabIndexes();this._filterPopup.show();Sys.UI.DomElement.setFocus(h[0]);$(e).find("input:text").keydown(function(n){n.which==13&&(n.preventDefault(),$(e).find("button:first").click())})},closeFieldFilter:function(n){var e=this._filterElement.getElementsByTagName("input"),s=[],r,i,t,u,f;if(n)for(r=this._allFields[this._filterFieldIndex],i=0;i<e.length;i++){if(t=e[i],String.isBlank(t.value)){alert(o.RequiredField);Sys.UI.DomElement.setFocus(t);return}if(this._formatSearchField(t,this._filterFieldIndex),u={NewValue:t.value.trim()},f=this._validateFieldValueFormat(r,u),f){alert(f);Sys.UI.DomElement.setFocus(t);return}Array.add(s,r.Type.startsWith("DateTime")?t.value.trim():u.NewValue)}this._disposeFieldFilter();this._restoreTabIndexes();n&&this.applyFieldFilter(null,null,s)},_disposeSearchBarExtenders:function(){if(this._searchBarExtenders){for(var n=0;n<this._searchBarExtenders.length;n++)this._searchBarExtenders[n].dispose();Array.clear(this._searchBarExtenders)}},_disposeFieldFilter:function(){if(this._filterExtenders){for(var n=0;n<this._filterExtenders.length;n++)this._filterExtenders[n].dispose();Array.clear(this._filterExtenders)}this._filterElement&&(this._filterPopup.hide(),this._filterPopup.dispose(),this._filterPopup=null,this._filterElement.parentNode.removeChild(this._filterElement),delete this._filterElement)},_showSearchBarFilter:function(n,t){if(this._searchBarVisibleIndex=t,n==-1){var i=this._get("$SearchBarValue$",t);i.value="";this._searchBarFuncChanged(t);this._searchBarVisibleIndex=null}else this.showCustomFilter(n)},_appendModalPanel:function(n){var t=this.get_element();t&&t.appendChild(n)},showCustomFilter:function(t){var u=this._allFields[t],r=this._customFilterPanel=document.createElement("div"),i,f;this._appendModalPanel(r);r.className="CustomFilterDialog";r.id=this.get_id()+"_CustomFilterPanel";i=new Sys.StringBuilder;i.appendFormat('<div><span class="Highlight">{0}<\/span> {1}:<\/div>',n.htmlEncode(u.Label),Web.DataViewResources.Data.Filters.Labels.Includes);i.append('<table cellpadding="0" cellspacing="0">');i.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}<\/div><\/td><\/tr>',this.get_id(),t,Web.DataViewResources.Common.WaitHtml);i.appendFormat('<tr><td><\/td><td align="right"><button id="{0}Ok">{1}<\/button> <button id="{0}Cancel">{2}<\/button><\/td><\/tr>',this.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);i.append("<\/table>");r.innerHTML=i.toString();i.clear();this._customFilterField=u;this._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:this.get_id()+"Ok",CancelControlID:this.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',this.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',this.get_id()),PopupControlID:r.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",this._bodyKeydownHandler);f=this.findFieldUnderAlias(u);this._loadFilterListOfValues(u.Name)},_loadFilterListOfValues:function(n){this._busy(!0);var t=this.get_lookupContext();this._invoke("GetListOfValues",this._createArgsForListOfValues(n),Function.createDelegate(this,this._onGetFilterListOfValuesComplete),{fieldName:n})},_renderFilterOption:function(n,t,i,r,u){var f=this._findItemByValue(t,i);f&&(i=f[1]);n.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/><\/td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}<\/label><\/td><\/tr>',this.get_id(),t.Index,r,i,u?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(t,i){var f,h,v,c,r,o,e,l,u,s,b,d;if(this._busy(!1),f=this.findField(i.fieldName),t[t.length-1]==null&&(Array.insert(t,0,t[t.length-1]),Array.removeAt(t,t.length-1)),h=this._get("$CustomFilterItemList$",f.Index),h){for(v=this._searchBarVisibleIndex!=null?this._createSearchBarFilter(!0):this._filter,c=null,this.findFieldUnderAlias(f)._listOfValues=t,r=0;r<v.length;r++)if(o=v[r].match(n._fieldFilterRegex),o[1]==f.Name){c=o[2];break}if(e=null,l="$in$",c&&(o=c.match(n._filterRegex),o))for(o[1].match(/\$(in|notin|between)\$/)?(l=o[1],e=o[3].split(n._listRegex)):e=[o[3]],r=0;r<e.length;r++)u=e[r],String.isJavaScriptNull(u)?e[r]=Web.DataViewResources.HeaderFilter.EmptyValue:(u=this.convertStringToFieldValue(f,u),e[r]=f.format(u));s=new Sys.StringBuilder;s.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/><\/td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}<\/label><\/td><\/tr>',this.get_id(),f.Index,Web.DataViewResources.Data.Filters.Labels.SelectAll);var y=[],a=[],k=[],p=[],w=this.findFieldUnderAlias(f);for(r=0;r<t.length;r++)u=t[r],b=u,u==null?u=Web.DataViewResources.HeaderFilter.EmptyValue:(u=n.htmlEncode(f.format(u)),u==""&&(u=Web.DataViewResources.HeaderFilter.BlankValue)),d=e&&(l=="$in$"&&Array.contains(e,u)||l=="$notin$"&&!Array.contains(e,u)),d?(Array.add(a,u),Array.add(y,b)):(Array.add(p,u),Array.add(k,b));for(r=0;r<a.length;r++)this._renderFilterOption(s,f,a[r],r,!0);for(r=0;r<p.length;r++)this._renderFilterOption(s,f,p[r],r+a.length,!1);s.append("<\/table>");h.innerHTML=s.toString();Sys.UI.DomElement.setFocus(h.getElementsByTagName("input")[0]);y.length>0&&(w._listOfValues=[],Array.addRange(w._listOfValues,y),Array.addRange(w._listOfValues,k))}},_selectAllFilterItems:function(n){for(var r=this._get("$CustomFilterItemList$",n),t=r.getElementsByTagName("input"),i=1;i<t.length;i++)t[i].checked=t[0].checked},applyCustomFilter:function(){var r=this._customFilterField,u=this._searchBarVisibleIndex!=null?this._get("$SearchBarValue$",this._searchBarVisibleIndex):null,s=u?this._get("$SearchBarFunction$",this._searchBarVisibleIndex):null,t,o;this.removeFromFilter(r);var n=null,h=this._get("$CustomFilterItemList$",r.Index),i=h.getElementsByTagName("input"),e=this.findFieldUnderAlias(r),f=0;for(t=1;t<i.length;t++)i[t].checked&&(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]),f++);if(n&&(f<=10||f!=i.length-1))if(f<=10||f<=(i.length-1)/2)u?s.value="$in,true":Array.add(this._filter,String.format('{0}:$in${1}\0',this._customFilterField.Name,n));else{for(n=null,t=1;t<i.length;t++)i[t].checked||(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]));u?s.value="$notin,true":Array.add(this._filter,String.format('{0}:$notin${1}\0',this._customFilterField.Name,n))}else n=null;for(t=0;t<this._allFields.length;t++)o=this._allFields[t],o!=e&&(o._listOfValues=null);u?(u.value=n?n:"",this._searchBarFuncChanged(this._searchBarVisibleIndex)):(this._forceSync(),this.refreshData());this.closeCustomFilter()},closeCustomFilter:function(){this._customFilterModalPopupBehavior&&(this._customFilterModalPopupBehavior.dispose(),this._customFilterModalPopupBehavior=null,this._customFilterField=null);this._customFilterPanel&&(this._customFilterPanel.parentNode.removeChild(this._customFilterPanel),delete this._customFilterPanel);$removeHandler(document.body,"keydown",this._bodyKeydownHandler);this._customFilterField=null;this._searchBarVisibleIndex=null},convertFieldValueToString:function(t,i){return typeof i=="string"&&(i.match(n._listRegex)||i.startsWith("%js%"))?i:(t.Type!="String"&&i!=null&&typeof i=="string"&&(i=this.convertStringToFieldValue2(t,i)),Date.isInstanceOfType(i)&&(i=n.stringifyDate(i,t)),String.format("%js%{0}",e.serialize(i)))},convertFieldValueToString2:function(n,t){return n.Type.startsWith("DateTime")&&!String.isNullOrEmpty(n.DataFormatString)?t==null?null:String.localeFormat(n.DataFormatString,t):n.Type=="Boolean"?t==null?null:t.toString():t.toString()},convertStringToFieldValue:function(t,i){return typeof i!="string"?i:i!=null&&i.startsWith("%js%")?(i=e.deserialize(i.substring(4)),n.isISO8601DateString(i)&&(i=new Date(i)),i):this.convertStringToFieldValue2(t,i)},convertStringToFieldValue2:function(n,t){var i,r;if(t==null)return t;switch(n.Type){case"DateTime":if(i=n.DataFormatString&&n.DataFormatString.length?Date.parseLocale(t,n.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(t),!isNaN(i)&&i!=null)return i;break;case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":if(r=Number.parseLocale(t),!isNaN(r))return r}return t},goToView:function(n){var o,s,r,t,u,f,e;if(!n&&this._doneCallback){this._doneCallback(this);return}if(!String.isNullOrEmpty(this._replaceTriggerViewId)&&this._replaceTriggerViewId==n){this._skipTriggeredView&&(this._skipTriggeredView=!1);location.replace(location.href);return}if(o=this._ditto&&this._ditto.slice(0),this._clearCache(!0),this._ditto=o,s=this.get_filter(),r=this.get_view().Group,n=="form")for(t=0;t<this.get_views().length;t++)if(this.get_views()[t].Type=="Form"){n=this.get_views()[t].Id;break}this._disposePendingUploads();this._detachBehaviors();this.get_isForm()||(this._lastViewId=this.get_viewId(),this._selectedRowIndex=0);var c=this.get_view().Id,i=c!=n,h,l=this.extension();i&&(this._focusedFieldName=null,h=this.get_isForm(),this.get_isGrid()||this.writeContext("vitals",null));this.set_viewId(n);u=this.get_view();u.Type!="Form"&&(this._lastViewId=n,this._restorePosition(),i&&h&&$app.mobile&&l._dispose(!0));this.set_pageIndex(-1);f=u.Type=="Form"?this.get_selectedKeyFilter():!String.isNullOrEmpty(r)&&this.get_view().Group==r||!i?s:[];this._requestedFilter&&(f=this._requestedFilter,this._requestedFilter=null);e=i?null:this.get_sortExpression();this._requestedSortExpression&&(e=this._requestedSortExpression,this._requestedSortExpression=null);this.set_filter(f);this.set_sortExpression(e);this._loadPage();this._raiseSelectedDelayed=!0;i&&(this._scrollIntoView=!0,this._focusedCell=null)},filterOf:function(n){for(var i,r=(String.isNullOrEmpty(n.AliasName)?n.Name:n.AliasName)+":",t=0;t<this._filter.length;t++)if(i=this._filter[t],i.startsWith(r)&&!i.match(":~"))return this._filter[t].substr(r.length);return null},findField:function(n){return this._mapOfAllFields[n]},findCategory:function(n){for(var i,t=0;t<this._categories.length;t++)if(i=this._categories[t],i.Id==n)return i;return null},_isInInstantDetailsMode:function(){return location.href.match(n.DetailsRegex)},_closeInstantDetails:function(){return this._isInInstantDetailsMode()&&Web.DataViewResources.Lookup.ShowDetailsInPopup?(close(),!0):!1},_confirm:function(t,i){var p=/(_(\w+))\s*=\s*(.+?)(\s*\r|;|\n|$)/gi,e=t.action.Confirmation,s=!0,h=p.exec(e),r,u,o,f,l,c;if(!h||__tf!=4)e=this._parseText(e,this.get_currentRow()),i?i(e):confirm(e)||(s=!1);else{for(var a=null,v=null,w="",y="New",b="";h;)r=h[2],u=h[3],r=="survey"&&(a=u),r=="controller"&&(v=u),r=="view"&&(w=u),r=="commandName"&&(y=y),r=="commandArgument"&&(b=u),r=="width"&&(t.MaxWidth=u),r=="title"&&(t.WindowTitle=u),h=p.exec(e);if(o=this.get_isModal()?null:n.find(v,"Controller"),o&&!o.get_isModal())f=o._collectFieldValues(),s=o._validateFieldValues(f,!0),s&&(this._convertValuesToParameters(f),this._paramValues=f);else{f=this._collectFieldValues();var k=t.Values=[],d=this.get_servicePath(),g=this.get_baseUrl();for(l=0;l<f.length;l++)c=f[l],Array.add(k,{Name:"Context_"+c.Name,Value:c.Modified?c.NewValue:c.OldValue});a?n.survey("show",{controller:a,parent:this._id,confirmContext:t}):o=n.showModal(this,v,w,y,b,g,d,[],{confirmContext:t,showSearchBar:this.get_showSearchBar()});s=!1}}return s},executeAction:function(t,i,r,u,f,e){var h,o,s;if(!this._isBusy){if(n.hideMessage(),!e){if(h=this.get_lookupField()!=null,o=h&&this._lookupActionProcessing()?null:t=="ActionBar"?this.get_actionGroups(t)[u].Actions:this.get_actions(t),i<0&&o){for(s=0;s<o.length;s++)if(this._isActionAvailable(o[s],r)){i=s;break}if(i<0)return}e=o?o[i]:null}if(!e||String.isNullOrEmpty(e.Confirmation)||(!this.get_isGrid()||this.get_isDataSheet()||this.get_lastCommandName()=="BatchEdit"||h||this.executeRowCommand(r,"Select"),f||this._confirm({action:e,scope:t,actionIndex:i,rowIndex:r,groupIndex:u}))){var c=e?e.CommandName:"Select",l=e?e.CommandArgument:null,a=e?e.CausesValidation:!0,v=e?e.Path:null;this.executeRowCommand(r,c,l,a,v)}}},delegateCommand:function(t,i){var u=this,e=n.touch,o=u.get_isForm(),r,f;return e&&(t.match(/New/)||t.match(/Select|Edit/)&&i&&u._viewId!=i)&&o&&(f=u._parentDataViewId,f?(r=$app.find(f),r.get_isForm()&&(r=u)):r=u,r&&u._controller==r._controller?e.pageInfo(u).deleted=!0:r=null),r},executeRowCommand:function(t,i,r,u,f){var e=this,s,o,h,c;if(s=e.delegateCommand(i,r),s&&s!=e)s.executeRowCommand(t,i,r,u,f);else{if(o=e.extension(),t!=null&&t>=0&&(e._selectedRowIndex=t,e._raiseSelectedDelayed=!(i=="Select"&&String.isNullOrEmpty(r)),o&&(e._selectedRow=e._rows[t]),e._selectKeyByRowIndex(t)),h={commandName:i,commandArgument:r?r:"",path:f,causesValidation:u?!0:!1},!$app.mobile&&e.get_isDataSheet()&&i.match(/Select|New|Edit|Duplicate/)&&e._rows.length>0&&(o==null||n.Extensions.active(o)?e._get_focusedCell()||e._startInputListenerOnCell(0,0):n.Extensions.active(o,!0)),!e.executeCommand(h))return;i=="ClientScript"?e._raiseSelectedDelayed||(c=e,setTimeout(function(){c.refresh(!0)},10)):i!="Select"||r!=null||e.get_isGrid()||e._render()}},rowCommand:function(t,i,r,u,f){var o,e,s;(this._raiseSelectedDelayed=!(i=="Select"&&String.isNullOrEmpty(r)),this._selectKeyByRow(t),o={commandName:i,commandArgument:r?r:"",path:f,causesValidation:u?!0:!1},this.get_isDataSheet()&&i.match(/Select|New|Edit|Duplicate/)&&(e=this.extension(),e==null||n.Extensions.active(e)||n.Extensions.active(e,!0)),this.executeCommand(o))&&(i=="ClientScript"?this._raiseSelectedDelayed||(s=this,setTimeout(function(){s.refresh(!0)},10)):i!="Select"||r!=null||this.get_isGrid()||this._render())},_get_dataRequestForm:function(){var n=$get("_dataRequest_form");return n||(n=document.createElement("form"),n.id="_dataRequest_form",n.method="post",n.innerHTML='<input type="hidden" name="q" id="q"/><input type="hidden" name="aa" id="aa"/><input type="hidden" name="c" id="c"/><input type="hidden" name="a" id="a"/>',document.body.appendChild(n)),n},_applySelectionFilter:function(n){this.multiSelect()&&this._selectedKeyList.length>0&&this._keyFields.length==1&&(n.Filter=Array.clone(n.Filter),Array.add(n.Filter,String.format("{0}:$in${1}",this._keyFields[0].Name,this._selectedKeyList.join("$or$"))))},get_appRootPath:function(){var n=this.get_servicePath();return typeof __cothost!="undefined"&&(__cothost=="DotNetNuke"&&n.match(/DesktopModules\//i)||__cothost=="SharePoint"&&n.match(/_layouts\//i))?n.replace(/Service\.asmx$/i,""):"~/"},executeReport:function(t){var i,r,f,h,o,s,a,c,u,l;if(this._cancelConfirmation(),i=this._createParams(!0),i.Controller=this.get_controller(),i.View=this.get_viewId(),r=this._get_dataRequestForm(),r.target="",r.action=this.resolveClientUrl(this.get_appRootPath()+"Report.ashx"),$get("c",r).value=t.commandName,f=t.commandArgument,String.isNullOrEmpty(f)||(f.startsWith("_")&&(r.target=f),h=f.split(n._simpleListRegex),f=h[0],h.length==3&&(i.Controller=h[1],i.View=h[2])),$get("a",r).value=f,i.Filter.length>0&&this.get_viewType()!="Form"){if(o=new Sys.StringBuilder,this.useCase("$app"))o.append(this._filterDetailsText);else if(this._renderFilterDetails(o,i.Filter),s=this.get_master(),s)for(a=s.get_selectedRow(),c=0;c<s._allFields.length;c++)u=s._allFields[c],u.ShowInSummary&&!u.OnDemand&&(u=s._allFields[u.AliasIndex],o.isEmpty()||o.append(" "),o.appendFormat("{0} {1} {2}.",u.HeaderText,Web.DataViewResources.Data.Filters.Labels.Equals,u.format(a[u.Index])));i.FilterDetails=o.toString()}this._viewMessages&&(i.FilterDetails=String.format("{0} {1}",this._viewMessages[this.get_viewId()],i.FilterDetails));i.FilterDetails&&(i.FilterDetails=i.FilterDetails.replace(/(<b class=\"String\">([\s\S]*?)<\/b>)/g,'"$2"').replace(/(&amp;)/g,"&").replace(/(<.+?>)|&nbsp;/g,""));i.FilterDetails&&$app.touch&&(i.filterDetails=this.extension().filterStatus());this._applySelectionFilter(i);$get("q",r).value=e.serialize(i);l=this._createArguments(t);this._validateFieldValues(l.Values,!0);l.ExternalFilter=i.ExternalFilter;$get("aa",r).value=n.htmlEncode(e.serialize(l));this._showDownloadProgress();r.submit()},_showDownloadProgress:function(){var n,t,i;$app.isSaaS()||(this._busy(!0),n=this,t="APPFACTORYDOWNLOADTOKEN",document.cookie=String.format("{0}={1}; path=/",t,encodeURIComponent(this.get_id())),i=setInterval(function(){var u,r,f,e,o;if(!String.isNullOrEmpty(document.cookie))for(u=document.cookie.split(";"),r=0;r<u.length;r++)f=u[r].trim(),f.startsWith(t)&&(e=f.substring(t.length+1).split(","),(e.length==2&&e[0]==n.get_id()||n._stopWaiting)&&(n._stopWaiting=!1,document.cookie=String.format("{0}=; expires={1}; path=/",t,new Date(0).toUTCString()),n._busy(!1),clearInterval(i),o=n._pendingExecuteComplete,n._pendingExecuteComplete&&(n._pendingExecuteComplete=null,n._onExecuteComplete(o.result,o.context))))},500))},executeExport:function(n){var t=this._get_dataRequestForm(),i;t.target=n.commandName=="ExportRss"?"_blank":"";t.action=this.resolveClientUrl(this.get_appRootPath()+"Export.ashx");i=this._createParams(!0);this._applySelectionFilter(i);n.Controller=this.get_controller();n.View=this.get_viewId();n.Filter=i.Filter;n.SortExpression=i.SortExpression;$get("c",t).value=n.commandName;$get("a",t).value=n.commandArgument;$get("q",t).value=e.serialize(n);t.submit()},_clearDynamicItems:function(){for(var t,n=0;n<this._allFields.length;n++)t=this._allFields[n],t.DynamicItems&&(t.DynamicItems=null,t.ItemCache=null)},_copyLookupValues:function(t,i,r,u){var o=u||[],f,s,e;if(i.Copy)while(f=n._fieldMapRegex.exec(i.Copy))if(i._dataView.findField(f[1]))if(f[2]=="null")Array.add(o,{name:f[1],value:null});else if(t)s=this.findField(f[2]),s&&Array.add(o,{name:f[1],value:t[s.Index]});else if(r)for(e=0;e<r.length;e++)if(r[e].Name==f[2]){Array.add(o,{name:f[1],value:r[e].NewValue});break}u||(i._dataView._skipFocus=!0,i._dataView.refresh(!0,o),i._dataView._focus(),i._dataView._skipFocus=!1)},_copyExternalLookupValues:function(){var n,r,u,t,i;if(this.get_filterSource()&&this.get_filterSource()!="Context"&&(n=this.get_master(),n)){for(r=[],u=this.get_externalFilter(),t=0;t<u.length;t++)i=this.findField(u[t].Name),i&&!String.isNullOrEmpty(i.Copy)&&n._copyLookupValues(n.get_currentRow(),i,null,r);this._ditto=r}},_processSelectedLookupValues:function(){var i=[],u=[],f=this.get_lookupField(),o=this.findField(f.ItemsDataValueField),e=this.findField(f.ItemsDataTextField),r=this.get_selectedRow(),n,t;if(o)Array.add(i,r[o.Index]);else for(n=0;n<this._allFields.length;n++)this._allFields[n].IsPrimaryKey&&Array.add(i,r[this._allFields[n].Index]);if(e)Array.add(u,e.format(r[e.Index]));else{for(n=0;n<this.get_fields().length;n++)if(t=this.get_fields()[n],!t.Hidden&&t.Type=="String"){Array.add(u,t.format(r[t.AliasIndex]));break}if(u.length==0)for(n=0;n<i.length;n++)if(t=this.get_fields()[n],!t.Hidden){Array.add(u,t.format(r[t.AliasIndex]));break}}this._copyLookupValues(r,f);f._dataView.changeLookupValue(f.Index,i.length==1?i[0]:i,u.join(";"))},_showModal:function(t){this.set_lastCommandName(null);this.set_lastCommandArgument(null);this._render();t.commandName=="Duplicate"&&(t.commandName="New");var i=n.showModal(this,this.get_controller(),t.commandArgument,t.commandName,t.commandArgument,this.get_baseUrl(),this.get_servicePath(),this.get_hasParent()||this._lookupInfo?this._externalFilter:null,{filter:this.get_selectedKeyFilter(),ditto:this.get_ditto(),lastViewId:this.get_lastViewId(),transaction:this.get_transaction(),filterSource:this.get_filterSource(),filterFields:this.get_filterFields(),showSearchBar:this.get_showSearchBar(),tag:this.get_tag(),showActionButtons:this.get_showActionButtons()});this.set_ditto(null);this._savePosition();i&&!i.inserting()&&(i._position=this._position);this._restorePosition()},_savePosition:function(){this.get_isForm()||this._selectedRowIndex==null||(this._position={index:this._pageSize*this._pageIndex+this._selectedRowIndex,count:this._totalRowCount,filter:this.get_filter(),sortExpression:this.get_sortExpression(),key:Array.clone(this._selectedKey),keyFilter:this._selectedKeyFilter,active:!1})},_restorePosition:function(){this._position&&(this._selectedKey=this._position.key,this._selectedKeyFilter=this._position.keyFilter,this._position=null)},_advance:function(n){this._isBusy||!this._position||n==-1&this._position.index==0||n==1&&this._position.index==this._position.count-1||(this._position.index+=n,this._position.changing=!0,this._position.changed=!0,this._loadPage(),this._position.changing=!1)},cancel:function(){if(this._cancelCallback)this._cancelCallback(this);else if(!this._closeInstantDetails()){if(this.endModalState("Cancel"))return;this.get_backOnCancel()||!String.isNullOrEmpty(this._replaceTriggerViewId)?(this.goBack(!1),setTimeout(function(){location.replace(location.href)},500)):(this.set_lastCommandName("Cancel"),this._pendingSelectedEvent=!0,this.get_isForm()||this.inserting()?(this._forceSync(),this.goToView(this._lastViewId)):this._totalRowCount<0?this.goToPage(-1):(this._clearDynamicItems(),this._render(),_body_performResize()))}},_convertValuesToParameters:function(n){for(var i=0,t;i<n.length;)t=n[i],t.ReadOnly=!0,t.Name.match("PrimaryKey")?Array.removeAt(n,i):(t.Name="Parameters_"+t.Name,i++)},_actionConfirmed:function(n){var t=this,u=t._createArguments(n),e=t._validateFieldValues(u.Values,n.causesValidation==null||n.causesValidation),i,r,f;e&&(i=t.get_confirmContext(),r=t.get_parentDataView(),i&&r?(f=r._paramValues=u.Values,t._convertValuesToParameters(f),r._confirmDataViewId=t.get_id(),r._lookupActionProcessing(!1),r.executeAction(i.scope,i.actionIndex,i.rowIndex,i.groupIndex,!0,i.action),r._lookupActionProcessing(!0)):t._survey&&t.cancel())},executeCommand:function(t){var l,a,v,o,f,k,nt,c,y,w;if(!this._isBusy){var e=new Web.BusinessRules(this),b=$app.mobile,u=t.commandName,r=t.commandArgument;if(e.before(t),e.canceled())return e.dispose(),this._valid=u=="Calculate",this._valid;switch(u){case"Select":case"":this.set_lastCommandName(u);this.set_lastCommandArgument(r);this.get_lookupField()&&r==""?this._processSelectedLookupValues():(String.isBlank(r)?this._render():(this._savePosition(),this.get_showModalForms()&&this.get_isForm(r)?this._showModal(t):this.goToView(r)),__designer()&&__designer_notifySelected(this));break;case"BatchEdit":this.batchEdit(r);break;case"Edit":case"New":case"Duplicate":if(b||(this._allowModalAutoSize(),this._fixHeightOfRow(!1),u=="Edit"?this._savePosition():this._restorePosition()),u=="Duplicate"&&(l=this.get_selectedRow(),l)){for(a=[],i=0;i<this._allFields.length;i++)v=this._allFields[i],Array.add(a,{name:v.Name,value:l[v.Index],duplicated:!0});this._ditto=a}o=this._get_focusedCell();f=this.extension();(u=="New"||u=="Duplicate")&&(String.isNullOrEmpty(r)&&(r=t.commandArgument=this.get_viewId()),f&&f.clearSelection?f.clearSelection(!0):this._forgetSelectedRow(!1,o),u=="New"&&this._copyExternalLookupValues());k=u=="Edit"&&r==this.get_viewId()&&!this.editing();this.set_lastCommandName(u);this.set_lastCommandArgument(r);this._clearDynamicItems();String.isBlank(r)||k?f&&f.stateChanged?f.stateChanged():(this.get_isModal()&&(this._container.style.height=""),this.get_isDataSheet()&&!this._pendingChars&&this._startInputListenerOnCell(this._selectedRowIndex,o==null?0:o.colIndex),this._render()):b||this.get_showModalForms()&&this.get_isForm(r)&&!this.get_isModal()?this._showModal(t):this.goToView(r);__designer()&&__designer_notifySelected(this);break;case"Navigate":this.navigate(r);break;case"Cancel":this.cancel();break;case"Confirm":this._actionConfirmed(t);break;case"Back":history.go(String.isNullOrEmpty(r)?-1:s(r));break;case"Report":case"ReportAsPdf":case"ReportAsImage":case"ReportAsExcel":case"ReportAsWord":this.executeReport(t);break;case"ExportCsv":case"ExportRowset":case"ExportRss":this.executeExport(t);break;case"_ViewDetails":this._viewDetails(r);break;case"ClientScript":p();eval(r);break;case"SelectModal":case"EditModal":this.set_lastCommandName(null);this.set_lastCommandArgument(null);this._render();var tt=u.match(/^(\w+)Modal$/),h=r.split(","),it=h.length==1?this.get_controller():h[0],d=h.length==1?r:h[1],g=[];for(i=0;i<this.get_selectedKey().length;i++)Array.add(g,{Name:this._keyFields[i].Name,Value:this.get_selectedKey()[i]});nt=n.showModal(this,it,d,tt[1],d,this.get_baseUrl(),this.get_servicePath(),g);nt._parentDataViewId=this.get_id();break;case"Import":this._showImport(r);break;case"DataSheet":this.writeContext("GridType","DataSheet");this._forceFocusDataSheet=!0;this.changeViewType("DataSheet");this.refreshAndResize();break;case"Grid":this.writeContext("GridType","Grid");this.changeViewType("Grid");this.refreshAndResize();break;case"Status":this._changeStatus(t);break;case"Search":this._executeSearch(t.path);break;case"None":return!0;default:c=null;y=r.match(/^view:(.+)$/);u=="Insert"&&y&&(c=y[1],Array.clear(this._selectedKey),this.updateSummary(),this.set_lastCommandName("New"),this.set_lastCommandArgument(c));w=this._createArguments(t,c);this._valid=this._validateFieldValues(w.Values,t.causesValidation==null||t.causesValidation);this._valid&&this._execute(w)}return e.after(t),e.dispose(),!e.canceled()}},_forgetSelectedRow:function(n,t){t||(t=this._get_focusedCell());this.get_isDataSheet()&&t&&(t.colIndex=0);this._lastSelectedRowIndex=!this._ignoreSelectedKey&&this._selectedKey.length>0&&this._rowIsSelected(this._selectedRowIndex)?this._selectedRowIndex:-1;this._ignoreSelectedKey=!1;Array.clear(this._selectedKey);this.updateSummary();n&&this.raiseSelected()},_changeStatus:function(n){var r,i,t,u;(!n.causesValidation||(r=this._collectFieldValues(),n.values&&(r=Array.clone(n.values)),this._validateFieldValues(r,!0)))&&(i=this.findField("Status"),i)&&(this.editing()?(t=this._get("_Item",i.Index),t||(t=document.createElement("input"),t.type="hidden",t.id=String.format("{0}_Item{1}",this._id,i.Index),this._container.appendChild(t)),t.value=n.commandArgument):(u=this.get_selectedRow(),u[i.Index]=n.commandArgument),this._updateVisibility())},_notifyDesigner:function(n){if(__designer()&&n){var t=this._lastArgs;external.ExplorerNodeChanged(this.get_controller(),this.get_viewId(),t.CommandName,t.CommandArgument,e.serialize(t.Values))}},goBack:function(t){n._navigated=!0;this._notifyDesigner(t);var i=location;i.href.match(/_explorerNode=/)?i.replace(i.href):history.go(-1)},_viewDetails:function(t){var i=this.findField(t),e,r,o,u,f,s;if(i){if(e=i.Name,i.ItemsDataController==this.get_controller())for(r=0;r<this._allFields.length;r++)if(this._allFields[r].IsPrimaryKey){e=this._allFields[r].Name;break}if(o=this.get_contextFilter(i),__designer()){for(u=String.format("{0}&{1}={2}",i.ItemsDataController,String.isNullOrEmpty(i.ItemsDataValueField)?e:i.ItemsDataValueField,this.get_selectedRow()[i.Index]),r=0;r<o.length;r++)f=o[r],u=String.format("{0}&{1}={2}",u,f.Name,f.Value);u=this.resolveClientUrl(String.format("~/Details.{0}?l={1}",__designer()?"htm":"aspx",encodeURIComponent(u)));location.href=u;n._navigated=!1}else f=[{Name:String.isNullOrEmpty(i.ItemsDataValueField)?e:i.ItemsDataValueField,Value:this.fieldValue(i.Name)}],Array.addRange(f,o),s=$app.showModal(this,i.ItemsDataController,"editForm1","Select","editForm1",this.get_baseUrl(),this.get_servicePath(),f,{useCase:"ObjectRef"}),s.set_showSearchBar(this.get_showSearchBar()),s._parentDataViewId=this.get_id(),s._closeViewDetails=!0}},changeViewType:function(n){this.cancelDataSheet();this._viewTypes||(this._viewTypes=[]);this._viewTypes[this.get_viewId()]=n;this._clearCache()},_parseLocation:function(n,t,i){var e,o,l,h;if(t||(t=this.get_selectedRow()),!n)return null;n=this.resolveClientUrl(n);for(var c=/([\s\S]*?)\{(\w+)?\}/g,u="",f=-1,r=c.exec(n);r;){if(u+=r[1],i&&this._lastArgs){for(e=0;e<i.length;e++)if(o=i[e],o.Name==r[2]){u+=this._lastArgs.CommandName.match(/Insert/i)?o.NewValue:o.OldValue;break}}else l=r[2].match(/^\d+$/)?this.get_fields()[s(r[2])]:this.findField(r[2]),l&&(h=t[l.Index],h!=null&&(u+=r.index==0?h:encodeURIComponent(h)));f=c.lastIndex;r=c.exec(n)}return f!=-1&&(n=u+(f<n.length?n.substr(f):"")),n.startsWith("?")&&(n=location.pathname+n),n},_parseText:function(n,t){var f,r;if(t||(t=this.get_selectedRow()),!n)return null;for(var e=/([\s\S]*?)\{(\w+)?\}/g,o="",u=-1,i=e.exec(n);i;)o+=i[1],f=i[2].match(/^\d+$/)?this.get_fields()[s(i[2])]:this.findField(i[2]),f&&(r=t[f.Index],r!=null&&(r=f.format(r),o+=r)),u=e.lastIndex,i=e.exec(n);return u!=-1&&(n=o+(u<n.length?n.substr(u):"")),n},_showImport:function(n){n||(n=this.get_viewId());this._importView=n;this._importElement=document.createElement("div");this._importElement.id=this.get_id()+"$Import";this._importElement.className="Import";var t=new Sys.StringBuilder,i=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}<\/a>",this.get_id(),n,Web.DataViewResources.Data.Import.DownloadTemplate);t.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}<\/span> {2}<\/div>',this.get_id(),Web.DataViewResources.Data.Import.UploadInstruction,i);t.appendFormat('<div id="{0}$ImportMap" class="Map" style="display:none"><\/div>',this.get_id());t.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"><\/iframe>',this.get_id(),this.resolveClientUrl(this.get_appRootPath()+"Import.ashx"),this.get_controller(),n);t.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/><\/div>',this.get_id(),Web.DataViewResources.Data.Import.Email);t.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false" style="display:none">{1}<\/button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false">{2}<\/button><\/div>',this.get_id(),Web.DataViewResources.Data.Import.StartButton,Web.DataViewResources.ModalPopup.CancelButton);this._importElement.innerHTML=t.toLocaleString();this._appendModalPanel(this._importElement);this._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$ImportPopup",PopupControlID:this._importElement.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._saveTabIndexes();this._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){this._importElement&&(this._importPopup.hide(),this._importPopup.dispose(),this._importPopup=null,this._importElement.parentNode.removeChild(this._importElement),delete this._importElement)},_disposePendingUploads:function(){$(this._pendingUploads).each(function(){this.files=null;this.form=null});this._pendingUploads=null;$(this._container).find(".app-drop-box").each(function(){$app.upload("destroy",{container:this})})},_downloadImportTemplate:function(n){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),n)})},_initImportUpload:function(n){var t=n.createElement("div");t.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/><\/form>',this.get_id());n.body.appendChild(t);Sys.UI.DomElement.setFocus(n.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(n){var t=n.split(/\\/);this._importFileName=t[t.length-1];Sys.UI.DomElement.setVisible(this._get_importFrame(),!1);$(this._get_importStatus()).addClass("Wait");this._get_importStatus().innerHTML=Web.DataViewResources.Data.Import.Uploading},_finishImportUpload:function(t){var s,c,i,r,l,f,e,o,v,a;if(Sys.UI.DomElement.removeCssClass(this._get_importStatus(),"Wait"),Sys.UI.DomElement.addCssClass(this._get_importStatus(),"Ready"),s=t.getElementById("Errors"),s)this._get_importStatus().innerHTML=s.value;else{var p=t.getElementById("FileName"),y=t.getElementById("NumberOfRecords"),u=t.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),h=t.getElementById("FieldMap").value.trim().split(/\r?\n/);for(this._get_importStatus().innerHTML=String.format(Web.DataViewResources.Data.Import.MappingInstruction,y.value,this._importFileName),this._importFileName=t.getElementById("FileName").value,c=$get(this.get_id()+"$StartImport"),Sys.UI.DomElement.setVisible(c,!0),Sys.UI.DomElement.setFocus(c),i=new Sys.StringBuilder,i.append("<table>"),r=0;r<h.length;r++){for(l=h[r].match(/^(.+?)=(.+?)?$/),i.appendFormat('<tr><td>{2}<\/td><td><select id="{0}$ImportField{1}"><option value="">{3}<\/option>',this.get_id(),r,n.htmlEncode(l[1]),Web.DataViewResources.Data.Import.AutoDetect),f=0;f<u.length;f++)e=u[f].split("="),e[0]==l[2]&&(i.appendFormat('<option value="{0}"',e[0]),i.append(' selected="selected"'),i.appendFormat(">{0}<\/option>",n.htmlEncode(e[1])));i.append("<\/select><\/td><\/tr>")}i.append("<\/table>");o=$get(this.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(o,!0);o.innerHTML=i.toString();v=$(o).find("select").change(function(){a()});a=function(){var i=Array.clone(h),t=[],n=0;v.each(function(){$(this).css("width","auto");this.value!=""&&Array.add(t,this.value)}).each(function(){var r=this,n,i;for($(r).find("option").filter(function(){return r.value!=this.value&&this.value!=""}).remove(),n=0;n<u.length;n++)i=u[n].split("="),Array.contains(t,i[0])||$(this).append($("<option>",{value:i[0]}).text(i[1]))}).each(function(){var t=$(this).outerWidth();t>n&&(n=t)}).css("width",n)};a()}this._importPopup.show();this._get_importFrame().parentNode.removeChild(this._get_importFrame())},_startImportProcessing:function(){var r=$get(this.get_id()+"$ImportEmail"),u=r.value.replace(/;/g,","),n,t,i;if(String.isBlank(u)&&!confirm(Web.DataViewResources.Data.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(r);return}for(n=new Sys.StringBuilder,n.appendFormat("{0};{1};{2};{3};",this._importFileName,this.get_controller(),this._importView,u),t=0;;){if(i=$get(this.get_id()+"$ImportField"+t),!i)break;n.append(i.value);n.append(";");t++}this.executeCommand({commandName:"ProcessImportFile",commandArgument:n.toString()});this._closeImport();alert(Web.DataViewResources.Data.Import.Processing);this.refresh()},navigate:function(n,t){var r,i;for(this.set_selectedValue(this.get_selectedKey()),p(),n=this._parseLocation(n,null,t),i=0;i<this.get_views().length;i++)if(this.get_views()[i].Id==n){r=this.get_views()[i];break}r?this.goToView(n):this._navigate(n)},_navigate:function(t,i){n._navigated=!0;var r=t.match(n.LocationRegex);typeof __dauh!="undefined"?r?this.encodePermalink(r[2],r[1],i):this.encodePermalink(t):r?(n._navigated=!1,open(r[2],r[1],i?i:"")):window.location.href=t},get_contextFilter:function(n,t){var f=[],e,u,i,h,o,l;if(!String.isNullOrEmpty(n.ContextFields))for(var s=t?t:this._collectFieldValues(!0),c=/(\w+)(\s*=\s*(.+?)){0,1}\s*(,|$)/g,r=c.exec(n.ContextFields);r;){if(e=String.isNullOrEmpty(r[3])?r[1]:r[3],u=e.match(/^\'(.+)\'$/),u||(u=e.match(/^(\d+)$/)),u){for(i=0;i<f.length;i++)if(f[i].Name==r[1]){f[i].Value+='\0='+u[1];u=null;break}u&&Array.add(f,{Name:r[1],Value:u[1]})}else if(h=this.findField(e),h)for(i=0;i<s.length;i++)if(s[i].Name==h.Name){o=s[i];l=o.Modified?o.NewValue:o.OldValue;Array.add(f,{Name:r[1],Value:l});break}r=c.exec(n.ContextFields)}return f},showLookup:function(n){var t,f,i,r,u;this.get_enabled()&&(t=this._allFields[n],t._lookupModalBehavior?t._lookupDataControllerBehavior._render():(f=$get(this.get_id()+"_Item"+t.Index+"_ShowLookupLink"),f&&(i=t._lookupModalPanel=document.createElement("div"),this._appendModalPanel(i),i.className="ModalPanel",i.id=this.get_id()+"_ItemLookupPanel"+t.Index,i.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"><\/div><\/td><td><div style="height:1px;font-size:1px"><\/div><\/td><\/tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"><\/td><td class="RightSideShadow"><\/td><\/tr><tr><td colspan="2"><div class="BottomShadow"><\/div><\/td><\/tr><\/table><\/td><\/tr><\/table>',this.get_id(),t.Index),t._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"_ItemLookup"+t.Index,PopupControlID:i.id,BackgroundCssClass:"ModalBackground"},null,null,f))),r=this.get_contextFilter(t),u=!0,t._lookupDataControllerBehavior?r.length>0&&(t._lookupDataControllerBehavior.set_externalFilter(r),t._lookupDataControllerBehavior.goToPage(-1),u=!0):(u=!1,t._lookupDataControllerBehavior=$create(Web.DataView,{id:this.get_id()+"_LookupView"+n,baseUrl:this.get_baseUrl(),pageSize:t.ItemsPageSize?t.ItemsPageSize:Web.DataViewResources.Pager.PageSizes[0],showFirstLetters:t.ItemsLetters,servicePath:this.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,showActionBar:Web.DataViewResources.Lookup.ShowActionBar,lookupField:t,externalFilter:r,filterSource:r.length>0?"Context":null,showSearchBar:this.get_showSearchBar(),searchOnStart:this.get_showSearchBar()&&t.SearchOnStart,description:t.ItemsDescription},null,null,$get(this.get_id()+"_ItemLookupPlaceholder"+t.Index))),this._saveTabIndexes(),t._lookupModalBehavior.show(),u&&t._lookupDataControllerBehavior._focusQuickFind(!0),$addHandler(document.body,"keydown",t._lookupDataControllerBehavior._bodyKeydownHandler),t._lookupDataControllerBehavior._adjustLookupSize(),this._lookupIsActive=!0)},changeLookupValue:function(n,t,i){var u=this._allFields[n],r=this;setTimeout(function(){var f,o,e;r._restoreTabIndexes();f=r.get_id()+"_Item"+n;o=r.get_id()+"_Item"+u.AliasIndex;Sys.UI.DomElement.setVisible($get(f+"_ClearLookupLink"),!0);e=$get(f+"_ShowLookupLink");e.innerHTML=r.htmlEncode(u,i);Sys.UI.DomElement.setFocus(e);t&&(t=u.format(t));$get(f).value=t;f!=o&&($get(o).value=i);$(e).closest("table").css("width","");r._updateLookupInfo(t,i);r._valueChanged(n);r._adjustModalHeight()},0);r._closeLookup(u)},clearLookupValue:function(n){var t=this._allFields[n],i=this.get_id()+"_Item"+n,e=this.get_id()+"_Item"+t.AliasIndex;if(Sys.UI.DomElement.setVisible($get(i+"_ClearLookupLink"),!1),$get(i+"_ShowLookupLink").innerHTML=Web.DataViewResources.Lookup.SelectLink,$get(i).value="",$get(e).value="",!String.isNullOrEmpty(t.Copy)){for(var u=[],f=/(\w+)=(\w+)/g,r=f.exec(t.Copy);r;)r[2]=="null"&&Array.add(u,{name:r[1],value:null}),r=f.exec(t.Copy);u.length>0&&this.refresh(!0,u)}this._updateLookupInfo("",Web.DataViewResources.Lookup.SelectLink);$get(i+"_ShowLookupLink").focus();this._valueChanged(n);this._adjustModalHeight()},_updateLookupInfo:function(n,t){var i=$get(this.get_id()+"_Text0"),r,u;i&&(i.value=t,i.name=i.id,r=$get(this.get_id()+"_Item0"),r.value=n,r.name=r.id,this.get_lookupPostBackExpression()&&(u=Sys.WebForms.PageRequestManager.getInstance(),u?eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+this.get_lookupPostBackExpression().match(/\w+(.+)/)[1]):eval(this.get_lookupPostBackExpression())))},createNewLookupValue:function(t){var i=this._newLookupValueField=this._allFields[t],r=this._createNewView=n.showModal(this,i.ItemsDataController,i.ItemsNewDataView,"New",i.ItemsNewDataView,this.get_baseUrl(),this.get_servicePath(),this.get_contextFilter(i));r._parentDataViewId=this.get_id();r.add_executed(Function.createDelegate(this,this._saveNewLookupValueCompleted));r.set_showSearchBar(this.get_showSearchBar());this._lookupIsActive=!0},_saveNewLookupValueCompleted:function(t,r){var u,s,e;if(!(r.result.Errors.length>0)){r.handled=!0;n.hideMessage();var h=null,f=this._newLookupValueField,o=f.ItemsDataValueField;for(String.isNullOrEmpty(o)&&(o=t._keyFields[0].Name),r.result.Values.length==0&&(r.result.Values=t._lastArgs.Values),u=0;u<r.result.Values.length;u++)if(r.result.Values[u].Name==o){h=r.result.Values[u].NewValue;break}for(s=null,e=f.ItemsDataTextField,String.isNullOrEmpty(e)&&(e=t._fields[0].Name),i=0;i<t._lastArgs.Values.length;i++)if(t._lastArgs.Values[i].Name==e){s=t._lastArgs.Values[i].NewValue;break}this._createNewView.endModalState("Cancel");this._copyLookupValues(null,f,t._lastArgs.Values);this.changeLookupValue(f.Index,h,s);this._lookupIsActive=!1}},hideLookup:function(n){var i=n?this._allFields[n]:this.get_lookupField(),t=this.get_lookupField()._dataView;t._closeLookup(i);t._restoreTabIndexes();$get(t.get_id()+"_Item"+i.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var n=this.get_lookupField();n._dataView.createNewLookupValue(n.Index)},htmlEncode:function(t,i){var r=this._allFields[t.AliasIndex];return r.HtmlEncode?r.Type=="String"?n.htmlEncode(i):i:i},filterIsExternal:function(n){var t,r,u,i;if(this._externalFilter.length==0)return!1;for(t=0;t<this._filter.length;t++){if(r=this._filter[t].match(/(\w+):/)[1],u=!1,!n||n==r)for(i=0;i<this._externalFilter.length;i++)if(this._externalFilter[i].Name==r){u=!0;break}if(!u)return!1}return!0},updateSummary:function(){var t,f,i,a,u,h,c,e,o,l,s;if(this.get_showInSummary()&&!n.touch&&(t=null,this._summaryId||(f=$getSideBar(),f?(this._summaryId="PageSummary_"+this.get_id(),t=$get("PageSummaryBox"),t||(t=document.createElement("div"),t.id="PageSummaryBox",t.className="TaskBox Summary",t.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}<\/div><\/div>',Web.DataViewResources.Menu.Summary),f.insertBefore(t,f.childNodes[f._hasActivators?1:0]),t._numberOfVisibleSummaries=0),i=$get(this._summaryId),i||(i=document.createElement("div"),i.id=this._summaryId,t.childNodes[0].appendChild(i))):this._summaryId=""),this._summaryId)){if(t||(t=$get("PageSummaryBox")),!this._rows||this._rows.length==0){this._filterSource||Sys.UI.DomElement.setVisible(t,!1);return}a=this.get_selectedRow();i=$get(this._summaryId);var r=new Sys.StringBuilder,v=this._lastCommandName,y=this.get_view().Type;if(this.get_view().Type="Grid",this._lastCommandName=null,u=!0,this._selectedKey.length>0)for(h=!0,c=0,e=0;e<this._allFields.length;e++)if(o=this._allFields[e],o.ShowInSummary&&(u=!1,r.append('<div class="Field">'),h?h=!1:r.append('<div class="Divider"><\/div>'),r.appendFormat('<div class="Label">{0}<\/div>',String.trimLongWords(this._allFields[o.AliasIndex].Label)),r.append('<div class="Value">'),this._renderItem(r,o,a,!1,!1,!1,!1,!0),r.append("<\/div><\/div>"),c++,this.get_summaryFieldCount()>0&&c>=this.get_summaryFieldCount()))break;Sys.UI.DomElement.setVisible(i,!u);u&&this._summaryIsVisible?t._numberOfVisibleSummaries--:(u||this._summaryIsVisible)&&(u||this._summaryIsVisible!=null)||t._numberOfVisibleSummaries++;this._summaryIsVisible=!u;Sys.UI.DomElement.setVisible(t,t._numberOfVisibleSummaries>0);l=r.toString();i.innerHTML=l;s=this._lastArgs!=this._lastClearArgs&&this._lastArgs.CommandName=="Delete";$app.mobile||u&&!s||this.get_filterSource()!=null||typeof Web.Membership=="undefined"||(s&&(this._lastClearArgs=this._lastArgs),Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",this.get_keyRef(),this.get_controller()),s?null:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}<\/div>{1}<\/div><\/div>',document.title,l,i.offsetWidth==0?135:i.offsetWidth)));r.clear();this._lastCommandName=v;this.get_view().Type=y}},get_hasDetails:function(){return this._hasDetails==!0},get_hasParent:function(){return this._hasParent==!0},get_usesTransaction:function(){return this._usesTransaction==!0},get_inTransaction:function(){return this.get_transaction()!=null},add_selected:function(n){this._hasDetails=!0;this.get_events().addHandler("selected",n)},remove_selected:function(n){this.get_events().removeHandler("selected",n)},raiseSelected:function(){if(!n._navigated){var t=this.get_events().getHandler("selected");t&&t(this,Sys.EventArgs.Empty);this.multiSelect()||this.set_selectedValue(this.get_selectedKey())}},add_executed:function(n){this.get_events().addHandler("executed",n)},remove_executed:function(n){this.get_events().removeHandler("executed",n)},raiseExecuted:function(n){var t=this.get_events().getHandler("executed");t&&t(this,n)},_closeLookup:function(n){if($closeHovers(),n&&n._lookupModalBehavior&&(n._lookupModalBehavior.hide(),$removeHandler(document.body,"keydown",n._lookupDataControllerBehavior._bodyKeydownHandler)),this._lookupIsActive=!1,window.event){var t=new Sys.UI.DomEvent(event);t.stopPropagation();t.preventDefault()}},_collectFieldValues:function(t){var c,v,s,w,u,e,o,k,tt,f,h,l,y,d,b,g,p,a;if(t=!0,w=this.extension(),w&&w.collect)return w.collect();if(c=[],v=this.get_selectedRow(),s=this.inserting(),!v&&!s)return c;for(u=0;u<this._allFields.length;u++){var i=this._allFields[u],nt=i.ItemsStyle=="RadioButtonList",r=this._get("_Item",u);if(i.ReadOnly&&!t)r=null;else if(nt)for(e=0,o=$get(this.get_id()+"_Item"+u+"_"+e);o;){if(o.checked){r=o;break}else r=null;e++;o=$get(this.get_id()+"_Item"+u+"_"+e)}else if(i.ItemsStyle=="CheckBoxList"&&r&&(e=0,o=$get(this.get_id()+"_Item"+u+"_"+e),o))for(r.value="";o;)o.checked&&(r.value.length>0&&(r.value+=","),r.value+=o.value),e++,o=$get(this.get_id()+"_Item"+u+"_"+e);i.ClientEditor&&r?i.ClientEditor=="Web$DataView$RichText"&&(k=n.EditorFactories[i.ClientEditor.replace(".","$")],k.persist&&k.persist(r)):i.Editor&&r&&(tt=$get(r.id+"$Frame"),tt&&(editor=n.Editors[i.EditorId],editor&&(r.value=editor.GetValue())));f=r?r.value:null;f&&(i.Type.startsWith("Date")?(h=Date.tryParseFuzzyDate(f,i.DataFormatString),h!=null&&r.type=="text"&&(f=r.value=i.DateFmtStr?String.format(i.DateFmtStr,h):i.format(h))):!String.isBlank(i.DataFormatString)&&i.isNumber()&&(l=Number.tryParse(f),l!=null&&(i.DataFormatString.match(/\{0:p\}/i)&&l>1&&(l=l/100),f=r.value=i.format(l))));i.TimeFmtStr&&(y=this._get("_Item$Time",u),y&&(h=Date.tryParseFuzzyTime(y.value),h!=null&&(y.value=String.localeFormat(i.TimeFmtStr,h),f+=" "+y.value)));!i.OnDemand&&(r||i.IsPrimaryKey||!i.ReadOnly||t)&&(d=!0,b=!1,this._lastCommandName=="BatchEdit"&&(g=$get(String.format("{0}$BatchSelect{1}",this.get_id(),i.Index)),b=i.TextMode==4||i.Hidden||i.ReadOnly,d=i.IsPrimaryKey||b||g&&g.checked),d&&Array.add(c,{Name:i.Name,OldValue:s?null:v[i.Index],NewValue:r&&f!=null?i.Type=="Boolean"&&f.length>0?f=="true":f.length==0?null:f:!s&&(i.TextMode==4||i.Hidden||i.ReadOnly)?v[i.Index]:null,Modified:r!=null&&!(!s&&i.Type=="String"&&String.isNullOrEmpty(f)&&String.isNullOrEmpty(v[i.Index]))||nt&&s&&!i.AllowNulls,ReadOnly:i.ReadOnly&&!(i.IsPrimaryKey&&s)||b}))}for(u=0;u<this._externalFilter.length;u++)for(p=this._externalFilter[u],e=0;e<c.length;e++)if(a=c[e],a.Name.toLowerCase()==p.Name.toLowerCase()&&a.NewValue==null){a.NewValue=typeof p.Value=="string"?this.convertStringToFieldValue(this.findField(a.Name),p.Value):p.Value;a.Modified=!0;break}return c},_enumerateExpressions:function(n,t,i){var f=[],u,r;if(this._expressions)for(u=0;u<this._expressions.length;u++)r=this._expressions[u],r.Scope==t&&(n==Web.DynamicExpressionType.Any||r.Type==Web.DynamicExpressionType.RegularExpression)&&r.Target==i&&Array.add(f,r);return f},_prepareJavaScriptExpression:function(n){var t,f,u,e;if(!n._variables){for(var i=[],o=/(\[(\w+)\])|(\$row\.(\w+))/gm,r=o.exec(n.Test);r;){for(t=r[2]||r[4],f=!1,u=0;u<i.length;u++)if(i[u].name==t){f=!0;break}f||(e=this.findField(t),e&&Array.add(i,{name:t,regex:new RegExp("(\\["+t+"\\])|(\\$row\\."+t+")","g"),replace:String.format("this._javaScriptRowValue({0})",e.Index)}));r=o.exec(n.Test)}n._variables=i;n.Test=n.Test.replace(/\[(\w+)\.(\w+)\]/gi,"this.fieldValue('$2','$1')")}},_javaScriptRowValue:function(n){var t=this,r=t._javaScriptRow[n],u,i;return t._javaScriptRowConvert?(u=t._allFields[n],i={Name:u.Name,NewValue:r,Modified:!0},t._validateFieldValues([i],!1,!1,!1)?i.NewValue:null):r},_evaluateJavaScriptExpressions:function(n,t,i){for(var f=i?"":null,o,s,h,r,u,e=0;e<n.length;e++)if(r=n[e],r.Type==Web.DynamicExpressionType.ClientScript){if(this._prepareJavaScriptExpression(r),u=r._script,!u){for(u=r.Test,o=0;o<r._variables.length;o++)s=r._variables[o],u=u.replace(s.regex,s.replace);r._script=eval("(function(){return "+u+"})");r._script==null?r._script=u:u=r._script}if(u){this._javaScriptRow=t;this._javaScriptRowConvert=this.editing();try{if(h=typeof u=="string"?eval(u):u.call(this),i)h&&(f==null?f=r.Result:f+=" "+r.Result);else return r.Result==null?h:r.Result}finally{this._javaScriptRow=null}}}return f},_validateFieldValueFormat:function(n,t){var r=null,i;switch(n.Type){case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":i=t.NewValue;typeof i!="number"&&(i=Number.tryParse(i));isNaN(i)||i==null?r=o.NumberIsExpected:(i!=null&&n.Type.match(/int|byte/i)&&(i=Math.round(i)),t.NewValue=i);break;case"Boolean":try{t.NewValue=String.isInstanceOfType(t.NewValue)?Boolean.parse(t.NewValue):t.NewValue}catch(u){r=o.BooleanIsExpected}break;case"DateTime":typeof t.NewValue=="string"?(i=String.isNullOrEmpty(n.DataFormatString)?Date.parse(t.NewValue):Date.parseLocale(t.NewValue,n.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]),i||(i=Date.tryParseFuzzyDate(t.NewValue,n.DataFormatString)),i?t.NewValue=i:r=o.DateIsExpected):isNaN(t.NewValue.getTime())&&(r=o.DateIsExpected)}return r},validate:function(n){for(var t=0;t<n.length;t++)if(n[t].Error)return!1;return!0},_validateFieldValues:function(t,i,r,u){for(var k=this,h=!0,v=new Sys.StringBuilder,p,d,f,s,e,rt,g,w,l,nt,tt,it,c,a,b,y=0;y<t.length;y++)if(f=t[y],p=f.NewValue,d=f.OldValue,s=this.findField(f.Name),s&&(!r||s.ColIndex==r.colIndex)){if(e=null,s.ReadOnly&&s.IsPrimaryKey)p==null&&d!=null&&(f.NewValue=d);else if(f.Modified){if(s.AllowNulls||s.HasDefaultValue&&!o.EnforceRequiredFieldsWithDefaultValue||!String.isBlank(p)||s.Hidden||s.isReadOnly()||(e=o.RequiredField),!e&&String.isBlank(p)&&(f.NewValue=null),e||f.NewValue==null||s.IsMirror||s.Hidden&&!f.Modified||(rt=this._validateFieldValueFormat(s,f,u),s.isReadOnly()||(e=rt)),!e)for(g=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,f.Name),w=0;w<g.length;w++){l=g[w];nt=f.NewValue?f.NewValue:"";try{tt=new RegExp(l.Test);it=tt.exec(nt);l.Result.match(/\$(\d|\'\`)/)?it&&(f.NewValue=nt.replace(tt,l.Result)):it||(e=e?e+=l.Result:l.Result)}catch(ut){}}f.Modified=s.Type.startsWith("DateTime")?(f.NewValue==null?null:f.NewValue.toString())!=(f.OldValue==null?null:f.OldValue.toString()):f.NewValue!=f.OldValue}if(f.Error=e,$app.mobile)e&&i&&h&&(this._focus(s.Name,e),h=!1);else{if(c=$get(this.get_id()+"_Item"+s.Index+"_Error"),c&&i)for(Sys.UI.DomElement.setVisible(c,!1),c.innerHTML=e,e!=null&&h&&this._showFieldError(s,e),a=c.parentNode;a&&a.tagName!="BODY";){if(!$common.getVisible(a)){c=null;break}a=a.parentNode}e&&i&&(h&&(b=this._lastFocusedCell,b&&(this._focusCell(-1,-1,!1),this._focusCell(b.rowIndex,b.colIndex,!0),this._lastFocusedCell=null),this._focus(s.Name)),h=!1,c||v.append(n.formatMessage("Attention",s.Label+": "+e)))}}return h&&$app.upload()&&$(this._allFields).each(function(){var n=this,t;if(n.OnDemand&&(t=$app.upload("validate",{container:et(k,n),dataViewId:k._id,fieldName:n.Name}),!n.AllowNulls&&!t&&i))return h=!1,e=o.Required,$app.mobile?k._focus(n.Name,e):v.appendFormat("<b>{0}<\/b>: {1}",n.Label,e),!1}),i||(h=!0),h||n.showMessage(v.toString()),v.clear(),h},_fieldIsInExternalFilter:function(n){return this._findExternalFilterItem(n)!=null},_findExternalFilterItem:function(n){for(var i,t=0;t<this._externalFilter.length;t++)if(i=this._externalFilter[t],n.Name.toLowerCase()==i.Name.toLowerCase())return i;return null},_internalFocus:function(){var n=$get(this._focusId);if(n)try{n.value="";n.value=this._focusText;Sys.UI.DomElement.setCaretPosition(n,this._focusText.length)}catch(t){}},_showFieldError:function(n,t){var i=this._get("_Item",n.Index+"_Error"),u,s,r,e;if(i&&(Sys.UI.DomElement.setVisible(i,t!=null),t))if(this._skipErrorReset=!0,i.style.marginLeft="0px",i.style.marginTop="0px",i.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;<\/span><\/a>',t,Web.DataViewResources.ModalPopup.Close,this.get_id(),n.Name),this.get_isForm())u=$common.getPaddingBox(i.previousSibling?i.previousSibling:i),i.style.marginLeft=u.left+"px",i.style.marginTop="1px";else{var h=$app.scrolling(),c=$common.getClientBounds(),o=$common.getBounds(i),f=o.x+o.width-(h.x+c.width);for(f<0&&(f=0),s=$common.getBounds(i.parentNode),u=$common.getPaddingBox(i.parentNode),r=i.nextSibling;r&&r.nodeType!=1;)r=r.nextSibling;e=$common.getBounds(r?r:i);i.style.marginLeft=-(e.x-s.x+1+f)+"px";i.style.marginTop=e.height+u.bottom+"px"}},_focus:function(t,i){var r,f,u,l,s,e,a,o,w,v,c;if(!this._skipFocus){if($app.mobile){this.extension().focus(t,i);return}if(i)for(r=0;r<this.get_fields().length;r++)this._showFieldError(this.get_fields()[r]);if(f=this._get_focusedCell(),f&&this.editing()&&this._id==n._activeDataSheetId){if(!String.isNullOrEmpty(t)){for(u=null,l=!1,r=0;r<this._fields.length;r++)if(u=this._fields[r],u.Name==t){this._focusCell(f.rowIndex,f.colIndex,!1);l=f.colIndex!=r;f={rowIndex:this._selectedRowIndex,colIndex:r};this._continueAfterScript||(this._saveAndNew=!1);break}!String.isNullOrEmpty(i)&&u&&(l&&(this._focusCell(f.rowIndex,f.colIndex,!0),this.refresh(!0)),this._showFieldError(u,i))}if(s=this._focusCell(f.rowIndex,f.colIndex,!0),s){for(e=s.getElementsByTagName("input"),a=!1,r=0;r<e.length;r++)if(e[r].type!="hidden"){a=!0;break}for(a||(e=s.getElementsByTagName("textarea")),e.length==0&&(e=s.getElementsByTagName("select")),e.length==0&&(e=s.getElementsByTagName("a")),r=0;r<e.length;r++)if(o=e[r],o.tagName!="INPUT"||o.type!="hidden"){(o.tagName=="INPUT"||o.tagName=="TEXTAREA")&&this._pendingChars!=null?(this._focusText=this._pendingChars,this._focusId=o.id,w=this,setTimeout(function(){w._internalFocus()},50)):Sys.UI.DomElement.setFocus(o);break}}this._pendingChars=null;return}for(String.isNullOrEmpty(t)&&!String.isNullOrEmpty(this._focusedFieldName)&&(u=this.findField(this._focusedFieldName),u&&(t=u.Name)),this._focusedFieldName=t,r=0;r<this.get_fields().length;r++)if(u=this.get_fields()[r],v=u.ItemsStyle=="AutoComplete"&&(u.Name==t||u.AliasName==t||String.isNullOrEmpty(t)),!u.ReadOnly&&(t==null||u.Name==t||v)){c=this.get_id()+"_Item"+(v?u.AliasIndex:u.Index);switch(u.ItemsStyle){case"RadioButtonList":case"CheckBoxList":c+="_0";break;case"Lookup":c+="_ShowLookupLink"}var y=$get(c),p=$(y).data("focus"),b=$get(String.format("{0}_ItemContainer{1}",this.get_id(),u.Index)),k=this._categories[u.CategoryIndex],h=Array.indexOf(this._tabs,k.Tab);if(t&&h>=0&&this.set_categoryTabIndex(h),this._toggleCategoryVisibility(u.CategoryIndex,!0),y&&(!b||Sys.UI.DomElement.getVisible(b)||p)&&(t||h==this.get_categoryTabIndex()||this._tabs.length==0)){h>=0&&this.set_categoryTabIndex(h);try{i&&this._showFieldError(u,i);p?p():Sys.UI.DomElement.setFocus(y)}catch(d){}break}}}},_serverFocus:function(n,t){this._focus(n,t);this.get_isDataSheet()&&(this.refresh(!0),this._focus(n,t))},_saveTabIndexes:function(){var t,u,i,r;for(this._lastSavedTabIndexes=this._savedTabIndexes,this._savedTabIndexes=[],t=0;t<n._tagsWithIndexes.length;t++)for(u=document.getElementsByTagName(n._tagsWithIndexes[t]),i=0;i<u.length;i++)r=u[i],r&&Array.add(this._savedTabIndexes,{element:r,tabIndex:r.tabIndex})},_restoreTabIndexes:function(){if(this._savedTabIndexes){for(var n=0;n<this._savedTabIndexes.length;n++)this._savedTabIndexes[n].element.tabIndex=this._savedTabIndexes[n].tabIndex,delete this._savedTabIndexes[n].element;Array.clear(this._savedTabIndexes)}this._savedTabIndexes=this._lastSavedTabIndexes;this._lastSavedTabIndexes=null},_selectKeyByRowIndex:function(n){this._selectKeyByRow(this._rows[n])},_selectKeyByRow:function(n){var i,t,r;if(n){for(this._selectedRow=n,i=this._selectedKey,this._selectedKey=[],this._selectedKeyFilter=[],t=0;t<this._keyFields.length;t++)r=this._keyFields[t],Array.add(this._selectedKey,n[r.Index]),Array.add(this._selectedKeyFilter,r.Name+":="+this.convertFieldValueToString(r,n[r.Index])),i&&(i.length<t||i[t]!=this._selectedKey[t])&&(i=null);this.updateSummary();i||this._raiseSelectedDelayed||this.raiseSelected()}},_showWait:function(n){var i,t,r;$app.mobile||(i=Web.DataViewResources.Common.WaitHtml,this.get_fields()==null||n?(this._container.innerHTML=this.get_isModal()||this.get_lookupField()?i:'<div class="dataview-busy-whitespace"><\/div>',$(this._container).find(".Wait").addClass("dataview")):(t=$get(this.get_id()+"_Wait"),t&&(this._oldWaitHTML=t.innerHTML,t.innerHTML=i)),r=this.extension(),r&&r.wait())},_hideWait:function(){if(this._oldWaitHTML!=null){var n=$get(this.get_id()+"_Wait");n&&(n.innerHTML=this._oldWaitHTML)}},_get_colSpan:function(){return this.get_isForm()?2:this.get_fields().length+(this.multiSelect()?1:0)+(this.get_showIcons()?1:0)+(this.get_isDataSheet()?1:0)+(this._actionColumn?1:0)},_renderCreateNewBegin:function(n,t){String.isNullOrEmpty(t.ItemsNewDataView)||n.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(n,t){String.isNullOrEmpty(t.ItemsNewDataView)||(n.append("<\/td><td>"),this.get_enabled()&&n.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;<\/a>',this.get_id(),t.Index,String.format(Web.DataViewResources.Lookup.NewToolTip,t.Label),String.format(' tabindex="{0}"',$nextTabIndex())),n.append("<\/td><\/tr><\/table>"))},_raisePopulateDynamicLookups:function(){var t=this;t._hasDynamicLookups&&t.editing()&&t._skipPopulateDynamicLookups!=!0&&(t._survey?n.survey("populateItems",{dataView:t,callback:function(){var n={Values:[]};$(t._allFields).each(function(){var t=this;t.ItemsAreDynamic&&n.Values.push({Name:t.Name,NewValue:t.Items})});t._populateDynamicLookups(n)}}):t.executeCommand({commandName:"PopulateDynamicLookups",commandArgument:"",causesValidation:!1}));t._skipPopulateDynamicLookups=!1},_raiseCalculate:function(n,t){this.executeCommand({commandName:"Calculate",commandArgument:n.Name,causesValidation:!1,trigger:t.Name})},get_currentRow:function(){return this.inserting()?this._newRow?this._newRow:[]:this.get_selectedRow()},fieldValue:function(n,t){var e,u,i,f,r;return n=="_wizard"?(e=$("#"+this._id+" [data-layout]"),u=e.data("wizard-config"),u?u.active:0):(i=!t||t.length==0?this:t.match(/^master$/i)?this.get_master():$find(t),!i)?null:i._allFields?(f=i.findField(n),!f)?null:(r=i._clonedRow,r==null&&(r=i._cloneChangedRow()),r?r[f.Index]:null):null},_useLEVs:function(n){var r,t,e,u;if(n&&this._allowLEVs&&(r=this._get_LEVs(),r.length>0))for(i=0;i<r[0].length;i++)if(t=r[0][i],f=this.findField(t.Name),f&&f.AllowLEV){if(this._lastCommandName=="New"&&t.Modified&&t.NewValue!=null){for(e=!0,u=0;u<this._externalFilter.length;u++)if(this._externalFilter[u].Name.toLowerCase()==t.Name.toLowerCase()){e=!1;break}e&&(n[f.Index]=t.NewValue)}f._LEV=t.Modified?t.NewValue:null}},_configure:function(n){var r,t,u,i,f,e;if(this._requiresConfiguration&&(n||(n=this.get_currentRow()),n))for(r=0;r<this._allFields.length;r++)if(t=this._allFields[r],!String.isNullOrEmpty(t.Configuration))for(u=/\s*(\w+)=(\w+)\s*?($|\n)/g,i=u.exec(t.Configuration);i;)f=this.findField(i[2]),f&&(e=n[f.Index],e&&(t[i[1]]=e)),i=u.exec(t.Configuration)},_focusQuickFind:function(n){if(!this._quickFindFocused||n==!0){this._lostFocus=!0;try{Sys.UI.DomElement.setFocus(this.get_quickFindElement())}catch(t){}this._quickFindFocused=!0}},_restoreEmbeddedViews:function(){var t,n;if(this._embeddedViews){for(t=0;t<this._embeddedViews.length;t++)n=this._embeddedViews[t],n.parent.appendChild(n.view._element),delete n.parent,n.view=null;Array.clear(this._embeddedViews)}},_incorporateEmbeddedViews:function(){var n;if(this._embeddedViews)for(n=0;n<this._embeddedViews.length;n++){var t=this._embeddedViews[n],r=$get("v_"+t.view.get_cookie().replace(/-/g,"")),i=t.view._element;t.parent=i.parentNode;r.appendChild(i)}},raiseSelectedDelayed:function(){this._raiseSelectedDelayed&&(this._raiseSelectedDelayed=!1,this.raiseSelected(),this._forceChanged=!1)},refreshChildren:function(){var n=this.get_parentDataView(this);n._forceChanged=!0;n._raiseSelectedDelayed=!0;n._isBusy||n.refresh(!0)},_render:function(t){var r,u,i;$app.mobile?(t&&this._refreshExtension(),this.get_parentDataView(this).raiseSelectedDelayed()):(this._restoreEmbeddedViews(),this._detachBehaviors(),this._disposeSearchBarExtenders(),this._useLEVs(),this._configure(),this._internalRender(),this._viewMessages&&this.showViewMessage(this._viewMessages[this.get_viewId()]),this._raisePopulateDynamicLookups(),!this.get_modalAnchor()&&this.get_lookupField()&&this._focusQuickFind(),this.raiseSelectedDelayed(),this._scrollIntoView&&(this._scrollIntoView=!1,r=$common.getBounds(this._element),u=$app.scrolling(),r.y<u.y&&this._element.scrollIntoView(!0)),this._incorporateEmbeddedViews(),this.get_isModal()&&this._adjustModalPopupSize(),this.get_searchOnStart()&&this.get_isGrid()&&(this._focusSearchBar(),this.set_searchOnStart(!1)),this.get_isDataSheet()&&(i=this._get_focusedCell(),this.inserting()&&!i?this._startInputListenerOnCell(0,0):i&&this._id==n._activeDataSheetId&&(this._skipCellFocus=!0,this._focusCell(-1,-1,!0))),this.get_isGrid()&&this._synced&&(this._synced=!1,this._selectedRowIndex==null&&(this._forgetSelectedRow(!0),this.refresh(!0))),this._syncKeyFilter())},_syncKeyFilter:function(){var i=this.get_selectedKey(),n,t;if(i.length>0&&this._selectedKeyFilter.length==0)for(n=0;n<this._keyFields.length;n++)t=this._keyFields[n],Array.add(this._selectedKeyFilter,t.Name+":="+this.convertFieldValueToString(t,i[n]))},_mergeRowUpdates:function(n){var u,f,i,r,t;if(this._lastCommandName=="BatchEdit"&&(u=this._batchEdit=[],f=this._allFields,$(this._element).find(".BatchSelect input:checkbox:checked").each(function(){var n=this.id.match(/BatchSelect(\d+)$/),t;n&&(t=f[s(n[1])],Array.add(u,t.Name))})),this._originalRow=null,this._useLEVs(n),this.editing()&&this._ditto){for(this._originalRow=Array.clone(n),i=0;i<this._ditto.length;i++)r=this._ditto[i],t=this.findField(r.name),!t||t.ReadOnly&&t.IsPrimaryKey||(n[t.Index]=r.value);delete this._ditto}this._configure(n);this._mergedRow=n},_removeRowUpdates:function(){var t=this._mergedRow,n;if(t){if(this._originalRow)for(n=0;n<this._originalRow.length;n++)t[n]=this._originalRow[n];this._mergedRow=null}},_internalRender:function(){var e,t,o,i,r,s,u,f,a;if(this._multipleSelection=null,this._dynamicActionButtons=!1,e=this.get_viewType(),t=new Sys.StringBuilder,this.get_mode()==Web.DataViewMode.Lookup)i=this._fields[0],r=this.get_lookupText(),r==null&&(r=Web.DataViewResources.Lookup.SelectLink),s=i.format(r),this._renderCreateNewBegin(t,i),t.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',this.get_id(),i.Index,this.htmlEncode(i,s),String.format(Web.DataViewResources.Lookup.SelectToolTip,i.Label),this.get_lookupValue(),String.format(Web.DataViewResources.Lookup.ClearToolTip,i.Label),n.htmlAttributeEncode(s),$nextTabIndex(),this.get_enabled()?"":' disabled="true" class="Disabled"'),this._renderCreateNewEnd(t,i),this.get_element().appendChild(this._container),this._container.innerHTML=t.toString(),this.get_lookupValue()!=""&&this.get_enabled()||($get(this.get_id()+"_Item0_ClearLookupLink").style.display="none");else{if(o=e=="Form",t.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',this.get_isModal()?String.format(' style="width:{0}px"',this._container.offsetWidth-20):"",this.get_controller(),this.get_viewId(),this._numberOfColumns>0?" MultiColumn":"",this._tabs.length>0?" Tabbed":"",e),o?this._renderFormView(t):this._renderGridView(t),t.append("<\/table>"),this._mergedRow){var h=this._get_focusedCell(),c=this.inserting(),l=this.get_isDataSheet();for(u=0;u<this._allFields.length;u++)f=this._allFields[u],a=h&&u!=this._fields[h.colIndex].Index,(f.Hidden&&(!f.IsPrimaryKey||c)||a||!h&&c&&l)&&(r=this._mergedRow[u],(r!=null||l&&!c)&&t.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',this.get_id(),u,n.htmlAttributeEncode(r!=null?f.format(r):"")))}this._container.innerHTML=t.toString();this._multipleSelection!=null&&this._multipleSelection==!0&&($get(this.get_id()+"_ToggleButton").checked=!0);this._attachBehaviors();this._updateVisibility();this.editing()&&(this._lastCommandName=="BatchEdit"&&$(this._element).find("div.BatchSelect input:checkbox:checked").each(function(){n._updateBatchSelectStatus(this,o)}),this._focus())}t.clear();this._updateChart();this._updateSearchBar();this._removeRowUpdates();this._fixWidthOfColumns();this._fixHeightOfRow(!0);this._refreshExtension()},_refreshExtension:function(){var n=this.extension(),t=this._lastExtension;n!=t&&(t&&t.hide(),n&&n.show(),this._lastExtension=n);n&&n.refresh()},_get_headerRowElement:function(){for(var t=this._container.childNodes[0].childNodes[0].childNodes,n=0;n<t.length;){if(Sys.UI.DomElement.containsCssClass(t[n],"HeaderRow"))return t[n];n++}return null},_fixWidthOfColumns:function(){var t,i,n,u,f,h,e;if((this.get_isDataSheet()||this.get_isGrid())&&!this.extension()&&(t=this._get_headerRowElement(),t)){if(this._viewColumnSettings||(this._viewColumnSettings=[]),i=this._viewColumnSettings[this.get_viewId()],!i){for(i=[],$(t).addClass("Fixed"),n=0;n<t.childNodes.length;n++){if(u=t.childNodes[n],f=$common.getBounds(u),f.width==0){Sys.UI.DomElement.removeCssClass(t,"Fixed");return}var o=$common.getPaddingBox(u),s=$common.getBorderBox(u),r={w:f.width-o.horizontal-s.horizontal,h:f.height-o.vertical-s.vertical};Array.add(i,r)}for(h=$common.getBounds(t),n=0;n<i.length;n++)i[n].h=h.height;this._viewColumnSettings[this.get_viewId()]=i;Sys.UI.DomElement.removeCssClass(t,"Fixed")}for(n=0;n<t.childNodes.length;n++)r=i[n],r&&(e=t.childNodes[n],e.style.height=r.h+"px",e.style.width=r.w+"px")}},_fixHeightOfRow:function(n){var i,e,f,r,t,u,o;if((this.get_isDataSheet()||this.get_isGrid())&&(!n||this.editing())){if(i=this._get_headerRowElement(),!i)return;if(e=this._get_focusedCell(),f=this.get_isGrid()?this._selectedRowIndex:e.rowIndex,f>=0){for(r=i.parentNode,t=0;t<r.childNodes.length;t++)if(r.childNodes[t]==i)break;u=r.childNodes[t+f+1];u&&(n?this._selectedRowHeight&&(u.style.height=this._selectedRowHeight+"px"):(o=$common.getBounds(u),this._selectedRowHeight=o.height))}}},_updateChart:function(){var t,i,n;if(this.get_isChart()){t=this._get("$Chart");i=t.offsetWidth;i<100&&(i=t.parentNode.offsetWidth);n=this._createParams();delete n.Transaction;delete n.LookupContextFieldName;delete n.LookupContextController;delete n.LookupContextView;delete n.LookupContext;delete n.LastCommandName;delete n.LastCommandArgument;delete n.Inserting;delete n.DoesNotRequireData;var u=e.serialize(n),f=$common.getBounds(t),r=this;r._chartHeight&&(t.style.height=r._chartHeight+"px");$(t).one("load",function(){try{r._chartHeight=$(this).height()}catch(n){}}).attr("src",String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",this.get_baseUrl(),this.get_controller(),this.get_viewId(),i,encodeURIComponent(u)))}},_toggleCategoryVisibility:function(n,t){var r=$get(String.format("{0}$Category${1}",this.get_id(),n)),u,i;r&&(u=this.get_categories()[n],t||(t=!Sys.UI.DomElement.getVisible(r)),$(r).css("display",t?"":"none"),i=$get(String.format("{0}$CategoryButton${1}",this.get_id(),n)),u.Collapsed=!t,t?(Sys.UI.DomElement.removeCssClass(i,"Maximize"),i.childNodes[0].title=Web.DataViewResources.Form.Minimize):($(i).addClass("Maximize"),i.childNodes[0].title=Web.DataViewResources.Form.Maximize),_body_performResize())},_processTemplatedText:function(n,t){var e,r,i,u,f,o,s;if(t||(t=""),e=/\{(\w+)\}/g,r=e.exec(t),!r)return t;for(i=new Sys.StringBuilder,u=0;r;)i.append(t.substring(u,r.index)),f=r[1],u=r.index+f.length+2,o=this.findField(f),o?(i.append('<span class="FieldPlaceholder">'),this._renderItem(i,o,n,!1,!1,!1,!1,!1,!0),i.append("<\/span>")):i.appendFormat("[{0}]",f),r=e.exec(t);return s=t.length-1,u<s&&i.append(t.substring(u,s)),i.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(t){var nt=this.editing(),u,o,v,g,y,c,p,a,r,h,b,k,e,d;if(this._renderStatusBar(t),this._renderViewDescription(t),Web.DataViewResources.Form.ShowActionBar&&this._renderActionBar(t),u=this.get_currentRow(),this._mergeRowUpdates(u),this._updateVisibility(u),this.inserting()&&this._expressions)for(i=0;i<this._expressions.length;i++)o=this._expressions[i],o.Scope==Web.DynamicExpressionScope.DefaultValues&&o.Type==Web.DynamicExpressionType.ClientScript&&(f=this.findField(o.Target),f&&u[f.Index]==null&&(String.isNullOrEmpty(o.Test)?u[f.Index]=o.Result:(v=eval(o.Test),v&&(u[f.Index]=String.isNullOrEmpty(o.Result)?v:o.Result))));for(g=0,i=0;i<this._allFields.length;i++)this._allFields[i].Hidden||g++;if(y=u!=null,y&&this._renderActionButtons(t,"Top","Form"),c=this._get_selectedTab(),this._tabs.length>0){for(t.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',this._get_colSpan(),y?"":" WithMargin"),t.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>'),i=0;i<this._tabs.length;i++)t.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}<\/a><\/span><\/span><\/span><\/td>',n.htmlEncode(this._tabs[i]),i==this.get_categoryTabIndex()?" Selected":"",this.get_id(),i,$nextTabIndex());t.append("<\/tr><\/table><\/td><\/tr>")}if(u)if(p=this._get_template(),p)t.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',this._get_colSpan()),this._renderTemplate(p,t,u,!0,!1),t.append("<\/td><\/tr>");else{var l=this.get_categories(),s=this.get_fields(),w=this._numberOfColumns;if(w>0){for(t.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',this._get_colSpan()),a=0;a<w;a++){for(a>0&&t.append('<td class="CategorySeparator">&nbsp;<\/td>'),t.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/w),i=0;i<l.length;i++)if(r=l[i],r.ColumnIndex==a||this._ignoreColumnIndex){for(this.get_isModal()&&(r.Collapsed=!1),t.appendFormat('<div id="{0}_Category{1}" class="Category {3}" style="display:{2}">',this.get_id(),i,!c||c==r.Tab?"block":"none",r.Id),h=this._processTemplatedText(u,r.Description),b=this._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[h],!0,h),t.appendFormat('<table class="Category {8}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}<\/span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"><\/span><\/a><div style="clear:both;height:1px;margin-top:-1px;"><\/div><\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}<\/td><\/tr><\/table>',r.HeaderText,b,this.get_id(),i,r.Collapsed?Web.DataViewResources.Form.Maximize:Web.DataViewResources.Form.Minimize,l.length>1&&!this.get_isModal()?"":"display:none",r.Collapsed?" Maximize":"",String.isNullOrEmpty(b)?"none":"block",r.Id),k=!0,j=0;j<s.length;j++)if(e=s[j],!e.Hidden&&e.CategoryIndex==r.Index){k=!1;break}if(!k){if(t.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',this.get_id(),i,r.Collapsed?"display:none":""),String.isNullOrEmpty(r.Template))for(j=0;j<s.length;j++)e=s[j],e.Hidden||e.CategoryIndex!=r.Index||(d=e.Name.match(/^(_[A-Za-z_]+)\d/),t.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',d?d[1]:e.Name),this._renderItem(t,e,u,!0,!1,!1,!0),t.appendFormat('<\/td><td class="Item{0}" valign="top">',nt&&!e.isReadOnly()?"":" ReadOnly"),this._renderItem(t,e,u,!0),t.append("<\/td><\/tr><\/table>"));else this._renderTemplate(r.Template,t,u,!0,!1);t.append("<\/td><\/tr><\/table>")}t.append("<\/div>")}t.append("<\/td>")}t.append("<\/tr><\/table><\/td><\/tr>")}else for(i=0;i<l.length;i++){if(r=l[i],h=this._processTemplatedText(u,r.Description),t.appendFormat('<tr class="CategoryRow {5}" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category {5}"><table class="Category {5}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}<\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}<\/td><\/tr><\/table><\/td><td valign="top" class="Fields {5}">',r.HeaderText,this._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[h],!0,h),this.get_id(),i,!c||c==r.Tab?"":"none",r.Id),String.isNullOrEmpty(r.Template))for(j=0;j<s.length;j++)e=s[j],e.Hidden||e.CategoryIndex!=r.Index||this._renderItem(t,e,u,!0);else this._renderTemplate(r.Template,t,u,!0,!1);t.append("<\/td><\/tr>")}}else this._renderNoRecordsWhenNeeded(t);u&&this._renderActionButtons(t,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var i,n,t,r;if(this._tabs&&this._tabs.length>0){for(i=this._tabs[this.get_categoryTabIndex()],n=0;n<this._tabs.length;n++)t=this._get("_Tab",n),t&&(n==this.get_categoryTabIndex()?$(t).addClass("Selected"):$(t).removeClass("Selected"));for(n=0;n<this._categories.length;n++)r=this._categories[n],t=this._get("_Category",n),t&&Sys.UI.DomElement.setVisible(t,r.Tab==i);this._updateVisibility()}this._adjustModalHeight()},_renderItem:function(t,i,r,u,f,e,o,s,h){var p=Web.DataViewResources.Data,v=this.get_isForm()||f,c=r[i.Index],ct,st,ht,ti,lt,pt,wt,at,b,d,ot,nt,tt,it,y,w,ui,kt,fi,l,ei,oi,vt,dt,yt,gt,rt;c!=null&&(c=c.toString());var k=null,ut=i.ItemsStyle=="CheckBoxList",g=this.editing(),ft=i.Index!=i.AliasIndex,ni=ft&&!i.ItemsStyle;if(g&&i.ItemsStyle=="CheckBox"&&i.Items.length==2&&(ct=i.Items[0][0],st=i.Items[1][0],ct=="true"&&(ct="false",st="true"),c==null&&(c=i.Items[0][0]),k=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{7}"/>',this.get_id(),i.Index,st&&(c=="true"||c==st)?" checked":"",$nextTabIndex(),c,ct,st,i.ToolTip)),ht=i.isReadOnly(),v){if(ti=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index),o||t.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',this.get_id(),i.Index,i.Name),lt=(g&&ni?this.findFieldUnderAlias(i):this._allFields[i.AliasIndex]).HeaderText,k&&o&&!(g&&ht)){t.append('<div class="Header">&nbsp;<\/div>');return}if(lt.length>0&&(h&&k&&this._numberOfColumns>0?t.append('<div class="Header">&nbsp;<\/div>'):t.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}<\/label><\/div>',this.get_id(),i.Index,lt,this._numberOfColumns>0||h?"":k,g&&!i.AllowNulls&&!k&&!ht&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFieldMarker:"",i.Name)),o)return;(k==null||this._numberOfColumns>0)&&t.append('<div class="Value">')}if(pt=!g&&!String.isNullOrEmpty(i.ItemsDataController)&&!ut&&!e&&c&&this._disableObjectRef!=!0&&!i.tagged("lookup-details-hidden"),pt&&!v&&t.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>'),g&&u&&!ht){ni&&(i=this.findFieldUnderAlias(i));wt=i;i._LEV!=null&&t.append('<table cellpadding="0" cellspacing="0"><tr><td>');!v&&k&&t.append(k);var ii=!String.isNullOrEmpty(i.ItemsStyle),bt=i.ItemsStyle=="Lookup",ri=!String.isNullOrEmpty(i.ContextFields),et=i.ItemsStyle=="AutoComplete",a=i.DynamicItems?i.DynamicItems:i.Items;if(!ii||bt||et||a.length!=0||ut||!ri){if(i.DynamicItems&&!ut){for(at=!1,b=0;b<a.length;b++)if(a[b][0]==c){at=!0;break}at||(c=null);!i.AllowNulls&&at||String.isNullOrEmpty(a[0][0])||Array.insert(a,0,["",p.NullValueInForms])}}else a=[],(i.AllowNulls||ri)&&Array.add(a,["",p.NullValueInForms]),c!=null&&Array.add(a,[c,r[i.AliasIndex]]);if(k!=null)(this._numberOfColumns>0||h)&&(t.append(k),t.appendFormat('<label for="{0}_Item{1}" title="{3}">{2}<\/label>',this.get_id(),i.Index,lt,i.ToolTip));else if(a.length>0||ut||ii&&!bt&&!et)if(i.ItemsStyle=="RadioButtonList"){for(t.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',i.ToolTip),d=i.Columns==0?1:i.Columns,ot=Math.floor(a.length/d)+(a.length%d>0?1:0),nt=0;nt<ot;nt++){for(t.append("<tr>"),tt=0;tt<d;tt++)it=tt*ot+nt,it<a.length?(y=a[it],w=y[0]==null?"":y[0].toString(),c==null&&(c=""),t.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),i.Index,it,w,w==c?" checked":"",this.htmlEncode(i,y[1]),$nextTabIndex())):t.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');t.append("<\/tr>")}t.append("<\/table>")}else if(ut)if(ui=c?c.split(","):[],kt=!String.isNullOrEmpty(i.ContextFields)&&!i.DynamicItems,t.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,kt?c:""),kt)t.append(Web.DataViewResources.HeaderFilter.Loading);else{for(t.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',i.ToolTip),d=i.Columns==0?1:i.Columns,ot=Math.floor(a.length/d)+(a.length%d>0?1:0),nt=0;nt<ot;nt++){for(t.append("<tr>"),tt=0;tt<d;tt++)it=tt*ot+nt,it<a.length?(y=a[it],w=y[0]==null?"":y[0].toString(),c==null&&(c=""),t.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),i.Index,it,w,Array.indexOf(ui,w)!=-1?" checked":"",this.htmlEncode(i,y[1]),$nextTabIndex())):t.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');t.append("<\/tr>")}t.append("<\/table>")}else{for(t.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{4}">',this.get_id(),i.Index,i.ItemsStyle=="ListBox"?i.Rows==0?5:i.Rows:"1",$nextTabIndex(),i.ToolTip),c==null&&(c=""),c=c.toString(),b=0;b<a.length;b++)y=a[b],w=y[0],fi=w==null&&!i.AllowNulls?Web.DataViewResources.Lookup.SelectLink:y[1],w==null&&(w=""),w=w.toString(),t.appendFormat('<option value="{0}"{1}>{2}<\/option>',w,w==c?" selected":"",this.htmlEncode(i,fi));t.append("<\/select>")}else!String.isNullOrEmpty(i.ItemsDataController)&&bt?(c=r[i.AliasIndex],c==null&&(c=Web.DataViewResources.Lookup.SelectLink),l=this._allFields[i.AliasIndex].format(c),this._renderCreateNewBegin(t,i),t.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',this.get_id(),i.Index,this.htmlEncode(i,l),String.isNullOrEmpty(i.ToolTip)?String.format(Web.DataViewResources.Lookup.SelectToolTip,i.Label):i.ToolTip,r[i.Index],$nextTabIndex(),$nextTabIndex(),String.format(Web.DataViewResources.Lookup.ClearToolTip,i.Label),r[i.Index]!=null?"display":"none",i.AliasIndex),this._renderCreateNewEnd(t,i)):i.OnDemand?this._renderOnDemandItem(t,i,r,u,v):i.Editor?(ei=i.Editor,t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,n.htmlAttributeEncode(c)),t.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}" tabindex="{4}"><\/iframe>',this.resolveClientUrl(this.get_appRootPath()+"ControlHost.aspx"),this.get_id(),i.Index,ei,$nextTabIndex())):i.Rows>1?(t.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{3}" style="',this.get_id(),i.Index,$nextTabIndex(),i.ToolTip),i.TextMode!=3||String.isNullOrEmpty(c)||t.append("display:none;"),v?t.appendFormat('" cols="{0}"',i.Columns>0?i.Columns:50):t.append('display:block;width:100%;"'),t.appendFormat(' rows="{0}"',i.Rows),$app.supportsPlaceholder&&!String.isNullOrEmpty(i.Watermark)&&t.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(i.Watermark)),t.append(">"),t.append(i.HtmlEncode?this.htmlEncode(i,c):c),t.append("<\/textarea>"),i.TextMode!=3||String.isNullOrEmpty(c)||t.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}<\/a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}<\/a><\/div><\/div>",this.get_id(),i.Index,this.htmlEncode(i,c).replace(/((\r\n*)|\n)/g,"<br/>"),p.NoteEditLabel,p.NoteDeleteLabel,p.NoteDeleteConfirm)):(d=i.Columns>0?i.Columns:50,oi=i.ToolTip,et&&(!ft||g)&&(c=r[i.Index],t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,n.htmlAttributeEncode(c)),i=this._allFields[i.AliasIndex]),i.TimeFmtStr&&t.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">'),t.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),i.Index,$nextTabIndex(),i.TextMode!=1?"text":"password"),v?t.appendFormat(' size="{0}"',d):t.append(' style="display:block;width:90%;"'),i.Len>0&&t.appendFormat(' maxlength="{0}"',i.Len),et&&t.appendFormat(' title="{0}"',oi),c=r[i.Index],c==null?l=et?p.NullValueInForms:"":ft?l=c.toString():(i.DateFmtStr&&(typeof c=="string"&&(c=Date.parseLocale(c,i.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])),i.DataFormatString=i.DateFmtStr),l=i.format(c),i.DateFmtStr&&(i.DataFormatString=i.DataFmtStr)),t.appendFormat(' value="{0}" {1}',n.htmlAttributeEncode(l),v?' class="TextInput"':String.format('class="TextInput {0}Type"',i.Type)),t.appendFormat(' title="{0}"',i.ToolTip),$app.supportsPlaceholder&&!String.isNullOrEmpty(i.Watermark)&&t.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(i.Watermark)),t.append("/>"),i.Type.startsWith("DateTime")&&v&&Web.DataViewResources.Form.ShowCalendarButton&&!i.TimeFmtStr&&t.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;<\/a>',this.get_id(),i.Index),i.TimeFmtStr&&(t.appendFormat('<\/td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),i.Index,$nextTabIndex()),v?t.appendFormat(' size="{0}"',d):t.append(' style="display:block;width:90%;"'),c==null?l=et?p.NullValueInForms:"":ft?l=c.toString():(i.DataFormatString=i.TimeFmtStr,l=i.format(c),i.DataFormatString=i.DataFmtStr),t.appendFormat(' value="{0}" {1}/><\/td><\/table>',n.htmlAttributeEncode(l),v?"":'class="TimeType"')));i._LEV!=null&&(vt=this._allFields[i.AliasIndex]._LEV,vt==null&&(vt=""),t.appendFormat('<\/td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),i.Index,$nextTabIndex(),n.htmlAttributeEncode(String.format(p.UseLEV,this._allFields[i.AliasIndex].format(vt)))));this._lastCommandName=="BatchEdit"&&t.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="$app._updateBatchSelectStatus(this,{3})"{4}/><\/td><td><label for="{0}$BatchSelect{1}">{2}<\/a><\/td><\/tr><\/table><\/div>',this.get_id(),wt.Index,p.BatchUpdate,v==!0,this._batchEdit&&Array.contains(this._batchEdit,wt.Name)?' checked="checked"':"")}else if(i.OnDemand)this._renderOnDemandItem(t,i,r,u,v);else{if(c=this.htmlEncode(i,r[i.AliasIndex]),g&&ht&&u&&(dt=r[i.Index],t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,dt!=null?n.htmlAttributeEncode(this._allFields[i.AliasIndex].format(dt)):"")),yt=i.DynamicItems?i.DynamicItems:i.Items,yt.length==0)i.Type=="String"&&c!=null&&c.length>p.MaxReadOnlyStringLen&&!(i.TextMode==3||i.TextMode==2)&&(c=c.substring(0,p.MaxReadOnlyStringLen)+"..."),c&&i.TextMode==3&&(c=c.replace(/\r?\n/g,"<br/>")),l=String.isBlank(c)?v?p.NullValueInForms:p.NullValue:this._allFields[i.AliasIndex].format(c);else if(ut){for(a=c?c.split(","):[],gt=!0,b=0;b<yt.length;b++)y=yt[b],w=y[0]==null?"":y[0].toString(),Array.contains(a,w)&&(gt?gt=!1:t.append(", "),t.append(n.htmlEncode(y[1])));l=a.length==0?p.NullValueInForms:""}else ft&&!u?l=c:(y=this._findItemByValue(i,ft?r[i.Index]:c),l=y[1],v||l!=p.NullValueInForms||(l=p.NullValue));String.isNullOrEmpty(i.HyperlinkFormatString)||c==null||(rt=this._parseLocation(i.HyperlinkFormatString,r),l=rt&&rt.match(/^mailto\:/)?String.format('<a href="{0}" title="{2}">{1}<\/a>',rt,l,i.ToolTip):rt.match(/^javascript\:/)?String.format('<a href="javascript:" onclick="{0};return false;" title="{2}">{1}<\/a>',rt.substring(11),l,i.ToolTip):String.format('<a href="javascript:" onclick="$find(\'{2}\')._navigate(\'{0}\');" title="{3}">{1}<\/a>',rt,l,this.get_id(),i.ToolTip));i.TextMode==1&&(l="**********");i.Type!="Byte[]"||i.OnDemand||(l=$app.toHexString(l));s==!0&&(l=String.trimLongWords(l));__designer()&&l&&(l=l.replace(/\^\w+\^/g,""));t.append(l)}pt&&(v||t.append('<\/td><td align="right">'),t.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;<\/span>',String.format(Web.DataViewResources.Lookup.DetailsToolTip,n.htmlAttributeEncode(this._allFields[i.AliasIndex].HeaderText)),this.get_id(),i.Name),v||t.append("<\/td><\/tr><\/table>"));v&&((k==null||this._numberOfColumns>0)&&t.append("<\/div>"),t.append(ti),String.isNullOrEmpty(i.FooterText)||t.appendFormat('<div class="Footer">{0}<\/div>',i.FooterText),t.append("<\/div>"))},_renderOnDemandItem:function(n,t,i,r,u){var f=Web.DataViewResources.Data,e=i[t.Index],c=e!=null?e.toString().match(/^null\|(.+)$/):null,o=c!=null||e==null,s;c&&(e=c[1]);o&&!r&&t.OnDemandStyle==1?n.append(u?f.NullValueInForms:f.NullValue):(s=this.resolveClientUrl(this.get_appRootPath()+f.BlobHandler),r&&!o&&n.appendFormat('<a href="{0}?{1}=o|{2}" title="{3}" onclick="$find(&quot;{4}&quot;)._showDownloadProgress();open(this.href, &quot;_blank&quot;,&quot;height={5},width={6},resizable=yes&quot;);return false">',s,t.OnDemandHandler,e,f.BlobDownloadHint,this.get_id(),h.height()/2,h.width()/2),t.OnDemandStyle==1?o?n.append(u?f.NullValueInForms:f.NullValue):n.append(r?f.BlobDownloadLink:f.BlobDownloadLinkReadOnly):o?n.append(u?f.NullValueInForms:f.NullValue):n.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',s,t.OnDemandHandler,e),r&&!o&&n.append("<\/a>"),!t.ReadOnly&&this.editing()&&r&&($app.upload()?n.appendFormat('<div class="drop-box-{0}"><\/div>',t.Index):n.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}" tabindex="{6}"><\/iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}<\/div>',s,t.OnDemandHandler,e,this.get_id(),t.Index,"Uploading...",$nextTabIndex())))},_showUploadProgress:function(n,t){var f=$get(String.format("{0}_Frame{1}",this.get_id(),n)),i=$get(String.format("{0}_ProgressBar{1}",this.get_id(),n)),e,u,c,r;if(f!=null&&i!=null){e=$(t).find("input:file");u=e.val().split(/(\\|\/)/);u=u.length>0?u[u.length-1]:null;var l=this.inserting(),o=$(i).show().text(u).focus(),s=$common.getPaddingBox(i),h=$common.getBorderBox(i);i.style.width=f.offsetWidth-s.horizontal-h.horizontal+"px";i.style.height=f.offsetHeight-s.vertical-h.vertical+"px";c=$(f).hide();l?(r=this._pendingUploads,r||(r=this._pendingUploads=[]),r.push({form:t,progress:i}),o.find("a").button("destroy"),o.addClass("dataview-insert").append($(String.format("<a>{0}<\/a>",Web.DataViewResources.Data.Filters.Labels.Clear)).button({icons:{primary:"ui-icon-close"},text:!1}).click(function(){o.hide();c.show();for(var n=0;n<r.length;n++)if(r[n].form==t){Array.removeAt(r,n);break}e.replaceWith(e.clone(!0))}))):(this._showDownloadProgress(),t.submit())}},_internalRenderActionButtons:function(n,t,i,r){var u,f,e;for(r||(r=this._actionButtonsInScope(i)),this._clonedRow=this._cloneChangedRow(),u=0;u<r.length;u++)action=r[u],this._isActionAvailable(action)&&(f=String.isNullOrEmpty(action.CssClass)?"":action.CssClass,action.HeaderText&&action.HeaderText.length>10&&(f.length>0&&(f+=" "),f+="AutoWidth"),e=action.CommandName=="None",n.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false" tabindex="{3}" class="{8}{4}"{7}>{2}<\/button>',this.get_id(),u,action.HeaderText,$nextTabIndex(),f,i,e?"return false;":"",e?' disabled="disabled"':"",action.CssClassEx)),action._whenClientScript!=null&&(this._dynamicActionButtons=!0);this._clonedRow=null},_actionButtonsInScope:function(n){var t=this.get_actions(n),r,i;if(t.length!=0){if(n=="Row"){for(r=!1,i=0;i<t.length;i++)if(this._isActionAvailable(t[i])){r=!0;break}if(!r)return null}return t}},_renderActionButtons:function(n,t,i){var e,o,s,h;if(this.get_showActionButtons().indexOf(t)!=-1&&(e=this._actionButtonsInScope(i),e)){if(o=this._get_colSpan(),s="",i=="Row"&&this._actionColumn&&(o--,s='<td class="ActionColumn">&nbsp;<\/td>'),n.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow {2}Scope">{3}<td colspan="{1}" class="ActionButtons {2}ActionButtons">',t,o,i,s),n.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>'),h=String.format(' id="{0}$ActionButtons${1}"',this.get_id(),t),i=="Form"){var r=this._position,c=r&&r.count>1&&!this.inserting(),l=r&&r.index>0,a=r&&r.index<r.count-1,u=this._get_specialAction("Print"),f=this.get_isModal()?this._get_specialAction("Annotate"):null;n.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span><\/span><\/a><\/td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span><\/span><\/a><\/td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span><\/span><\/a><\/td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span><\/span><\/a><\/td><td class="Instruction" id="{0}_Wait" align="left">{1}<\/td><\/tr><\/table><\/td><td class="Right" align="right"{14}>&nbsp;',t=="Bottom"?this.get_id():"",this.editing()&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFiledMarkerFootnote:"",this.get_id(),Web.DataViewResources.Pager.Previous,Web.DataViewResources.Pager.Next,l?"":" Disabled",a?"":" Disabled",c?"":" Hidden",u?u.text:"",u?"":" Hidden",u?u.script:null,f?f.text:"",f?"":" Hidden",f?f.script:null,h)}else n.appendFormat("<td{0}>",h);this._internalRenderActionButtons(n,t,i,e);this._lastActionButtonsScope=i;n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},_isActionMatched:function(n){n._csInitialized||(String.isNullOrEmpty(n.WhenClientScript)||(n._whenClientScript=this._prepareJavaScriptExpressionEx(n.WhenClientScript)),n._csInitialized=!0);return(n.WhenViewRegex==null||n.WhenViewRegex.exec(this.get_viewId())!=null==n.WhenViewRegexResult)&&(n.WhenTagRegex==null||n.WhenTagRegex.exec(this.get_tag())!=null==n.WhenTagRegexResult)&&(n.WhenHRefRegex==null||n.WhenHRefRegex.exec(location.pathname)!=null==n.WhenHRefRegexResult)&&(n._whenClientScript==null||eval(n._whenClientScript)==!0)},_isActionAvailable:function(n,t){var r=this,i=n.WhenLastCommandName?n.WhenLastCommandName:"",f,e,u,o;if(i=="Any"&&(i=this.get_lastCommandName()),f=n.WhenLastCommandArgument?n.WhenLastCommandArgument:"",e=i.length==0||i==this.get_lastCommandName()&&(f.length==0||f==this.get_lastCommandArgument()),e){if(u=this.editing(),n.CommandName=="DataSheet")return!u&&this.get_isGrid()&&this.get_viewType()!="DataSheet"&&this._isActionMatched(n);if(n.CommandName=="Grid")return!u&&this.get_isGrid()&&this.get_viewType()!="Grid"&&this._isActionMatched(n);if(n.CommandName=="BatchEdit")return r.get_showMultipleSelection()&&r._selectedKeyList&&r._selectedKeyList.length>1&&r._isActionMatched(n);if(u)return o=this._rowIsSelected(t==null?this._selectedRowIndex:t),o?(i=="New"||i=="Edit"||i=="BatchEdit"||i=="Duplicate")&&this._isActionMatched(n):o||t!=null||i!="New"&&i!="Duplicate"?i.length==0&&t!=null&&this._isActionMatched(n):this._isActionMatched(n)}return e&&(!n.WhenKeySelected||n.WhenKeySelected&&this._selectedKey&&this._selectedKey.length>0)&&this._isActionMatched(n)&&(n.CommandName!="New"||this._hasKey())},_hasKey:function(){return this._keyFields&&this._keyFields.length>0},_rowIsSelected:function(n){if(!this._hasKey())return this.get_isModal()&&this.get_isForm();var t=this._rows[n];return this.rowIsSelected(t)},rowIsSelected:function(n){var u=this._keyFields,f=this._selectedKey,t;if(n&&u.length==f.length&&u.length){if(n==this._mergedRow)return!0;for(t=0;t<u.length;t++){var e=u[t],i=f[t],r=n[e.Index];if(e.Type.startsWith("DateTime")){if(!(i||r))return!1;i=i.toString();r=r.toString()}if(i!=r&&!(r==null&&String.isNullOrEmpty(i)))return!1}return!0}return!1},_get_template:function(n){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(n?"_"+n:""))},_renderTemplate:function(t,i,r,u,f){for(var o=typeof t=="string"?t:t.innerHTML,l=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,c=0,e=l.exec(o),s,h;e;)c=e.index+e[0].length,i.append(e[1]),s=this.findField(e[2]),s?e[4]&&e[4].length>0?i.appendFormat("{0:"+e[4]+"}",r[s.Index]):this._renderItem(i,s,r,u,f,null,null,null,!0):(h=n.find(e[2]),h&&(this._embeddedViews||(this._embeddedViews=[]),Array.add(this._embeddedViews,{view:h}),i.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"><\/div>',h.get_cookie().replace(/-/g,"")))),e=l.exec(o);c<o.length&&i.append(o.substring(c))},_renderNewRow:function(n){var e,o,s,u,t;if(this.inserting()){var r=this.get_isDataSheet(),l=this._actionColumn&&!r,f=this._get_focusedCell();if(f||(f={colIndex:0}),e=r?null:this._gridTemplates.New,n.appendFormat('<tr class="Row Selected{0}{1}">',e?" InlineFormRow":"",r?" Inserting":""),o=this.multiSelect(),o&&n.append('<td class="Cell Toggle First">&nbsp;<\/td>'),s=this.get_showIcons(),s&&n.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;<\/span><\/td>',o?"":" First"),this.get_isDataSheet()&&n.appendFormat('<td class="Cell Gap"><div class="Icon"><\/div><\/td>',!o&&!s?" First":""),l&&n.append('<td class="Cell ActionColumn">&nbsp;<\/td>'),u=this._newRow?this._newRow:[],this._mergeRowUpdates(u),this._updateVisibility(u),e)n.appendFormat('<td class="Cell" colspan="{0}">',this.get_fields().length),this._renderTemplate(e,n,u,!0,!0),n.append("<\/td>");else for(t=0;t<this._fields.length;t++){var i=this._fields[t],h=this._allFields[i.AliasIndex],c="";r&&(this._editing=f&&f.colIndex==i.ColIndex,this._editing||(c=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",this.get_id(),t)));n.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',h.Name,h.Type,t==0?" FirstColumn":"",t==this._fields.length-1?" LastColumn":"",c);i.ReadOnly||n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index);this._renderItem(n,i,u,!i.OnDemand,null);this._editing=null;n.append("<\/td>")}n.append("<\/tr>");r||this._renderActionButtons(n,"Bottom","Row")}},_iconClicked:function(n){this.get_isDataSheet()||this.get_lookupField()!=null||this._icons&&this._icons[n]=="Attachment"&&(this._lastClickedIcon="Attachment",this.set_autoSelectFirstRow(!0),this._autoSelect(n))},_renderRows:function(n,t,i){var l=this.get_lookupField()!=null,a=this.get_isDataSheet(),tt=!l&&this._actionColumn&&!a,yt=tt?this.get_actionGroups("ActionColumn",!0):null,pt=this._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,this.get_viewId()),b,it,k,u,f,v,s,d,ft,g,nt,y,p,vt;for(n.append('<tr class="HeaderRow">'),b=this.get_showIcons(),i&&(n.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/><\/th>',this.get_id()),this._multipleSelection=!1),b&&n.appendFormat('<th class="Icons{0}">&nbsp;<\/th>',i?"":" First"),a&&n.appendFormat('<th class="Gap{0}">&nbsp;<\/th>',!i&&!b?" First":""),tt&&n.appendFormat('<th class="FieldHeaderSelector ActionColumn"><span>{0}<\/span><\/th>',this._actionColumn),it=this.get_sortExpression(),k=it?it.match(/^\s*(\w+)((\s+(asc|desc))|(\s*(,|$)))/i):null,u=0;u<this._fields.length;u++)f=this._fields[u],v=f.Name,f=this._allFields[f.AliasIndex],f.Name==v&&(v=""),n.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',f.Name,f.Items.length>0?"String":f.Type,u==0?" FirstColumn":"",u==this._fields.length-1?" LastColumn":"",v),(f.AllowSorting||f.AllowQBE)&&n.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',this.get_id(),u),n.append(">"),f.AllowSorting?(n.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}<\/a>',this.get_id(),f.Name,f.HeaderText,String.format(Web.DataViewResources.HeaderFilter.SortBy,f.HeaderText),u,$nextTabIndex()),k&&k[1]==f.Name&&n.append(String.format('<span class="{0}">&nbsp;<\/span>',k[4]?k[4].toLowerCase()=="asc"?"SortUp":"SortDown":"SortUp")),this.filterOf(f)!=null&&n.append('<span class="Filter">&nbsp;<\/span>')):n.appendFormat("<span>{0}<\/span>",f.HeaderText),n.append("<\/th>");n.append("<\/tr>");var o=this._get_focusedCell(),h=this.editing(),et=this.inserting(),rt=this._lastSelectedRowIndex;this._gridTemplates||(s={Default:this._get_template(),Edit:this._get_template("edit"),New:this._get_template("new")},s.Default&&(s.Default=s.Default.innerHTML),s.Edit=s.Edit?s.Edit.innerHTML:s.Default,s.New=s.New?s.New.innerHTML:s.Default,this._gridTemplates=s);var ut=a?null:this._gridTemplates.Edit,ot=a?null:this._gridTemplates.Default,c=null;this._registerRowSelectorItems();var wt=this.get_showRowNumber(),st=!1;for(u=0;u<this.get_rows().length;u++){var w=this.get_rows()[u],ht=" "+this._evaluateJavaScriptExpressions(pt,w,!0),e=this._rowIsSelected(u);if(e&&(st=!0),e&&(this._selectedRowIndex=u),d=null,ft="",i&&(g=Array.indexOf(this._selectedKeyList,this._createRowKey(u))!=-1,g&&(this._multipleSelection=!0),d=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/><\/td>',this.get_id(),u,g?' checked="checked"':null,g?" Selected":""),g&&(ft=" MultiSelectedRow")),nt=b?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}<\/span><\/td>',this._icons?this._icons[u]:"",i?"":" First",wt?this.get_pageSize()*this.get_pageIndex()+u+1+(this._pageOffset?this._pageOffset:0):"&nbsp;",this.get_id(),u):"",a&&(nt+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"><\/div><\/td>',this.get_id(),u,!i&&!b?" First":"")),tt&&(nt+=this._renderActionColumnCell(w,u,e,yt)),h&&e&&(this._mergeRowUpdates(w),this._updateVisibility(w)),e&&(h&&ut||ot))n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',this.get_id(),u,u%2==0?"":"Alternating"," InlineFormRow",this.get_fields().length,d,nt,h?" Editing":""),this._renderTemplate(h&&ut?ut:ot,n,w,!0,!0),n.append("<\/td>");else for(n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',this.get_id(),u,u%2==0?"":"Alternating",e?" Selected"+ht:ht,ft,t?"":" ReadOnlyRow",a&&!l?"":"onmouseover=\"$(this).addClass('Highlight');\" onmouseout=\"$(this).removeClass('Highlight')\"",e&&h?" Editing":""),d&&n.append(d),n.append(nt),j=0;j<this._fields.length;j++){f=this._fields[j];y=this._allFields[f.AliasIndex];v=f.Name==y.Name?"":f.Name;o&&(this._editing=h&&o.rowIndex==u&&o.colIndex==f.ColIndex);p=j==0&&t;p&&(c=r.HoverMonitor.Families[String.format("{0}$RowSelector${1}",this.get_id(),u)],c&&c.items.length!=0||(p=!1));var ct=j==0?" FirstColumn":"",lt=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",this.get_id(),u,j,a&&!l?"dataSheet":"gridView"),at=j==this._fields.length-1?" LastColumn":"";p&&!l||e&&h||f.OnDemand&&e?n.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',y.Name,f.Items.length>0?"String":y.Type,ct,e&&h&&(!a||o&&o.colIndex==f.ColIndex)?"":lt,at,v):n.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',this.get_id(),u,y.Name,y.Type=="Byte[]"?"Binary":f.Items.length>0?"String":y.Type,ct,lt,at,v);e&&h&&!f.ReadOnly&&n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),f.Index);p&&(!l&&c&&c.items.length>1&&n.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',this.get_id(),u),e&&h||(vt=l||!c||c.items.length==1?"":String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",this.get_id(),u),l?n.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex()):n.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',this.get_id(),u,$nextTabIndex(),vt)));this._renderItem(n,f,w,e,null,p);p&&!h&&(e&&h||n.append("<\/a>"),!l&&c&&c.items.length>1&&n.append("<\/div>"));n.append("<\/td>");o&&(this._editing=null)}n.append("<\/tr>");e&&o==null&&this._renderActionButtons(n,"Bottom","Row");et&&rt==u&&(rt=-2,this._renderNewRow(n));this._syncFocusedCell&&o&&e&&(o.rowIndex=u)}et&&rt!=-2&&this._renderNewRow(n);this._saveAndNew&&(this._saveAndNew=!1,this._syncFocusedCell?this.newDataSheetRow():(o=this._get_focusedCell(),o&&(o.colIndex=0,this._moveFocusToNextRow(o,this.get_pageSize()))));this._syncFocusedCell=!1;st||(this._selectedRowIndex=null)},_renderActionColumnCell:function(t,i,r,u){var l,a,f,h,e,c,o,s,v;for(this._clonedRow=t,r||(l=this.get_lastCommandName(),a=this.get_lastCommandArgument(),this.set_lastCommandName("Select"),this.set_lastCommandArgument(null)),f=new Sys.StringBuilder,f.append('<td class="Cell ActionColumn">'),h=!0,e=0;e<u.length;e++)for(c=u[e],o=0;o<c.Actions.length;o++)s=c.Actions[o],this._isActionAvailable(s)&&(h?h=!1:f.append('<span class="Divider">&nbsp;<\/span>'),f.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}<\/span><\/span><\/span><\/a>',this.get_id(),n.htmlEncode(s.HeaderText),o,e,i,n.htmlEncode(s.Description),s.CssClass));return h&&f.append("&nbsp;"),f.append("<\/td>"),v=f.toString(),f.clear(),this._clonedRow=null,r||(this.set_lastCommandName(l),this.set_lastCommandArgument(a)),v},extension:function(){var t=null,u=n.Extensions,i,r,f;return u&&(i=this.get_viewType(),r=this._extensions,r==null&&(r=this._extensions={}),t=r[i],t==null&&(f=u?u[i]:null,t=this._extensions[i]=f?new f(this):0,t&&t.initialize())),t},_renderGridView:function(n){var o,t,r,i,u,f,e;if(this._renderViewDescription(n),this._renderActionBar(n),this._renderSearchBar(n),o=this.get_showPager(),t=this.extension(),this._renderPager(n,"Top"),this.get_isChart()){for(this._renderInfoBar(n),this._sortingDisabled=!1,r=!1,i=0;i<this._fields.length;i++)u=this._fields[i],u.Aggregate!=0?this._sortingDisabled=!0:r||(r=!0,this.set_sortExpression(null),this.set_sortExpression(u.Name));t||n.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/><\/td><\/tr>',this.get_id(),this._get_colSpan())}else f=this._hasKey(),e=this.multiSelect()&&f,this.get_searchOnStart()||(this._renderInfoBar(n),t||this._renderRows(n,f,e)),t||(this._renderAggregates(n,e),this._renderNoRecordsWhenNeeded(n));t||this._renderPager(n,"Bottom")},_renderAggregates:function(n,t){var e=this.get_aggregates(),f,i,r,u,o;if(this._totalRowCount!=0&&e!=null){for(n.append('<tr class="AggregateRow">'),t&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_showIcons()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_isDataSheet()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this._actionColumn&&n.append('<td class="Aggregate">&nbsp;<\/td>'),f=0;f<this.get_fields().length;f++)i=this.get_fields()[f],i.Aggregate==0?n.append('<td class="None">&nbsp;<\/td>'):(r=e[i.Index],r=r==null?Web.DataViewResources.Data.NullValue:i.format(r),u=this._allFields[i.AliasIndex],u.IsMirror&&(r=e[i.AliasIndex]),o=Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[i.Aggregate]],n.appendFormat('<td class="Aggregate {0} {1}Type" title="',u.Name,u.Type),n.appendFormat(o.ToolTip,u.HeaderText),n.append('">'),n.appendFormat(o.FmtStr,r),n.append("<\/td>"));n.append("<\/tr>")}},_renderSearchBar:function(n){this.get_showSearchBar()&&__tf==4&&(this._searchBarInitialized=!1,n.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/><\/td><\/tr>',this.get_id(),this._get_colSpan(),this.get_searchBarIsVisible()?"":"display:none"))},_renderNoRecordsWhenNeeded:function(n){if(this._totalRowCount==0){var t=this.get_isDataSheet()&&this._keyFields.length>0&&this.executeActionInScope(["Row","ActionBar"],"New",null,null,!0)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}<\/a>',this.get_id(),Web.DataViewResources.Grid.NewRowLink,Web.DataViewResources.Lookup.GenericNewToolTip):"";n.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}<\/td><\/tr>',this._get_colSpan(),Web.DataViewResources.Data.NoRecords,t)}},_attachBehaviors:function(){if(!$app.mobile){this._detachBehaviors();this._attachFieldBehaviors();var n=this.get_quickFindElement();n&&$addHandlers(n,this._quickFindHandlers,this)}},_get:function(n,t){return t==null?$get(this.get_id()+n):$get(this.get_id()+n+t)},_attachTimeOptions:function(t,i){var f=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:this.get_id()+"_AutoComplete$Time"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength,typeCssClass:"AutoComplete"},null,null,i),u,o;Sys.UI.DomElement.addCssClass(f._completionListElement,"Time");var s=Sys.CultureInfo.CurrentCulture.dateTimeFormat,r=null,e=t.DataFormatString&&t.DataFormatString.replace(/\W/g,"_")||"Default";if(t.Type=="TimeSpan"){if($app._timeSpanOptions||($app._timeSpanOptions={}),r=$app._timeSpanOptions[e],!r){for(r=[],u=new Date,o=t.DataFormatString||"{0:HH:mm}",u.setHours(0,0,0,0);r.length<96;)Array.add(r,String.localeFormat(o,u)),u.setMinutes(u.getMinutes()+15);$app._timeSpanOptions[e]=r}}else if(r=n._timeOptions,!r){for(r=[],u=new Date,u.setHours(u.getHours(),0,0,0);r.length<48;)Array.add(r,String.localeFormat("{0:"+s.ShortTimePattern+"}",u)),u.setMinutes(u.getMinutes()+30);n._timeOptions=r}return(f._cache=[])["%"]=r,f},_executeClientEditorFactories:function(t,i,r){var h=i==null?t.Editor:t.ClientEditor,e,f,s,c;if(!String.isNullOrEmpty(h))for(e=h.split(n._simpleListRegex),f=0;f<e.length;f++){var l=e[f],o=l.replace(/\W/g,"$"),u=n.EditorFactories[o];if(u==null){try{u=eval(String.format('typeof {0}!="undefined"?new {0}():""',o))}catch(a){u=""}n.EditorFactories[o]=u}if(i==null)return u!="";if(u!=""){if(!r&&Array.indexOf(n._customInputElements,i.id)<0)return;if(s=this.get_viewType(),c=r?u.attach(i,s):u.detach(i,s),c)return r?Array.add(n._customInputElements,i.id):Array.remove(n._customInputElements,i.id),!0}}return!1},_attachFieldBehaviors:function(){var h=this,f,o,s,u;if(h.editing())for(f=0;f<this.get_fields().length;f++){var n=this.get_fields()[f],t=this._get("_Item",n.Index),i=null;if(!t||n.ReadOnly||this._executeClientEditorFactories(n,t,!0))n.OnDemand&&(u=$(this._container).find(".drop-box-"+n.Index),u.length&&(n._dropBox?(n._dropBoxInput.insertAfter(u),n._dropBox.insertAfter(u),u.remove(),n._dropBoxInput=null,n._dropBox=null):$app.upload("create",{container:u,dataViewId:h._id,fieldName:n.Name})));else{if(t.tagName=="TEXTAREA"&&n.Len>0&&(t.setAttribute("maxlength",n.Len),$addHandler(t,"keyup",this._checkMaxLengthHandler),$addHandler(t,"blur",this._checkMaxLengthHandler)),!String.isNullOrEmpty(n.Mask)){var r=Sys.CultureInfo.CurrentCulture,e=r.dateTimeFormat.ShortDatePattern.toUpperCase().split(r.dateTimeFormat.DateSeparator),c=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:r.dateTimeFormat.AMDesignator+";"+r.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:r.numberFormat.CurrencySymbol,CultureDateFormat:e[0].substring(0,1)+e[1].substring(0,1)+e[2].substring(0,1),CultureDatePlaceholder:r.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:r.numberFormat.NumberDecimalSeparator,CultureName:r.name,CultureThousandsPlaceholder:r.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:r.dateTimeFormat.TimeSeparator,DisplayMoney:n.DataFormatString=="{0:c}",Mask:n.Mask,MaskType:n.MaskType,ClearMaskOnLostFocus:n.MaskType>0,id:this.get_id()+"_MaskedEdit"+n.Index},null,null,t);n.MaskType==2&&c.set_InputDirection(1);Array.add(n.Behaviors,c)}n.Type.startsWith("Date")?(i=$create(AjaxControlToolkit.CalendarBehavior,{id:this._get("_Calendar",n.Index)},null,null,t),i.set_format((n.DateFmtStr?n.DateFmtStr:n.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]),o=$get(t.id+"_Button"),o&&i.set_button(o),n.TimeFmtStr&&(t=this._get("_Item$Time",n.Index),t&&(Array.add(n.Behaviors,i),i=this._attachTimeOptions(n,t)))):n.Type=="TimeSpan"?i=this._attachTimeOptions(n,t):t.type=="text"&&n.AutoCompletePrefixLength>0?i=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",this.get_controller(),this.get_viewId(),n.Name),delimiterCharacters:",;",id:this.get_id()+"_AutoComplete"+n.Index,minimumPrefixLength:n.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:this.get_servicePath(),useContextKey:!0,typeCssClass:"AutoComplete"},null,null,t):n.ItemsStyle=="AutoComplete"&&(s=this._allFields[n.AliasIndex],t=this._get("_Item",s.Index),t&&t.type=="text"&&(i=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",this.get_id(),s.Name),delimiterCharacters:"",id:this.get_id()+"_AutoComplete"+n.Index,minimumPrefixLength:n.AutoCompletePrefixLength==0?1:n.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:this.get_servicePath(),useContextKey:!0,fieldName:n.Name,enableCaching:!1,typeCssClass:"Lookup"},null,null,t)));i&&Array.add(n.Behaviors,i)}}},_detachBehaviors:function(){var e,t,r,f,u;if(!$app.mobile&&(e=this.get_quickFindElement(),e&&$clearHandlers(e),this.get_fields()!=null))for(i=0;i<this.get_fields().length;i++)if(t=this.get_fields()[i],r=this._get("_Item",t.Index),!r||!this._executeClientEditorFactories(t,r,!1)){for(t.Len>0&&t.Rows>1&&r&&r.tagName=="TEXTAREA"&&r._events&&($removeHandler(r,"keyup",this._checkMaxLengthHandler),$removeHandler(r,"blur",this._checkMaxLengthHandler)),t._lookupModalBehavior!=null&&(t._lookupModalBehavior.dispose(),t._lookupModalPanel.parentNode.removeChild(t._lookupModalPanel),delete t._lookupModalPanel,t._lookupModalBehavior=null),t._lookupDataControllerBehavior!=null&&(t._lookupDataControllerBehavior.dispose(),t._lookupDataControllerBehavior=null),f=0;f<t.Behaviors.length;f++)t.Behaviors[f].dispose();Array.clear(t.Behaviors);t.Editor&&(n.Editors[t.EditorId]=null);t.OnDemand&&(u=$(this._container).find(".drop-box-"+t.Index),u.length&&u.is(".app-drop-box")&&!u.is(".app-drop-box-destroyed")&&(t._dropBoxInput=u.next().detach(),t._dropBox=u.detach()))}},_registerDataTypeFilterItems:function(n,t,i,r,u){for(var f,o,e=null,s=0;s<i.length;s++)if(f=i[s],f){if(!f.Hidden&&(!u.SearchOptions||Array.indexOf(u.SearchOptions,f.Function)>=0)&&(e=new Web.Item(n,f.Prompt?f.Text+"...":f.Text),t.addChild(e),f.List?this._registerDataTypeFilterItems(n,e,f.List,r,u):f.Prompt?e.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),u.Index,f.Function,f.Text):e.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),u.Index,f.Function),r&&f.Function==r))for(o=e;o;)o.set_selected(!0),o=o.get_parent()}else u.SearchOptions||(e=new Web.Item(n),t.addChild(e))},_registerFieldHeaderItems:function(n,t,i,r){var it=n==null?0:n,rt=n==null?this.get_fields().length-1:n,v=this.get_sortExpression(),y,p,w,k,d,u,b,g,c,nt;for(v&&(v=v.match(/^(\w+)\s+(asc|desc)/)),y=it;y<=rt;y++){var e=null,o=[],h=t?t:String.format("{0}$FieldHeaderSelector${1}",this.get_id(),y),l=this.get_fields()[y],f=this._allFields[l.AliasIndex];if(!r||f.Aggregate==0){if(f.AllowSorting||f.AllowQBE){p=Web.DataViewResources.HeaderFilter.GenericSortAscending;w=Web.DataViewResources.HeaderFilter.GenericSortDescending;switch(f.FilterType){case"Text":p=Web.DataViewResources.HeaderFilter.StringSortAscending;w=Web.DataViewResources.HeaderFilter.StringSortDescending;break;case"Date":p=Web.DataViewResources.HeaderFilter.DateSortAscending;w=Web.DataViewResources.HeaderFilter.DateSortDescending}if(k=f.AllowSorting&&!this._sortingDisabled,k&&(d=v&&v[1]==f.Name,u=new Web.Item(h,p),d&&v[2]=="asc"?u.set_selected(!0):u.set_cssClass("SortAscending"),u.set_script('$find("{0}").sort("{1} asc")',this.get_id(),f.Name),Array.add(o,u),u=new Web.Item(h,w),d&&v[2]=="desc"?u.set_selected(!0):u.set_cssClass("SortDescending"),u.set_script('$find("{0}").sort("{1} desc")',this.get_id(),f.Name),Array.add(o,u)),f.AllowQBE&&(e=this.filterOf(f),k&&Array.add(o,new Web.Item),u=new Web.Item(h,String.format(Web.DataViewResources.HeaderFilter.ClearFilter,f.HeaderText)),u.set_cssClass("FilterOff"),e||u.set_disabled(!0),u.set_script('$find("{0}").applyFilterByIndex({1},-1)',this.get_id(),l.AliasIndex),Array.add(o,u),b=null,__designer()||(g=Web.DataViewResources.Data.Filters[f.FilterType],f.Items.length==0&&(u=new Web.Item(h,g.Text),Array.add(o,u),b=this.get_fieldFilter(f,!0),this._registerDataTypeFilterItems(h,u,g.List,b,f)),f.FilterType!="Boolean"&&(!f.SearchOptions||Array.indexOf(f.SearchOptions,"$in")>=0)&&f.AllowMultipleValues!=!1&&(u=new Web.Item(h,Web.DataViewResources.HeaderFilter.CustomFilterOption),e&&e.match(/\$(in|out)\$/)?u.set_selected(!0):u.set_cssClass("CustomFilter"),u.set_script('$find("{0}").showCustomFilter({1})',this.get_id(),l.AliasIndex),Array.add(o,u))),l.AllowSamples!=!1))if(l._listOfValues)for(e&&e.startsWith("=")&&(e=e.substring(1),e.endsWith('\0')&&(e=e.substring(0,e.length-1))),c=0;c<l._listOfValues.length;c++){c==0&&Array.add(o,new Web.Item);var a=l._listOfValues[c],tt=!1,s=a;a==null?s=Web.DataViewResources.HeaderFilter.EmptyValue:f.Items.length>0?(u=this._findItemByValue(f,a),s=u[1]):f.Type=="String"&&a.length==0?s=Web.DataViewResources.HeaderFilter.BlankValue:String.isNullOrEmpty(f.DataFormatString)||(s=f.Type.startsWith("DateTime")?String.localeFormat("{0:d}",a):f.format(a));a=this.convertFieldValueToString(f,a);tt=b=="="&&e&&a==e;s.length>Web.DataViewResources.HeaderFilter.MaxSampleTextLen&&(s=s.substring(0,Web.DataViewResources.HeaderFilter.MaxSampleTextLen)+"...");typeof s!="string"&&(s=s.toString());u=new Web.Item(h,s);tt&&u.set_selected(!0);u.set_script("$find('{0}').applyFilterByIndex({1},{2});",this.get_id(),l.AliasIndex,c);u.set_group(1);Array.add(o,u)}else(!f.SearchOptions||Array.indexOf(f.SearchOptions,"=")>=0)&&(u=new Web.Item(h,Web.DataViewResources.HeaderFilter.Loading),u.set_dynamic(!0),u.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',this.get_id(),h,l.Name,f.Name),Array.add(o,u))}if(t){for(u=new Web.Item(t,f.HeaderText),Array.add(i,u),c=0;c<o.length;c++)nt=o[c],u.addChild(nt);nt.get_selected()&&u.set_selected(!0);e&&u.set_selected(!0)}else $registerItems(h,o,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}}},_get_specialAction:function(n){if(!this._specialActions)return null;var i=this._specialActions[n+"Text"],t=this._specialActions[n+"Script"];return String.isNullOrEmpty(t)?null:{text:i,script:t}},_registerSpecialAction:function(n,t,i,r){if(!this._specialActions.PrintText&&n.CommandName.match(/^Report/)){if(r==null&&!this._isActionAvailable(n))return;this._specialActions.PrintText=n.HeaderText;this._specialActions.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",this.get_id(),i,t)}else if(n.CssClass=="AttachIcon"){if(r==null&&!this._isActionAvailable(n))return;this._specialActions.AnnotateText=n.HeaderText;this._specialActions.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",this.get_id(),i,t)}},_registerActionBarItems:function(){var o=this.get_actionGroups("ActionBar"),s=this.get_isChart(),r,u,i,f,n,t,e;for(s&&!this.get_showViewSelector()&&(r=String.format("{0}${1}$ActionGroup$Chart",this.get_id(),this.get_viewId()),u=[],this._registerFieldHeaderItems(null,r,u,!0),$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)),this._specialActions={PrintText:null,PrintScript:null,AnnotateText:null,AnnotateScript:null},i=0;i<o.length;i++)if(f=o[i],r=String.format("{0}${1}$ActionGroup${2}",this.get_id(),this.get_viewId(),i),f.Flat)for($unregisterItems(r),n=0;n<f.Actions.length;n++)this._registerSpecialAction(f.Actions[n],i,n);else{for(u=[],n=0;n<f.Actions.length;n++)t=f.Actions[n],this._isActionAvailable(t)&&(e=new Web.Item(r,t.HeaderText,t.Description),e.set_cssClass(t.CssClassEx+(String.isNullOrEmpty(t.CssClass)?t.CommandName+"LargeIcon":t.CssClass)),Array.add(u,e),e.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",this.get_id(),n,i)),this._registerSpecialAction(t,i,n,!0));$registerItems(r,u,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}Array.clear(o)},_registerViewSelectorItems:function(){for(var t,i,r=[],n=this,u=n.get_id()+"$ViewSelector",f=0;f<n.get_views().length;f++)t=n.get_views()[f],(t.Type!="Form"&&t.ShowInSelector||t.Id==n.get_viewId())&&(i=new Web.Item(u,t.Label),t.Id==this.get_viewId()&&i.set_selected(!0),i.set_script(function(t){n.executeCommand({commandName:"Select",commandArgument:t.Id})}),i.context(t),Array.add(r,i));n.get_isChart()&&(Array.add(r,new Web.Item),n._registerFieldHeaderItems(null,u,r,!0));$registerItems(u,r,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var r=this.get_actions("Grid"),n,u,e,i,t,f;if(r&&r.length>0)for(n=0;n<this._rows.length;n++){for(u=[],e=String.format("{0}$RowSelector${1}",this.get_id(),n),i=0;i<r.length;i++)t=r[i],this._isActionAvailable(t,n)&&(f=new Web.Item(e,t.HeaderText,t.Description),f.set_cssClass(t.CssClassEx+(String.isNullOrEmpty(t.CssClass)?t.CommandName+"Icon":t.CssClass)+(u.length==0?" Default":"")),Array.add(u,f),f.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',this.get_id(),i,n)));$registerItems(e,u,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(n=0;n<this._rows.length;n++)$unregisterItems(String.format("{0}$RowSelector${1}",this.get_id(),n))},_get_searchBarSettings:function(){var o,i,l,t,nt,f,tt,u,w,d,r,s,h,e,a,v,b,y,g;if(this._searchBarSettings||(this._searchBarSettings=[]),o=this._searchBarSettings[this.get_viewId()],!o){var k=[],c=[],p=this.get_filter();if(p.length>0&&!this.filterIsExternal())for(i=0;i<p.length;i++)(l=p[i].match(n._fieldFilterRegex),t=this.findField(l[1]),t&&!this._fieldIsInExternalFilter(t))&&(nt=this._allFields[t.AliasIndex],f=l[2].match(n._filterRegex),l[2].startsWith("~")||(t._renderedOnSearchBar=!0,tt=this._findItemByValue(t,f[3]),u=f[3],u=="null"&&(u=""),w=u.match(/^([\s\S]+?)\0?$/),w&&(u=w[1]),d=t.Items.length==0?f[1]:"$in",r=$app.filterDef(Web.DataViewResources.Data.Filters[t.FilterType].List,t.FilterType=="Boolean"&&f[3].length>1?f[3]=="%js%true"?"$true":"$false":d),r&&(s=u.match(/^(.+?)\$and\$(.+?)$/),Array.add(c,{Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false"),Value:s?s[1]:u,Value2:s?s[2]:""}))));for(h=!1,i=0;i<this._allFields.length;i++)if(t=this._allFields[i],h=t.Search==Web.FieldSearchMode.Required||t.Search==Web.FieldSearchMode.Suggested,h)break;for(i=0;i<this._allFields.length;i++)if(e=this._allFields[i],t=this._allFields[e.AliasIndex],t.AllowQBE&&t.Search!=Web.FieldSearchMode.Forbidden&&(!e.Hidden||e.Search!=Web.FieldSearchMode.Default)){if(a=!h&&c.length<Web.DataViewResources.Grid.VisibleSearchBarFields||h&&(e.Search==Web.FieldSearchMode.Required||e.Search==Web.FieldSearchMode.Suggested),!t._renderedOnSearchBar){for(v=t.Items.length==0||t.FilterType=="Boolean"?null:"$in",t.SearchOptions&&(v=t.SearchOptions[0]),b=Web.DataViewResources.Data.Filters[t.FilterType].List,y=0;y<b.length;y++)if(r=b[y],v==null||r.Function==v)break;g={Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false")};(a||this.findFieldUnderAlias(t)==t||t.VisibleOnSearchBar==null)&&Array.add(a?c:k,g);t.VisibleOnSearchBar=a}t._renderedOnSearchBar=!1}o={visibleFields:c,availableFields:k};this._searchBarSettings[this.get_viewId()]=o}return o},_lookupActionProcessing:function(n){return n!=null&&(this._standardActionProcessing=!n),this._standardActionProcessing!=!0},search:function(n){var t=this,r=[],i,f;if(n){if(n.sortExpression&&(t._sortExpression=n.sortExpression,i=t.readContext("vitals"),i&&(i.SortExpression=n.sortExpression)),n._filter&&(t._filter=n._filter.slice(0)),n.filter){function u(n){return Date.isInstanceOfType(n)&&(n=new Date(n-n.getTimezoneOffset()*6e4)),String.format("%js%{0}",e.serialize(n))}$(n.filter).each(function(){var t=this,n=t.value||t.values,i=t.operator,f;i.match(/\w/)&&(i="$"+i+"$");Array.isInstanceOfType(n)?(f=new Sys.StringBuilder,$(n).each(function(n){n>0&&f.append(i=="$between$"?"$and$":"$or$");f.append(u(this))}),n=f.toString()):n=u(n);r.push(String.format("{0}:{1}{2}",t.name||t.field,i,n))});t._filter=r}n._init||t.sync()}else return t._lookupActionProcessing(!1),f=t._hasSearchAction&&t.executeActionInScope(["ActionBar","Form"],"Search",null,-1),t._lookupActionProcessing(!0),f},_toggleSearchBar:function(){this._hasSearchShortcut&&this.search()||(this.set_searchBarIsVisible(!this.get_searchBarIsVisible()),this._updateSearchBar(),this.get_searchBarIsVisible()&&(this.get_lookupField()&&this._adjustLookupSize(),this._focusSearchBar()),_body_performResize())},_renderSearchBarFieldNameOptions:function(t,i,r){var u,f,e;if(i.Search!=Web.FieldSearchMode.Required)for(u=0;u<r.availableFields.length;u++)f=r.availableFields[u],e=this._allFields[f.Index],t.appendFormat('<option value="{0}">{1}<\/option>',u,n.htmlEncode(e.HeaderText))},_renderSearchBarFunctionOptions:function(t,i,r,u,f){for(var e,s,o=0;o<r.length;o++)if(e=r[o],e)if(e.List)this._renderSearchBarFunctionOptions(t,i,e.List,u);else if(f==null||e.Function==f){var h=String.format("{0},{1}",n.htmlAttributeEncode(e.Function),e.Prompt?"true":"false"),l=h==u.Function?' selected="selected"':"",c=String.format('<option value="{0}"{1}>{2}{3}<\/option>',h,l,e.Prompt?"":Web.DataViewResources.Data.Filters.Labels.Equals+" ",e.Function.match(n._keepCapitalization)?e.Text:e.Text.toLowerCase());i.SearchOptions?(s=Array.indexOf(i.SearchOptions,e.Function),s>=0&&(i.SearchOptionSet[s]=c)):t.append(c)}},_renderSearchBarField:function(t,i,r){var c=i.visibleFields[r],u=this._allFields[c.Index],k=u.Items.length==0||u.FilterType=="Boolean"?null:"$in",l=c.Function.match(/^(.+?),(true|false)$/),e,s,h,w,o,b,v,a;if(t.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}<\/option>',this.get_id(),r,n.htmlEncode(u.HeaderText),$nextTabIndex()),this._renderSearchBarFieldNameOptions(t,u,i),t.append("<\/select><\/td>"),t.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',this.get_id(),r,$nextTabIndex()),u.SearchOptions&&(u.SearchOptionSet=[]),this._renderSearchBarFunctionOptions(t,u,Web.DataViewResources.Data.Filters[u.FilterType].List,c,k),u.SearchOptions)for(e=0;e<u.SearchOptionSet.length;e++)t.append(u.SearchOptionSet[e]);t.append("<\/select><\/td>");var y=u.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",p=l[1]=="$in"||l[1]=="$notin",f=c.Value;if(p){if(s=new Sys.StringBuilder,h=!String.isNullOrEmpty(f),s.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="$app.highlightFilterValues(this,true,\'Active\')" onmouseout="$app.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" title="{5}">',this.get_id(),u.Index,r,h?"":" Empty",$nextTabIndex(),Web.DataViewResources.Data.Filters.Labels.FilterToolTip),h)for(w=f.split(/\$or\$/),e=0;e<w.length;e++)e>0&&s.append('<span class="Highlight">, <\/span>'),o=w[e],String.isJavaScriptNull(o)?o=Web.DataViewResources.HeaderFilter.EmptyValue:(o=this.convertStringToFieldValue(u,o),b=this._findItemByValue(u,o),o=b?b[1]:u.format(o)),s.append(o);else s.append(Web.DataViewResources.Lookup.SelectLink);s.appendFormat('<\/a><\/div><\/td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" >&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),h?-1:u.Index,r,h?Web.DataViewResources.Data.Filters.Labels.Clear:Web.DataViewResources.Data.Filters.Labels.FilterToolTip,$nextTabIndex(),h?" Clear":"");y=s.toString()}else String.isNullOrEmpty(f)||(f=f.split(/\$or\$/)[0]);l[2]=="true"?(typeof f!="string"||p||(f=u.format(this.convertStringToFieldValue(u,f))),t.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2} {7}" value="{3}" tabindex="{4}"/>{5}<\/td>',this.get_id(),r,u.FilterType,n.htmlAttributeEncode(f=="null"?Web.DataViewResources.HeaderFilter.EmptyValue:f),$nextTabIndex(),y,p?"hidden":"text",u.AllowAutoComplete!=!1?" AutoComplete":"")):t.append("<td>&nbsp;<\/td>");v=$nextTabIndex();l[1]=="$between"&&(v=$nextTabIndex());t.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span><\/span<\/a><\/td>',this.get_id(),v,Web.DataViewResources.Grid.RemoveCondition,r);t.append("<\/tr>");u.FilterType!="Text"&&l[1]=="$between"&&(a=c.Value2,typeof a=="string"&&(a=u.format(this.convertStringToFieldValue(u,a))),t.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}<\/td><td><input id="{0}$SearchBarValue2${1}" type="text" class="{2}" value="{3}" tabindex="{5}"/>{6}<\/td><td>&nbsp;<\/td><\/tr>',this.get_id(),r,u.FilterType,n.htmlAttributeEncode(a),Web.DataViewResources.Data.Filters.Labels.And,v-1,y))},_focusSearchBar:function(n){var u=n!=null,i,t,r;u||(n=0);i=this._get_searchBarControl("Function",n);i||(n=0,i=this._get_searchBarControl("Function",0));t=this._get_searchBarControl("Value",n);t?t.type=="hidden"?(r=t.parentNode.getElementsByTagName("a")[0],r.focus(),u&&this._searchBarVisibleIndex==null&&String.isNullOrEmpty(t.value)&&r.click()):Sys.UI.DomElement.setFocus(t):i&&i.focus()},_searchBarNameChanged:function(n,t){var i,u,f,r;this._saveSearchBarSettings();i=this._get_searchBarSettings();u=i.visibleFields[n];t?Array.removeAt(i.visibleFields,n):(f=this._get_searchBarControl("Name",n),r=s(f.value),i.visibleFields[n]=i.availableFields[r],Array.removeAt(i.availableFields,r));Array.insert(i.availableFields,0,u);this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarFuncChanged:function(n){this._saveSearchBarSettings();var t=this._get_searchBarSettings(),i=t.visibleFields[n],r=this._get_searchBarControl("Function",n);i.Function=r.value;this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarAddField:function(){this._saveSearchBarSettings();var n=this._get_searchBarSettings();Array.add(n.visibleFields,n.availableFields[0]);Array.removeAt(n.availableFields,0);this._renderSearchBarControls(!0);this._focusSearchBar(n.visibleFields.length-1)},_createSearchBarFilter:function(n){for(var l,i,r,v,u,f,e,s,y,p,w=Array.clone(this._filter),a=this._get_searchBarSettings(),h=[],c=!0,t=0;t<a.visibleFields.length;t++)if(l=a.visibleFields[t],i=this._allFields[l.Index],this.removeFromFilter(i),r=l.Function.match(/^(.+?),(true|false)$/),v=[],r[2]=="true"){if(u=this._get_searchBarControl("Value",t),f=this._get_searchBarControl("Value2",t),String.isBlank(u.value)&&(!f||String.isBlank(f.value))&&i.Search!=Web.FieldSearchMode.Required)continue;if(r[1]=="$in"||r[1]=="$notin"){Array.add(h,{Index:i.Index,Function:r[1],Values:[u.value]});continue}if(String.isBlank(u.value)){if(n)continue;else alert(o.RequiredField),Sys.UI.DomElement.setFocus(u),c=!1;break}if(e={NewValue:u.value.trim()},s=this._validateFieldValueFormat(i,e),s)if(n)continue;else{alert(s);Sys.UI.DomElement.setFocus(u);c=!1;break}else Array.add(v,i.Type.startsWith("DateTime")?u.value.trim():e.NewValue);if(r[1]=="$between"){if(String.isBlank(f.value)){if(n)continue;else alert(o.RequiredField),Sys.UI.DomElement.setFocus(f),c=!1;break}if(e={NewValue:f.value.trim()},s=this._validateFieldValueFormat(i,e),s)if(n)continue;else{alert(s);Sys.UI.DomElement.setFocus(f);c=!1;break}else Array.add(v,i.Type.startsWith("DateTime")?f.value.trim():e.NewValue)}Array.add(h,{Index:i.Index,Function:r[1],Values:v})}else Array.add(h,{Index:i.Index,Function:r[1],Values:null});if(!c)return null;for(t=0;t<a.availableFields.length;t++)l=a.availableFields[t],i=this._allFields[l.Index],this.removeFromFilter(i);for(t=0;t<h.length;t++)y=h[t],this.applyFieldFilter(y.Index,y.Function,y.Values,!0);return p=this._filter,this._filter=w,p},_executeSearch:function(t){var f=this.get_action(t),e,r,i,u,o;if(!f||f.Confirmation&&f.Confirmation.match(/_controller\s*=/))this._clearSelectedKey(),this._cancelConfirmation(),this.refreshAndResize();else for(e=Sys.Application.getComponents(),r=0;r<e.length;r++)i=e[r],n.isInstanceOfType(i)&&i._hasSearchAction&&(u=i.get_action(i._hasSearchAction),u&&u.Confirmation&&(o=u.Confirmation.match(/_controller\s*=\s*(\w+)/),o&&o[1]==this._controller&&i.search()))},_performSearch:function(){if(!this._isBusy){this._saveSearchBarSettings();var n=this._createSearchBarFilter(!1);n&&(this.set_filter(n),this.refreshData(),this._setFocusOnSearchBar=!0);this._forgetSelectedRow(!0)}},_resetSearchBar:function(){this._isBusy||(this.clearFilter(),this._searchBarSettings[this.get_viewId()]=null,this._renderSearchBarControls(!0),this._focusSearchBar())},_get_searchBarControl:function(n,t){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),n,t))},_saveSearchBarSettings:function(){for(var r=this._get_searchBarSettings(),n=0;n<r.visibleFields.length;n++){var t=r.visibleFields[n],f=this._get_searchBarControl("Function",n),i=this._get_searchBarControl("Value",n),u=this._get_searchBarControl("Value2",n);t.Function=f.value;i&&(i.value==Web.DataViewResources.HeaderFilter.EmptyValue?"null":i.value,t.Value=this._formatSearchField(i,t.Index));u&&(t.Value2=this._formatSearchField(u,t.Index))}},_formatSearchField:function(n,t){var i=this._allFields[t],r,u;return i.Type.startsWith("Date")?(r=Date.tryParseFuzzyDate(n.value,i.DataFormatString),r!=null&&(n.value=i.format(r))):i.Type!="String"&&(u=Number.tryParse(n.value,i.DataFormatString),u!=null&&(n.value=i.format(u))),n.value},_renderSearchBarControls:function(n){var s,i,u,t,f,h,e,r,o,l;if(!this._searchBarInitialized||n){for(s=$get(this.get_id()+"$SearchBarContent"),this._searchBarInitialized=!0,i=new Sys.StringBuilder,i.append('<table class="SearchBarFrame">'),u=this._get_searchBarSettings(),t=0;t<u.visibleFields.length;t++)this._renderSearchBarField(i,u,t);for(u.availableFields.length>0&&i.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}<\/a><\/td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span><\/span><\/a><\/td>',this.get_id(),$nextTabIndex(),Web.DataViewResources.Grid.AddCondition,Web.DataViewResources.Grid.AddConditionText),i.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"><\/div><\/td><td><div id="{0}$SearchBarFuncStub" class="Stub"><\/div><\/td><td><\/td><\/tr>',this.get_id()),i.append("<\/table>"),i.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}" class="Search">{1}<\/button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}" class="Reset">{2}<\/button><\/div>',this.get_id(),a.Grid.PerformAdvancedSearch,a.Data.Filters.Labels.Clear,$nextTabIndex(),$nextTabIndex()),s.innerHTML=i.toString(),i.clear(),f=$get(this.get_id()+"$SearchBarNameStub"),f.style.width=f.offsetWidth+"px",f=$get(this.get_id()+"$SearchBarFuncStub"),f.style.width=f.offsetWidth+"px",h=s.getElementsByTagName("select"),t=0;t<h.length;t++)h[t].style.width="100%";for(this._searchBarExtenders||(this._searchBarExtenders=[]),t=0;t<u.visibleFields.length;t++){var v=u.visibleFields[t],y=this._allFields[v.Index],c=this._get_searchBarControl("Value",t);if(c)if(v.Function.match(/\$(in|notin),/)==null)e=this._createFieldInputExtender("SearchBar",y,c,t),e&&Array.add(this._searchBarExtenders,e);else{for(r=c;r&&r.tagName!="TR";)r=r.parentNode;for(o=0;o<r.childNodes.length;o++)r.childNodes[o].vAlign="top"}l=this._get_searchBarControl("Value2",t);l&&(e=this._createFieldInputExtender("SearchBar",y,l,t+"$2"),e&&Array.add(this._searchBarExtenders,e))}}},_updateSearchBar:function(){var r=this._get("$SearchBar"),n,t,u,i;r&&(n=this.get_searchBarIsVisible(),t=this._get("$SearchBarActivator"),t&&(n?Sys.UI.DomElement.addCssClass(t,"Activated"):Sys.UI.DomElement.removeCssClass(t,"Activated")),Sys.UI.DomElement.setVisible(r,n),n&&this._renderSearchBarControls(r),t&&(Sys.UI.DomElement.setVisible(this._get("$QuickFind"),!n),u=this._get("$SearchToggle"),u.title=this._hasSearchAction&&this._hasSearchShortcut?Web.DataViewResources.Grid.PerformAdvancedSearch:this.get_searchBarIsVisible()?Web.DataViewResources.Grid.HideAdvancedSearch:Web.DataViewResources.Grid.ShowAdvancedSearch),i=this._get("$InfoRow"),i&&(n?Sys.UI.DomElement.addCssClass(i,"WithSearchBar"):Sys.UI.DomElement.removeCssClass(i,"WithSearchBar")),this._setFocusOnSearchBar&&(this._setFocusOnSearchBar=!1,this._focusSearchBar()))},_renderSearchBarActivator:function(n){this.get_showSearchBar()&&(this.get_showQuickFind()||!this.get_searchOnStart())&&(n.appendFormat('<td class="SearchBarActivator{1}" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span><\/span><\/a><\/td>',this.get_id(),this._hasSearchAction&&this._hasSearchShortcut?" Search":""),this.get_showQuickFind()||n.append('<td class="Divider"><div><\/div><\/td>'))},_internalRenderActionBar:function(t){var o=this.get_actionGroups("ActionBar"),s,h,c,f,u,e,l,r,i;if(t.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>'),s=this.get_isGrid(),s&&this._renderSearchBarActivator(t),s&&this.get_showQuickFind()?(h=this.get_quickFindText(),t.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/><\/td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;<\/span><\/a><\/td><\/tr><\/table><\/div><\/td>',this.get_id(),n.htmlAttributeEncode(h),Web.DataViewResources.Grid.QuickFindToolTip,h==Web.DataViewResources.Grid.QuickFindText?"Empty":"NonEmpty",$nextTabIndex()),t.append('<td class="Divider"><div><\/div><\/td>'),this.get_lookupField()&&!String.isNullOrEmpty(this.get_lookupField().ItemsNewDataView)&&t.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"><\/span><\/a><\/td>',this.get_id(),Web.DataViewResources.Lookup.GenericNewToolTip,$nextTabIndex())):(o.length==0||this.get_lookupField())&&t.append('<td class="Divider"><div style="visibility:hidden"><\/div><\/td>'),!this.get_lookupField())for(this._registerActionBarItems(),c=this.get_isChart()&&!this.get_showViewSelector(),c&&t.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),f=0;f<o.length;f++)if((f>0||c)&&t.append('<td class="Divider"><div><\/div><\/td>'),u=o[f],u.Flat){for(e=-1,l=-1,r=0;r<u.Actions.length;r++)i=u.Actions[r],i._isAvailable=this._isActionAvailable(i)&&!String.isNullOrEmpty(i.HeaderText),i._isFirst=!1,i._isLast=!1,i._isAvailable&&(e==-1&&(e=r),l=r);for(e>=0&&(u.Actions[e]._isFirst=!0,u.Actions[l]._isLast=!0),r=0;r<u.Actions.length;r++)i=u.Actions[r],i._isAvailable&&t.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})" title="{10}"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)">{3}<\/a><\/span><\/td>',this.get_id(),r,f,n.htmlEncode(i.HeaderText),$nextTabIndex(),String.isNullOrEmpty(i.CssClass)?"":String.format('<span class="FlatGroupIcon {0}">&nbsp;<\/span>',n.cssToIcon(i.CssClass)),String.isNullOrEmpty(i.CssClass)?"":" FlatGroupWithIcon",i.CssClassEx,i._isFirst?" First":"",i._isLast?" Last":"",i.Description)}else t.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),f,u.HeaderText,$nextTabIndex(),u.CssClassEx);t.append("<\/tr><\/table>")},_renderActionBar:function(t){if(!this.get_showActionBar()){this._registerActionBarItems();return}t.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',this._get_colSpan());t.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',this.get_id());this._internalRenderActionBar(t);this._registerViewSelectorItems();t.append('<\/td><td class="ViewSelectorControl">');this.get_showViewSelector()&&(t.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:<\/td><td>',Web.DataViewResources.ActionBar.View),t.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}<\/a><\/span><\/span><\/span>',this.get_id(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),t.append("<\/td><\/tr><\/table>"));t.append("<\/td><\/tr><\/table>");t.append("<\/td><\/tr>")},get_statusBar:function(){var n=this,t=n._statusBar||n._statusBarAuto;return t||!n._isWizard||n.tagged("status-bar-disabled")||(t=n._statusBarAuto=n._controller+"."+n._viewId+"._wizard: 0\n"+a.HeaderFilter.Loading+">\n"),t},_renderStatusBar:function(n){n.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"><\/td><\/tr>',this.get_id(),this._get_colSpan())},statusBar:function(){var a=this.get_statusBar(),e,u,t,o,r,f,s,h,i;if(!String.isNullOrEmpty(a))for(u=/((\w+)\.)?((\w+)\.)?(\w+):\s*(.+?)\s*\n\s*(((.+?)\s*>\s*)+)/g,t=u.exec(a);t;){if(o=this.fieldValue(t[5]),o==null&&(o="null"),(t[6]==o||t[6]=="*")&&(String.isNullOrEmpty(t[2])||t[2]==this.get_controller())&&(String.isNullOrEmpty(t[3])||t[4]==this.get_viewId())){for(u=/(\[)?\s*(.+?)\s*(\])?\s*>\s*/g,r=[],f=u.exec(t[7]);f;)Array.add(r,{Text:f[2],Current:f[1]=="["&&f[3]=="]"}),f=u.exec(t[7]);if(r.length>0&&!(__tf!=4)){for(e=new Sys.StringBuilder('<ul class="StatusBar">'),s=!1,h=!0,i=0;i<r.length;i++)if(r[i].Current){s=!0;h=!1;break}for(i=0;i<r.length;i++){var c=r[i],l=c.Current?"Current":s?"Past":h?"Future":"",v=i<r.length-1?r[i+1]:null,y="";v&&(v.Current?y=l+"ToCurrent":c.Current&&(y=v.Current?l+"ToCurrent":l+"ToFuture"));c.Current&&(s=!1,h=!0);e.appendFormat('<li class="Segment {1}{2}{3} {4}"><span class="Outer"><span class="Inner"><span class="Self">{0}<\/span><\/span><\/span><\/li>',n.htmlEncode(c.Text),l,i==0?" First":"",i==r.length-1?" Last":"",y)}e.append("<\/ul>")}break}t=u.exec(a)}return e?e.toString():null},_updateStatusBar:function(){var i=this.get_statusBar(),t,n;String.isNullOrEmpty(i)||(n=$(this._get("$StatusBar")),n.length&&(t=this.statusBar(),t?n.html(t).parent().show():n.parent().hide()))},filterByFirstLetter:function(n){var t=this._firstLetters[0],i=this._firstLetters[n];this.applyFieldFilter(this.findField(t).Index,"$beginswith",[i])},_renderViewDescription:function(t){var l=this._firstLetters&&this._firstLetters.length>2,h=this.get_showDescription(),u,e,f,o,c,i,r,a,s;if(h||l){if(u=h?this.get_description():"",e=null,l){for(f=new Sys.StringBuilder,f.append('<div class="Letters">'),o=this.findField(this._firstLetters[0]),c=null,i=0;i<this._filter.length;i++)if(r=this._filter[i].match(n._fieldFilterRegex),r&&r[1]==o.Name){r=r[2].match(/^\$beginswith\$(.+?)\0$/);r&&(c=this.convertStringToFieldValue(o,r[1]));break}for(a=String.format("{0} {1} ",n.htmlAttributeEncode(o.Label),Web.DataViewResources.Data.Filters.Text.List[2].Text.toLowerCase()),i=1;i<this._firstLetters.length;i++)s=this._firstLetters[i],f.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}<\/a> ',this.get_id(),i,s,a,n.htmlAttributeEncode(s),c==s?" Selected":"");f.append("<\/div>");e=f.toString();f.clear()}h&&String.isNullOrEmpty(u)&&(u=this.get_view().HeaderText);(!String.isNullOrEmpty(u)||this.get_lookupField()||e)&&(t.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',this._get_colSpan()),this.get_lookupField()!=null&&t.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">'),t.appendFormat('<div id="{0}$HeaderText">',this.get_id()),t.append(this._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[u],!0,u)),t.append("<\/div>"),e&&t.append(e),this.get_lookupField()!=null&&t.appendFormat('<\/td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),Web.DataViewResources.ModalPopup.Close,$nextTabIndex()),t.append("<\/td><\/tr>"))}},_renderInfoBar:function(n){var i=this.get_filter(),t;i.length>0&&!this.filterIsExternal()&&(t=new Sys.StringBuilder,this.get_viewType()!="Form"&&this._renderFilterDetails(t,i),this.get_viewType()=="Form"||t.isEmpty()||(n.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',this.get_id(),this._get_colSpan(),this.get_viewType()),n.append(t.toString()),n.append("<\/td><\/tr>")),t.clear())},_renderFilterDetails:function(t,i,r){function et(n){for(var t=v+1;t<i.length;){if(i[t].match(/^(_match_|_donotmatch)/))break;t++}return t-v>2?d[n+"PastTense"]:n.startsWith("DoNot")?d.DidNotMatch:d.Matched}function ut(n,t,i){return n.getHours&&(n.getHours()==0&&n.getMinutes()==0&&n.getSeconds()==0||i&&n.getHours()==23&&n.getMinutes()==59&&n.getSeconds()==59)?String.format("{0:d}",n):t}for(var it=!1,o=this,l,b,rt=o.viewProp&&o.viewProp("deepSearchInfo"),y=0,k,d=Web.DataViewResources.Mobile,a,h,f,c,tt,w,v=0;v<i.length;v++){var s=i[v].match(n._fieldFilterRegex),g=s[1]=="_quickfind_",u=g?o._fields[0]:o.findField(s[1]),p;if(!u&&s[1].match(/\,/)&&rt){k++>0&&t.append("; ");t.append(rt[s[1].replace(/\W/g,"_")+(y-1)]);continue}if(!u||this._fieldIsInExternalFilter(u)){s[1]=="_match_"?p="Match":s[1]=="_donotmatch_"&&(p="DoNotMatch");p&&(p+=s[2]=="$all$"?"All":"Any",y>0&&t.append(". "),t.append(et(p)),t.append(": "),y++,k=0);continue}it||(r!=!1&&t.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').clearFilter();return false" class="Close" tabindex="{3}" title="{2}">&nbsp;<\/a><span class="Details"><span class="Information">&nbsp;<\/span>{1} ',this.get_id(),Web.DataViewResources.InfoBar.FilterApplied,Web.DataViewResources.ModalPopup.Close,$nextTabIndex()),it=!0);for(var ft=u&&this._allFields[u.AliasIndex],e=n._filterIteratorRegex.exec(s[2]),nt=!0;e&&(e[1].startsWith("~")||!(u.Index==u.AliasIndex&&u.IsPrimaryKey&&u.Hidden));){if(nt?t.appendFormat('<span class="FilterElement" onclick="$find(\'{0}\').removeFromFilterByIndex({1})" title="{2}">',this.get_id(),g?-1:u.Index,g?Web.DataViewResources.Data.Filters.Labels.Clear:n.htmlAttributeEncode(String.format(Web.DataViewResources.HeaderFilter.ClearFilter,u.Label))):t.append(", "),e[1].startsWith("~"))t.appendFormat(String.format('{0} <b class="String">{1}<\/b>',Web.DataViewResources.InfoBar.QuickFind,this.convertStringToFieldValue(u,e[3]))),l=$app.touch&&o.viewProp("quickFindHint"),l&&(l=l.split(";"),t.append(" "+Web.DataViewResources.Mobile.In+" "),l[0]?t.append(o.get_view().Label):b=!0,$($app.touch._pages).each(function(){var r=this,n=r.dataView,i;n&&o._id==n._filterSource&&(i=l.indexOf(n._controller+"."+n._viewId+"."+n._filterFields),i!=-1&&(b?b=!1:i==l.length-1?t.append(" "+Web.DataViewResources.Data.Filters.Labels.And+" "):t.append(", "),t.append(n.get_view()&&n.get_view().Label||r.text)))}));else if(k++>0&&t.append("; "),t.appendFormat('<span class="Highlight">{0}<\/span>',o._fieldNameHint&&o._fieldNameHint[ft.Name]||ft.HeaderText),a=$app.filterDef(Web.DataViewResources.Data.Filters[u.FilterType].List,u.FilterType=="Boolean"&&e[3].length>1?e[3]=="%js%true"?"$true":"$false":e[1]),a)if(a.Prompt){if(t.appendFormat(" {0} ",a.Text.toLowerCase()),f=e[3],c=f.split(n._listRegex),String.isJavaScriptNull(c[0])&&(c[0]=Web.DataViewResources.InfoBar.Empty),!String.isJavaScriptNull(e[2]))for(tt=c[0].match(/^([\s\S]+?)\0?$/),tt&&(c[0]=tt[1]),f=this.convertStringToFieldValue(u,c[0]),h=this._findItemByValue(u,f),t.appendFormat("<b>{0}<\/b>",String.htmlEncode(h?h[1]:ut(f,u.format(f)))),w=1;w<c.length;w++)if(t.appendFormat("{0} ",e[1]=="$between$"?" "+Web.DataViewResources.Data.Filters.Labels.And:", "),f=this.convertStringToFieldValue(u,c[w]),f==null?f=Web.DataViewResources.HeaderFilter.EmptyValue:(h=this._findItemByValue(u,f),f=h?h[1]:ut(f,u.format(f),!0)),t.appendFormat('<b class="{1}">{0}<\/b>',String.htmlEncode(f)),w>5){t.append(", ..");break}}else t.appendFormat(" {0} <b>{1}<\/b>",Web.DataViewResources.Data.Filters.Labels.Equals,a.Function.match(n._keepCapitalization)?a.Text:a.Text.toLowerCase());else{switch(e[1]){case"=":t.append(String.isJavaScriptNull(e[2])?Web.DataViewResources.InfoBar.Empty:Web.DataViewResources.InfoBar.EqualTo);break;case"<":t.append(Web.DataViewResources.InfoBar.LessThan);break;case"<=":t.append(Web.DataViewResources.InfoBar.LessThanOrEqual);break;case">":t.append(Web.DataViewResources.InfoBar.GreaterThan);break;case">=":t.append(Web.DataViewResources.InfoBar.GreaterThanOrEqual);break;case"*":t.append(e[2].startsWith("%")?Web.DataViewResources.InfoBar.Like:Web.DataViewResources.InfoBar.StartsWith)}h=this._findItemByValue(u,this.convertStringToFieldValue(u,e[3]));f=h==null?e[3]:h[1];f=String.isJavaScriptNull(e[3])||String.isBlank(f)?Web.DataViewResources.InfoBar.Empty:this.convertStringToFieldValue(u,f);t.appendFormat("<b>{0}<\/b>",String.htmlEncode(f))}e=n._filterIteratorRegex.exec(s[2]);nt=!1}nt||y||o._fieldNameHint||t.append(".");t.append("<\/span> ")}y&&t.append(". ");t.append("<\/span>")},_findItemByValue:function(t,i){var u=t.DynamicItems||t.Items,r=t.ItemCache;return u.length==0?null:(r||(r=t.ItemCache={},$(u).each(function(){var n=this;r[n[0]]=n})),r[i]||[null,this.get_isForm()||n.touch?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue])},_renderPager:function(n,t){var c,u,f,e,o,s,h,l;if(this.get_showPager().indexOf(t)!=-1){if(c=this.get_isChart(),n.appendFormat('<tr class="FooterRow {2}PagerRow"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{1}">',this._get_colSpan(),c?" Print":"",t),u=this.get_pageCount(),f=this.get_pageSize(),c&&(u=1,f=this._totalRowCount,e=this._get_specialAction("Print"),e&&n.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span><\/span><\/a><\/td><td>',e.text,e.script)),u>1){var r=this._firstPageButtonIndex,a=this.get_pagerButtonCount(),v=a;for(this.get_pageIndex()>0?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()-1,this.get_id(),Web.DataViewResources.Pager.Previous,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',Web.DataViewResources.Pager.Previous),n.appendFormat(" | {0}: ",Web.DataViewResources.Pager.Page),r>0&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage(0,true);return false" class="PaddedLink" tabindex="{2}">1<\/a><a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">...<\/a>',r-1,this.get_id(),$nextTabIndex(),$nextTabIndex());v>0&&r<u;)r==this.get_pageIndex()?n.appendFormat('<span class="Selected">{0}<\/span>',r+1):n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',r,this.get_id(),r+1,$nextTabIndex()),r++,v--;r<=u-1&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...<\/a><a href="#" onclick="$find(\'{1}\').goToPage({3}-1,true);return false" class="PaddedLink" tabindex="{4}">{3}<\/a>',this._firstPageButtonIndex+a,this.get_id(),$nextTabIndex(),u,$nextTabIndex());n.append(" | ");this.get_pageIndex()<u-1?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()+1,this.get_id(),Web.DataViewResources.Pager.Next,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',Web.DataViewResources.Pager.Next)}if(n.append('<\/td><td align="right" class="Pager PageSize">&nbsp;'),o=this.get_showPageSize(),s=this._pageSizes,o&&this._totalRowCount>f){for(n.append(Web.DataViewResources.Pager.ItemsPerPage),i=0;i<s.length;i++)i>0&&n.append(", "),f==s[i]?n.appendFormat("<b>{0}<\/b>",f):n.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}<\/a>',this.get_id(),s[i],$nextTabIndex());n.append(" | ")}this._totalRowCount>0&&(h=(this.get_pageIndex()+1)*f,h>this._totalRowCount&&(h=this._totalRowCount),o&&n.appendFormat(Web.DataViewResources.Pager.ShowingItems,this.get_pageIndex()*f+1,h,this._totalRowCount),l=this.multiSelect(),l&&(n.appendFormat('<span id="{0}$SelectionInfo">',this.get_id()),this._selectedKeyList.length>0&&n.appendFormat(Web.DataViewResources.Pager.SelectionInfo,this._selectedKeyList.length),n.append("<\/span>")),(o||l)&&n.append(" | "));n.appendFormat('<\/td><td align="center" class="Pager Refresh" id="{0}_Wait">',this.get_id());this.get_searchOnStart()||n.appendFormat('<a href="#" onclick="$find(\'{0}\').{3}();return false" tabindex="{2}" title="{1}"><span>&nbsp;<\/span><\/a>',this.get_id(),Web.DataViewResources.Pager.Refresh,$nextTabIndex(),this._hasSearchAction?"search":"sync");n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},refreshData:function(){this._clearCache();this.set_pageIndex(-2);this._loadPage()},_dittoCollectedValues:function(n,t){var r,i,f,s;if(this.editing()){var e=t?new RegExp(String.format("^{0}(Length|ContentType|FileName|FullFileName)?$",t)):null,o=this._collectFieldValues(!0),u=[];for(r=0;r<o.length;r++)i=o[r],e&&i.Name.match(e)||Array.add(u,{name:i.Name,value:i.Modified?i.NewValue:i.OldValue});if(n)for(r=0;r<n.length;r++){for(i=n[r],f=0;f<u.length;f++)if(s=i.Name?i.Name:i.name,u[f].name==s){Array.removeAt(u,f);break}Array.add(u,i.Name?{name:i.Name,value:i.NewValue}:i)}this._ditto=u}},refresh:function(t,i,r){var u=this,f;u._dittoCollectedValues(i,r);u._lastSelectedCategoryTabIndex=u.get_categoryTabIndex();t?u._render():n.touch?(f=u.get_parentDataView(this),f==u?u.sync():f._syncKey=f.get_selectedKey()):(u.goToView(u.get_viewId()),u._ditto=null)},_cname:function(n){var t=this.get_viewId();return t==null&&(t="grid1"),String.format("{0}${1}${2}",this._id,t,n)},readContext:function(n){return Web.PageState.read(this._cname(n))},writeContext:function(n,t){Web.PageState.write(this._cname(n),t)},_saveViewVitals:function(){this.writeContext("vitals",{PageIndex:this.get_pageIndex(),PageSize:this.get_pageSize(),Filter:this.get_filter(),SortExpression:this.get_sortExpression(),Tag:this.get_tag()})},_restoreViewVitals:function(n){var t,u,i,r,e,h,o;if(!(n.PageIndex>=0)&&(t=this.readContext("vitals"),t!=null)&&(n.RequiresRowCount=!0,n.RequiresMetaData=!0,n.PageIndex==-1&&t.Filter&&n.Filter)){if(n.Tag=t.Tag,n.PageIndex=t.PageIndex,n.PageSize=t.PageSize,n.FilterIsExternal){for(u=n.Filter,i=0;i<t.Filter.length;i++){var f=t.Filter[i],c=f.substring(0,f.indexOf(":")),s=!1;for(r=0;r<n.Filter.length;r++)if(e=n.Filter[r],h=e.substring(0,e.indexOf(":")),h==c){s=!0;break}s||Array.add(u,f)}n.Filter=Array.clone(u)}else(n.Filter==null||n.Filter.length==0)&&(n.Filter=Array.clone(t.Filter));n.SortExpression=t.SortExpression;this.get_isDataSheet()&&this._get_focusedCell()||(o=this.readContext("GridType"),o!=null&&this.changeViewType(o))}},paramValue:function(n,t){this._paramValues||(this._paramValues=[]);this._paramValues.push({Name:n,Value:t})},_useSearchParams:function(n){var t=this._paramValues,r,i,u;if(t?(this._searchParamValues=t,this._paramValues=null):t=this._searchParamValues,t){for(r=Array.clone(n.ExternalFilter),i=0;i<t.length;i++)u=t[i],Array.add(r,{Name:u.Name,Value:u.NewValue});n.ExternalFilter=r}},_forceSync:function(){var t=this;t._skipSync||n.touch&&t.get_isForm()?t._skipSync=!1:t._syncKey=t.get_selectedKey()},sync:function(n){var i,t,r;if(this._clearCache(),n!=null){for(Array.isInstanceOfType(n)||(n=[n]),i=[],t=0;t<this._keyFields.length;t++)r=this._keyFields[t],i[this._keyFields[t].Index]=n[t];this._raiseSelectedDelayed=!0;this._pendingSelectedEvent=!0;this._selectKeyByRow(i)}this._forceSync();this.refreshAndResize();this._synced=!0},_sync:function(){var n=this._viewColumnSettings;this._viewColumnSettings=[];this.sync();this._viewColumnSettings=n},combinedFilter:function(){return this._combinedFilter(this.get_filter())},dataSignature:function(){var n=this.combinedFilter();return e.serialize(n)},_combinedFilter:function(n){var r=$app.touch,i=this,t;return r&&i.viewProp("useAdvancedSearch")&&(t=i.viewProp("advancedSearchFilter"),t&&t.length&&($(n).each(function(){if(this.startsWith("_quickfind_"))return n.splice(n.indexOf(this),1),!1}),n=(n||[]).concat(t))),n},_createParams:function(n){var t=this,r=t.get_lookupContext(),f=t.get_viewType(),o=t.extension(),s=t._lookupInfo,e;String.isNullOrEmpty(f)&&(f=t.readContext("GridType"));t.get_searchOnStart()&&s&&s.value!=null&&t.set_searchOnStart(!1);var h=t.get_confirmContext(),u=t._api,i={PageIndex:t.get_pageIndex(),PageSize:t.get_pageSize(),PageOffset:t.get_pageOffset(),SortExpression:t.get_sortExpression(),GroupExpression:t.get_groupExpression(),Filter:t._combinedFilter(t.get_filter()),ContextKey:t.get_id(),Cookie:t.get_cookie(),FilterIsExternal:t._externalFilter.length>0,LookupContextFieldName:r?r.FieldName:null,LookupContextController:r?r.Controller:null,LookupContextView:r?r.View:null,LookupContext:r,Inserting:t.inserting(),LastCommandName:t.get_lastCommandName(),LastCommandArgument:t.get_lastCommandArgument(),ExternalFilter:t.get_externalFilter(),Transaction:t.get_transaction(),DoesNotRequireData:t.get_searchOnStart(),LastView:t.get_lastViewId(),Tag:t.get_tag(),RequiresFirstLetters:t.get_showFirstLetters(),ViewType:f,SupportsCaching:Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>7,SystemFilter:o?o.systemFilter():null,RequiresRowCount:t._requiresRowCount==!0,QuickFindHint:$app.touch?t.viewProp("quickFindHint"):null,RequiresPivot:t._requiresPivot==!0,PivotDefinitions:t._pivotDefinitions?t._pivotDefinitions:null};return u&&(i.SupportsCaching=!1,u.DoesNotRequireData&&(i.DoesNotRequireData=!0),i.MetadataFilter=u.metadataFilter,i.FieldFilter=u.fieldFilter,u.requiresAggregates==!1&&(i.DoesNotRequireAggregates=!0)),h&&(e=Array.clone(i.ExternalFilter),Array.addRange(e,h.Values),i.ExternalFilter=e),t._useSearchParams(i),t._position&&(t._position.changing&&(i.PageIndex=t._position.index,i.PageSize=1,i.Filter=t._position.filter,i.SortExpression=t._position.sortExpression,i.RequiresMetaData=!0),n&&(i.Filter=t._selectedKeyFilter)),i.SyncKey=t._syncKey,t.useCase("$app")&&(i.RequiresMetaData=!0),i},_createArguments:function(n,t,i){var r,u,f;if(i||(i=this._collectFieldValues()),t||(t=this.get_viewId()),n.values&&(i=Array.clone(n.values)),this._paramValues&&(i=Array.clone(i),Array.addRange(i,this._paramValues),delete this._paramVlaues),r={CommandName:n.commandName,CommandArgument:n.commandArgument,Path:n.path,LastCommandName:this.get_lastCommandName(),Values:i,ContextKey:this.get_id(),Cookie:this.get_cookie(),Controller:this.get_controller(),View:t,LastView:this.get_lastViewId(),Tag:this.get_tag(),Trigger:n.trigger},r.Filter=this._combinedFilter(this.get_filter()),r.SortExpression=this.get_sortExpression(),r.GroupExpression=this.get_groupExpression(),r.SelectedValues=this.get_selectedValues(),r.ExternalFilter=Array.clone(this.get_externalFilter()),r.Transaction=this.get_transaction(),n.commandName=="PopulateDynamicLookups")for(u=0;u<this._allFields.length;u++)f=this.get_contextFilter(this._allFields[u],i),f.length>0&&Array.addRange(r.ExternalFilter,f);return String.isNullOrEmpty(r.Transaction)||this.get_isModal()||this.get_filterSource()||!r.CommandName.match(/Insert|Update|Delete/)||(r.Transaction+=":complete"),r.SaveLEVs=this._allowLEVs==!0,r},_loadPage:function(){var n=this,t=n._survey,i,r,u;(n._isBusy&&n._cancelWSRequest(),n._delayedLoading=!1,n._source)||(n.get_mode()!=Web.DataViewMode.View?(n._allFields=[{Index:0,Label:"",DataFormatString:"",AliasIndex:0,ItemsDataController:n.get_controller(),ItemsNewDataView:n.get_newViewId(),ItemsDataView:n.get_viewId(),_dataView:n,Behaviors:[],format:_field_format,isReadOnly:_field_isReadOnly,isNumber:_field_isNumber}],n._fields=n._allFields,n._render()):(n._busy(!0),n._detachBehaviors(),n._showWait(),i=n._createParams(),n._restoreViewVitals(i),r={controller:n.get_controller(),view:n.get_viewId(),request:i},u=new Web.BusinessRules(n),u.before({commandName:"Select",commandArgument:r.view}),u.dispose(),t&&t.result?(n._onGetPageComplete(t.result,null),t.result=null):n._startPage?(n._onGetPageComplete(n._startPage,null),n._startPage=null):n._invoke("GetPage",r,Function.createDelegate(n,n._onGetPageComplete))))},_cancelWSRequest:function(){var n=this._wsRequest;n&&(this._wsRequest=null,n.get_executor&&!n.completed()&&(!Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.version>9)&&n.get_executor().abort())},_invoke:function(t,i,r,u,f){function h(n,e,c){n.get_statusCode()==0?$app.confirm(Web.DataViewResources.Data.ConnectionLost,function(){o._wsRequest=Sys.Net.WebServiceProxy.invoke(s,t,!1,i,r,h,u)},function(){o._onMethodFailed(n,e,c)}):(o._onMethodFailed(n,e,c),f&&f())}var o=this,s=this.get_servicePath();if(o._autoRefresh(!0),i.args&&n.ensureJSONCompatibility(i.args.Values),s.startsWith("http")){switch(t){case"GetPage":case"GetListOfValues":i.request.Controller=i.controller;i.request.View=i.view;i=i.request;break;case"Execute":i=i.args}$.ajax({url:this.get_baseUrl()+"appservices/_invoke",type:"GET",cache:!1,data:{method:t,args:e.serialize(i)},dataType:"jsonp",success:function(n){r(n,u)},error:function(n){o._onMethodFailed(n.message,n.response,u)}})}else o._wsRequest=Sys.Net.WebServiceProxy.invoke(s,t,!1,i,function(n,t,i){n&&n.ExceptionType?o._onMethodFailed({get_timedOut:function(){return!1},get_exceptionType:function(){return n.ExceptionType},get_message:function(){return n.Message},get_stackTrace:function(){return n.StackTrace},get_statusCode:function(){return"HSR"}},null,u):r(n,t,i)},h,u)},_disposeFields:function(){var n,t;if(this._allFields)for(n=0;n<this._allFields.length;n++)t=this._allFields[n],t._dataView=null,t._listOfValues&&Array.clear(t._listOfValues)},_formatViewText:function(n,t,i){var r=this._views.length>0?this._views[0].Label:this._view?this._view.Label:"";return String.isNullOrEmpty(n)?i:String.format(n,t==!0?r.toLowerCase():r)},_autoRefresh:function(n){if(this._refreshInterval>0&&(this._riTimeout&&(clearTimeout(this._riTimeout),this._riTimeout=null),!n)){var t=this;this._riTimeout=setTimeout(function(){t.get_isForm()||t.sync()},this._refreshInterval*1e3)}},_clearCache:function(n){var t=this._cachedPages,r,f=$.Event("reset.dataview.app"),i,u;if(t){for(i=0;i<t.length;i++)u=t[i],Array.clear(u.rows),delete u.rows;Array.clear(t);delete this._cachedPages}r=this.extension();r&&r.reset(n==null||n==!0);f.dataView=this;$(document).trigger(f)},_supportsCaching:function(n){return n=="DataSheet"||n=="Grid"&&$app.mobile},_cacheResult:function(n){var s=n.PageSize,o=n.PageSize<n.Rows.length,l=this.get_viewType(),t,p,e,i,f,v,r,u,y;if(o||l||(l=this.readContext("GridType")),o||(o=this._supportsCaching(l)),!o&&!l&&n.Views)for(t=0;t<n.Views.length;t++)if(p=n.Views[t],p.Id==n.View){o=this._supportsCaching(p.Type);break}if(o&&n.SupportsCaching){e=n.Rows;n.Rows=[];i=this._cachedPages;i||(i=this._cachedPages=[]);var a=n.PageIndex,h=0,c=s-1;for(a>0&&(e.length<=s*2?(h=s,c=e.length-1):(h+=s,c+=s)),f={index:a,rows:[]},t=h;t<=c;t++)v=e[t],v&&(n.Rows.push(v.slice(0)),f.rows.push(v));if(r=null,h>0)for(r={index:a-1,rows:[]},t=0;t<h;t++)r.rows.push(e[t]);if(u=null,c<e.length-1)for(u={index:a+1,rows:[]},t=c+1;t<e.length;t++)u.rows.push(e[t]);for(t=0;t<i.length;)y=i[t],f!=null&&y.index==f.index?(i[t]=f,f=null):r!=null&&y.index==r.index?(i[t]=r,r=null):u!=null&&y.index==u.index?(i[t]=u,u=null):t++;(f||r||u)&&(i.length>100&&i.splice(0,3),f&&i.push(f),r&&i.push(r),u&&i.push(u))}},_onGetPageComplete:function(t){var c=this,ft=n.mobile,r,tt,rt,et,i,bt,ai,ct,p,vi,yi,kt,f,pi,e,dt,lt,wi,y,gt,v,w,at,ni,s,b,ti,u,vt,l,g,a,h,ii,ri,pt,ui,fi,ei,wt,oi,ki,di,si;if(c._syncKey&&(c._syncKey=null),c._busy(!1),d(t,ht,[]),Sys.Services&&Sys.Services.AuthenticationService&&Sys.Services.AuthenticationService.get_isLoggedIn&&Sys.Services.AuthenticationService.get_isLoggedIn()&&!t.IsAuthenticated){location.replace($app.unanchor(location.href));return}if(c._fields||(c._viewId=t.View),c._containerIsHidden&&(Sys.UI.DomElement.setVisible(c._container,!0),c._containerIsHidden=!1),c.set_tag(t.Tag),t.FirstLetters!=""&&(c._firstLetters=t.FirstLetters?t.FirstLetters.split(/,/):null),tt=c._position&&c._position.changed,c._cacheResult(t),c._pageIndex<0||tt){if(this._pageIndex==-1||tt){if(this._disposeFields(),this._expressions=t.Expressions,this._detachBehaviors(),this._allFields=t.Fields,this._mapOfAllFields={},this._fields=[],rt=[],this._keyFields&&this._selectedKey.length>0){for(r=0;r<this._keyFields.length;r++)rt[r]={name:this._keyFields[r].Name,value:this._selectedKey[r]};this._selectedKey=[]}this._keyFields=[];var hi=!1,ut=!1,ci=[],li=0;for(r=0,$(t.Fields).each(function(){var t=this;c._mapOfAllFields[t.Name]=t;t.Index=r++;t.Type||(t.Type="String");t.Type!="DataView"||n.touch||(t.Hidden=!0);d(t,ot,!0);d(t,st,0);t.Items==null&&(t.Items=[]);t.Name=="Status"&&(hi=!0)}),hi||(t.Fields[t.Fields.length]={Name:"Status",ReadOnly:!0,Type:"String",AllowNulls:!0,Hidden:!0,Index:t.Fields.length,_system:!0}),et=n._commandLine.match(/\W_display=(.+?)(&|$)/),r=0;r<t.Fields.length;r++){if(i=t.Fields[r],bt=String.isNullOrEmpty(i.AliasName)?null:this.findField(i.AliasName),i.AliasIndex=bt?bt.Index:r,i.ItemsDataController&&i._autoAlias&&(p={Name:i.Name+"_auto_alias_",ReadOnly:!0,Type:"String",Index:t.Fields.length,Label:i.Label,AllowNulls:!0,Items:[],htmlEncode:!0},p.AliasIndex=p.Index,i.AliasIndex=p.Index,t.Fields.push(p),c._mapOfAllFields[p.Name]=p),(!i.Hidden||et)&&this._fieldIsInExternalFilter(i)&&this.get_hideExternalFilterFields()){if(vi=i.Hidden,i.Hidden=!0,i.Copy)while(ai=n._fieldMapRegex.exec(i.Copy))ct=this.findField(ai[1]),ct&&ct.ReadOnly&&(ct.Hidden=!0);et&&Array.indexOfCaseInsensitive(et[1].split(","),i.Name)!=-1&&(vi||(i.Hidden=!1),this.inserting()&&(yi=new RegExp(String.format("\\W{0}=(.*?)(&|$)",i.Name)),kt=n._commandLine.match(yi),kt&&(t.NewRow||(t.NewRow=[]),t.NewRow[r]=decodeURIComponent(kt[1]))))}i.Behaviors=[]}if($app.newValues&&(this._ditto||(this._ditto=[]),this._ditto=this._ditto.concat($app.newValues),$app.newValues=null),t.NewRow&&this._ditto)for(r=0;r<t.Fields.length;r++)if(i=t.Fields[r],t.NewRow[r]!=null)for(f=0;f<this._ditto.length;f++)if(this._ditto[f].name==i.Name&&!this._ditto[f].duplicated){Array.removeAt(this._ditto,f);break}for(this._ignoreNewRow=!0,this._hasDynamicLookups=!1,this._requiresConfiguration=!1,pi=0,r=0;r<t.Fields.length;r++){if(i=t.Fields[r],i._dataView=this,i.Hidden||Array.add(this._fields,i),i.IsPrimaryKey)for(Array.add(this._keyFields,i),f=0;f<rt.length;f++)if(rt[f].name==i.Name){Array.add(this._selectedKey,rt[f].value);break}String.isNullOrEmpty(i.HeaderText)&&(i.HeaderText=i.Label);String.isNullOrEmpty(i.HeaderText)&&(i.HeaderText=i.Name);i.FilterType="Number";switch(i.Type){case"Time":case"String":i.FilterType="Text";break;case"DateTime":case"DateTimeOffset":i.FilterType="Date";break;case"Boolean":i.FilterType="Boolean"}if(String.isBlank(i.SearchOptions)||__tf!=4)i.SearchOptions=null;else{for(e=i.SearchOptions.replace(/\s+/g,",").split(/,/),i.AllowAutoComplete=!Array.contains(e,"$disableautocomplete"),i.AllowAutoComplete||Array.remove(e,"$disableautocomplete"),i.AllowSamples=!Array.contains(e,"$disablesamples"),i.AllowSamples||Array.remove(e,"$disablesamples"),i.AllowMultipleValues=!Array.contains(e,"$disablemultiplevalues"),i.AllowMultipleValues||Array.remove(e,"$disablemultiplevalues"),i.AutoCompleteAnywhere=Array.contains(e,"$autocompleteanywhere"),i.AutoCompleteAnywhere&&(Array.remove(e,"$autocompleteanywhere"),t.Fields[i.AliasIndex].AutoCompleteAnywhere=!0),f=0,dt=!1;f<e.length;)lt=e[f]=e[f].trim(),lt=="*"&&(dt=!0),lt.length>0&&lt!="*"?f++:Array.removeAt(e,f);dt&&e.length>0&&(wi=Web.DataViewResources.Data.Filters[i.FilterType],this._enumerateMissingSearchOptions(e,wi.List));Array.contains(e,"$in")&&!Array.contains(e,"$notin")&&Array.add(e,"$notin");i.SearchOptions=e.length==0?null:e}i.format=_field_format;i.isReadOnly=_field_isReadOnly;i.isNumber=_field_isNumber;i.text=_field_text;i.trim=_field_trim;i.htmlEncode=_field_htmlEncode;i.tagged=function(){var i=this.Tag,r,u,f="",e=arguments,t,o;if(i)for(t=0;t<e.length;t++)if(u=e[t],r=i.indexOf(u),r>=0){for(t=r+u.length;t<i.length;)if(o=i[t].match(/\d/),o)f+=i[t++];else break;return n.tagSuffix=f,!0}return!1};i.tag=function(n){this.Tag=(this.Tag||"")+","+n};_field_prepareDataFormatString(this,i);y=i.ItemsStyle;gt=i.ItemsDataController;i.Type=="Boolean"&&i.Items.length==0&&(i.Items=Array.clone(i.AllowNulls?Web.DataViewResources.Data.BooleanOptionalDefaultItems:Web.DataViewResources.Data.BooleanDefaultItems),y||(i.ItemsStyle=Web.DataViewResources.Data.BooleanDefaultStyle));i.Items&&i.Items.length>0&&(i.AllowNulls&&!i.ItemsTargetController||y=="DropDownList"&&!gt)&&!String.isNullOrEmpty(i.Items[0][0])&&y!="CheckBoxList"&&Array.insert(i.Items,0,[null,Web.DataViewResources.Data.NullValueInForms]);String.isNullOrEmpty(y)||(String.isNullOrEmpty(i.ContextFields)||y=="Lookup"||i.ItemsStyle=="AutoComplete"||String.isNullOrEmpty(gt)?y=="UserNameLookup"?(i.ItemsStyle="Lookup",i.ItemsDataController="aspnet_Membership",i.ItemsDataTextField="UserUserName",i.ItemsDataValueField="UserUserName",i.ItemsValueSyncDisabled=!0,it()&&(i.ItemsNewDataView="createForm1")):y=="UserIdLookup"&&(i.ItemsStyle="Lookup",i.ItemsDataController="aspnet_Membership",i.ItemsDataTextField="UserUserName",i.ItemsDataValueField="UserId",it()&&(i.ItemsNewDataView="createForm1")):(this._hasDynamicLookups=!0,i.ItemsAreDynamic=!0));String.isNullOrEmpty(i.ToolTip)||(i.ToolTip=n.htmlAttributeEncode(i.ToolTip));i.Watermark||i.AllowNulls||i.Items&&i.Items.length||(i.Watermark=o.Required);String.isNullOrEmpty(i.Configuration)||(this._requiresConfiguration=!0);i.AllowLEV&&(this._allowLEVs=!0);i.TextMode==2&&String.isNullOrEmpty(i.Editor)&&!ft&&(Sys.Extended.UI.HtmlEditorExtenderBehavior||typeof CKEDITOR!="undefined"?i.ClientEditor="Web$DataView$RichText":i.Editor="RichEditor",i.HtmlEncode=!1);i.Editor&&(this._executeClientEditorFactories(i)?(i.ClientEditor=i.Editor,i.Editor=null):i.EditorId=String.format("{0}_Item{1}",this.get_id(),i.Index));i.ColIndex=i.Hidden?-1:pi++;v=n.Geo;i.tagged("modified-","created-")&&i.tagged("modified-latitude","modified-longitude","modified-coords","created-latitude","created-longitude","created-coords")&&((!v||v.latitude<0)&&setTimeout(function(){v=n.Geo={latitude:-1,longitude:-1};var t=navigator.geolocation;t&&t.watchPosition(function(n){v.acquired=!0;v.latitude=n.coords.latitude;v.longitude=n.coords.longitude},function(n){v.error=n;v.acquired=!1})},1500),i.TextMode=4);ut||(i.tagged("map-")&&!i.tagged("map-none")?ut=!0:(w=i.Name.match(/\b(address|city|state|region|postal(.*?)code|zip(.*?)code|zip|country)\b/i),w&&!i.tagged("map-none")&&(w=w[1].toLowerCase(),ci.push({field:i,tag:w}),w.match(/address|city/)&&li++)))}for(this.untag("supports-view-style-map"),ut||li!=2||(ut=!0,$(ci).each(function(){this.field.tag("map-"+this.tag);this.tag=="address"&&this.field.tag("action-location")})),ut&&this.tag("supports-view-style-map"),t.LEVs&&this._recordLEVs(t.LEVs),$(t.Views).each(function(){var n=this;t.View==n.Id&&(n.HeaderText=t.ViewHeaderText,n.Layout=t.ViewLayout);n.ShowInSelector==null&&(n.ShowInSelector=!0)}),this._views=t.Views,this._view=null,this._lastViewId||this.get_isForm()||(this._lastViewId=t.View),this._actionGroups=t.ActionGroups?t.ActionGroups:[],this._statusBar=t.StatusBar,at=/^(true|false)\:(.+)$/,ni=0,this._actionColumn=null,r=0;r<this._actionGroups.length;r++)for(s=this._actionGroups[r],s.maxTextLength=0,s.groupText=[],b=k[s.Scope],b&&b._Self&&(ti=b._Self[s.HeaderText],ti&&(s.HeaderText=ti.HeaderText)),s.Scope=="ActionColumn"&&(this._actionColumn=String.isNullOrEmpty(s.HeaderText)?Web.DataViewResources.Grid.ActionColumnHeaderText:s.HeaderText),s.Id||(s.Id="auto"+ni++),s.CssClassEx=String.format("Actions-g-{0} ",s.Id),f=0;f<s.Actions.length;f++)u=s.Actions[f],u.Id||(u.Id="auto"+ni++),u.CausesValidation==null&&(u.CausesValidation=!0),u.CommandName==null&&(u.CommandName=""),u.Path=String.format("{0}/{1}",s.Id,u.Id),vt=u.Confirmation,u.CommandName=="Search"&&(this._hasSearchAction=u.Path,this._hasSearchShortcut=vt&&vt.match(/_shortcut\s*=\s*true/)),u.CssClassEx=String.format("Actions-g-{0}-a-{1} ",s.Id,u.Id),b&&String.isNullOrEmpty(u.HeaderText)&&(l=b[u.CommandName],l?(l.CommandArgument&&(g=l.CommandArgument[u.CommandArgument],g&&(l=g)),l.WhenLastCommandName&&(g=l.WhenLastCommandName[u.WhenLastCommandName],g&&(l=g)),u.HeaderText=l.HeaderText,!String.isNullOrEmpty(l.HeaderText)&&l.HeaderText.indexOf("{")>=0&&(u.HeaderText=l.VarMaxLen!=null&&t.Views[0].Label.length>l.VarMaxLen?l.HeaderText2:this._formatViewText(l.HeaderText)),String.isNullOrEmpty(u.Description)&&(u.Description=this._formatViewText(l.Description)),String.isNullOrEmpty(vt)&&(u.Confirmation=l.Confirmation)):u.HeaderText=u.CommandName),String.isNullOrEmpty(u.WhenView)?u.WhenViewRegex=null:(a=at.exec(u.WhenView),u.WhenViewRegex=new RegExp(a?a[2]:u.WhenView),u.WhenViewRegexResult=a?a[1]!="false":!0),String.isNullOrEmpty(u.WhenTag)?u.WhenTagRegex=null:(a=at.exec(u.WhenTag),u.WhenTagRegex=new RegExp(a?a[2]:u.WhenTag),u.WhenTagRegexResult=a?a[1]!="false":!0),String.isNullOrEmpty(u.WhenHRef)?u.WhenHRefRegex=null:(a=at.exec(u.WhenHRef),u.WhenHRefRegex=new RegExp(a?a[2]:u.WhenHRef),u.WhenHRefRegexResult=a?a[1]!="false":!0),u.HeaderText&&(s.maxTextLength=Math.max(u.HeaderText.length,s.maxTextLength),s.groupText.push(u.HeaderText));var yt=1,bi=!1,nt=this._categories=t.Categories;for(this._tabs=[],r=0;r<nt.length;r++)if(h=nt[r],h.Index=r,h.Tab==null&&(h.Tab=""),String.isNullOrEmpty(h.Tab)||Array.contains(this._tabs,h.Tab)||Array.add(this._tabs,h.Tab),h.NewColumn&&(r>0&&yt++,bi=!0),h.ColumnIndex=yt-1,h.Id&&(ii=$get(String.format("{0}_{1}_{2}",t.Controller,t.View,h.Id)),ii&&(h.Template=ii.innerHTML)),h.Floating&&String.isNullOrEmpty(h.Template)){for(ri=new Sys.StringBuilder('<div class="FloatingCategoryHeader"><\/div>'),f=0;f<this._allFields.length;f++)pt=this._allFields[f],pt.Hidden||r!=pt.CategoryIndex||ri.appendFormat('<div class="FieldPlaceholder">{{{0}}}<\/div>',pt.Name);h.Template=ri.toString()}if(this._tabs.length>0){for(r=0;r<nt.length;r++)h=nt[r],String.isNullOrEmpty(h.Tab)&&(String.isNullOrEmpty(nt[0].Tab)?(h.Tab=Web.DataViewResources.Form.GeneralTabText,this._tabs[0]!=Web.DataViewResources.Form.GeneralTabText&&Array.insert(this._tabs,0,Web.DataViewResources.Form.GeneralTabText)):h.Tab=nt[0].Tab),h.ColumnIndex=0;this._lastSelectedCategoryTabIndex!=null?(ui=this._focusedFieldName,this.set_categoryTabIndex(!(this._lastSelectedCategoryTabIndex>=0)||ui&&ui.startsWith("_Annotation_")?this._tabs.length-1:0),delete this._lastSelectedCategoryTabIndex):this.set_categoryTabIndex(0);fi=this.get_parentDataView(this);fi._lastClickedIcon=="Attachment"&&this.set_categoryTabIndex(this._tabs.length-1);fi._lastClickedIcon=null;yt=1}else this.set_categoryTabIndex(-1);this._numberOfColumns=bi&&!this._get_template()?yt:0}this._filter=t.Filter;this._sortExpression=t.SortExpression;this._groupExpression=t.GroupExpression;this._updatePageCount(t,tt);ei=this.get_pagerButtonCount(!0);this._firstPageButtonIndex=Math.floor(t.PageIndex/ei)*ei}else this._requiresRowCount&&(this._requiresRowCount=!1,this._updatePageCount(t,!1));for(r=0;r<t.Fields.length;r++)i=t.Fields[r],wt=t.Fields[i.AliasIndex],i.AllowAutoComplete==!1&&(wt.AllowAutoComplete=!1),i.AllowSamples==!1&&(wt.AllowSamples=!1),i.AllowMultipleValues==!1&&(wt.AllowMultipleValues=!1);if(this._icons=t.Icons,!this.inserting()){if(oi=!1,this._rows){for((this._rows.length==0||t.Rows.length==0)&&delete this._viewColumnSettings,r=0;r<this._rows.length;r++)Array.clear(this._rows[r]);Array.clear(this._rows);oi=this.get_isGrid()}if(this._rows=t.Rows,oi)for(this._selectedRowIndex=null,r=0;r<this._rows.length;r++)if(this._rowIsSelected(r)){this._selectedRowIndex=r;break}}this._newRow=t.NewRow?t.NewRow:[];t.Aggregates&&(this._aggregates=t.Aggregates);this.get_isForm()&&this._selectedRowIndex==null&&this._totalRowCount>0&&(this._selectedRowIndex=0,this._selectKeyByRowIndex(0));tt&&(this._position.changed=!0,this._selectKeyByRowIndex(0));ft&&c._autoSelect();this._render(!0);ft||(this.get_lookupField()&&this._adjustLookupSize(),this._isInInstantDetailsMode()&&(ki=$common.getClientBounds(),di=$common.getContentSize(document.body),resizeBy(0,di.height-ki.height)),this._saveViewVitals(),this._pendingSelectedEvent&&(this._pendingSelectedEvent=!1,this.updateSummary()),this._registerFieldHeaderItems(),_body_resize());this._executeSecondCommand();this._autoRefresh();ft||this._autoSelect();String.isNullOrEmpty(t.ClientScript)||eval(t.ClientScript);si=new Web.BusinessRules(this);si.after({commandName:t.NewRow?"New":"Select",commandArgument:t.View,view:t.View});si.dispose()},_updatePageCount:function(n,t){this._totalRowCount=n.TotalRowCount;this._position&&this._position.count==-1&&(this._position.count=n.TotalRowCount);this._pageIndex=n.PageIndex;t||(this._pageSize=n.PageSize,this._pageCount=Math.floor(n.TotalRowCount/n.PageSize),n.TotalRowCount%n.PageSize!=0&&this._pageCount++)},_autoSelect:function(t){var i=null,e=null,o,h=!1,r,u,f,s;if(this.get_autoHighlightFirstRow()&&(this.set_autoHighlightFirstRow(!1),i="Select",o="highlight"),this.get_autoSelectFirstRow()&&(this.set_autoSelectFirstRow(!1),o="select",r=this.get_actionGroups("Grid"),r.length>0))for(u=0;u<r[0].Actions.length;u++)if(f=r[0].Actions[u],f.CommandName){i=f.CommandName;e=f.CommandArgument;h=!String.isNullOrEmpty(e)&!this.get_showModalForms()&&t==null;break}i&&this.get_viewType()!="Form"&&this._rows.length>0&&(h&&this._hideContainer(),s=this.extension(),s?s._autoSelect={row:this._rows[t||0],action:o}:this.executeRowCommand(t||0,i,e));(!this._tryFocusDataSheet||this._forceFocusDataSheet)&&(this._tryFocusDataSheet=!0,this.get_isDataSheet()&&!this.get_lookupField()&(!this.get_filterSource()||this._forceFocusDataSheet)&&this._rows.length>0&&!n.mobile&&this.executeRowCommand(this.get_selectedKey().length>0?null:0,"Select"),this._forceFocusDataSheet=!1)},_hideContainer:function(){this._containerIsHidden=!0;this._container.style.display="none"},_enumerateMissingSearchOptions:function(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i&&!i.Hidden&&(i.List?this._enumerateExpressions(n,t):Array.contains(n,i.Function)||Array.add(n,i.Function))},_executeSecondCommand:function(t){var i,r;t?(i=n._commandLine.match(/_commandName2=(\w+)(.*?_commandArgument2=(.*?)(&|$))?/),i&&this.executeActionInScope([this.get_viewType(),"ActionBar"],i[1],i[3])):this._trySecondCommand&&(this._trySecondCommand=!1,(this.get_viewType()!="Form"||this._totalRowCount>0)&&(r=this,setTimeout(function(){r._executeSecondCommand(!0)},50)))},_skipNextInputListenerClickEvent:function(){(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&(this._skipClickEvent=!0)},_gridViewCellFocus:function(n,t){try{var r=new Sys.UI.DomEvent(n),i=r.target;if((i.tagName=="A"||i.parentNode.tagName=="A")&&!this.get_lookupField()||Sys.UI.DomElement.containsCssClass(i,"RowSelector")||i.tagName=="SPAN"&&i.className=="ObjectRef")return!1;this.get_lookupField()&&(r.stopPropagation(),r.preventDefault());this._skipNextInputListenerClickEvent()}catch(u){}return this.executeRowCommand(t,"Select"),!0},_dataSheetCellFocus:function(n,t,i){var r=this._get_focusedCell(),u=this.inserting(),f;if(u&&t!=-1&&(t=-1),i==-1&&(i=r!=null?r.colIndex:0),this.editing()&&r){this._focusCell(-1,-1,!1);this._focusCell(t,i);f=t==r.rowIndex||u&&t==-1;(f||this._updateFocusedRow(r))&&this._updateFocusedCell(r)?f&&t!=this._selectedRowIndex&&!u&&this.cancelDataSheetEdit():(this._focusCell(t,i,!1),this._focusCell(r.rowIndex,r.colIndex));this._skipNextInputListenerClickEvent();return}if(n){if(!this._gridViewCellFocus(n,t,i))return}else this._skipNextInputListenerClickEvent();r==null||r.rowIndex!=t||r.colIndex!=i||this.editing()||this.get_lookupField()?this._startInputListenerOnCell(t,i):(document.selection&&document.selection.clear(),this._skipEditOnClick!=!0&&this._allowEdit()&&this.editDataSheetRow(r.rowIndex));this._skipEditOnClick=!1},_startInputListenerOnCell:function(t,i){if(this._startInputListener(),this._focusCell(-1,-1,!1),this._focusCell(t,i),!this.get_lookupField()){if(n._activeDataSheetId!=this.get_id()){var r=$find(n._activeDataSheetId);r&&r.cancelDataSheet();n._activeDataSheetId=this.get_id()}this._lostFocus=!1}},_startInputListener:function(){this._stopInputListener();this._inputListenerKeyDownHandler||(this._inputListenerKeyDownHandler=Function.createDelegate(this,this._inputListenerKeyDown),this._inputListenerKeyPressHandler=Function.createDelegate(this,this._inputListenerKeyPress),this._inputListenerClickHandler=Function.createDelegate(this,this._inputListenerClick),this._inputListenerDblClickHandler=Function.createDelegate(this,this._inputListenerDblClick),this._focusedCell=null);$addHandler(document,"keydown",this._inputListenerKeyDownHandler);$addHandler(document,"keypress",this._inputListenerKeyPressHandler);$addHandler(document,"click",this._inputListenerClickHandler);$addHandler(document,"dblclick",this._inputListenerDblClickHandler);this._trackingInput=!0},_stopInputListener:function(){this._trackingInput&&($removeHandler(document,"keydown",this._inputListenerKeyDownHandler),$removeHandler(document,"keypress",this._inputListenerKeyPressHandler),$removeHandler(document,"click",this._inputListenerClickHandler),$removeHandler(document,"dblclick",this._inputListenerDblClickHandler),this._lostFocus=!0,this._trackingInput=!1)},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var n=this.get_actionGroups("Grid");return Array.addRange(n,this.get_actionGroups("ActionBar")),Array.addRange(n,this.get_actionGroups("Form")),Array.addRange(n,this.get_actionGroups("ActionColumn")),n},_findActionsByCommandName:function(n){for(var t,r,u=[],f=this.get_interactiveActionGroups(),i=0;i<f.length;i++)for(actions=f[i].Actions,t=0;t<actions.length;t++)r=actions[t],r.CommandName==n&&Array.add(u,r);return u},findAction:function(n){n=n.split(/\s*\\|\/\s*/g);var i=n[0],r=n[1],t;return $(this._actionGroups).each(function(){var n=this;n.Id==i&&$(n.Actions).each(function(){var n=this;if(n.Id==r)return t=n,!1})}),t},_inputListenerKeyPress:function(n){var t,i;if((!n.rawEvent||n.rawEvent.charCode!=0)&&!this._lostFocus){if(this.editing()){this._pendingChars&&(this._pendingChars+=String.fromCharCode(n.charCode));return}this._isBusy||(t=this._get_focusedCell(),t!=null)&&((i=this._fields[t.colIndex],i.ReadOnly)||this._allowEdit()&&(this.executeRowCommand(t.rowIndex,"Select"),i.isReadOnly()||(this._pendingChars=String.fromCharCode(n.charCode),this.editDataSheetRow(t.rowIndex))))}},cancelDataSheet:function(){this.get_isDataSheet()&&(this._focusCell(-1,-1,!1),this._stopInputListener(),this.set_ditto(null),n._activeDataSheetId=null,this.cancelDataSheetEdit(),this._lostFocus=!1,this._focusedCell=null)},_inputListenerKeyDown:function(n){var i,o,e,h;if(!this._lookupIsActive&&!this._lostFocus&&!r.HoverMonitor._instance.get_isOpen()){if(this._isBusy){if(this._pendingChars)return;n.preventDefault();n.stopPropagation();return}if(!this._isBusy&&(i=this._get_focusedCell(),i!=null)){var t={rowIndex:i.rowIndex,colIndex:i.colIndex},u=!1,s=!1,f=this.get_pageSize();this._rows.length<f&&(f=this._rows.length);switch(n.keyCode){case 83:case Sys.UI.Key.enter:if(n.keyCode==83&&!n.ctrlKey)return;if(this.editing()){if(o=n.target&&n.target.tagName,(o=="TEXTAREA"||o=="A")&&!n.ctrlKey)return;u=!0;this._updateFocusedRow(i);n.preventDefault();n.stopPropagation();return}n.ctrlKey&&!this.editing()||this.get_lookupField()?(u=!0,this.executeRowCommand(i.rowIndex,"Select")):n.shiftKey?t.rowIndex>0&&t.rowIndex--:this._moveFocusToNextRow(t,f)&&(u=!0);break;case Sys.UI.Key.down:if(this.editing()||n.ctrlKey)return;this._moveFocusToNextRow(t,f)&&(u=!0);break;case Sys.UI.Key.up:if(this.editing()||n.ctrlKey)return;t.rowIndex>0?t.rowIndex--:(this._pageOffset==0&&this.get_pageIndex()==0?(this._pageOffset=null,u=!0):this._pageOffset==null?this.get_pageIndex()>0&&(this._pageOffset=-1):this._pageOffset--,u=!0,this._pageOffset==-f?(this._pageOffset=null,this.get_pageIndex()>0&&this.goToPage(this.get_pageIndex()-1)):this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:if(e=!0,(n.keyCode==Sys.UI.Key.right||n.keyCode==Sys.UI.Key.left)&&this.editing())return;if(!n.shiftKey&&n.target.parentNode.className=="Date")return;if(n.shiftKey&&n.target.id&&n.target.id.match(/\$Time\d+/))return;if(h=this._pageOffset,n.shiftKey||n.keyCode==Sys.UI.Key.left)if(t.colIndex>0){if(t.colIndex--,n.keyCode==Sys.UI.Key.tab)while(t.colIndex>0&&this._fields[t.colIndex].isReadOnly())t.colIndex--}else this.editing()&&(u=!0);else if(t.colIndex<this._fields.length-1){if(t.colIndex++,n.keyCode==Sys.UI.Key.tab)while(t.colIndex<this._fields.length-1&&this._fields[t.colIndex].isReadOnly())t.colIndex++}else{if(this.editing()){if(this._updateFocusedRow(i,n.keyCode==Sys.UI.Key.tab))e=!1;else{n.preventDefault();n.stopPropagation();return}u=!0}e&&this._moveFocusToNextRow(t,f)&&(u=!0);(t.rowIndex!=i.rowIndex||this._pageOffset!=h)&&(t.colIndex=0,u=!1)}e&&this.editing()&&(s=!0);break;case Sys.UI.Key.home:if(this.editing())return;n.ctrlKey?this.get_pageIndex()>0?(u=!0,this._pageOffset=0,this.goToPage(0),i.rowIndex=0,i.colIndex=0):(t.rowIndex=0,t.colIndex=0):t.colIndex=0;break;case Sys.UI.Key.end:if(this.editing())return;n.ctrlKey?(u=!0,i.colIndex=this._fields.length-1,i.rowIndex=this._totalRowCount%this.get_pageSize()-1,i.rowIndex<0&&(i.rowIndex=this.get_pageSize()),this._pageOffset=null,this.goToPage(this.get_pageCount()-1)):t.colIndex=this._fields.length-1;break;case Sys.UI.Key.pageUp:if(this.editing())return;u=!0;this.get_pageIndex()>0?this.goToPage(this.get_pageIndex()-1):this._pageOffset!=null&&(this._pageOffset=null,this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.pageDown:if(this.editing())return;u=!0;this.get_pageIndex()<this.get_pageCount()-1&&this.goToPage(this.get_pageIndex()+1);break;case Sys.UI.Key.esc:this.cancelDataSheetEdit()||this.cancelDataSheet();u=!0;break;case Sys.UI.Key.del:if(this.editing()||n.shiftKey||n.altKey)return;u=!0;n.ctrlKey?this.deleteDataSheetRow():(this._pendingChars="",this.editDataSheetRow(i.rowIndex));break;case 45:this.editing()||(u=!0,this._allowNew()&&this.newDataSheetRow());break;case 32:if(n.ctrlKey&&this.multiSelect()&&!this.inserting())u=!0,this.toggleSelectedRow(i.rowIndex);else return;break;case 113:if(this.editing())return;u=!0;this._allowEdit()&&this.editDataSheetRow(i.rowIndex)}i.rowIndex==t.rowIndex&&i.colIndex==t.colIndex||u||(this._focusCell(i.rowIndex,i.colIndex,!1),this._focusCell(t.rowIndex,t.colIndex,!0),u=!0);u&&(n.preventDefault(),n.stopPropagation());s&&(this._updateFocusedCell(i)||(this._focusCell(t.rowIndex,t.colIndex,!1),this._focusCell(i.rowIndex,i.colIndex,!0)))}}},_updateFocusedCell:function(n){var u=this._collectFieldValues(),e=this._validateFieldValues(u,!0,n),t=this._fields[n.colIndex],f,r,i;if(e)f=!0,t.Index<u.length&&u[t.Index].Modified&&(f=!this._performValueChanged(t.Index)),f&&this.refresh(!0);else if(t.Behaviors)for(r=0;r<t.Behaviors.length;r++)i=t.Behaviors[r],AjaxControlToolkit.CalendarBehavior.isInstanceOfType(i)&&i.get_isOpen()&&(i.hide(),i.show());return e},_updateFocusedRow:function(t,i){return n.showMessage(),this._syncFocusedCell=this.inserting(),this._lastFocusedCell=t,this._skipSync=!0,this.executeRowCommand(t.rowIndex,this._syncFocusedCell?"Insert":"Update",null,!0),this._valid&&(this._saveAndNew=i),this._valid},_get_selectedDataRowIndex:function(n){return this.get_pageIndex()*this.get_pageSize()+this.get_pageOffset()+(n!=null?n:this._selectedRowIndex)},executeActionInScope:function(n,t,i,r,u){var o,l,s,f,h,e,c;for(r==null&&(r=this._selectedRowIndex),o=0;o<n.length;o++)if(l=n[o],s=this.get_actionGroups(l),s)for(f=0;f<s.length;f++)if(h=s[f].Actions,h)for(e=0;e<h.length;e++)if(c=h[e],c.CommandName==t&&(String.isNullOrEmpty(i)||c.CommandArgument==i)&&this._isActionAvailable(c,r))return u!=!0&&this.executeAction(l,e,r,f),!0;return!1},newDataSheetRow:function(){var n=this;setTimeout(function(){n.executeCommand({commandName:"New",commandArgument:n.get_viewId()})},100)},editDataSheetRow:function(n){this.get_isDataSheet()&&this.executeRowCommand(n,"Edit","",!1)},deleteDataSheetRow:function(){var n=this._get_focusedCell(),t;n&&(this.executeRowCommand(n.rowIndex,"Select"),t=this,setTimeout(function(){t.executeActionInScope(["Row","ActionBar"],"Delete",null,n.rowIndex)},100))},_moveFocusToNextRow:function(n,t){var i=!1,r=this._get_selectedDataRowIndex(n.rowIndex),u=this._pageOffset;return n.rowIndex<t-1?n.rowIndex++:this._get_selectedDataRowIndex(n.rowIndex)<this._totalRowCount-1&&(this._pageOffset==null?this._pageOffset=1:this._pageOffset++,i=!0,this._pageOffset==t?(this._pageOffset=null,this.goToPage(this.get_pageIndex()+1)):this.goToPage(this.get_pageIndex())),r==this._get_selectedDataRowIndex(n.rowIndex)&&!this.editing()&&this._allowNew()&&(this._ignoreSelectedKey=!0,this.newDataSheetRow(),i=!0),i},_scrollToRow:function(){return},cancelDataSheetEdit:function(){if(this.editing()){var n=this._get_focusedCell();return n!=null&&this.executeRowCommand(n.rowIndex,"Cancel",null,!1),!0}return!1},_inputListenerClick:function(n){if(this._skipClickEvent){this._skipClickEvent=!1;return}if(!this._lookupIsActive){for(var t=n.target,r=!1,i=!1,u=!0;t!=null;){if(t==this._container){r=!0;break}t.className!=null&&(t.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/)?i=!0:t.className.match(/QuickFind|SearchBarFrame\s*/)&&(u=!1));t=t.parentNode}r?(this._lostFocus=u?!i:!0,this._skipEditOnClick=!0,i||this.cancelDataSheetEdit()):this.cancelDataSheet()}},_inputListenerDblClick:function(){if(!this._lostFocus){var n=this._get_focusedCell();n&&!this.editing()&&this._allowEdit()&&(document.selection&&document.selection.clear(),this.editDataSheetRow(n.rowIndex))}},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(n,t,i){var w,v,s,u,e,c,r,l,k,a;if(!this.get_isDataSheet())return this._focusedCell=null,null;if(w=this.inserting(),i==null&&(i=!0),n==-1&&t==-1){if(!this._focusedCell)return null;n=this._focusedCell.rowIndex;t=this._focusedCell.colIndex}for(n>=this._rows.length&&(n=this._rows.length-1),t>=this._fields.length&&(t=this._fields.length-1),v=this._container.childNodes[0].rows,s=-1,u=0;u<v.length;u++)if(e=v[u],(Sys.UI.DomElement.containsCssClass(e,"Row")||Sys.UI.DomElement.containsCssClass(e,"AlternatingRow"))&&s++,w){if(Sys.UI.DomElement.containsCssClass(e,"Inserting"))break}else if(s==n)break;if(s<0)return null;for(c=-1,u=0;u<e.childNodes.length;u++)if(r=e.childNodes[u+this.get_sysColCount()],r&&Sys.UI.DomElement.containsCssClass(r,"Cell")&&c++,c==t)break;if(c<0)return null;var b=r.parentNode.childNodes[this.get_sysColCount()-1],y=this._get_headerRowElement(),o=y.childNodes[t+this.get_sysColCount()];if(i==!0){if(l=$common.getBounds(o),Sys.UI.DomElement.addCssClass(r,"Focused"),Sys.UI.DomElement.addCssClass(b,"CrossHair"),Sys.UI.DomElement.addCssClass(o,"CrossHair"),!this._skipCellFocus){var h=$app.scrolling(),p=$common.getClientBounds(),f=$common.getBounds(r);h.y>f.y?(s==0?o:r).scrollIntoView(!0):h.y+p.height<=f.y+f.height?r.scrollIntoView(!1):(h.x>f.x||h.x+p.width-1<=f.x||h.x+p.width-1<=f.x+f.width)&&r.scrollIntoView(!1);Sys.Browser.agent==Sys.Browser.InternetExplorer&&(k=$common.getBounds(y),y.style.height=k.height+"px")}a=$common.getBounds(o);(l.width!=a.width||l.x!=a.x||l.y!=a.y)&&Sys.UI.DomElement.addCssClass(o,"Narrow");this._skipCellFocus=!1}else Sys.UI.DomElement.removeCssClass(r,"Focused"),Sys.UI.DomElement.removeCssClass(r,"Narrow"),Sys.UI.DomElement.removeCssClass(b,"CrossHair"),Sys.UI.DomElement.removeCssClass(o,"CrossHair");return this._focusedCell={rowIndex:n,colIndex:t},r},_initializeModalPopup:function(){var u;Sys.UI.DomElement.addCssClass(this.get_element(),"ModalPlaceholder");var r=$common.getClientBounds(),n=r.width/5*4,i=Web.DataViewResources.ModalPopup.MaxWidth,t=this.get_confirmContext();t&&t.MaxWidth>0&&t.MaxWidth<n&&(i=t.MaxWidth);n>i&&(n=i);u=r.height/5*4;this._container.style.overflowX!=null?(this._container.style.overflowY="auto",this._container.style.overflowX="hidden"):this._container.style.overflow="auto";this._container.style.height=u+"px";this._container.style.width=n+"px";this._saveTabIndexes();this._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"ModalPopup"+Sys.Application.getComponents().length,PopupControlID:this.get_element().id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this.get_modalAnchor());this._modalPopup.show()},_resizeContainerBounds:function(){this._modalPopup||(this._container.style.height="");var n=$common.getBounds(this._container),i=$common.getClientBounds(),t=Math.ceil(i.height/5*4);return n.height>t&&(this._container.style.height=t+"px",n.skipResizing=!0),n},_adjustModalPopupSize:function(){var o=this.get_confirmContext(),f,e,r,u,s,v;Sys.UI.DomElement.removeCssClass(this._element,"EmptyModalDialog");var t=new Sys.StringBuilder,i=[],a=this._container.getElementsByTagName("table");for(f=a.length-1;f>=0;f--)e=a[f],e.className=="ActionButtons"&&(t.isEmpty()&&(t.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">'),t.append(e.parentNode.parentNode.innerHTML),t.append("<\/tr><\/table>")),Array.add(i,e.parentNode.parentNode));while(i.length>0)i[0].parentNode.removeChild(i[0]),delete i[0],Array.removeAt(i,0);r=this._container.childNodes[0];r.style.width="";r.style.height="";u=$common.getContentSize(r);u.height+=Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version<8?3:1;this._buttons?this._modalAutoSized||(this._container.style.width="auto",this._modalAutoSized=!0):(this._buttons=document.createElement("div"),this.get_element().appendChild(this._buttons),this._buttons.style.width=u.width+"px",Sys.UI.DomElement.addCssClass(this._buttons,"FixedButtons"),this._title=document.createElement("div"),Sys.UI.DomElement.addCssClass(this._title,"FixedTitle"),this.get_element().insertBefore(this._title,this._container),__designer()||$(this._element).draggable({handle:this._title,drag:function(n,t){var i=h,f=i.width(),e=i.height(),r=t.offset.left-i.scrollLeft(),u=t.offset.top-i.scrollTop(),o=t.helper.outerWidth();if(r+o<50||u<5||r>f-50||u>e-75)return!1}}));this._buttons.innerHTML=t.toString();t.clear();s=this._resizeContainerBounds();s.height>u.height&&!s.skipResizing&&(v=$common.getBorderBox(r),u.width+=v.horizontal,$common.setContentSize(this._container,u));r.style.width=this._title.offsetWidth+"px";this._buttons.style.width=this._title.offsetWidth+"px";Sys.UI.DomElement.setVisible(this.get_element(),!0);var y=$common.getBounds(this._container),c=$common.getPaddingBox(this._title),l=$common.getBorderBox(this._title);this._title.style.width=y.width-c.horizontal-l.horizontal+"px";c=$common.getPaddingBox(this._buttons);l=$common.getBorderBox(this._buttons);this._buttons.style.width=y.width-c.horizontal-l.horizontal+"px";this._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}<\/div><\/td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),o&&o.WindowTitle?o.WindowTitle:n.htmlEncode(this.get_view().Label),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());this._modalPopup.show();this._modalAutoSized&&!this._modalWidthFixed&&(this._modalWidthFixed=!0,this._container.style.width=this._container.offsetWidth+"px");this._adjustModalHeight(!0)},_adjustModalHeight:function(n){var t=this._container,e,o,i,u,r,s,f,h;if(this._modalPopup&&this.get_viewType()=="Form")if(n)this._lastContainerHeight=$(t).height();else if(this._lastContainerHeight!=null){for(e=t.style.height,o=t.scrollTop,t.style.height="",i=null,u=t.getElementsByTagName("tr"),r=0;r<u.length;r++)if(u[r].className=="Categories"){i=u[r].childNodes[0];break}i&&(i.style.paddingBottom="");containerBounds=$common.getBounds(t);this._lastContainerHeight>containerBounds.height?i&&(s=$common.getPaddingBox(i),f=this._lastContainerHeight-containerBounds.height-s.bottom,Sys.Browser.agent==Sys.Browser.InternetExplorer&&f++,i.style.paddingBottom=f+"px"):(h=$common.getClientBounds(),h.height*.8<=containerBounds.height?(t.style.height=e,t.scrollTop=o):this._lastContainerHeight=containerBounds.height)}},_allowModalAutoSize:function(){this._modalWidthFixed=!1;this._modalAutoSized=!1},_disposeModalPopup:function(){if(this._modalPopup){this._modalPopup.hide();this._modalPopup.dispose();__designer()||$(this._element).draggable("destroy");delete this._buttons;delete this._title;delete this._modalAnchor;var n=this.get_element();n.parentNode.removeChild(n);this._restoreTabIndexes()}},endModalState:function(n){var t=this.get_parentDataView(),i,r;if(this.get_isModal()&&(i=this.get_exitModalStateCommands(),i))for(r=0;r<i.length;r++)if(n==i[r])return t&&(t._lookupIsActive=!1,t._skipClickEvent=!0),$app.mobile?$app.mobile.endModalState(t,this):this.dispose(),!0;return t&&!this.get_confirmContext()&&($app.mobile||t.refresh()),p(),!1},_adjustLookupSize:function(){if(this.get_lookupField()&&this.get_pageSize()>3){var t=$app.scrolling(),i=$common.getClientBounds(),n=$common.getBounds(this.get_element());n.height+n.y>i.height+t.y&&this.set_pageSize(Math.ceil(this.get_pageSize()*.66))}},_onMethodFailed:function(t){(this._busy(!1),n._navigated)||this._wsRequest!=null&&(n.showMessage(String.format('<pre style="word-wrap:break-word;margin:0px">Component: {4}\r\nController: {5}; View: {6}; Timed out: {0}; Status Code: {7};\r\nException: {1}\r\nMessage: {2}\r\nStack:\r\n{3}<\/pre>',t.get_timedOut(),t.get_exceptionType(),t.get_message(),t.get_stackTrace(),this.get_id(),this.get_controller(),this.get_viewId(),t.get_statusCode())),$(this.get_element()).css("border","1px red solid"))},_createArgsForListOfValues:function(n){var t=this.get_lookupContext(),i=this._searchBarVisibleIndex==null?this.get_filter():this._createSearchBarFilter(!0),r={FieldName:n,Controller:this.get_controller(),View:this.get_viewId(),Filter:this._combinedFilter(i.length==1&&i[0].match(/(\w+):/)[1]==n?null:i),ExternalFilter:this.get_externalFilter(),LookupContextFieldName:t?t.FieldName:null,LookupContextController:t?t.Controller:null,LookupContextView:t?t.View:null,Tag:this.get_tag(),QuickFindHint:$app.touch?this.viewProp("quickFindHint"):null};return this._useSearchParams(r),{controller:this.get_controller(),view:this.get_viewId(),request:r}},_loadListOfValues:function(n,t,i,r){this._busy(!0);this._invoke("GetListOfValues",this._createArgsForListOfValues(i),Function.createDelegate(this,this._onGetListOfValuesComplete),{family:n,fieldName:t,callback:r})},_onGetListOfValuesComplete:function(t,i){this._busy(!1);var u=this.findField(i.fieldName);u._listOfValues=t;t[t.length-1]==null&&(Array.insert(t,0,t[t.length-1]),Array.removeAt(t,t.length-1));i.callback?i.callback():(this.get_isChart()?(this.get_showViewSelector()?this._registerViewSelectorItems():this._registerActionBarItems(),r.HoverMonitor._instance._tempOpenDelay=100):this._registerFieldHeaderItems(Array.indexOf(this.get_fields(),u)),$refreshHoverMenu(i.family),n._resized=!0)},get_parentDataView:function(n){var t=n;return this._parentDataViewId&&(t=$find(this._parentDataViewId)),t},get_selectedValues:function(){var n=this.get_parentDataView(this),t=n?n.get_selectedValue():[];return t.length==0?[]:n.multiSelect()?t.split(";"):[t]},_execute:function(n){this._busy(!0);this._showWait();this._lastArgs=n;this._invoke("Execute",{controller:n.Controller,view:n.View,args:n},Function.createDelegate(this,this._onExecuteComplete))},_populateDynamicLookups:function(n){for(var r,t,i=0;i<n.Values.length;i++)r=n.Values[i],t=this.findField(r.Name),t&&(t.DynamicItems=r.NewValue,t.Items=[],t.ItemCache=null);$app.mobile?$app.input.execute({dataView:this,values:n.Values,populateDynamicLookups:!1}):(this._skipPopulateDynamicLookups=!0,this.refresh(!0),this._focus())},_updateCalculatedFields:function(n){var i,t,r;for(this._displayActionErrors(n),i=[],t=0;t<n.Values.length;t++)r=n.Values[t],Array.add(i,{name:r.Name,value:r.NewValue});this.refresh(!0,i);this._focus()},_get_LEVs:function(){for(var t,i=0;i<n.LEVs.length;i++)if(t=n.LEVs[i],t.controller==this.get_controller())return t.records;return t={controller:this.get_controller(),records:[]},Array.add(n.LEVs,t),t.records},_recordLEVs:function(n){var t,r,i;if(this._allowLEVs&&(n||this._lastArgs.CommandName.match(/Insert|Update/))&&(this._lastArgs||n)){for(n||(n=this._lastArgs.Values),t=this._get_LEVs(),r=!0,i=0;i<n.length;i++)if(n[i].Modified){r=!1;break}r||(t.length>0&&Array.removeAt(t,t.length-1),Array.insert(t,0,n))}},_applyLEV:function(n){for(var t,r=this._allFields[n],e=this._allFields[r.AliasIndex],u=[],f=this._get_LEVs()[0],i=0;i<f.length;i++)t=f[i],(t.Name==r.Name||t.Name==e.Name)&&Array.add(u,{name:t.Name,value:t.NewValue});this.refresh(!0,u)},_notifyMaster:function(){if(this.get_hasParent()){var n=$find(this.get_filterSource());n&&n._updateDynamicValues("controller:"+this.get_controller())}},_clearSelectedKey:function(n){var t=this._lookupInfo?this:this.get_parentDataView(this),i=t._selectedKey,r;i&&i.length&&(r=t._selectedKeyList.indexOf(i.join(";")),r!=-1&&t._selectedKeyList.splice(r,1));t._selectedKey=[];t._selectedKeyFilter=[];t._selectedRowIndex=null;t._position=null;n!=!1&&(t._raiseSelectedDelayed=!0);t._selectedRow=null},_refreshSelectedKey:function(n){var t=this,i,u=[],s=[],f,e,r,o;for(n.length==0&&t._lastArgs&&(n=t._lastArgs.Values),e=0;e<t._keyFields.length;e++)for(f=t._keyFields[e],r=0;r<n.length;r++)if(n[r].Name==f.Name){if(o=n[r],o.NewValue==null){t._clearSelectedKey();return}Array.add(u,o.NewValue);Array.add(s,f.Name+":="+t.convertFieldValueToString(f,o.NewValue));break}i=t.get_parentDataView(t);u.length>0?(i._selectedKey=u,i._selectedKeyFilter=s,i._selectedKeyList=[u.join(";")],i._raiseSelectedDelayed=!0):i._selectedKeyList=[]},_cancelConfirmation:function(){if(this._confirmDataViewId){var n=$find(this._confirmDataViewId);n&&(this._confirmDataViewId=null,n.cancel())}},_findKeyValue:function(n){for(var i,r=this._keyFields[0],t=0;t<n.length;t++)if(i=n[t],r.Name==i.Name)return i.NewValue;return null},_onExecuteComplete:function(n,t){var i=this,y=i.extension(),g=$app.mobile,r=i._lastArgs.CommandName,u=n.Values,l,a,e,c,v,p,w,nt,tt,it,s,rt,ut,ft,ht,h,b,k,ot,f,o,ct,d,st;if(i._busy(!1),i._hideWait(),l=n.Errors.length==0,a=i._pendingUploads,a&&a.length>0&&l&&r.match(/^(Insert|Update)$/)){e=a[0];Array.removeAt(a,0);c=i._findKeyValue(u);c==null&&(c=i._findKeyValue(i._lastArgs.Values));e.files?(v=i.findField(e.fieldName),v.Name.match(/_Annotation_Attachment/)&&(c=v._dataView._controller+","+v.Name+"|"+c),$app.upload("execute",{container:et(i,v),files:e.files,url:String.format("{0}Blob.ashx?{1}=u|{2}&_v=2",__baseUrl,v.OnDemandHandler,c),success:function(){i._stopWaiting=!0},error:function(){a.push(e);i._stopWaiting=!0}})):e.form.action=e.form.action.replace(/=u\|&/,String.format("=u|{0}&",c));i._pendingExecuteComplete={result:n,context:t};i._showDownloadProgress();e.form&&e.form.submit();return}if(p=i._lastFocusedCell,r=="PopulateDynamicLookups"){i._populateDynamicLookups(n);return}if(r=="Calculate"){$app.touch?$app.input.execute({dataView:i,values:u,raiseCalculate:!1}):i._updateCalculatedFields(n);n.ClientScript&&eval(n.ClientScript);return}if(w=!1,nt=r=="Custom",l){if(i._confirmDataViewId&&g){g.pageShown(function(){i._onExecuteComplete(n,t)});i._cancelConfirmation();return}i._cancelConfirmation()}if(tt={result:n,context:t,handled:!1},i.raiseExecuted(tt),!tt.handled){if(it=!r.match(/Insert/),r.match(/Delete/i)&&n.RowsAffected>0)y=i.get_parentDataView(i).extension(),y&&y.clearSelection?y.clearSelection(!0):i._clearSelectedKey();else if(r.match(/Custom|SQL|Email/))w=!nt&&i.editing(),u.length>0?($app.touch?$app.input.execute({dataView:i,values:u}):i.refresh(!0,u),nt&&!n.ClientScript&&(n.ClientScript="void(0)"),i._refreshSelectedKey(u,l)):w||r!="SQL"||(i._raiseSelectedDelayed=!0,i._forceChanged=!0);else if(it)for(s=0;s<u.length;s++)rt=u[s],ut=i.findField(rt.Name),ut&&(i.get_currentRow()[ut.Index]=rt.NewValue);else $app.touch&&($app.input.execute({dataView:i,values:u}),i.get_isForm()&&(h=i.get_parentDataView(null),h&&h!=i&&(ft=[],ht=i.editRow(),$(i._allFields).each(function(){var n=this,t=h.findField(n.Name),i=ht[n.Index];t&&(ft[t.Index]=i)}),h.extension()._commandRow=ft))),i._refreshSelectedKey(u,l);if(l){if(i._forceSync(),h=i.get_parentDataView(),h&&h._forceSync(),i.set_tag(n.Tag),i._requestedFilter=n.Filter,i._requestedSortExpression=n.SortExpression,i._autoRefresh(),i.multiSelect()&&(i._selectedKeyList=[],i.set_selectedValue("")),i._recordLEVs(),i.updateSummary(),i._continueAfterScript=!0,n.ClientScript&&(i._continueAfterScript=!1,n.ClientScript=i.resolveClientUrl(n.ClientScript),eval(n.ClientScript)),i._lastFocusedCell=null,b=i._lastArgs.CommandArgument,k=new Web.BusinessRules(i),k.after({commandName:r,commandArgument:b}),k.canceled()&&(i._continueAfterScript=!1),k.dispose(),i._continueAfterScript){if(n.NavigateUrl)n.NavigateUrl=i.resolveClientUrl(n.NavigateUrl),i.navigate(n.NavigateUrl,it?i._lastArgs.Values:u);else if(!i._closeInstantDetails()&&!i.endModalState(r))if(i.get_backOnCancel()||!String.isNullOrEmpty(i._replaceTriggerViewId))i.goBack(!0);else{for(i._notifyDesigner(!0),ot=i.get_actions(i._get_lastActionScope(),!0),ct=i._lastArgs.Values,s=0;s<ot.length;s++)if(f=ot[s],f.WhenLastCommandName==r&&(!f.WhenLastCommandArgument||f.WhenLastCommandArgument==b)&&i._isActionMatched(f)){d=f.CommandName;st=f.CommandArgument;g&&(o=i.delegateCommand(d,st));o||(o=i);(!f.WhenKeySelected||(o.get_selectedKey()||[]).length)&&(o.set_lastCommandName(r),o.set_lastCommandArgument(b),o.executeCommand({commandName:d,commandArgument:st,path:f.Path,causesValidation:f.CausesValidation,values:r.match(/Insert|Custom/)?ct:null}),o._pendingSelectedEvent=d.match(/^(Edit|Select)/)!=null,o._notifyMaster());return}w||(i._pendingSelectedEvent=r.match(/Update|Custom|SQL/),i.set_lastCommandName(null),i.get_isModal()&&(!i.get_isForm(i._lastViewId)||i._closeViewDetails)?i.endModalState("Cancel"):i.goToView(i._lastViewId))}i._notifyMaster()}}else p&&(i._focusCell(-1,-1,!1),i._focusCell(p.rowIndex,p.colIndex,!0),i._lastFocusedCell=null,i._saveAndNew=!1),n.ClientScript&&(n.ClientScript=i.resolveClientUrl(n.ClientScript),eval(n.ClientScript)),i._displayActionErrors(n)}},_get_lastActionScope:function(){var f=this._lastArgs?this._lastArgs.Path:null,i,r,n,u,t;if(f&&(i=f.match(/^(\w+)\//),i))for(r=this._actionGroups,n=0;n<r.length;n++)if(u=r[n],u.Id==i[1])return u.Scope;return t=this.get_viewType(),t.match(/DataSheet|Tree/)&&(t="Grid"),t},_displayActionErrors:function(t){if(t.Errors.length!=0){for(var r=new Sys.StringBuilder,i=0;i<t.Errors.length;i++)r.append(n.formatMessage("Attention",t.Errors[i]));n.showMessage(r.toString());r.clear()}},_busy:function(t){var o,v,g,p,l,b,k;if(t==null)return this._isBusy;if(this._isBusy=t,this._enableButtons(!t),!n.isSaaS()){var f=this,r=n.mobile,y=f._busyInterval,u=!r&&(f.get_isModal()||f.get_lookupField()!=null||!this._controller)||r!=null||this.get_useCase()=="$app",d=r?r.toolbar():u?document.body:f._container,c=$(d),a=$(f._container),e;if(r&&!r.toolbar().is(":visible")){r.wait(t);return}if(r){clearTimeout($app._busyIndicatorTimeout);e=$app._busyIndicator;e||(e=n._busyIndicator=$('<div class="dataview-busy-indicator"><\/div>').appendTo(document.body),n._busyCount=0);t?(n._busyCount||(n._busyTime=+new Date,e.removeClass("dataview-busy-indicator-done").css({top:c.outerHeight()-e.outerHeight()-1,"animation-duration":Math.max(1e3,h.width())*3+"ms"}),e.addClass("dataview-busy-indicator-animate")),n._busyCount++):n._busyCount&&(n._busyCount==1&&(+new Date-n._busyTime>500?(e.toggleClass("dataview-busy-indicator-animate dataview-busy-indicator-done"),setTimeout(function(){e.removeClass("dataview-busy-indicator-done")},1550)):e.removeClass("dataview-busy-indicator-animate dataview-busy-indicator-done")),n._busyCount--);return}if(t&&!y){r||a.is(".dataview-loaded")||a.addClass("dataview-loading");!u;o=c.outerWidth()/5;o>200&&(o=200);var i=f._$busy=$(String.format('<div class="dataview-busy-indicator{0}"><\/div>',u?" modal":"")).css({position:r?"fixed":"absolute",width:o,"z-index":u?r?5e3:3e6:0}),s=-o,w=u?0:i.height();i.hide().appendTo(document.body);v=0;g=!1;this._busyInterval=setInterval(function(){var n,t;if(v!=null)if(v++>(r?35:75))v=null,p=!0;else return;s+=Math.ceil(o/30);p?(u&&$app._busyIndicator?(l=!0,i.hide()):($app._busyIndicator=!0,i.show()),p=!1):l&&!$app._busyIndicator&&(l=!1,$app._busyIndicator=!0,i.show());s>=0?(n=c.outerWidth(),s>=n-o&&s<n?i.width(n-s):s>=n&&(s=-o),l||(t=c.scrollTop(),i.position({my:"left top",at:String.format("left+{0} top{1}{2}",s,u?"+":"-",u?h.scrollTop():w),of:c}))):l||(i.width(o+s),i.position({my:"left top",at:String.format("left top{0}{1}",u?"+":"-",u?h.scrollTop():w),of:c}))},1e3/60)}else y&&(r||a.is(".dataview-loaded")||a.removeClass("dataview-loading").addClass("dataview-loaded"),clearInterval(y),f._busyInterval=null,i=f._$busy,i&&(b=i.offset(),k=c.offset(),f._$busy=null,i.width(c.outerWidth()-(b.left-k.left)),setTimeout(function(){i.remove();u&&($app._busyIndicator=!1)},500)))}},_enableButtons:function(n){if(!$app.mobile)var t=$("button",this._element).each(function(){$(this).toggleClass("disabled",!n)})},_bodyKeydown:function(n){var t=!1;this._customFilterField?n.keyCode==Sys.UI.Key.enter?(t=!0,this.applyCustomFilter()):n.keyCode==Sys.UI.Key.esc&&(t=!0,this.closeCustomFilter()):this.get_lookupField()&&n.keyCode==Sys.UI.Key.esc&&(t=!0,this.hideLookup());t&&(n.preventDefault(),n.stopPropagation())},_prepareJavaScriptExpressionEx:function(n){return n.replace(/\[((\w+)\.)?(\w+)\]/g,'this.fieldValue("$3","$2")').replace(/\$row\.(\w+)/gm,'this.fieldValue("$1")').replace(/\$master\.(\w+)/gm,'this.fieldValue("$1","master")')},_evaluateVisibility:function(){var n=this.get_visibleWhen();return String.isNullOrEmpty(n)?!0:(n=this._prepareJavaScriptExpressionEx(n),eval(n)!=!1)},_filterSourceSelected:function(t,i,r){var e,u,o,h,c,l,a,v,y,f,s;if(this._hidden=!this._evaluateVisibility(),e=this.readContext("vitals"),e){for(u=0;u<e.Filter.length;){var p=e.Filter[u],b=p.substring(0,p.indexOf(":")),w=!1;if(this._keyFields)for(o=0;o<this._keyFields.length;o++)if(this._keyFields[o].Name==b){w=!0;break}w?Array.removeAt(e.Filter,u):u++}this.writeContext("vitals",e)}for(h=[],u=0;u<this._externalFilter.length;u++)Array.add(h,this._externalFilter[u].Value),this._externalFilter[u].Value=null;for(c=!1,l=!1,n.isInstanceOfType(t)?(String.isNullOrEmpty(this._transaction)||this.set_transaction(t.get_transaction()),this._populateExternalViewFilter(t),c=!t.get_showDetailsInListMode()&&t.get_isGrid(),t._forceChanged&&(l=!0)):this._externalFilter.length>0&&(this._externalFilter[0].Value=t.target.value),this.applyExternalFilter($app.mobile),a=!0,v=!1,u=0;u<this._externalFilter.length;u++)y=this._externalFilter[u].Value,y!=null&&(a=!1),y!=h[u]&&(v=!0);this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!a&&!c&&!this._hidden);(v||l)&&(r||(s=this.extension(),this.set_pageIndex(-1),s&&s.currentPageIndex&&s.currentPageIndex(null)),f=this._position,f&&(f.index=0,f.count=-1,f.key=[],f.keyFilter=[],f.filter=this.get_filter()),r||(this._selectedKey=[],this._selectedKeyFilter=[]),this._clearCache(),this.loadPage());this.raiseSelected();this.updateSummary()},_createExternalFilter:function(){var r,i,t;if(this._externalFilter=[],r=/(\w+)(,|$)/g,this.get_filterFields())for(i=this.get_filterFields().split(n._simpleListRegex),t=0;t<i.length;t++)Array.add(this._externalFilter,{Name:i[t],Value:null})},_populateExternalViewFilter:function(n){var i,r,f,t,u,e;if(n._selectedKey&&n._keyFields&&n._selectedKey.length==n._keyFields.length)for(i=0;i<this._externalFilter.length;i++){for(r=this._externalFilter[i],f=!1,t=0;t<n._keyFields.length;t++)if(u=n._keyFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,n._selectedKey[t]);f=!0;break}if(!f&&this.get_controller()!=n.get_controller()&&(e=n.get_selectedRow(),e&&e.length))for(t=0;t<n._allFields.length;t++)if(u=n._allFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,e[n._allFields[t].Index]);f=!0;break}!f&&n._selectedKey.length>=i&&(r.Value=n._selectedKey[i])}},_cloneChangedRow:function(){var t,n,i;if(this.editing()){var r=this._collectFieldValues(),u=this.get_currentRow(),f=u?Array.clone(u):null,e=__designer();for(t=0;t<r.length;t++)n=r[t],i=this.findField(n.Name),i&&(f[i.Index]=e?n.Modified?n.NewValue:n.OldValue:n.NewValue);return f}return this.get_selectedRow()},_updateVisibility:function(n){var p,s,h,w,u,e,t,i,f,c,r,l,b,g,a,tt,o,it,y,d;if(this._expressions&&(this._readOnlyChanged=!1,p=this.get_isForm(),s=[],n||(n=this._cloneChangedRow()),n)){for(h=!1,w=!1,u=0;u<this._expressions.length;u++)e=s[0]=this._expressions[u],e.Type==Web.DynamicExpressionType.ClientScript&&(e.Scope==Web.DynamicExpressionScope.DataFieldVisibility?(t=this.findField(e.Target),t&&(i=this._get(p?"_ItemContainer":"Item",t.Index),i&&(f=this._evaluateJavaScriptExpressions(s,n,!1),p&&(c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.containsCssClass(i.parentNode,"FieldPlaceholder")?i=i.parentNode:Sys.UI.DomElement.containsCssClass(i.parentNode.parentNode,"FieldWrapper")&&(i=i.parentNode.parentNode.parentNode.parentNode),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0))))):e.Scope==Web.DynamicExpressionScope.CategoryVisibility?(r=this.findCategory(e.Target),r&&(i=this._get("_Category",r.Index),i&&(r.IsVisible=this._evaluateJavaScriptExpressions(s,n,!1),f=r.IsVisible&&(String.isNullOrEmpty(r.Tab)||r.Tab==this._get_selectedTab()),c=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.setVisible(i,f==!0),c!=f&&(h=!0),l=this._get("$CategoryDescription$",r.Index),l&&(b=this._processTemplatedText(n,r.Description),l.innerHTML=b,l.style.display=String.isNullOrEmpty(b)?"none":"block"),String.isNullOrEmpty(r.Tab)||(w=!0)))):e.Scope==Web.DynamicExpressionScope.ReadOnly&&(t=this.findField(e.Target),t&&(t.OriginalTextMode==null&&(t.OriginalTextMode=t.TextMode),g=t.isReadOnly(),f=this._evaluateJavaScriptExpressions(s,n,!1),t.TextMode=f==!0?4:t.OriginalTextMode,f!=g&&(h=!0,this._readOnlyChanged=!0))));if(w)for(u=0;u<this._tabs.length;u++){var rt=this._tabs[u],nt=!1,k=!1;for(a=0;a<this._categories.length;a++)if(r=this._categories[a],r.Tab==rt&&r.IsVisible!=null&&(nt=!0,k=r.IsVisible,k))break;nt&&Sys.UI.DomElement.setVisible(this._get("_Tab",u),k)}if(this._dynamicActionButtons&&(this._clonedRow=n,tt=this._get("$ActionButtons$","Top"),tt&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Top",this._lastActionButtonsScope),this._newTopActionButtons=o.toString(),o.clear()),it=this._get("$ActionButtons$","Bottom"),it&&(o=new Sys.StringBuilder,this._internalRenderActionButtons(o,"Bottom",this._lastActionButtonsScope),this._newBottomActionButtons=o.toString(),o.clear()),y=this,setTimeout(function(){y._refreshActionButtons()},500),this._clonedRow=null),this._updateStatusBar(),h&&(this._adjustModalHeight(),this._modalPopup&&this._modalPopup.show(),_body_performResize()),this.editing()&&!this._lookupIsActive)for(d=this._get_focusedCell(),u=0;u<this._fields.length;u++)if(t=this._fields[u],!t.ReadOnly&&!t.Hidden&&t.AutoSelect&&t.ItemsStyle=="Lookup"&&(d==null||d.colIndex==t.ColIndex)&&(t.AutoSelect=!1,v=n[t.Index],v==null)){this._lookupIsActive=!0;y=this;setTimeout(function(){y.showLookup(t.Index)},100);break}}},_refreshActionButtons:function(){var t=this._get("$ActionButtons$","Top"),n;t&&this._newTopActionButtons&&(t.innerHTML=this._newTopActionButtons,this._newTopActionButtons=null);n=this._get("$ActionButtons$","Bottom");n&&this._newBottomActionButtons&&(n.innerHTML=this._newBottomActionButtons,this._newBottomActionButtons=null)},_updateDynamicValues:function(n){var t=this,u=!1,o=t._allFields,s=n&&n.Name?n.Name:n,f,i,h,e,r;if(n&&n.CausesCalculate){if(!t.editing())return t.refresh(),!0;t._raiseCalculate(n,n);u=!0}else for(f=0;f<o.length;f++)if(i=o[f],h=!String.isNullOrEmpty(i.ContextFields),h){for(e=/\s*([\w\:]+)\s*(=\s*(\w+)\s*)?(,|$)/g,r=e.exec(i.ContextFields);r;){if(i.ItemsAreDynamic&&(n==null||r[3]==s)){if(!t.editing())return t.refresh(),!0;t._raisePopulateDynamicLookups();u=!0}else if((i.Calculated||i.CausesCalculate)&&r[1]==s||r[1]==n||"controller:"+r[1]==n){if($app.touch){t.extension().notify(n);return}if(!t.editing())return t.refresh(),!0;t._raiseCalculate(i,n);u=!0}if(u)break;r=e.exec(i.ContextFields)}if(u)break}return u},_valueFocused:function(t){var i=this._allFields[t];this._focusedFieldName=i.Name;n._focusedDataViewId=this._id;n._focusedItemIndex=t},_resetContextLookupValues:function(n){var t=[],i;return this._enumerateContextFieldValues(n,t,{}),i=t.length>0,i&&this.refresh(!0,t),i},_enumerateContextFieldValues:function(t,i,r){for(var u,o,l,s,h,a,v=t.Name,c,e=this._allFields,f=0;f<e.length;f++)if(u=e[f],o=u.ContextFields,o&&!r[f]&&u.ItemsStyle)for(l=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g;c=l.exec(o);)if(c[3]==v){if(r[f]=!0,i.push({name:u.Name,value:null}),s=e[u.AliasIndex],s!=u&&i.push({name:s.Name,value:null}),h=u.Copy,h)while(a=n._fieldMapRegex.exec(h))i.push({name:a[1],value:null});u.DynamicItems=null;u.ItemCache=null;this._enumerateContextFieldValues(u,i,r)}},_copyStaticLookupValues:function(t){var u,o,i,f,h,c;if(!String.isNullOrEmpty(t.Copy)&&(t.ItemsStyle=="RadioButtonList"||t.ItemsStyle=="ListBox"||t.ItemsStyle=="DropDownList")){var l=this._collectFieldValues(),r=l[t.Index].NewValue,e=null,s=t.DynamicItems||t.Items;for(r!=null&&typeof r!="string"&&(r=r.toString()),u=0;u<s.length;u++)if(o=s[u],i=o[0],i!=null&&typeof i!="string"&&(i=i.toString()),i==r){e=o;break}if(e){for(f=[],h=2;c=n._fieldMapRegex.exec(t.Copy);)Array.add(f,{name:c[1],value:e[h++]});return $app.touch?$app.input.execute({dataView:this,values:f}):this.refresh(!0,f),!0}}return!1},_replaceFieldValue:function(n){for(var t,o,r=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,n.Name),i=0;i<r.length;i++){t=r[i];try{if(t.Result.match(/\$(\d|\'\`)/)){var s=this._collectFieldValues(),u=s[n.Index],f=u.NewValue?u.NewValue.toString():null,h=new RegExp(t.Test),e=f.replace(h,t.Result);e!=f&&(o=[{name:n.Name,value:e}],this.refresh(!0,o))}}catch(c){}}},_valueChanged:function(t){var r=this._allFields[t],i;this._showFieldError(r,null);this._skipErrorReset=!1;i=this;i._valueChangedTimeout=setTimeout(function(){n._navigated||i._performValueChanged(t,!0)},200)},_performValueChanged:function(n,t){var i=this._allFields[n],r,u,f;if(i){if(this._skipErrorReset){this._skipErrorReset=!1;return}return this._showFieldError(i,null),this._replaceFieldValue(i),r=this._resetContextLookupValues(i),u=this._copyStaticLookupValues(i),this._updateVisibility(),f=this._updateDynamicValues(i),t&&this._readOnlyChanged&&this.editing()&&(this.refresh(!0),this._focus()),u||f||r||this._readOnlyChanged}},_quickFind_focus:function(){var n=this.get_quickFindElement();n.value==Web.DataViewResources.Grid.QuickFindText&&(n.value="");Sys.UI.DomElement.removeCssClass(n,"Empty");Sys.UI.DomElement.removeCssClass(n,"NonEmpty");n.select();this._lostFocus=!0},_quickFind_blur:function(){var n=this.get_quickFindElement();String.isBlank(n.value)?(n.value=Web.DataViewResources.Grid.QuickFindText,Sys.UI.DomElement.addCssClass(n,"Empty")):Sys.UI.DomElement.addCssClass(n,"NonEmpty");this._lostFocus=!1},_executeQuickFind:function(n){var t,i;for(this._forceSync(),t=0;t<this._allFields.length;t++)this._allFields[t]._listOfValues=null;for(this.removeQuickFind(),t=0;t<this._allFields.length;t++)if(i=this._allFields[t],!i.Hidden){i=this._allFields[i.AliasIndex];String.isNullOrEmpty(n)?this.refreshData():this.applyFilter(i,"~",n);break}},quickFind:function(n){var t=(String.isNullOrEmpty(n)?this.get_quickFindElement().value:n).match(/^\s*(.*?)\s*$/),i=t[1]==Web.DataViewResources.Grid.QuickFindText?"":t[1];this.set_quickFindText(i);this._executeQuickFind(i);this._lostFocus=!1},_quickFind_keydown:function(n){if(n.keyCode==Sys.UI.Key.enter)n.preventDefault(),n.stopPropagation(),this.quickFind();else if(n.keyCode==Sys.UI.Key.down)return},encodePermalink:function(n,t,i){Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"EncodePermalink",!1,{link:n,rooted:!1},Function.createDelegate(this,this._encodePermalink_Success),Function.createDelegate(this,this._onMethodFailed),{target:t,features:i})},_encodePermalink_Success:function(n,t){t.target||t.features?open(n,t.target,t.features):location.href=n},showViewMessage:function(n){var r=this._get("$HeaderText"),i,t;r!=null&&n&&(i=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage();return false;" class="Close" title="{2}">&nbsp;<\/a><\/div>',this.get_id(),n,Web.DataViewResources.ModalPopup.Close),t=this.get_view(),t.OriginalHeaderText||(t.OriginalHeaderText=t.HeaderText),t.HeaderText=i,r.innerHTML=i,this._viewMessages||(this._viewMessages={}),this._viewMessages[t.Id]=n)},hideViewMessage:function(){var i=this._get("$HeaderText"),t,n;if(i!=null){if(t=this.get_view(),n=t.OriginalHeaderText,!n)return;t.HeaderText=n;i.innerHTML=this._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[n],!0,n);this._viewMessages[t.Id]=null}}};n.loadDesigner=function(){if(n.Designer)$app.Designer.open();else{var t="http://localhost:"+__designerPort+"/touch/codeontime.designer.css";$('link[href="'+t+'"]').length||$("head").append('<link id="designer-css" rel="stylesheet" type="text/css" href="'+t+'">');typeof __cotdesigner!="undefined"?n.Designer=new __cotdesigner:($.ajax("http://localhost:"+__designerPort+"/touch/codeontime.designer.css"),$.getScript("http://localhost:"+__designerPort+"/Scripts/codeontime.designer.js",function(){typeof __cotdesigner!="undefined"&&(n.Designer=new __cotdesigner)}))}};n.registerClass("Web.DataView",Sys.UI.Behavior);r.AutoComplete=function(n){Web.AutoComplete.initializeBase(this,[n])};r.AutoComplete.prototype={initialize:function(){Web.AutoComplete.callBaseMethod(this,"initialize");this._textBoxMouseOverHandler=Function.createDelegate(this,this._onTextBoxMouseOver);this._textBoxMouseOutHandler=Function.createDelegate(this,this._onTextBoxMouseOut);this._completionListItemCssClass="Item";this._highlightedItemCssClass="HighlightedItem"},dispose:function(){this._viewPage=null;this._element&&($removeHandler(this._element,"mouseover",this._textBoxMouseOverHandler),$removeHandler(this._element,"mouseout",this._textBoxMouseOutHandler));Web.AutoComplete.callBaseMethod(this,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(n){this._fieldName=n},updated:function(){var n=document.createElement("div");n.className="AutoCompleteFrame "+this.get_typeCssClass();n.innerHTML=String.format('<table><tr><td class="Input"><\/td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;<\/span><\/td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;<\/span><\/td><\/tr><\/table>',this.get_id(),Web.DataViewResources.Data.Filters.Labels.Clear,this.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");this._element.setAttribute("autocomplete","off");this._element.parentNode.insertBefore(n,this._element);n.getElementsByTagName("td")[0].appendChild(this._element);Sys.Browser.agent==Sys.Browser.WebKit&&(n.style.marginLeft="2px");this._completionSetCount==10&&(this._completionSetCount=100);$addHandler(this._element,"mouseover",this._textBoxMouseOverHandler);$addHandler(this._element,"mouseout",this._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(this,"updated");document.body.appendChild(this._completionListElement);this._completionListElement.className="CompletionList AutoComplete";this._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],!1)},_showFullList:function(){var t,i,n;if(!this._webRequest&&(t=this._popupBehavior.get_visible(),this._hideCompletionList(),this._element.focus(),!t)){if(this._completionWord="%",this._cache&&this._cache["%"]){i=this;setTimeout(function(){i._showCachedFullList()},50);return}n={prefixText:this._completionWord,count:this._completionSetCount};this._useContextKey&&(n.contextKey=this._contextKey);this._ignoreCompletionWord=!0;this._invoke(n,this._completionWord)}},_showDropDown:function(n){for(var t=this._element;t.tagName!="TR";)t=t.parentNode;n?Sys.UI.DomElement.addCssClass(t,"Active"):this._textBoxHasFocus?Sys.UI.DomElement.addCssClass(t,"Active"):Sys.UI.DomElement.removeCssClass(t,"Active")},_onKeyDown:function(n){var i,t;n.keyCode==Sys.UI.Key.down&&n.altKey&&(n.preventDefault(),n.stopPropagation(),this._showFullList());i=this._popupBehavior._visible;Web.AutoComplete.callBaseMethod(this,"_onKeyDown",[n]);(n.keyCode==Sys.UI.Key.enter||n.keyCode==Sys.UI.Key.esc)&&(t=this._get_fieldDataView(!0),t&&(t.get_isDataSheet()&&i?(n.preventDefault(),n.stopPropagation()):t.get_searchBarIsVisible()&&(n.preventDefault(),n.stopPropagation(),i||setTimeout(function(){t._performSearch()},100))))},_update:function(n,t,i){var r,u,f,e;if(Web.AutoComplete.callBaseMethod(this,"_update",[n,t,i]),t){for(r=-1,u=this._currentCompletionWord().toLowerCase(),f=0;f<t.length;f++)if(e=t[f],e!=null&&(e=e.toLowerCase(),r==-1&&e.startsWith(u)&&(r=f),e==u)){r=f;break}r>=0&&r<this._completionListElement.childNodes.length&&(this._selectIndex=r,u=this._completionListElement.childNodes[r],this._highlightItem(u),this._handleScroll(u,r+5))}},_get_fieldDataView:function(t){var r=null,i=this._get_contextInfo();return i&&(i.type=="Field"||t&&i.type=="SearchBar")&&(r=n.find(i.controller)),r},_setText:function(n){var u,h,t,o,v,c,r;if(Web.AutoComplete.callBaseMethod(this,"_setText",[n]),this._updateClearButton(),u=this._get_fieldDataView(),u){var f=u.findField(this.get_fieldName()),l=this.get_element().value,e=[];if(l!=Web.DataViewResources.Data.NullValueInForms&&(h=this._enumerateViewPageItems(l),h!=-1)){var i=this._viewPage,a=i.Rows[h],s=[];for(t=0;t<i.Fields.length;t++)o=i.Fields[t],o.Name==f.ItemsDataValueField&&Array.add(s,o);if(s.length==0)for(t=0;t<i.Fields.length;t++)if(o=i.Fields[t],o.IsPrimaryKey){Array.add(s,o);break}for(t=0;t<s.length;t++)v=a[s[0].Index],Array.add(e,v)}if($get(u.get_id()+"_Item"+f.Index).value=e.toString(),this._originalElementText=this.get_element().value,this._get_isInLookupMode()){if(!String.isNullOrEmpty(f.Copy)){for(e=[],c=/(\w+)=(\w+)/g,r=c.exec(f.Copy);r;){if(r[2]=="null")Array.add(e,{name:r[1],value:null});else for(t=0;t<i.Fields.length;t++)i.Fields[t].Name==r[2]&&Array.add(e,{name:r[1],value:a[t]});r=c.exec(f.Copy)}u.refresh(!0,e)}u._valueChanged(f.Index)}}},_get_isInLookupMode:function(){var n=this._get_contextInfo();return n!=null&&n.type=="Field"},_updateClearButton:function(){var n=this._element.parentNode.parentNode;String.isBlank(this._element.value)?Sys.UI.DomElement.removeCssClass(n,"Filtered"):Sys.UI.DomElement.addCssClass(n,"Filtered")},_onGotFocus:function(n){if(Web.AutoComplete.callBaseMethod(this,"_onGotFocus",[n]),this._showDropDown(!0),this._updateClearButton(),this._get_isInLookupMode()){var t=this.get_element();this._originalElementText=t.value;this._originalElementText==Web.DataViewResources.Data.NullValueInForms&&(t.value="",t.select())}},_onLostFocus:function(n){Web.AutoComplete.callBaseMethod(this,"_onLostFocus",[n]);this._showDropDown(!1);this._updateClearButton();this._get_isInLookupMode()&&this._originalElementText!=null&&(this.get_element().value=this._originalElementText)},_onTextBoxMouseOver:function(){this._showDropDown(!0)},_onTextBoxMouseOut:function(){this._showDropDown(!1)},_currentCompletionWord:function(){if(this._completionWord){var n=this._completionWord;return this._completionWord=null,n}return Web.AutoComplete.callBaseMethod(this,"_currentCompletionWord")},_onTimerTick:function(n,t){var i,r;if(this._timer.set_enabled(!1),this._servicePath&&this._serviceMethod){if(i=this._currentCompletionWord(),i.trim().length<this._minimumPrefixLength){this._currentPrefix=null;this._update("",null,!1);return}if(this._currentPrefix!==i||i==""&&this._minimumPrefixLength==0){if(this._currentPrefix=i,i!=""&&this._cache&&this._cache[i]){this._update(i,this._cache[i],!1);return}if(t=new Sys.CancelEventArgs,this.raisePopulating(t),t.get_cancel())return;r={prefixText:this._currentPrefix,count:this._completionSetCount};this._useContextKey&&(r.contextKey=this._contextKey);this._webRequest&&(this._webRequest.get_executor().abort(),this._webRequest=null);this._invoke(r,i);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var n=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return n?{type:n[1],controller:n[2],fieldName:n[3]}:null},_invoke:function(t,i){var e=this,o=e._get_contextInfo(),u,h,k,f,c,w;if(o){var r=n.find(o.controller),s=[],v=o.fieldName,b="beginswith";if(o.type=="SearchBar"?s=r._createSearchBarFilter(!0):o.type=="Filter"?s=r.get_filter():(u=r.findField(this.get_fieldName()),v=String.isNullOrEmpty(u.ItemsDataTextField)?u.Name:u.ItemsDataTextField),!this._ignoreCompletionWord){for(h=0;h<s.length;h++)if(k=s[h].match(/^(\w+):/),k[1]==o.fieldName){Array.removeAt(s,h);break}u||(u=r.findField(v));u&&u.AutoCompleteAnywhere&&(b="contains");Array.add(s,String.format('{0}:${1}${2}\0',v,b,this._currentCompletionWord()))}var y=null,l=null,a=null,p,d;if(o.type=="Field"){if(l=u.ItemsDataController,a=u.ItemsDataView||"grid1",p=[u.ItemsDataTextField],u.Copy)while(d=n._fieldMapRegex.exec(u.Copy))p.push(d[2]);for(f={FieldName:u.Name,Controller:r.get_controller(),View:r.get_viewId()},c=r.get_contextFilter(u),h=0;h<c.length;h++)w=c[h],Array.add(s,String.format('{0}:={1}\0',w.Name,w.Value));y={PageIndex:0,RequiresMetaData:!0,RequiresRowCount:!1,PageSize:300,FieldFilter:p,SortExpression:u.ItemsDataTextField,Filter:s,ContextKey:r.get_id(),Cookie:r.get_cookie(),FilterIsExternal:c.length>0,Transaction:r.get_transaction(),LookupContextFieldName:f?f.FieldName:null,LookupContextController:f?f.Controller:null,LookupContextView:f?f.View:null,LookupContext:f,View:r.get_viewId(),Tag:r.get_tag(),MetadataFilter:["fields"],ExternalFilter:c}}else l=r.get_controller(),a=r.get_viewId(),y={FieldName:o.fieldName,Filter:s,LookupContextFieldName:f?f.FieldName:null,LookupContextController:f?f.Controller:null,LookupContextView:f?f.View:null,AllowFieldInFilter:this._ignoreCompletionWord!=!0,Controller:l,View:a,Tag:r.get_tag(),ExternalFilter:r.get_externalFilter()};r._busy(!0);e._webRequest=r._invoke(e.get_serviceMethod(),{controller:l,view:a,request:y},function(n,t){o.type=="Field"?(r._busy(!1),e._onGetPageComplete(n,t)):(r._busy(!1),e._onGetListOfValuesComplete(n,t))},i);e._ignoreCompletionWord=!1}else e._webRequest=Sys.Net.WebServiceProxy.invoke(e.get_servicePath(),e.get_serviceMethod(),!1,t,Function.createDelegate(e,e._onMethodComplete),Function.createDelegate(e,e._onMethodFailed),i)},_onGetListOfValuesComplete:function(n,t){n.length>0&&n[0]==null&&(n[0]=Web.DataViewResources.HeaderFilter.EmptyValue);this._webRequest=null;this._update(t,n,!0)},_onGetPageComplete:function(n,t){if(this._element){this._viewPage=n;var i=this._enumerateViewPageItems();this._onGetListOfValuesComplete(i,t)}},_enumerateViewPageItems:function(n){for(var i,f,e,r=this._viewPage,s=this._get_fieldDataView(),o=s.findField(this.get_fieldName()),u=[],t=0;t<r.Fields.length;t++)i=r.Fields[t],i.Index=t,i.Type||i.Type=="String",i.Name==o.ItemsDataTextField&&Array.add(u,i);if(u.length==0)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden&&i.Type=="String"){Array.add(u,i);break}if(u.length==0)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden){Array.add(u,i);break}for(f=[],o.AllowNulls&&Array.add(f,Web.DataViewResources.Data.NullValueInForms),t=0;t<r.Rows.length;t++)if(e=r.Rows[t][u[0].Index],n!=null){if(e==n)return t}else Array.add(f,e);return n!=null?-1:f},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(n){this._typeCssClass=n}};n.hideMessage=function(){n.showMessage()};n.formatMessage=function(n,t){return String.format('<table cellpadding="0" cellspacing="0" ><tr><td class="{0}" valign="top">&nbsp;<\/td><td class="Message">{1}<\/td><\/tr><\/table>',n,t)};n.showMessage=function(t){var r,h,i,u,o,s,f,e;String.isBlank(t)&&(t=null);r=document.getElementsByTagName("body")[0];h=!1;n.MessageBar||(i=document.createElement("div"),i.id="DataView_MessageBar",r.appendChild(i),Sys.UI.DomElement.setVisible(i,!1),Sys.UI.DomElement.addCssClass(i,"MessageBar"),n.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},null,null,i),u=Sys.UI.DomElement.getBounds(r),u.y<0&&(u.y=0),n.OriginalBodyTopOffset=u.y);i=$get("DataView_MessageBar");o=Sys.UI.DomElement.getVisible(i);i.innerHTML=t?String.format('<div>{0}<\/div><div class="Stub"><\/div>',t):"";Sys.UI.DomElement.setVisible(i,t!=null);s=Sys.UI.DomElement.getBounds(i);f=t?n.OriginalBodyTopOffset+s.height:n.OriginalBodyTopOffset;r.style.paddingTop=f+"px";e=$get("Membership_Login");e&&(e.style.marginTop=f+"px");Sys.UI.DomElement.getVisible(i)!=o&&_body_performResize()};n._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];n._delayedLoadingViews=[];n._performDelayedLoading=function(){for(var i=0,t;i<n._delayedLoadingViews.length;)t=n._delayedLoadingViews[i],t.get_isDisplayed()?(Array.remove(n._delayedLoadingViews,t),t._delayedLoading&&t._loadPage()):i++};n.unanchor=function(n){var t=n.match(/^(.+?)#.*$/);return t?t[1]:n};n.ensureJSONCompatibility=function(t){$(t).each(function(){var t=this;t.OldValue&&t.OldValue.getTimezoneOffset&&(t.OldValue=n.stringifyDate(t.OldValue));t.NewValue&&t.NewValue.getTimezoneOffset&&(t.NewValue=n.stringifyDate(t.NewValue))})};n.stringifyDate=function(n){return ct(n)?String.format("{0}-{1:d2}-{2:d2}T{3:d2}:{4:d2}:{5:d2}.{6:d3}",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):n};n.isISO8601DateString=function(n){return n&&typeof n=="string"&&n.match(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)};n.execute=function(t){function e(){i.dispose();h.remove()}function o(){i._busy(!1)}var h=$("<p>"),s=t.externalFilter,i=$create(Web.DataView,{controller:t.controller,viewId:t.view||"grid1",servicePath:t.url||__servicePath,baseUrl:__baseUrl,useCase:"$app",tags:t.tags,externalFilter:s,filterSource:t.filterSource||(s&&s.length?"External":null)},null,null,h.get(0)),u=t.sync,r={},f;if(i._api=r,u&&(i._syncKey=Array.isArray(u)?u:[u]),t.requiresData==!1&&(r.DoesNotRequireData=!0),r.requiresAggregates=t.requiresAggregates==!0,r.metadataFilter=t.metadataFilter||["fields"],t.fieldFilter&&(r.fieldFilter=t.fieldFilter),i._onMethodFailed=function(n,i){o();t.error&&t.error(n,i);e()},t.batch){i._busy(!0);$(t.batch).each(function(){var n=this;n.pageIndex==null&&(n.pageIndex=0);n.pageSize==null&&(n.pageSize=100);n.metadataFilter&&(n.RequiresMetaData=!0)});i._invoke("GetPageList",{requests:t.batch},function(n){o();t.success&&t.success(n);e()},null);return}if(i._onGetPageComplete=function(n){o();var r={totalRowCount:n.TotalRowCount,pageIndex:n.PageIndex,pageSize:n.PageSize},s=r[t.controller]=[],u=t.format,f=[];$(n.Fields).each(function(){var n=this;n.IsPrimaryKey&&f.push(n);n.Type||(n.Type="String")});u&&$(n.Fields).each(function(){var n=this;_field_prepareDataFormatString(i,n);n.format=_field_format});r.primaryKey=f;r.fields=n.Fields;$(n.Rows).each(function(){var i=this,t={};s.push(t);$(n.Fields).each(function(n){var r=this,f=i[n];u&&r.DataFormatString&&r.FormatOnClient&&(f=r.format(f));t[r.Name]=f})});this._requiresPivot&&(r.Pivots={},$(n.Pivots).each(function(){r.Pivots[this.Name]=this}));t.success&&t.success(r);e()},i._pendingExecuteComplete={},i._onExecuteComplete=function(n){if(o(),t.success){var i=n?{rowsAffected:n.RowsAffected,canceled:n.Canceled,clientScript:n.ClientScript,navigateUrl:n.NavigateUrl,errors:n.Errors}:{},r=i[t.controller]={};$(t.values).each(function(){var n=this;r[n.name]=typeof n.newValue=="undefined"?typeof n.oldValue=="undefined"?n.value:n.oldValue:n.newValue});n&&$(n.Values).each(function(){r[this.Name]=this.Value});t.success(i)}e()},i._collectFieldValues=function(){var i=[];return $(t.values).each(function(){var t=this,r=n.stringifyDate(typeof t.oldValue=="undefined"?t.value:t.oldValue),u=n.stringifyDate(typeof t.newValue=="undefined"?r:t.newValue);i.push({Name:t.name||t.field,NewValue:u,OldValue:r,Modified:typeof t.modified!="undefined"?t.modified==!0:r!=u,ReadOnly:t.readOnly==!0})}),i},i._validateFieldValues=function(){return!0},t.pageIndex!=null&&(i._pageIndex=t.pageIndex),t.pageSize==null&&(t.pageSize=100),t.sort&&(t.sortExpression=t.sort),i._pageSize=t.pageSize,t.selectedValues&&(i.SelectedValues=t.selectedValues),t.selectedKeys&&(i.multiSelect(!0),i.set_selectedValue(t.selectedKeys.join(";"))),t.lastCommand&&i.set_lastCommandName(t.lastCommand),t.lastCommandArgument&&i.set_lastCommandArgument(t.lastCommandArgument),t._init=!0,i.search(t),t._filter&&(i._filter=t._filter),i._filterDetailsText=t.filterDetails,t.command||(t.command="Select"),t.command=="Pivot"&&(t.command="Select",i._requiresPivot=!0,t.pivotDefinitions))for(f in t.pivotDefinitions)t.pivotDefinitions[f].length>0&&(i._pivotDefinitions+=";"+f+"="+t.pivotDefinitions[f].join());t.requiresRowCount&&(i._requiresRowCount=!0);i._lookupContext=t.lookupContext;t.command=="Select"?i._loadPage():i.executeCommand({commandName:t.command,commandArgument:t.argument||"",causesValidation:!1})};n.find=function(t,i){var e,f,u,r;if(!t)return null;for(e="_"+t,f=Sys.Application.getComponents(),u=0;u<f.length;u++)if(r=f[u],i){if(n.isInstanceOfType(r)&&(i=="Controller"&&r._controller==t||i=="Tag"&&r.get_isTagged(t)))return r}else if(r._id==t||n.isInstanceOfType(r)&&r._id.endsWith(e))return r;return arguments.length==1?$app.find(t,"Controller"):null};n.confirm=function(n,t,i){window.confirm(n)?t&&t():i&&i()};n.alert=function(n,t){window.alert(n);t&&t()};n.eval=function(n){if(n)for(var t=n.match(g);t;)n=n.substring(0,t.index)+eval(t[1])+n.substring(t.index+t[0].length),t=n.match(g);return n};n.showModal=function(t,i,r,u,f,e,o,s,h){var g=n.isInstanceOfType(t),y=t,a=$app.mobile,k,w,l,c,v,tt,d;if(!$app.mobile){if(g&&t._container&&(y=t._container.getElementsByTagName("a")[0]),!y)for(k=document.getElementsByTagName("a","input","button"),w=k.length-1;w>=0;w--)if(k[w].tabIndex>=0){y=k[w];break}if(y==null){alert("Cannot find an anchor for a modal popup.");return}p()}if(a){if(a.busy())return;a.modalDataView()}e||(e=n._baseUrl);o||(o=n._servicePath);for(var b=this._placeholder=document.createElement("div"),it=i.toLowerCase(),nt=it,rt=1;Sys.Application._components[nt];)nt=it+rt++;return b.id=String.format("{0}_{1}_Placeholder{2}",i,r,Sys.Application.getComponents().length),g?t._appendModalPanel(b):document.body.appendChild(b),b.className="ModalPlaceholder FixedDialog EmptyModalDialog",c={id:nt,baseUrl:e,servicePath:o,controller:i,viewId:r,showActionBar:!1,modalAnchor:y,startCommandName:u,startCommandArgument:f,exitModalStateCommands:["Cancel"],externalFilter:s},h&&(h.useCase||(h.useCase=$app._defaultUseCase,$app._defaultUseCase=null),c.filter=h.filter,c.ditto=h.ditto,c.lastViewId=h.lastViewId,c.transaction=h.transaction,c.filterSource=h.filterSource,c.filterFields=h.filterFields,c.confirmContext=h.confirmContext,c.showSearchBar=h.showSearchBar,c.useCase=h.useCase,c.tag=h.tag,c.showActionButtons=h.showActionButtons,l=c.survey=h.survey),v=$create(Web.DataView,c,null,null,b),g&&(tt=t._id,d=t._externalFilter,a&&a.pageInfo(t._id).deleted&&(tt=t._parentDataViewId,d&&d.length&&(v._externalFilter=d)),v._parentDataViewId=tt,v._hasDetails=t._hasDetails),l?(l.description&&(n.touch?l.text=[l.text,l.description]:(v.set_showDescription(!0),v.set_description(l.description))),l.compiled=function(n){a?(l.result=n,a.modalDataView(c.id,!0)):v._onGetPageComplete(n)},n.survey("compile",l)):a&&a.modalDataView(c.id,!0),v};n.alert=function(n,t){alert(n);t&&t()};n.isSaaS=function(){var n=this;return n._isSaaS==null&&(n._isSaaS=!1,$("script").each(function(){this.src.match(/\/factory(.*?)\.js/)&&(n._isSaaS=!0)})),n._isSaaS};n._resizeInterval=null;n._resizing=!1;n._resized=!1;n._customInputElements=[];n.contentFrameworks={bootstrap:{hasSelectors:[{name:"navbar-fixed-top",selector:".navbar-fixed-top"},{name:"navbar-fixed-bottom",selector:".navbar-fixed-bottom"},{name:"navbar-static-top",selector:".navbar-static-top"},{name:"footer",selector:"footer"}],footer:{selector:"footer,.footer",content:{html:'<footer><div class="container"><\/div><\/footer>',selector:".container"}},fixedTop:{selector:".navbar-fixed-top"},fixedBottom:{selector:".navbar-fixed-bottom"}}};n.filterDef=function(n,t){var r,i,u;for(t.endsWith("$")&&(t=t.substring(0,t.length-1)),r=0;r<n.length;r++)if(i=n[r],i)if(i.List){if(u=$app.filterDef(i.List,t),u)return u}else if(i.Function==t)return i;return null};n._invoke=function(n,t,i,r){var f=$("<p>"),u=$create(Web.DataView,{servicePath:__servicePath,baseUrl:__baseUrl,useCase:"$app"},null,null,f.get(0));u._busy(!0);u._invoke(n,t,function(n){u._busy(!1);i&&i(n);u.dispose();f.remove()},null,r)};n.callWithFeedback=function(n,t){$app.mobile?$app.mobile.callWithFeedback(n,t):t()};n.userName=function(){return __settings.appInfo.split("|")[1]};n.loggedIn=function(){return!!$app.userName()};n.login=function(n,t,i,r,u){$app._invoke("Login",{username:n,password:t,createPersistentCookie:i},function(n){n?r&&r():u&&u()})};n.logout=function(n){$app._invoke("Logout",{},function(){n&&n()})};n.roles=function(n){$app._invoke("Roles",{},function(t){n&&n(t)})};n.configureFramework=function(n,t,i){$($app.contentFrameworks[n]).each(function(){var n=this;$(n.hasSelectors).each(function(){t.find(this.selector).length&&t.addClass("has-"+this.name)});n.footer&&!t.find(n.footer.container).find(n.footer.selector).length&&$(n.footer.content.html).appendTo(t).find(n.footer.content.selector).append($("#PageFooterBar,footer small").html());i&&i(n)})};n.borderBox=function(n){var t=$(n);return{horizontal:t.outerWidth()-t.innerWidth(),vertical:t.outerHeight()-t.innerHeight()}};n.paddingBox=function(n){var t=$(n);return{horizontal:t.innerWidth()-t.width(),vertical:t.innerHeight()-t.height()}};n.marginBox=function(n){var t=$(n);return{horizontal:t.outerWidth(!0)-t.outerWidth(),vertical:t.outerHeight(!0)-t.outerHeight()}};n.bounds=function(n){var t=$(n),i=t.offset();return{x:i.left,y:i.top,width:t.outerWidth(),height:t.outerHeight()}};n.scrolling=function(){return{x:h.scrollLeft(),y:h.scrollTop()}};n.clientBounds=function(){return{width:h.width(),height:h.height()}};t._body_hideLayoutContainers=function(){var t,i;if(n._layoutContainers)for(t=0;t<n._layoutContainers.length;t++)i=n._layoutContainers[t],i.width!="100%"&&Sys.UI.DomElement.setVisible($get(i.id),!1)};t._body_resizeLayoutContainers=function(){var r=n._layoutContainers,e,o,h,u,i,t;if(r&&r.length!=0&&(e=$get("PageContent"),e)){var s=$app.bounds(e),y=$app.paddingBox(e),p=$app.borderBox(e),w=$app.marginBox(e);for(s.width-=y.horizontal+p.horizontal+w.horizontal,o=r[r.length-1].rowIndex;o>=r[0].rowIndex;){for(h=0,u=0;u<r.length;u++)if(i=r[u],i.rowIndex==o&&!String.isNullOrEmpty(i.width)&&(t=$get(i.id),t)){var c=$app.paddingBox(t),l=$app.borderBox(t),a=$app.marginBox(t),v=i.width.match(/(\d+)(%|px|)/),f=v[2]!="%"?parseFloat(v[1]):Math.floor(s.width*parseFloat(v[1])/100);h+=f;f-=c.horizontal+l.horizontal+a.horizontal;i.width!="100%"?(t.style.width=f+"px",Sys.UI.DomElement.setVisible(t,!0)):$(t).removeClass("LayoutContainer").addClass("RowContainer")}if(h<s.width)for(u=0;u<r.length;u++)i=r[u],i.rowIndex==o&&String.isNullOrEmpty(i.width)&&(t=$get(i.id),t&&(c=$app.paddingBox(t),l=$app.borderBox(t),a=$app.marginBox(t),f=Math.floor((s.width-h)/i.peersWithoutWidth),f-=c.horizontal+l.horizontal+a.horizontal,f<1&&(f=1),t.style.width=f+"px",Sys.UI.DomElement.setVisible(t,!0)));o--}}};t._body_keydown=function(t){var i,r;if(t.keyCode==Sys.UI.Key.enter&&n._focusedItemIndex!=null){if(i=$find(n._focusedDataViewId),i&&i._get_focusedCell())return;r=$get(n._focusedDataViewId+"_Item"+n._focusedItemIndex);r&&r.tagName=="INPUT"&&r.type=="text"&&r==t.target&&(t.preventDefault(),t.stopPropagation(),i=$find(n._focusedDataViewId),i&&i._valueChanged(n._focusedItemIndex))}};t._body_resize=function(){$getSideBar()&&$("body,.MembershipBarPlaceholder").width("");n._resizeInterval&&clearInterval(n._resizeInterval);n._resizing||n._resized?$closeHovers():n._resizeInterval=setInterval(function(){_body_hideLayoutContainers();_body_resizeLayoutContainers();_body_performResize()},200);n._resized=!1};t._body_scroll=function(){var t=$getSideBar(),f,i,e;if(t){var r=$app.scrolling(),o=$common.getClientBounds(),u=$common.getBounds(t);t._originalTop==null&&(t._originalTop=u.y);f=t._originalTop;i=0;n.MessageBar&&(e=$common.getBounds(n.MessageBar._element),f+=i=e.height);r.y>t._originalTop&&u.height+4<=o.height&&r.x==0?(t.style.width=u.width+"px",Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<=6?(t.style.top=4+r.y+i+"px",t.style.position="absolute"):(t.style.top=4+i+"px",t.style.position="fixed")):(t.style.top="",t.style.width="",t.style.position="");$("body,.MembershipBarPlaceholder").width($("table#PageBody").outerWidth())}};t._body_createPageContext=function(t){var i=$get("PageContent");if(i){var u=$common.getBounds(i),f=$common.getPaddingBox(i),e=$common.getBorderBox(i),r={height:u.height-f.vertical-e.vertical,scrolling:$app.scrolling()};return t!=!1&&(n._pageContext=r),r}};t._body_performResize=function(){var t,f,a,i,e,u,v,o,s,h,r,c;if(n._resizeInterval&&clearInterval(n._resizeInterval),n._resizeInterval=null,$closeHovers(),t=$get("PageContent"),t&&!$app.mobile){if(f=$common.getClientBounds(),a=$common.getClientBounds(),n.MessageBar&&(i=n.MessageBar._element,$common.getVisible(i)&&(e=$common.getPaddingBox(i),i.style.width=a.width-e.horizontal+"px",u=i.childNodes[0],u.style.height="",v=$common.getBounds(u),o=Math.ceil(f.height*.15),v.height>o&&(u.style.height=o+"px",u.style.overflow="auto"),e=Sys.UI.DomElement.getBounds(i),s=n.OriginalBodyTopOffset+e.height,document.body.style.paddingTop=s+"px",h=$get("Membership_Login"),h&&(h.style.marginTop=s+"px"))),n._resizing=!0,r=n._pageContext,r==null?r=_body_createPageContext(!1):n._pageContext=null,c=$app.scrolling(),c.y==0&&(t.style.height="10px"),_body_resizeLayoutContainers(),typeof __cothost=="undefined"){var y=$app.bounds(t),p=$app.paddingBox(t),w=$app.borderBox(t),b=Web.Menu.MainMenuElemId?$get(Web.Menu.MainMenuElemId):null,k=b?$common.getBorderBox(b):null,d=$get("PageFooterContent"),g=$get("PageFooterBar"),l=c.y+f.height-y.y-(g?g.offsetHeight:0)-(d?d.offsetHeight:0)-w.vertical-p.vertical-(k?k.vertical:0);y.height<l&&Sys.Browser.agent==Sys.Browser.Opera&&(l+=w.vertical+p.vertical);r.scrolling.y==0||n._numberOfContainers<2?t.style.height=document.body.offsetHeight>f.height?"":l+"px":(t.style.height=r.height+"px",scrollTo(0,r.scrolling.y))}_body_scroll();n._resizing=!1;n._resized=!0}};n._activate=function(n,t,i){var a=new RegExp("^\\s*"+i+"\\s*\\|"),r=$get(t),f,e,u,s,o,h;if(i=="SideBarTask"){for(f=r;f&&String.isNullOrEmpty(this.prototype.dataAttr(f,"flow"));)f=f.parentNode;for(e=f.getElementsByTagName("div"),u=0;u<e.length;u++)s=this.prototype.dataAttr(e[u],"activator"),!String.isNullOrEmpty(s)&&a.exec(s)&&$(e[u]).hide()}if(Sys.UI.DomElement.setVisible(r,i=="SideBarTask"?!0:!Sys.UI.DomElement.getVisible(r)),r._activated=!0,i=="SiteAction"&&r.childNodes[0].className!="CloseSiteAction"&&(o=document.createElement("div"),o.className="CloseSiteAction",o.innerHTML=String.format("<a href=\"javascript:\" onclick=\"$app._activate(null,'{0}','SiteAction')\">{1}<\/a>",t,Web.DataViewResources.ModalPopup.Close),r.insertBefore(o,r.childNodes[0])),Sys.UI.DomElement.getVisible(r)){var c=$common.getBounds(r),v=$common.getClientBounds(),l=$app.scrolling();(c.y<l.y||c.y>l.y+v.height)&&r.scrollIntoView(!1)}if(n){while(n&&!Sys.UI.DomElement.containsCssClass(n,"Task"))n=n.parentNode;for(u=0;u<n.parentNode.childNodes.length;u++)h=n.parentNode.childNodes[u],h.className&&Sys.UI.DomElement.removeCssClass(h,"Selected");Sys.UI.DomElement.addCssClass(n,"Selected")}_body_performResize()};n._partialUpdateBeginRequest=function(t,i){for(var r,o,c,s=i.get_request(),h=Sys.Application.getComponents(),u=[],f=0;f<h.length;f++)r=h[f],r._controller&&r._viewId&&n.isInstanceOfType(r)&&(o=r.get_tag(),String.isNullOrEmpty(o)||(Array.add(u,o),Array.add(u,r.get_selectedKey())));c=e.serialize(u);s.set_body(s.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(c))};n._contentFactories={"site-map":function(n){var r=n.attr("data-start-from-current-node")=="true",t=Web.Menu,i=t.Nodes[t.MainMenuId],u=rt(i),f=$('<ul class="SiteMapPlaceholder"/>').appendTo(n);ut(f,r?u.children:i)}};n._load=function(){var c,i,f,ut,o,r,h,ft,t,w,b,l,k,a,et,d,v,ot,y,st,ht;if(!n._loaded){Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(n._partialUpdateBeginRequest);n._loaded=!0;updateACT();typeof __baseUrl=="undefined"&&(__baseUrl="../");$("#PageHeaderSideBar .PageLogo").attr("src",__baseUrl+"app_themes/_shared/placeholder.gif");n.supportsPlaceholder="placeholder"in document.createElement("input");var p=$get("PageContent"),ct,lt=[],at=$("body");if(p){for(at.find('div[data-app-role="page"]').each(function(){$(this).attr("data-content-framework")&&lt.push($(this).attr("id"))}).each(function(){var n=$(this),f=n.attr("id"),r=location.search.match(/_hash=(\w+)/),u=n.attr("data-content-framework"),t=n.find('> div[data-role="content"]'),i;if(t.length||(t=$('<div data-role="content"><\/div>'),n.contents().appendTo(t),t.appendTo(n)),u&&!ct&&(!r||r[1]==f)){i=$(p).closest("table");n.insertAfter(i);at.addClass("app-sidebar-undocked").addClass("app-theme-"+__settings.theme.toLowerCase());ct=!0;t=n.find('> div[data-role="content"]').addClass("app-bootstrap app-content-desktop");$app.configureFramework(u,t);n.css({position:"absolute",top:i.offset().top,width:"100%"});i.hide();n.find("a").each(function(){var i=$(this),n=i.attr("href"),t=n&&n.startsWith("#")&&n.length>1&&n.substring(1);t&&Array.indexOf(lt,t)!=-1&&i.attr("href","?_hash="+t)});$("#PageFooterBar").hide();return}n.remove()}),$(p).find('div[data-role="placeholder"]').each(function(){var n=$(this),t=$app._contentFactories[n.attr("data-placeholder")];t&&t(n)}),c=document.body.getElementsByTagName("div"),i=0;i<c.length;i++)if(c[i].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(c[i],"Loading");break}c=p.getElementsByTagName("div");var e=[],g=0,vt=!1,nt=!1,s=null,tt=[];for(n._numberOfContainers=0,f=n.prototype.dataAttr,i=0;i<c.length;i++){var u=c[i],it=f(u,"width"),rt=f(u,"flow");if(!String.isNullOrEmpty(it)||!String.isNullOrEmpty(rt)){if($(u).find("div[data-flow]").length)continue;for(rt!="NewColumn"&&rt!="column"&&(u.style.clear="left",g++),String.isNullOrEmpty(u.id)&&(u.id="_lc"+e.length),Sys.UI.DomElement.addCssClass(u,"LayoutContainer"),n._numberOfContainers++,it!="100%"&&(u.style.overflow="hidden"),Array.add(e,{id:u.id,width:it,rowIndex:g,peersWithoutWidth:0}),ut=u.getElementsByTagName("div"),o=[],r=0;r<ut.length;r++)h=ut[r],ft=f(h,"activator"),String.isNullOrEmpty(ft)||String.isBlank(h.innerHTML)||(h.id=String.isNullOrEmpty(h.id)?u.id+"$a"+r:h.id,t={elem:h,activator:n.eval(ft).split("|"),id:h.id},t.activator[0]=t.activator[0].trim(),t.activator.length==1&&(t.activator[1]=r.toString()),Array.add(o,t));for(r=1;r<o.length;){for(t=o[r],w=0;w<r;w++)if(b=o[w],b.activator[0]==t.activator[0]&b.activator[1]==t.activator[1]){while(t.elem.childNodes.length>0)b.elem.appendChild(t.elem.childNodes[0]);delete t.elem;Array.removeAt(o,r);t=null;break}t&&r++}if(o.length>0){for(vt=!0,l=[],k=!0,r=0;r<o.length;r++)t=o[r],t.activator[0]=="Tab"?(l.length==0&&(a=document.createElement("div"),a.className="TabBar",u.insertBefore(a,t.elem)),et={title:t.activator[1],elementId:t.id,selected:l.length==0,description:f(t.elem,"description"),hidden:f(t.elem,"hidden")},Array.add(l,et),Sys.UI.DomElement.setVisible(t.elem,et.selected),t.elem._activated=!0,Sys.UI.DomElement.addCssClass(t.elem,"TabBody TabContainer")):t.activator[0]=="SideBarTask"?(s||(s=new Sys.StringBuilder,s.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}<\/div>',Web.DataViewResources.Menu.Tasks)),t.elem._activated=k,k&&(k=!1),Sys.UI.DomElement.setVisible(t.elem,t.elem._activated),s.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"$app._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}<\/a><\/div>",t.activator[1],nt?"":" Selected",t.id,n.htmlAttributeEncode(f(t.elem,"description")),f(t.elem,"hidden")=="true"?' style="display:none"':""),nt=!0):t.activator[0]=="SiteAction"&&Web.Menu.get_siteActionsFamily()?(d=new Web.Item(Web.Menu.get_siteActionsFamily(),t.activator[1],f(t.elem,"description")),d.set_cssClass(f(t.elem,"cssClass")),d.set_script('$app._activate(null,"{0}","SiteAction")',t.id),Array.add(tt,d),Sys.UI.DomElement.setVisible(t.elem,!1)):Sys.UI.DomElement.setVisible(t.elem,!1),t.elem=null;l.length>0&&($create(Web.Menu,{id:u.id+"$ActivatorMenu",nodes:l},null,null,a),l.length<2&&i==0&&Sys.UI.DomElement.addCssClass(a,"EmptyTabBar"))}}}for(vt&&n._performDelayedLoading(),nt&&s&&(v=$getSideBar(),v&&(s.append("<\/div><\/div>"),ot=document.createElement("div"),ot.innerHTML=s.toString(),s.clear(),v.insertBefore(ot,v.childNodes[0]),v._hasActivators=!0)),tt.length>0&&Web.Menu.set_siteActions(tt),y=g;e.length>0&&y>=e[0].rowIndex;){for(st=0,ht=0,i=0;i<e.length;i++)lc=e[i],lc.rowIndex==y&&(ht++,String.isNullOrEmpty(lc.width)&&st++);for(i=0;i<e.length;i++)lc=e[i],lc.rowIndex==y&&(lc.peersWithoutWidth=st,ht==1&&String.isNullOrEmpty(lc.width)&&(lc.width="100%"));y--}n._layoutContainers=e;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}n._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)}};n._unload=function(){this._state&&(Array.clear(this._state),delete this._state);n._delayedLoadingTimer&&(clearInterval(n._delayedLoadingTimer),Array.clear(n._delayedLoadingViews),delete n._delayedLoadingViews);$get("PageContent")&&($removeHandler(window,"resize",_body_resize),$removeHandler(window,"scroll",_body_scroll));$removeHandler(document.body,"keydown",_body_keydown)};n._startDelayedLoading=function(){n._delayedLoadingViews.length>0&&!n._delayedLoadingTimer&&(n._delayedLoadingTimer=setInterval(function(){n._performDelayedLoading()},1e3))};n._updateBatchSelectStatus=function(n,t){for(var r=t?"Item":"Cell",i=n.parentNode;i!=null&&!Sys.UI.DomElement.containsCssClass(i,r);)i=i.parentNode;i&&(n.checked?Sys.UI.DomElement.addCssClass(i,"BatchEditFrame"):Sys.UI.DomElement.removeCssClass(i,"BatchEditFrame"))};n.highlightFilterValues=function(n,t,i){while(n&&n.tagName!="TABLE")n=n.parentNode;n&&(t&&!n.className.match(i)?Sys.UI.DomElement.addCssClass(n,i):!t&&n.className.match(i)&&Sys.UI.DomElement.removeCssClass(n,i))};n.get_commandLine=function(){var t=n._commandLine;return t||(typeof __dacl!="undefined"&&(t=__dacl),t||(t=typeof Web.Membership!="undefined"?Web.Membership._instance.get_commandLine():null,t=t?location.pathname+"?"+t:location.href),n._commandLine=$app.unanchor(t)),t};n._parse=function(){this._parsed||(this._parsed=!0,$("div[data-controller]").each(function(){var n=$(this),i=n.attr("data-controller"),t,r,u;i&&(t=n.attr("id"),t||(t=i),r={id:t,controller:i,baseUrl:__baseUrl,servicePath:__servicePath,showSearchBar:!0},u=[{name:"autoHide",aliases:["nothing","self","container"],values:[0,1,2]},{name:"autoSelectFirstRow",type:"bool"},{name:"autoHighlightFirstRow",type:"bool"},{name:"filterSource"},{name:"filterFields"},{name:"pageSize",type:"int"},{name:"refreshInterval",type:"int"},{name:"searchByFirstLetter",type:"bool",propName:"showFirstLetters"},{name:"searchOnStart",type:"bool"},{name:"selectionMode",aliases:["single","multiple"],values:["Single","Multiple"]},{name:"showActionBar",type:"bool"},{name:"showActionButtons",aliases:["","none","top","bottom","top-and-bottom"],values:["Auto","None","Top","Bottom","TopAndBottom"]},{name:"showDetailsInListMode",type:"bool"},{name:"showDescription",type:"bool"},{name:"showInSummary",type:"bool"},{name:"showModalForms",type:"bool"},{name:"showQuickFind",type:"bool"},{name:"showPageSize",type:"bool"},{name:"showPager",aliases:["none","top","bottom","top-and-bottom"],values:["None","Top","Bottom","TopAndBottom"]},{name:"showRowNumber",type:"bool"},{name:"showSearchBar",type:"bool"},{name:"showViewSelector",type:"bool"},{name:"startCommandName"},{name:"startCommandArgument"},{name:"summaryFieldCount",type:"int"},{name:"tag"},{name:"tags"},{name:"view",propName:"viewId"},{name:"visibleWhen"}],$(u).each(function(){var t=this,i=n.attr("data-"+t.name.replace(/([A-Z])/g,"-$1"));i&&(t.aliases&&(i=t.values[Array.indexOf(t.aliases,i.toString().toLowerCase())]),t.type=="bool"&&(i=i=="true"),t.type=="int"&&(i=s(i)),r[t.propName||t.name]=i)}),n.attr("id",null),$create(Web.DataView,r,null,null,this))}))};n.DetailsRegex=/\/Details\.aspx\?/i;n.LocationRegex=/^(_.+?):(.+)$/;n.LEVs=[];n.Editors=[];n.EditorFactories={};l=Sys.CultureInfo.CurrentCulture.dateTimeFormat;n.dateFormatStrings={"{0:g}":l.ShortDatePattern+" "+l.ShortTimePattern,"{0:G}":l.ShortDatePattern+" "+l.LongTimePattern,"{0:f}":l.LongDatePattern+" "+l.ShortTimePattern,"{0:u}":l.SortableDateTimePattern,"{0:U}":l.UniversalSortableDateTimePattern};Sys.Application.add_load(function(){n._parse()});$.mobile||(Sys.Application.add_load(n._load),Sys.Application.add_unload(n._unload));t.$createDataView=function(n,t,i){var u={id:t+"Extender",controller:t,baseUrl:"./",servicePath:"Services/DataControllerService.asmx"},r;if(i)for(r=0;r<i.length;r++)u[i[r].name]=i[r].value;$create(Web.DataView,u,null,null,$get(n))};t.updateACT=function(){Sys.Extended&&typeof AjaxControlToolkit=="undefined"&&(AjaxControlToolkit=Sys.Extended.UI);Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);Sys.Browser.WebKit={};navigator.userAgent.indexOf("WebKit/")>-1&&(Sys.Browser.agent=Sys.Browser.WebKit,Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]),Sys.Browser.name="WebKit");Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.agent==Sys.Browser.Firefox||Sys.Browser.agent==Sys.Browser.Opera||Sys.Extended||($common.old_getBounds=$common.getBounds,$common.getBounds=function(n){var i=$common.old_getBounds(n),t=$app.scrolling();return(t.y||t.x)&&(i.x+=t.x,i.y+=t.y),i});AjaxControlToolkit.CalendarBehavior&&!AjaxControlToolkit.CalendarBehavior.prototype.old_show&&(AjaxControlToolkit.CalendarBehavior.prototype.old_show=AjaxControlToolkit.CalendarBehavior.prototype.show,AjaxControlToolkit.CalendarBehavior.prototype.show=function(){function i(){r.position({my:"left "+(t?"bottom":"top"),at:"left "+(t?"top":"bottom"),of:n})}this.old_show();var r=$(this._container).zIndex(100100),n=$(this._element),t=n.parent().find(".Error:visible").length||n.closest("div.Item").find(".Error:visible").length;i();setTimeout(i,10)},AjaxControlToolkit.CalendarBehavior.prototype.old_raiseDateSelectionChanged=AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged,AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()});AjaxControlToolkit.TabContainer&&!AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex&&(AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex=AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex,AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex=function(n){var t=this.get_activeTabIndex();this._headerAssigned||(this._headerAssigned=!0,Sys.UI.DomElement.addCssClass(this._element.getElementsByTagName("div")[0],"tab-header"));this.old_set_activeTabIndex(n);n!=t&&_body_performResize()});AjaxControlToolkit.AutoCompleteBehavior&&!AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose&&(AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose=AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose,AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose=function(){this.old_dispose();this._completionListElement&&(this._completionListElement.parentNode.removeChild(this._completionListElement),delete this._completionListElement)},AjaxControlToolkit.AutoCompleteBehavior.prototype.old__handleFlyoutFocus=AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus,AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus=function(){this._completionListElement&&this.old__handleFlyoutFocus()},AjaxControlToolkit.AutoCompleteBehavior.prototype.old_showPopup=AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup,AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup=function(){var u,i,n,r,f,e;if(this.old_showPopup(),Sys.UI.DomElement.getVisible(this._completionListElement)){if(u=$app.scrolling(),this._completionListElement.style.height="",Sys.UI.DomElement.addCssClass(this._completionListElement,"CompletionList"),this._completionListElement.style.width="",this._completionListElement.style.zIndex=200100,i=$common.getClientBounds(),n=$common.getBounds(this._completionListElement),n.width>i.width/3&&(n.width=i.width/3),r=this._element,Sys.UI.DomElement.containsCssClass(r.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(r.parentNode,"AutoCompleteFrame"))r=r.parentNode;var t=$common.getBounds(r),o=$common.getBorderBox(this._completionListElement),s=$common.getPaddingBox(this._completionListElement);n.width<=t.width&&(this._completionListElement.style.width=t.width-o.horizontal-s.horizontal+"px");n=$common.getBounds(this._completionListElement);n.x!=t.x&&(n.x=t.x,this._completionListElement.style.left=n.x+"px");n.y!=t.y&&(n.y=t.y+t.height-1,this._completionListElement.style.top=n.y+"px");n.x+n.width>i.width&&(this._completionListElement.style.left=i.width-n.width+"px");bound=$common.getBounds(this._completionListElement);f=t.y-u.y;e=i.height-(t.y+t.height-u.y);bound.height<=e||e>=f?n.y+n.height-u.y>i.height&&(this._completionListElement.style.height=i.height-(n.y-u.y)-4+"px",this._completionListElement.style.overflow="auto"):f<n.height?(this._completionListElement.style.top=t.y-f+"px",this._completionListElement.style.height=f+"px",this._completionListElement.style.overflow="auto"):this._completionListElement.style.top=t.y-n.height+3+"px"}},AjaxControlToolkit.ModalPopupBehavior&&!AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup&&(AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup=AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup,AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup=function(){this.old__attachPopup();this._dropShadowBehavior&&(this._dropShadowBehavior.set_Width(4),(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&this._dropShadowBehavior.set_Rounded(!0))}))};t.$hoverTab=function(n,t){while(n&&n.tagName!="TD")n=n.parentNode;n&&(t?(Sys.UI.DomElement.addCssClass(n,"Active"),n.focus()):Sys.UI.DomElement.removeCssClass(n,"Active"))};t.$getSideBar=function(){var t=$get("PageContentSideBar"),n,i;if(!t)return null;for(n=0;n<t.childNodes.length;n++)if(i=t.childNodes[n],i.className=="SideBarBody")return i;return null};t.$dvget=function(t,i,r,u){for(var e,s,h,c=Sys.Application.getComponents(),l="_"+t,o=null,f=0;f<c.length;f++)if(e=c[f],e._id==t||n.isInstanceOfType(e)&&(e._id.endsWith(l)||e._controller==t&&(!i||e.get_viewId()==i))){o=e;break}if(o){if(r){if(s=o.findField(r),s){if(u){if(element=$get(o._id+"_ItemContainer"+s.Index),element)for(f=0;f<element.childNodes.length;f++)if(h=element.childNodes[f],h.className=="Value")return h}else return $get(o._id+"_Item"+s.Index);return element}return null}return o}return null};Sys.UI.DomElement.setFocus=function(n){var t=document.selection;t&&t.type!="Text"&&t.type!="None"&&t.clear();n&&(n.focus(),n.select&&n.select(),document.focus&&document.focus())};Sys.UI.DomElement.getCaretPosition=function(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart),t};Sys.UI.DomElement.setCaretPosition=function(n,t){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};t._field_prepareDataFormatString=function(t,i){if(i.DataFormatString&&i.DataFormatString.indexOf("{")==-1&&(i.DataFormatString="{0:"+i.DataFormatString+"}"),i.DataFormatString&&(i.DataFormatString=t.resolveClientUrl(i.DataFormatString)),i.Type.startsWith("DateTime"))if(i.DataFormatString){var f=i.DataFormatString.match(/{0:(g)}/i),r,u;f&&(r=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i.DateFmtStr="{0:"+r.ShortDatePattern+"}",i.TimeFmtStr="{0:"+(f[1]=="g"?r.ShortTimePattern:r.LongTimePattern)+"}");u=n.dateFormatStrings[i.DataFormatString];u&&(i.DataFormatString="{0:"+u+"}");i.DateFmtStr&&(i.DataFmtStr=i.DataFormatString)}else i.DataFormatString="{0:d}"};t._field_format=function(n){try{return n!=null&&this.Type=="TimeSpan"&&this.DataFormatString&&this.FormatOnClient&&typeof n=="string"&&(n=Date.tryParseFuzzyTime(n,!1)),n==null?"null":this.FormatOnClient&&!String.isNullOrEmpty(this.DataFormatString)?String.localeFormat(this.DataFormatString,n):n.toString()}catch(t){throw new Error(String.format("\nField: {0}\nData Format String: {1}\n{2}",this.Name,this.DataFormatString,t.message));}};t._field_isReadOnly=function(){return this.TextMode==4||this.ReadOnly};t._field_isNumber=function(){return Array.indexOf(["SByte","Byte","Int16","Int32","UInt32","Int64","Single","Double","Decimal","Currency"],this.Type)};t._field_htmlEncode=function(){return this.HtmlEncode&&this.TextMode!=2};t._field_trim=function(n){var t=this,i=Web.DataViewResources.Data;return t.Type=="String"&&n!=null&&n.length>i.MaxReadOnlyStringLen&&!(t.TextMode==3||t.TextMode==2)&&(n=n.substring(0,i.MaxReadOnlyStringLen)+"..."),n};t._field_text=function(t,i){var r=this,u,o,f=Web.DataViewResources.Data.NullValueInForms,s=r.DynamicItems||r.Items,e;return s.length==0?u=String.isBlank(t)?f:r.Type!="Byte[]"||r.OnDemand?r.format(t):$app.toHexString(t):r.ItemsDataController?(u=[],t&&typeof t!="string"&&(t=t.toString()),r.ItemsTargetController||r.ItemsStyle=="CheckBoxList"?(o=(t||"").split(n._simpleListRegex),$(s).each(function(){var n=this;o.indexOf((n[0]||"").toString())!=-1&&u.push(n[1])})):$((t||"").split(",")).each(function(){var n=r._dataView._findItemByValue(r,this);n&&u.push(n[1])}),u=u.length==0?f:u.join(", ")):t==null?u=f:(e=r._dataView._findItemByValue(r,t),u=e[0]==t?e[1]:t),r.TextMode==1&&(u="**********"),i!=!1&&(u=r.trim(u)),u};Array.indexOfCaseInsensitive=function(n,t){t=t.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==t)return i;return-1};Number.tryParse=function(n){var t,i,r;return typeof n!="string"?null:String.isNullOrEmpty(n)?null:(t=Number.parseLocale(n),isNaN(t)&&(i=Sys.CultureInfo.CurrentCulture.numberFormat,i._simplifyRegex||(i._simplifyRegex=new RegExp(String.format("({0}|\\{1})",i.CurrencySymbol.replace(/(\W)/g,"\\$1"),i.CurrencyGroupSeparator),"gi")),r=n.match(/\(/)!=null,n=n.replace(i._simplifyRegex,"").replace(/\(|\)/g,""),n=n.replace(i.CurrencyDecimalSeparator,i.NumberDecimalSeparator),t=Number.parseLocale(n),isNaN(t)&&(t=Number.parseLocale(n.replace(i.PercentSymbol,"")),isNaN(t)||(t/=100))),!isNaN(t))?(r&&(t*=-1),t):null};Date.tryParseFuzzyDate=function(n,t){var r,i,v,u,f,s,o,h,c,l,e,a;if(String.isNullOrEmpty(n))return null;if(r=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i=Date.parseLocale(n,r.ShortDatePattern),i==null&&(i=Date.parseLocale(n,r.LongDatePattern)),i!=null||String.isNullOrEmpty(t)||(v=t.match(/\{0:([\s\S]*?)\}/),v&&(i=Date.parseLocale(n,v[1]))),i)return i;if(i=new Date,u=n.match(/^\s*(\w+)\s*$/),u&&(f=Array.indexOfCaseInsensitive(r.DayNames,u[1]),f==-1&&(f=Array.indexOfCaseInsensitive(r.AbbreviatedDayNames,u[1])),f==-1&&(f=Array.indexOfCaseInsensitive(r.ShortestDayNames,u[1])),f>=0)){while(i.getDay()!=f)i.setDate(i.getDate()+1);return i}if(u=n.match(/^\s*(\w+|\d+)[^\w\d]*(\w+|\d+)\s*$/),u&&(s=u[1],o=u[2],s.match(/\d+/)&&(s=o,o=u[1]),u=o.match(/\d+/),o=u?u[0]:1,f=Array.indexOfCaseInsensitive(r.MonthNames,s),f==-1&&(f=Array.indexOfCaseInsensitive(r.AbbreviatedMonthNames,s)),f>=0)){for(i.setDate(1);i.getMonth()!=f;)i.setMonth(i.getMonth()+1);return i.setDate(o),i}if(u=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d+))?\s*$/),!u)return null;try{r.LogicalYearPosition||(h=r.ShortDatePattern.indexOf("m"),h<0&&(h=r.ShortDatePattern.indexOf("M")),c=r.ShortDatePattern.indexOf("d"),c<0&&(c=r.ShortDatePattern.indexOf("D")),r.LogicalYearPosition=5,r.LogicalMonthPosition=h<c?1:3,r.LogicalDayPosition=h<c?3:1);l=u[r.LogicalYearPosition];l=String.isNullOrEmpty(l)?i.getFullYear():Number.parseLocale(l);e=u[r.LogicalMonthPosition];String.isNullOrEmpty(e)?e=i.getMonth():(e=Number.parseLocale(e),e--);a=u[r.LogicalDayPosition];a=String.isNullOrEmpty(a)?i.getDay():Number.parseLocale(a);i=new Date(l,e,a)}catch(y){return null}return i};Date.tryParseFuzzyTime=function(n,t){if(String.isNullOrEmpty(n))return null;var u=null,f=Sys.CultureInfo.CurrentCulture.dateTimeFormat,i=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\s*(\w+))?\s*$/);if(i||(i=n.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d\d?))?(\D*(\d+))?(\s*([\S\s]+))?\s*$/)),i){u=new Date;var r=i[1],e=i[3],o=i.length==10?i[5]:"",s=i.length==10?i[7]:"",h=i[i.length-1];String.isNullOrEmpty(r)||(r=Number.parseLocale(r),String.isNullOrEmpty(h)?t!=!1&&!String.isNullOrEmpty(f.PMDesignator)&&f.ShortTimePattern.indexOf("tt")>0&&(new Date).getHours()>=12&&(r+=12):h.toLowerCase()==f.PMDesignator.toLowerCase()?r!=12&&(r+=12):r==12&&(r=0),u.setHours(r));String.isNullOrEmpty(e)||u.setMinutes(Number.parseLocale(e));u.setSeconds(String.isNullOrEmpty(o)?0:Number.parseLocale(o));u.setMilliseconds(String.isNullOrEmpty(s)?0:Number.parseLocale(s))}return u};Date._jsonRegex=new RegExp(/(\d{4})\-(\d{2})\-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})\.(\d{3})(Z)?/);Date.fromUTCString=function(n){var t=Date._jsonRegex.exec(n),i;return t&&(i=new Date(s(t[1]),s(t[2])-1,s(t[3]),s(t[4]),s(t[5]),s(t[6]),s(t[7]))),i};e.deserialize=function(n){var t;try{return t=n.replace(/\"(\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d{3})Z?\"/g,'Date.fromUTCString("$1")'),eval("("+t+")")}catch(i){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson);}};Date.$addDays=function(n,t){return n?new Date(n.setDate(n.getDate()+t)):n};Date.$now=function(){return new Date};Date.$today=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0)};Date.$endOfDay=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59)};Date.$within=function(n,t){return n?n<Date.$addDays(Date.$today(),t)&&n>=Date.$today():!1};Date.$pastDue=function(n,t){return t==null&&(t=new Date),t.getHours()==0&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)),n==null&&(n=new Date),n>t};t.__designer=function(){return typeof __designerMode!="undefined"};t.__evalEvent=function(n){var t=this.getAttribute("on"+n+"2"),i;return String.isNullOrEmpty(t)?!0:(i=!0,t=t.replace(/(^|;)return /g,";returnResult="),eval(t),i)};r.BusinessRules=function(n){this._dataView=n;this.result=new Web.BusinessRules.Result(this)};r.BusinessRules.prototype={canceled:function(){return this._canceled==!0},dispose:function(){this.reset(null);this._dataView=null;this.result._rules=null},reset:function(n){this._actionArgs=null;this._args=n},_initialize:function(){if(!this._actionArgs){var n=this._dataView;this._actionArgs=n._createArguments(this._args,null);n.editing()&&(n._validateFieldValues(this._actionArgs.Values,this._args.causesValidation,!1,!0),this._valid=n.validate(this._actionArgs.Values))}},process:function(t){var i=this,o=i._dataView,s=i._args.commandName,h,a,w,u,e,c,d,v,r,b,y,f,l,k,p;if(s=="Calculate"&&o._lookupIsActive){i.preventDefault();return}if(h=n.Geo,h&&h.acquired&&!(__tf!=4)&&(s.match(/New|Edit/)||s.match(/Update|Insert/)&&t=="Before")){for(w=this._dataView._fields,u=0;u<w.length;u++)e=w[u],e.readOnly||(e.tagged("modified-latitude")||e.tagged("created-latitude")&&s.match(/New|Insert/)?i.updateFieldValue(e.Name,h.latitude==-1?null:h.latitude):e.tagged("modified-longitude")||e.tagged("created-longitude")&&s.match(/New|Insert/)?i.updateFieldValue(e.Name,h.longitude==-1?null:h.longitude):(e.tagged("modified-coords")||e.tagged("created-coords")&&s.match(/New|Insert/))&&i.updateFieldValue(e.Name,h.latitude==-1?null:String.format("{0},{1}",h.latitude,h.longitude)));a=i._newValues;a&&($app.mobile?$app.input.execute({dataView:o,values:a}):o._updateCalculatedFields({Errors:[],Values:a}));i._newValues=null}if(c=o._expressions,c&&c.length!=0){if(!i._rules)for(i._rules=[],d=0,u=0;u<c.length;u++)if(v=c[u],v.Type==Web.DynamicExpressionType.ClientScript&&v.Scope==Web.DynamicExpressionScope.Rule&&(r=v.Result.match(/^<id>(.+?)<\/id><commandName>(.+?)<\/commandName><commandArgument>(.*?)<\/commandArgument><view>(.*?)<\/view><phase>(.*?)<\/phase><script>([\s\S]+?)<\/script>$/),r)){if(b=String.format("Web.BusinessRules.{0}_Rule_{1}",o._controller,r[1]?r[1]:d),y=eval(String.format('typeof {0} !="undefined"?{0}:null',b)),!y)try{y=eval(i._parseRule(b,r[6]))}catch(g){$app.alert(String.format('{0}\n\ncommand: "{1}"\nargument: "{1}"\nview: "{3}"\nphase: "{4}"\n\n{5}',g.message,r[2],r[3]||"n/a",r[4]||"n/a",r[5],(r[6]||"").trim()))}Array.add(i._rules,{commandName:r[2],commandArgument:r[3],view:r[4],phase:r[5],script:y})}for(u=0;u<i._rules.length;u++)if((f=i._rules[u],f.phase==t)&&(l=!1,String.isNullOrEmpty(f.view)||(k=o.get_viewId(),f.view==k||k.match(new RegExp(f.view))||(l=!0)),String.isNullOrEmpty(f.commandName)||(s=i._args.commandName,f.commandName==s||s.match(new RegExp(f.commandName))||(l=!0)),String.isNullOrEmpty(f.commandArgument)||(p=i._args.commandArgument,f.commandArgument==p||p&&p.match(new RegExp(f.commandArgument))||(l=!0)),!l)){if(i._args.causesValidation&&(i._initialize(),!i._valid)){i.preventDefault();break}if(f.script.call(i),i.canceled())break}i._newValues?($app.mobile?$app.input.execute({dataView:o,values:i._newValues,raiseCalculate:s!="Calculate"}):o._updateCalculatedFields({Errors:[],Values:i._newValues}),i._newValues=null,i._pendingFocus()):i.canceled()&&o.get_isDataSheet()&&(o._updateCalculatedFields({Errors:[],Values:[]}),i._pendingFocus())}},_pendingFocus:function(){this._focusFieldName&&(this._dataView._focus(this._focusFieldName,this._focusMessage),this._focusFieldName=null)},before:function(n){this.reset(n);this.process("Before");this.canceled()||this.process("Execute")},after:function(n){this._dataView._isBusy||(this.reset(n),this.process("After"))},_parseRule:function(n,t){var i,r;return t=ft(t),i=new Sys.StringBuilder,i.appendFormat("{0}=function(){{\n",n),r=/([\s\S]*?)(\[(\w+)(\.(\w+))?\](\s*=([^=][\s\S]+?);)?)/g,this._parseScript(i,r,t),t=i.toString(),i.clear(),this._parseScript(i,r,t),i.append("\n}"),i.toString()},_parseScript:function(n,t,i){for(var f=-1,r,u,e,o;r=t.exec(i);)n.append(r[1]),u=r[3],e=r[5],r[1].match(/\w$/)?n.append(r[2]):u.match(/^master$/i)?n.appendFormat("this.fieldValue('{0}','Master')",e):(o=this._dataView.findField(u),String.isNullOrEmpty(r[7])?n.appendFormat("this.fieldValue('{0}','{1}')",u,e):n.appendFormat("this.updateFieldValue('{0}',{1})",u,r[7])),f=t.lastIndex;f!=-1?n.append(f<i.length?i.substr(f):""):n.append(i)},preventDefault:function(){this._canceled=!0;this._dataView._raiseSelectedDelayed=!1;this._dataView._pendingSelectedEvent=!1},validateInput:function(){return this._initialize(),this._valid==!0},dataView:function(){return this._dataView},busy:function(){return this._dataView._busy()},arguments:function(){return this._initialize(),this._actionArgs},selectFieldValueObject:function(n){var i,t,r;for(this._initialize(),i=this._actionArgs.Values,t=0;t<i.length;t++)if(r=i[t],n==r.Name)return r;return this._dataView.findField(n)?{Name:n,Value:null}:null},selectFieldValue:function(n){var t=this.selectFieldValueObject(n);return t?t.Modified?t.NewValue:t.OldValue:null},fieldValue:function(n,t){var r,u,i;if(t=="Master"||t=="master")return r=this._dataView.get_master(),r?r.fieldValue(n):null;if(t=="context")return u=this._dataView.get_parentDataView(),u?u.fieldValue(n):null;if(!t||t=="Value")return this.selectFieldValue(n);i=this.selectFieldValueObject(n);i||this._unknownField(n);switch(t){case"NewValue":return i.NewValue;case"OldValue":return i.OldValue;case"Modified":return i.Modified;case"ReadOnly":return i.ReadOnly;case"Error":return i.Error;default:return i.OldValue}},updateFieldValue:function(n,t){var u=this.selectFieldValueObject(n),i,r;if(u){for(u.NewValue=t,u.Modified=!0,i=this._newValues,i||(i=this._newValues=[]),r=0;r<i.length;r++)if(i[r].Name==n){Array.removeAt(i,r);break}Array.add(i,u)}else this._unknownField(n)},property:function(n,t){if(n="Rules$"+n,arguments.length==1)return this._dataView.readContext(n);this._dataView.writeContext(n,t)},_unknownField:function(n){throw new Error(String.format('Unknown field "{0}" is not defined in  /controllers/{1}/views/{2}.',n,this._dataView._controller,this._dataView._viewId));}};Web.BusinessRules.Result=function(n){this._rules=n};Web.BusinessRules.Result.prototype={focus:function(t){var r=null,u,i,f;arguments.length>1&&(u=Array.clone(arguments),Array.removeAt(u,0),r=String._toFormattedString(!0,u));i=this._rules;f=i._dataView;n.mobile||(i._focusFieldName=t,i._focusMessage=r);setTimeout(function(){f._focus(t,r)})},showMessage:function(){n.showMessage(String._toFormattedString(!0,arguments))},showViewMessage:function(){this._rules._dataView.showViewMessage(String._toFormattedString(!0,arguments))},showAlert:function(){alert(String._toFormattedString(!0,arguments))},confirm:function(){return confirm(String._toFormattedString(!0,arguments))},refresh:function(n){this._rules._dataView(n==!0)},refreshChildren:function(){this._rules._dataView.refreshChildren()}};y={fileReader:typeof FileReader!="undefined",formData:!!window.FormData,progress:"upload"in new XMLHttpRequest,dragAndDrop:"draggable"in document.createElement("span")};$app.dataUrlToBlob=function(n){var i,u,r,t;for(i=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):unescape(n.split(",")[1]),u=n.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(i.length),t=0;t<i.length;t++)r[t]=i.charCodeAt(t);return new Blob([r],{type:u})};$app.upload=function(i,r){function s(){var r=t.devicePixelRatio||1,n=f.find("canvas"),u,i;n.length&&(u=n.width(),n.height(u*.5),n=n.get(0),n.width=n.offsetWidth*r,n.height=n.offsetHeight*r,i=n.getContext("2d"),i.scale(r,r),f.data("signature").clear(),i.fillStyle="#ccc",i.font="20pt Arial",i.textAlign="center",i.fillText(b.Files.Sign,u/2,u*.25))}function a(){var i=n.find(r.dataViewId),h=i.findField(r.fieldName),e=f.data("signature"),o=n.touch?i.extension().commandRow():i.get_currentRow(),s=o&&o[h.Index],t=s!=null&&!s.toString().match(/^null\|/),u;return f.is(".app-signature")?(u=!e.isEmpty(),t=t||u,w(i,r.fieldName,u?$app.dataUrlToBlob(e.toDataURL("image/png",1)):null)):t=t||f.find("div").length>0,t}function c(){var t=r.multiple,i=n.touch;f.empty().addClass("app-drop-box app-empty");y.dragAndDrop&&(!i||i.desktop())?f.text(t?u.DropMany:u.Drop):f.text(i?t?u.TapMany:u.Tap:t?u.ClickMany:u.Click);f.attr("title",i?t?u.TapMany:u.Tap:t?u.ClickMany:u.Click)}function v(){var t,i,o,h;if(!f.is(".app-drop-box"))if(c(),t=$app.find(r.dataViewId),i=t.findField(r.fieldName),i.OnDemandStyle==2){f.empty().attr("title",u.Sign);o=$('<canvas style="width:100%"><\/canvas>').appendTo(f).get(0);f.addClass("app-signature").data("signature",new SignaturePad(o,{backgroundColor:"white"}));$('<a class="app-clear ui-btn ui-btn-inline ui-corner-all"/>').insertAfter(f).text(u.Clear).attr("title",u.Clear).on(e,function(){if(f.data("signature").isEmpty()){n.touch&&n.touch.activeLink();return}f.addClass("app-dragging");$app.confirm(u.ClearConfirm,function(){if(f.removeClass("app-dragging").focus(),s(),r.dataViewId){var t=n.find(r.dataViewId);w(t,r.fieldName,null)}r.change&&r.change()},function(){f.removeClass("app-dragging").focus()})});n.touch||s()}else{h=$('<input type="file"/>').insertAfter(f).hide().on("change",function(){var n=this.files;n.length>0&&l(n)});r.multiple&&h.attr("multiple","");f.on("dragenter",function(){return $(this).addClass("app-dragging"),!1}).on("dragover",function(){return $(this).addClass("app-dragging"),!1}).on("dragend dragleave",function(){return $(this).removeClass("app-dragging"),!1}).on("drop",function(n){$(this).removeClass("app-dragging");n.preventDefault();f.is(".app-uploading")||l(n.originalEvent.dataTransfer.files)}).on(e,function(t){return f.is(".app-uploading")||($(t.target).closest(".app-clear").length?(f.addClass("app-dragging"),$app.confirm(f.find("div").map(function(){return $(this).text()}).get().join(", ")+"\n\n"+u.ClearConfirm,function(){if(f.removeClass("app-dragging").focus(),c(),f.next().val(""),r.dataViewId){var t=n.find(r.dataViewId);w(t,r.fieldName,null)}return r.change&&r.change(),!1},function(){f.removeClass("app-dragging").focus()})):f.next().trigger("click")),!1})}}function p(){r.change=null;f.is(".app-signature")?(f.removeData().find("canvas").off(),f.next().off().remove()):f.off().addClass("app-drop-box-destroyed").next().off().remove()}function l(t){!r.multiple&&t.length>1&&(t=[t[0]]);var e=0,i=n.find(r.dataViewId),o=i&&!n.touch&&i.get_isModal()?$(i._container).height():0;f.is(":empty")||f.css("min-height",f.height());f.find("img div").off();f.empty().removeClass("app-empty");$(t).each(function(n){var s=this,c=t.length>1?(n+1).toString()+". ":"",l=s.size>1024?String.format("{0:N0} ",s.size/1024)+u.KB:s.size+" "+u.Bytes,a=$("<div><\/div>").appendTo(f).text(c+s.name+" - "+l),h;y.fileReader&&s.type.match(/^image\//i)&&(e++,h=new FileReader,h._fileInfo=a,h.onload=function(n){$("<img/>").attr("src",n.target.result).insertAfter(this._fileInfo).one("load",function(){r.change&&r.change()});this._fileInfo=null;--e==0&&(f.css("min-height",""),o&&$(i._container).height(o))},h.readAsDataURL(s));e||(f.css("min-height",""),r.change&&r.change())});$('<a class="app-clear ui-btn ui-btn-icon-notext ui-icon-delete ui-corner-all"/>').appendTo(f).text(u.Clear).attr("title",u.Clear);i&&w(i,r.fieldName,t)}function k(){d(r.files)}function d(n){var u=new FormData,t=new XMLHttpRequest,i=$('<progress max="100"><\/progress>');$(n).each(function(){var n=this;u.append("file",n)});f.addClass("app-uploading");i.val(0).insertBefore(f.contents().first());t.open("POST",r.url);t.onload=function(){f.removeClass("app-uploading");r.success&&r.success()};t.onerror=function(){f.removeClass("app-uploading");i.remove();r.error&&r.error()};t.upload.onprogress=function(n){if(n.lengthComputable){var t=n.loaded/n.total*100|0;i.val(t)}};t.send(u)}var f,e,o;if(!arguments.length||!y.formData)return y.formData;f=$(r.container);e=n.touch?"vclick":"click";switch(i){case"create":v();break;case"destroy":p();break;case"execute":k();break;case"resize":o=f.data("screen-width");(o==null||o!=h.width())&&(f.is(":visible")&&f.data("screen-width",h.width()),s());break;case"validate":return a()}};t.Web$DataView$RichText=function(){};t.Web$DataView$RichText.prototype={attach:function(n){var f=$(n),r,t,e,i,u,o;return f.addClass("dataview-rich-text"),r=$("html").attr("lang"),String.isNullOrEmpty(r)&&(r=$("html").attr("xml:lang")),typeof CKEDITOR!="undefined"?($("<div><\/div>").insertAfter(f).width(f.outerWidth()).height(1),CKEDITOR.replace(n.id,{language:r,on:{instanceReady:function(t){var i=CKEDITOR.instances[n.id].getCommand("maximize");i&&(i._old_exec=i.exec,i.exec=function(n){this._old_exec(n);$(t.editor.container.$).find(".cke_maximized").css("z-index",10001)})}}})):(t=Web.DataViewResources.Editor,e=[{CommandName:"Undo",Tooltip:t.Undo},{CommandName:"Redo",Tooltip:t.Redo},{CommandName:"Bold",Tooltip:t.Bold,ElementWhiteList:{b:["style"],strong:["style"]}},{CommandName:"Italic",Tooltip:t.Italic,ElementWhiteList:{i:["style"],em:["style"]}},{CommandName:"Underline",Tooltip:t.Underline,ElementWhiteList:{u:["style"]}},{CommandName:"StrikeThrough",Tooltip:t.Strikethrough,ElementWhiteList:{strike:["style"]}},{CommandName:"Subscript",Tooltip:t.Subscript,ElementWhiteList:{sub:["style"]}},{CommandName:"Superscript",Tooltip:t.Superscript,ElementWhiteList:{sup:["style"]}},{CommandName:"JustifyLeft",Tooltip:t.JustifyLeft,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["left"]},{CommandName:"JustifyCenter",Tooltip:t.JustifyCenter,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["center"]},{CommandName:"JustifyRight",Tooltip:t.JustifyRight,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["right"]},{CommandName:"JustifyFull",Tooltip:t.JustifyFull,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["justify"]},{CommandName:"insertOrderedList",Tooltip:t.InsertOrderedList,ElementWhiteList:{ol:[],li:[]}},{CommandName:"insertUnorderedList",Tooltip:t.InsertUnorderedList,ElementWhiteList:{ul:[],li:[]}},{CommandName:"createLink",Tooltip:t.CreateLink,ElementWhiteList:{a:["href"]}},{CommandName:"UnLink",Tooltip:t.UnLink},{CommandName:"RemoveFormat",Tooltip:t.RemoveFormat},{CommandName:"SelectAll",Tooltip:t.SelectAll},{CommandName:"UnSelect",Tooltip:t.UnSelect},{CommandName:"Delete",Tooltip:t.Delete},{CommandName:"Cut",Tooltip:t.Cut},{CommandName:"Paste",Tooltip:t.Paste},{CommandName:"BackColor",Tooltip:t.BackColor,ElementWhiteList:{font:"style",span:"style"},AttributeWhiteList:{style:"background-color"}},{CommandName:"ForeColor",Tooltip:t.ForeColor,ElementWhiteList:{font:"color"},AttributeWhiteList:{font:"color"}},{CommandName:"FontName",Tooltip:t.FontName,ElementWhiteList:{font:["face"]},AttributeWhitList:{face:[]}},{CommandName:"FontSize",Tooltip:t.FontSize,ElementWhiteList:{font:["size"]},AttributeWhitList:{size:[]}},{CommandName:"Indent",Tooltip:t.Indent,ElementWhiteList:{blockquote:["style","dir"]},AttributeWhitList:{style:["margin","margin-right","padding","border"],dir:["ltr","rtl","auto"]}},{CommandName:"Outdent",Tooltip:t.Outdent},{CommandName:"InsertHorizontalRule",Tooltip:t.InsertHorizontalRule,ElementWhiteList:{hr:["size","width"]},AttributeWhiteList:{size:[],width:[]}},{CommandName:"HorizontalSeparator",Tooltip:""}],navigator.appVersion.match(/MSIE/)&&e.splice(0,2),i=Sys.Extended.UI.HtmlEditorExtenderBehavior,i._customized||(i.prototype.old_executeCommand=i.prototype._executeCommand,i.prototype._executeCommand=function(n){$(this._editableDiv).focus();this.old_executeCommand(n)},i._customized=!0),u=$create(i,{ToolbarButtons:e,id:n.id+"$Editor"},null,null,n),u._noEncoding=!0,u._editableDiv.tabIndex=n.tabIndex,o=$(u._topButtonContainer),o.find("nobr span").hide(),o.find("select").css({"font-family":"","font-size":""})),!0},detach:function(n){if(typeof CKEDITOR!="undefined")CKEDITOR.remove(n.id);else{var t=$find(n.id+"$Editor");t&&t.dispose()}return!0},persist:function(n){if(typeof CKEDITOR!="undefined")n.value=CKEDITOR.instances[n.id].getData();else{var t=$find(n.id+"$Editor");t&&(n.value=t._editableDiv.innerHTML)}}};n.surveyLibrary={};n.survey=function(i,r){function l(i){try{eval("$app.surveyDef="+i);var r=$app.surveyDef;$app.surveyDef=null;a(r);r.cache===!1&&(n.surveyLibrary[u]=null)}catch(f){n.alert("The definiton of "+u+" survey is invalid.\n\n"+f.message+(t.location.host.match(/\localhost\b/)?"\n\n"+f.stack.replace(/\n/g,"<br/>"):""))}}function a(t){!t.topics&&t.questions&&(t.topics=[{questions:t.questions}],t.questions=null);var i=$app.find(r.parent);t.controller=u;t.baseUrl=i.get_baseUrl();t.servicePath=i.get_servicePath();t.confirmContext=r.confirmContext;t.showSearchBar=i.get_showSearchBar();t.parent=r.parent;n.showModal(i,r.controller,"form1","New","",t.baseUrl,t.servicePath,[],{confirmContext:r.confirmContext,showSearchBar:t.showSearchBar,survey:t})}function o(n,t,i,r,u){var f=typeof t=="string"?'function(){$(document).trigger($.Event("'+t+'", {rules:this}))}':t.toString(),e=f.match(/^function\s*\(\)\s*\{([\s\S]+?)\}\s*$/);r||(r="");n.push({Scope:6,Target:null,Type:1,Test:null,Result:"<id>r"+n.length+"<\/id><commandName>"+i+"<\/commandName><commandArgument>"+r+"<\/commandArgument><view>form1<\/view><phase>"+u+"<\/phase><script>"+e[1]+"<\/script>",ViewId:"form1"})}function v(n){return n.match(/[a-z]/)&&n.match(/[A-Z]/)&&(n=n.replace(/([A-Z]+)/g," $1")),n.match(/\_/)&&(n=n.replace(/\_/g," ")),n.trim()}function y(n,t,i,r){$(n).each(function(){var n=this;i&&i(n);$(n.questions).each(function(){var i=this;r&&r(i,n,t)});n.topics&&y(n.topics,n,i,r)})}function s(t,i,r){var f=[],u=[],e;if($(t).each(function(t){var i=this;i.ItemsDataValueField||(i.ItemsDataValueField=n.cache[i.ItemsDataController+"_"+i.ItemsDataView+"_DataValueField"]);i.ItemsDataTextField||(i.ItemsDataTextField=n.cache[i.ItemsDataController+"_"+i.ItemsDataView+"_DataTextField"]);i.ItemsDataValueField&&i.ItemsDataTextField||u.push({controller:i.ItemsDataController,view:i.ItemsDataView,requiresData:!1,metadataFilter:["fields"],_fieldIndex:t})}),u.length){c(!0);n.execute({batch:u,success:function(f){$(f).each(function(i){var r=t[u[i]._fieldIndex],f=this;r.ItemsDataValueField||$(f.Fields).each(function(){var t=this;if(t.IsPrimaryKey)return r.ItemsDataValueField=t.Name,n.cache[r.ItemsDataController+"_"+r.ItemsDataView+"_DataValueField"]=t.Name,!1});r.ItemsDataTextField||(r.ItemsDataTextField=f.Fields[0].Name,n.cache[r.ItemsDataController+"_"+r.ItemsDataView+"_DataTextField"]=r.ItemsDataTextField)});s(t,i,r)},error:function(){c(!1)}});return}$(t).each(function(){var t=this,i,o=t._dataView,s=[t.ItemsDataValueField,t.ItemsDataTextField],h=t.Copy,c=t.ContextFields,l={controller:t.ItemsDataController,view:t.ItemsDataView,sortExpression:t.ItemsDataTextField,fieldFilter:s,metadataFilter:["fields"],pageSize:1e3},r,u;if(h)while(i=n._fieldMapRegex.exec(h))s.push(i[2]);if(c){for(e||(e=o.surveyRow()),r=[];i=n._fieldMapRegex.exec(c);)u=o.findField(i[2]),u&&r.push(i[1]+":="+o.convertFieldValueToString(u,e[u.Index]));r.length&&(l.Filter=r)}f.push(l)});c(!0);n.execute({batch:f,success:function(n){c(!1);$(t).each(function(t){var e=this,i=f[t],r=n[t],u={};$(r.Fields).each(function(n){u[this.Name]=n});$(r.Rows).each(function(){for(var r=this,t=[],n=0;n<i.fieldFilter.length;n++)t.push(r[u[i.fieldFilter[n]]]);e.Items.push(t)})});r&&r()},error:function(){c(!1)}})}function p(){var i=[],n={Controller:u,View:"form1",TotalRowCount:-1,Fields:[{Name:"sys_pk_",Type:"Int32",Label:"",IsPrimaryKey:!0,ReadOnly:!0,Hidden:!0,AllowNulls:!0,Columns:20}],Views:[{Id:"form1",Label:r.text,Type:"Form",HeaderText:r.description}],Expressions:[],ActionGroups:[{Scope:"Form",Id:"ag1",Actions:[{Id:"a1",CommandName:"Confirm",WhenLastCommandName:"New",HeaderText:r.submitText,Confirmation:r.submitConfirmation},{Id:"a2",CommandName:"Cancel",WhenLastCommandName:"New"}]}],Categories:[],NewRow:[1],Rows:[]},t;return $(r.topics).each(function(t){var u=this,f=n.Categories.length,e={Id:"c"+f,Index:f,HeaderText:u.text,Description:u.description,Wizard:u.wizard,NewColumn:u.newColumn!=null?u.newColumn:t==0,Collapsed:u.collapsed==!0,Tab:u.tab};n.Categories.push(e);$(u.questions).each(function(){var u=this,o=u.type||"String",s=u.format||u.dataFormatString,h=u.columns,a=u.rows,y=u.tags,e=u.items,p=u.value,w=u.context,t={Name:u.name,HtmlEncode:!0,AllowNulls:u.required!=!0,Label:u.text==!1?"&nbsp;":u.text||u.label||v(u.name),Hidden:u.hidden==!0,CausesCalculate:u.causesCalculate==!0},c,l;if(t.Name){switch(o.toLowerCase()){case"text":case"string":o="String";break;case"date":o="DateTime";s||(s="d",h==null&&(h=10));break;case"datetime":o="DateTime";h==null&&(h=20);break;case"time":o="DateTime";s||(s="t",h==null&&(h=8));break;case"number":o="Double";break;case"int":o="Int32";break;case"bool":case"Boolean":o="Boolean";!e&&u.required&&(e={style:"CheckBox"},p==null&&(p=!1));break;case"money":o="Currency";break;case"memo":o="String";a==null&&(a=5)}t.Type=o;o=="String"&&(t.Len=u.length||100);o!="DateTime"||s||(s="g");o!="Currency"||s||(s="c");s&&(t.DataFormatString=s);h&&(t.Columns=h);a&&(t.Rows=a);u.placeholder&&(t.Watermark=u.placeholder);y&&(t.Tag=typeof y=="string"?y:y.join(","));w&&(t.ContextFields=typeof w=="string"?w:w.join(","));(r.readOnly||u.readOnly&&typeof u.readOnly!="function")&&(t.ReadOnly=!0);t.Hidden||(t.CategoryIndex=f);u.extended&&(t.Extended=u.extended);c=e&&e.copy;c&&(typeof c!="string"&&(c=[],$(e.copy).each(function(){var n=this;c.push(n.to+"="+n.from)}),c=c.join("\n")),t.Copy=c);l=e&&e.filter;l&&(typeof l!="string"&&(l=[],$(e.filter).each(function(){var n=this;l.push(n.match+"="+n.to)}),l=l.join(",")),t.ContextFields=l);e&&(t.ItemsStyle=e.style||(e.values?"DropDownList":"Lookup"),t.Items=[],e.autoCompleteAnywhere&&(t.SearchOptions="$autocompleteanywhere"),e.values?$(e.values).each(function(){var n=this;t.Items.push([n.value,n.text]);e.other&&$(n.other).each(function(){t.Items.push(this)})}):e.controller&&(t.ItemsDataController=e.controller,t.ItemsDataView=e.view||"grid1",t.ItemsDataValueField=e.dataValueField,t.ItemsDataTextField=e.dataTextField,t.ItemsNewDataView=e.newView,t.ItemsStyle.match(/AutoComplete|Lookup/)||t.ContextFields||i.push(t),e.dataValueField!=e.dataTextField&&(t._autoAlias=!0)));u.visibleWhen&&n.Expressions.push({Scope:3,Target:u.name,Test:u.visibleWhen,Type:1,ViewId:"form1"});n.Fields.push(t);typeof p!="function"&&(n.NewRow[n.Fields.length-1]=p)}})}),r.init&&o(n.Expressions,r.init,"New","form1","After"),r.submit&&o(n.Expressions,r.submit,"Confirm",null,"Before"),r.cancel&&o(n.Expressions,r.cancel,"Cancel",null,"Before"),t=r.compiled,t&&(i.length?s(i,n.Fields,function(){t(n)}):t(n),r.compiled=null),n}var u=r.controller,h,e,f;if(i=="show")r.dynamic?a(r):(h=n.surveyLibrary[u],h?l(h):(c(!0),f=$app.find(r.parent),$.ajax({url:f.get_baseUrl()+"/scripts/surveys/"+u+".js",dataType:"text",cache:!1,success:function(t){c(!1);n.surveyLibrary[u]=t;l(t)},error:function(){c(!1);n.alert("Unable to load survey "+u+" from the server.")}})));else{if(i=="compile")return p();i=="populateItems"?(e=[],f=r.dataView,$(f._allFields).each(function(){var n=this;n.ItemsAreDynamic&&n.ContextFields&&e.push(n)}),e.length&&s(e,f._allFields,r.callback)):n.alert("Unsupported survey method: "+i)}};$(document).on("batcheditsubmit.dataview.app",function(t){var r=t.rules,u;if(r.busy()){r.preventDefault();return}var i=r.dataView(),s=i.surveyRow(),h=i._survey.context,f=[],e;$(i._allFields).each(function(){var r=this,o=r.Name.match(/^(.+?)\_BatchEdit$/),n,u,t;if(o&&r.Type=="Boolean"&&(n=i.findField(r.Name),n&&s[n.Index])){if(n=i.findField(o[1]),n&&(t=s[n.Index]),n.Extended&&!n.Extended.allowNulls&&t==null)return e=n,!1;if(u=n.Extended.dependency,u&&$(u).each(function(){var o=this,r=i.findField(o.Name),u=s[r.Index];if(t==null&u!=null)return e=n,!1;f.push({name:r.Name,newValue:u})}),e)return!1;f.push({name:n.Name,newValue:t})}});e?(r.preventDefault(),r.result.focus(e.Name,o.RequiredField)):f.length&&(r.preventDefault(),c(!0),u=i.get_parentDataView(),$(u._keyFields).each(function(){var n=this;f.push({name:n.Name})}),$app.confirm(nt.Confirmation,function(){n.execute({controller:h.controller,view:h.view,command:"Update",lastCommand:"BatchEdit",values:f,selectedKeys:u._selectedKeyList,success:function(){c(!1);n.touch?(n.touch.pageShown(function(){u._keepKeyList=!0;u.sync()}),i.cancel()):(i.cancel(),u.sync())},error:function(){c(!1)}})}))});typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();
/*!
    * Signature Pad v1.3.5
    * https://github.com/szimek/signature_pad
    *
    * Copyright 2015 Szymon Nowak
    * Released under the MIT license
    *
    * The main idea and some parts of the code (e.g. drawing variable width Bzier curve) are taken from:
    * http://corner.squareup.com/2012/07/smoother-signatures.html
    *
    * Implementation of interpolation using cubic Bzier curves is taken from:
    * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
    *
    * Algorithm for approximated length of a Bzier curve is taken from:
    * http://www.lemoda.net/maths/bezier-length/index.html
    *
    */
t.SignaturePad=function(n){var t=function(n,t){var r=this,i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7;this.minWidth=i.minWidth||.5;this.maxWidth=i.maxWidth||2.5;this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2};this.penColor=i.penColor||"black";this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)";this.onEnd=i.onEnd;this.onBegin=i.onBegin;this._canvas=n;this._ctx=n.getContext("2d");this.clear();this._handleMouseEvents();this._handleTouchEvents()},i,r;return t.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor;t.clearRect(0,0,n.width,n.height);t.fillRect(0,0,n.width,n.height);this._reset()},t.prototype.toDataURL=function(){var n=this._canvas;return n.toDataURL.apply(n,arguments)},t.prototype.fromDataURL=function(n){var r=this,t=new Image,i=window.devicePixelRatio||1,u=this._canvas.width/i,f=this._canvas.height/i;this._reset();t.src=n;t.onload=function(){r._ctx.drawImage(t,0,0,u,f)};this._isEmpty=!1},t.prototype._strokeUpdate=function(n){var t=this._createPoint(n);this._addPoint(t)},t.prototype._strokeBegin=function(n){var t=this._ctx,i=this._canvas;if(this._isEmpty&&(t.fillStyle=this.backgroundColor,t.fillRect(0,0,i.width,i.height),t.fillStyle=this.penColor),this._reset(),this._strokeUpdate(n),typeof this.onBegin=="function")this.onBegin(n)},t.prototype._strokeDraw=function(n){var t=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;t.beginPath();this._drawPoint(n.x,n.y,i);t.closePath();t.fill()},t.prototype._strokeEnd=function(n){var i=this.points.length>2,t=this.points[0];if(!i&&t&&this._strokeDraw(t),typeof this.onEnd=="function")this.onEnd(n)},t.prototype._handleMouseEvents=function(){var t=this,i=$(t._canvas);this._mouseButtonDown=!1;i.on("mousedown",function(n){n=n.originalEvent;n.which===1&&(t._mouseButtonDown=!0,t._strokeBegin(n))});i.on("mousemove",function(n){n=n.originalEvent;t._mouseButtonDown&&t._strokeUpdate(n)});$(n).on("mouseup",function(n){n=n.originalEvent;n.which===1&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(n))})},t.prototype._handleTouchEvents=function(){var t=this,i=$(t._canvas);this._canvas.style.msTouchAction="none";i.on("touchstart",function(n){n=n.originalEvent;var i=n.changedTouches[0];t._strokeBegin(i)});i.on("touchmove",function(n){n=n.originalEvent;n.preventDefault();var i=n.changedTouches[0];t._strokeUpdate(i)});$(n).on("touchend",function(n){n=n.originalEvent;var i=n.target===t._canvas;i&&t._strokeEnd(n)})},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[];this._lastVelocity=0;this._lastWidth=(this.minWidth+this.maxWidth)/2;this._isEmpty=!0;this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(n){var t=this._canvas.getBoundingClientRect();return new i(n.clientX-t.left,n.clientY-t.top)},t.prototype._addPoint=function(n){var t=this.points,u,f,e,i;t.push(n);t.length>2&&(t.length===3&&t.unshift(t[0]),i=this._calculateCurveControlPoints(t[0],t[1],t[2]),u=i.c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]),f=i.c1,e=new r(t[1],u,f,t[2]),this._addCurve(e),t.shift())},t.prototype._calculateCurveControlPoints=function(n,t,r){var e=n.x-t.x,o=n.y-t.y,s=t.x-r.x,h=t.y-r.y,f={x:(n.x+t.x)/2,y:(n.y+t.y)/2},u={x:(t.x+r.x)/2,y:(t.y+r.y)/2},p=Math.sqrt(e*e+o*o),c=Math.sqrt(s*s+h*h),w=f.x-u.x,b=f.y-u.y,l=c/(p+c),a={x:u.x+w*l,y:u.y+b*l},v=t.x-a.x,y=t.y-a.y;return{c1:new i(f.x+v,f.y+y),c2:new i(u.x+v,u.y+y)}},t.prototype._addCurve=function(n){var r=n.startPoint,u=n.endPoint,t,i;t=u.velocityFrom(r);t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity;i=this._strokeWidth(t);this._drawCurve(n,this._lastWidth,i);this._lastVelocity=t;this._lastWidth=i},t.prototype._drawPoint=function(n,t,i){var r=this._ctx;r.moveTo(n,t);r.arc(n,t,i,0,2*Math.PI,!1);this._isEmpty=!1},t.prototype._drawCurve=function(n,t,i){var l=this._ctx,p=i-t,a,y,o,r,s,h,u,c,v,f,e;for(a=Math.floor(n.length()),l.beginPath(),o=0;o<a;o++)r=o/a,s=r*r,h=s*r,u=1-r,c=u*u,v=c*u,f=v*n.startPoint.x,f+=3*c*r*n.control1.x,f+=3*u*s*n.control2.x,f+=h*n.endPoint.x,e=v*n.startPoint.y,e+=3*c*r*n.control1.y,e+=3*u*s*n.control2.y,e+=h*n.endPoint.y,y=t+h*p,this._drawPoint(f,e,y);l.closePath();l.fill()},t.prototype._strokeWidth=function(n){return Math.max(this.maxWidth/(n+1),this.minWidth)},i=function(n,t,i){this.x=n;this.y=t;this.time=i||(new Date).getTime()},i.prototype.velocityFrom=function(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):1},i.prototype.distanceTo=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},r=function(n,t,i,r){this.startPoint=n;this.control1=t;this.control2=i;this.endPoint=r},r.prototype.length=function(){for(var e=10,o=0,t,i,r,s,h,u,f,n=0;n<=e;n++)t=n/e,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),n>0&&(u=i-s,f=r-h,o+=Math.sqrt(u*u+f*f)),s=i,h=r;return o},r.prototype._point=function(n,t,i,r,u){return t*(1-n)*(1-n)*(1-n)+3*i*(1-n)*(1-n)*n+3*r*(1-n)*n*n+u*n*n*n},t}(document)})();