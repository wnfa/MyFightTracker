/*!
 * Data Aquarium Framework - Menus for Desktop UI
 * Copyright 2008-2016 Code On Time LLC; Licensed MIT; http://codeontime.com/license
 */
(function(){function u(n){return n?n.replace(/glyphicon[\w\-]+/,""):n}var i,n,r,t;Type.registerNamespace("Web");i=window;n=Web;r=Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<7;r&&$("body").addClass("IE6");n.Item=function(n,t,i){this._family=n;this._text=t;this._description=i;this._depth=0};n.Item.prototype={get_family:function(){return this._family},get_text:function(){return this._text},set_text:function(n){this._text=n},get_description:function(){return this._description},set_description:function(n){this._description=n},get_url:function(){return this._url},set_url:function(n){this._url=n},context:function(n){if(arguments.length==0)return this._context;this._context=n},get_script:function(){return this._script},set_script:function(n,t){this._script=t==null?n:String._toFormattedString(!1,arguments)},get_cssClass:function(){return this._cssClass},set_cssClass:function(n){this._cssClass=n},get_disabled:function(){return this._disabled},set_disabled:function(n){this._disabled=n},get_group:function(){return this._group},set_group:function(n){this._group=n},get_selected:function(){return this._selected},set_selected:function(n){this._selected=n},get_children:function(){return this._children},get_confirmation:function(){return this._confirmation},set_confirmation:function(n){this._confirmation=n},get_dynamic:function(){return this._dynamic},set_dynamic:function(n){this._dynamic=n;this._cssClass=n?"Dynamic":"";this._disabled=n},get_depth:function(){return this._depth},get_parent:function(){return this._parent},get_path:function(){if(!this._path){var t=this._parent?this._parent.get_path()+"/":"";t+=this._parent?Array.indexOf(this._parent.get_children(),this):Array.indexOf(n.HoverMonitor.Families[this._family].items,this);this._path=t}return this._path},get_id:function(){return this._id||(this._id=String.format("HoverMonitor${0}$Item${1}",this._family,this.get_path().replace(/\//g,"_"))),this._id},get_children:function(){return this._children},addChild:function(n){n._parent=this;this._children||(this._children=[],this._cssClass="Parent");n._depth=this._depth+1;Array.add(this._children,n)},dispose:function(){if(this._parent=null,this._children){for(var n=0;n<this._children;n++)this._children[n].dispose();Array.clear(this._children);this._children=null}},findChild:function(t){return n.Item.find(this._family,t,this._children)}};n.Item.find=function(t,i,r){var f,u,e,o;if(String.isNullOrEmpty(i))return null;if(!r){if(f=n.HoverMonitor.Families[t],!f)return null;r=f.items}return(u=i.match(/^(\d+)(\/(.+?)$|$)/),!u)?null:(e=parseInt(u[1]),!r||e>=r.length)?null:(o=r[e],u[3]&&u[3].length>0?o.findChild(u[3]):o)};n.Menu=function(n){Web.Menu.initializeBase(this,[n]);this.set_orientation(Web.MenuOrientation.Horizontal);this.set_cssClass("Menu");this.set_hoverStyle(Web.HoverStyle.Auto);this.set_itemDescriptionStyle(Web.ItemDescriptionStyle.ToolTip);this.set_popupPosition(Web.PopupPosition.Left)};t=n.Menu;t.prototype={initialize:function(){t.callBaseMethod(this,"initialize")},dispose:function(){for(var r,i=this.get_nodes(),n=0;n<i.length;n++)r=i[n],r.children&&$unregisterItems(this.get_id()+"_"+n);t.callBaseMethod(this,"dispose")},updated:function(){var f,v,b,h,i,r,s,e,y,k,c,u,l,nt,d,g,p,o,a,tt,w,it;if(t.callBaseMethod(this,"updated"),t.MainMenuId||(t.MainMenuId=this.get_id(),t.MainMenuElemId=this._element.id),f=this.get_nodes(),v=n.DataViewResources.Menu,f){if(b=this.get_presentationStyle(),b>0&&(typeof __tf=="undefined"||!(__tf!=4))){Sys.UI.DomElement.addCssClass(this._element,"menu "+(b==1?"two-level":"nav-button"));this._createMenu(f,this._element,1);return}for(h=null,i=0;i<f.length;i++)if(r=f[i],this._currentNode=r,r.children){for(s=this.get_id()+"_"+i,e=[],y=0;y<r.children.length;y++)Array.add(e,this._createItem(s,r.children[y]));this.set_items(e);$registerItems(s,e,this.get_hoverStyle(),this.get_popupPosition(),this.get_itemDescriptionStyle());r.selected&&(h=r)}if(this._render(f),this.get_showSiteActions()){if(s=this.get_id()+"_SiteActions",e=[],this._selectedItem)for(k=this._selectedItem.get_parent()?this._selectedItem.get_parent().get_children():n.HoverMonitor.Families[this._selectedItem.get_family()].items,i=0;i<k.length;i++)c=k[i],String.isNullOrEmpty(c.get_url())||c==this._selectedItem||(u=new n.Item(s,c.get_text(),c.get_description()),u.set_url(c.get_url()),u.set_cssClass(c.get_cssClass()),Array.add(e,u));if(e.length==0)for(!h||!h.children||h.children.length==1&&h.children[0].selected||(f=h.children),i=0;i<f.length;i++)r=f[i],String.isNullOrEmpty(r.url)||r.selected&&f.length!=1||(u=new n.Item(s,r.title,r.description),u.set_url(r.url),u.set_cssClass(r.cssClass),Array.add(e,u));if($registerItems(s,e,n.HoverStyle.ClickAndStay,n.PopupPosition.Right,n.ItemDescriptionStyle.Inline),t._siteActionsFamily=s,l=$getSideBar(),d=$('head meta[name="description"]'),l&&e.length>0){for(i=0;i<l.childNodes.length;i++)if(p=l.childNodes[i],p.className&&Sys.UI.DomElement.containsCssClass(p,"About")){p.getElementsByTagName("div")[1].innerHTML=v.About;nt=!0;break}for(o=new Sys.StringBuilder,o.append('<div class="Inner">'),o.appendFormat('<div class="Header">{0}<\/div>',v.SeeAlso),i=0;i<e.length;i++)if(u=e[i],String.isNullOrEmpty(u.get_url())||o.appendFormat('<div class="Item"><a href="{0}" title="{2}">{1}<\/a><\/div>',u.get_url(),String.trimLongWords(u.get_text()),String.trimLongWords(u.get_description())),i>5)break;o.append("<\/div>");a=document.createElement("div");a.className="TaskBox SeeAlso";a.innerHTML=o.toString();o.clear();l.insertBefore(a,l.childNodes[l.childNodes.length-1]);!nt&&d.length&&(g=$('<div class="TaskBox About"><div class="Inner"><div class="Header"><\/div><div class="Value"><\/div><\/div><\/div>').insertAfter(a),g.find(".Header").text(v.About),g.find(".Value").text(d.attr("content")))}if(tt=$get("TableOfContents"),tt){for(o.append('<div class="TableOfContents">'),i=0;i<f.length;i++)r=f[i],o.appendFormat('<div class="Header">',r.get_text());o.append("<\/div>")}}else w=n.PageState.read(this.get_id()),w!=null&&(it=this._element.getElementsByTagName("td"),this.select(w,it[w]))}},get_presentationStyle:function(){return this._presentationStyle},set_presentationStyle:function(n){this._presentationStyle=n},_createNewColumn:function(n,t,i){return n.cssClass&&n.cssClass.match(/(^|\s*)menu-new-column(\s*|$)/)?$("<div>").addClass("column "+i).appendTo(t):null},_createNavButton:function(n){var u=null,i=null,a=!1,v=!1,f=null,t,o,y,s,b,h,c,k,l,d;$("div.PageMenuBar").hide();t=$("<ul>").attr("id",this._id).addClass("root-level");o=$("<div>").addClass("menu-button-container").css({position:"absolute",height:"1px",left:"0px",top:"0px"});o.appendTo(document.body);t.appendTo(o);y=function(n,t){for(var r=0;r<n.length;r++){var i=n[r],u=$("<li>").appendTo(t),e=$("<a>").attr({href:i.url,title:i.description}).text(i.title).appendTo(u);i.selected&&!i.children&&(e.addClass("selected"),f=e);i.children&&i.children.length>0&&y(i.children,$("<ul>").addClass("menu-level").appendTo(u))}};y(n,t);var e=0,g=$("#"+this._id+" > li > a").each(function(){var n=$(this).outerWidth();n>e&&(e=n)}),r=$("#PageHeaderBar").addClass("menu-button-bar").contents().wrap('<span class="menu-button"><\/span>').parent().button({icons:{secondary:"ui-icon-triangle-1-s"}}),p=r.width()-4,w=t.find("ul").addClass("sub-level");for(s=w.length-1;s>=0;s--)b=$(w[s]),h=0,b.find("> li > a").each(function(){var n=$(this).outerWidth();n>h&&(h=n)}).width(h+25);t.find("ul").each(function(){$(this).find("ul").length==0&&$(this).addClass("last-level")});e+=25;p>e?t.width(p):t.width(e);c=function(){i||(i=setTimeout(function(){v||(t.hide(),r.removeClass("menu-button-active"));i=null},200))};k=function(){i&&(clearTimeout(i),i=null)};o.find("ul").hover(function(){v=!0},function(n){$(n.toElement).find("li:parent ul.menu-level:parent").length==0&&(v=!1,c())});t.menu({position:{of:"ul:has(a.ui-state-focus):last"},select:function(){},blur:function(){a||c()},focus:function(){i&&(clearTimeout(i),i=null);t.show()}});l=t.outerHeight();t.find("ul").show().each(function(){var n=$(this).outerHeight();n>l&&(l=n)}).andSelf().height(l).hide();t.hide();d=0;r.hover(function(){a=!0;k();u=setTimeout(function(){var i,n,e;if(r.addClass("menu-button-active"),t.show().position({my:"left top",at:"left bottom",of:r}),u=null,f){for(f.parentsUntil("div.menu-button-container","li").find("a:first").not("a.selected").addClass("ui-state-active"),t.show().position({my:"left top",at:"left bottom",of:r}),i=f.parentsUntil("div.menu-button-container","ul").show(),n=i.length-2;n>=0;n--)e=$(i[n]),e.position({my:"left top",at:"right top",of:$(i[n+1])});f=null}},500)},function(){a=!1;u&&(clearTimeout(u),u=null);c()})},_createMenu:function(n,i,r){var w=this._presentationStyle==2,c,o,s,e,u,y,l,a,f,h,v,b,k,d,p;if(r==1&&w){this._createNavButton(n);return}if(c=null,o="level"+r,r>1&&(i=$("<div>").addClass("children "+o).appendTo(i.first())),s=null,r==2)for(e=0;e<n.length;e++)if(u=n[e],s=this._createNewColumn(u,i,o),s){s.addClass("first");break}for(y=$("<ul>").addClass(o).appendTo(s?s:i),l=!0,e=0;e<n.length;e++)u=n[e],s&&e>0&&(a=this._createNewColumn(u,i,o),a&&(s=a,y=$("<ul>").addClass(o).appendTo(a),l=!0)),f=$("<li>").addClass(o).appendTo(y),u.selected&&(f.addClass("current"),c=u),e==0&&f.addClass("first"),e==n.length-1&&f.addClass("last"),h=u.url,String.isNullOrEmpty(h)&&r==1&&(h="javascript:void(0)"),String.isNullOrEmpty(h)?(k=$("<span>").addClass("text "+o).text(u.title).appendTo(f),l&&(l=!1,k.addClass("first"))):(v=$("<a>").attr({href:h,"class":o,tabIndex:$nextTabIndex()}).appendTo(f),h.match(t.UrlRegex.match)&&(v.attr("menuItemUrl",h),v.click(function(n){n.preventDefault();t.navigate(this.getAttribute("menuItemUrl"))})),b=$("<span>").addClass("outer").appendTo(v),$("<span>").addClass("inner").appendTo(b).text(u.title).attr("title",u.description)),r==1&&(w?f.hover(function(){var r=$(this).addClass("hover"),n;if(r.siblings("li").addClass("unhover"),n=$("div.level2:first",this),n.size()==1){var t=$(this).parents("div.nav-button.menu:first"),i=t.offset(),u=t.outerWidth(),f=t.outerHeight();i.left+=u;n.removeAttr("style").offset({left:0,top:0}).css("width","auto");n.removeAttr("style").offset(i)}},function(){var n=$(this).removeClass("hover").siblings("li").removeClass("unhover");$("div.level2:first",this).hide()}):f.hover(function(){var i=$(this).addClass("hover"),t,n,r;if(i.siblings("li").addClass("unhover"),$closeHovers(),t=$("div.level2:first",this),t.size()==1){n=i.offset();n.top+=i.outerHeight();var f=i.outerWidth(),u=$(window).width(),e=$(window).height();t.removeAttr("style").offset({left:0,top:0});r=t.outerWidth();n.left+r>u&&(n.left=u-r-10);n.left<0&&(n.left=0);t.hide().removeAttr("style").offset(n)}},function(){var n=$(this).removeClass("hover").siblings("li").removeClass("unhover");$("div.level2:first",this).hide()})),d=u.children&&u.children.length>0,d?(p=this._createMenu(u.children,f,r+1),p&&(c=p,f.addClass("selected")),f.addClass("parent"),r==1&&u.cssClass&&$("div.children:first",f).addClass(u.cssClass)):f.addClass("terminal"),r==2&&i.hide();return c},get_nodes:function(){return this._nodes||(this._nodes=t.Nodes[this.get_id()]),this._nodes},set_nodes:function(n){this._nodes=n},get_orientation:function(){return this._orientation},set_orientation:function(n){this._orientation=n},get_cssClass:function(){return this._cssClass},set_cssClass:function(n){this._cssClass=n},get_hoverStyle:function(){return this._hoverStyle},set_hoverStyle:function(n){this._hoverStyle=n},get_itemDescriptionStyle:function(){return this._itemDescriptionStyle},set_itemDescriptionStyle:function(n){this._itemDescriptionStyle=n},get_popupPosition:function(){return this._popupPosition},set_popupPosition:function(n){this._popupPosition=n},get_showSiteActions:function(){return this._showSiteActions},set_showSiteActions:function(n){this._showSiteActions=n},get_items:function(){return this._items},set_items:function(n){this._items=n},_createItem:function(t,i,r){var u=new n.Item(t,i.title,i.description),f;if(u.set_url(i.url),i.selected&&(u.set_selected(i.selected),this._currentNode.selected=!0,this._selectedItem=u),r&&r.addChild(u),i.children)for(f=0;f<i.children.length;f++)this._createItem(t,i.children[f],u);return u},_render:function(t){var i,u,r,f;for($("td.Item",this._element).unbind("mouseover mouseout click"),$("td.Item a.Link",this._element).unbind("click focus blur"),i=new Sys.StringBuilder,i.appendFormat('<table class="{0}" cellpadding="0" cellspacing="0" style="float:left">',this.get_cssClass()),this.get_orientation()==n.MenuOrientation.Horizontal&&i.append("<tr>"),u=0;u<t.length;u++)r=t[u],this.get_orientation()==n.MenuOrientation.Vertical&&i.append("<tr>"),i.appendFormat('<td class="Item{3}" onmouseover2="$showHover(this,&quot;{0}_{1}&quot;,&quot;{4}&quot;)" onmouseout2="$hideHover(this)" onclick2="if(this._skip)this._skip=false;else $find(&quot;{0}&quot).select({1},this);"{7}><span class="Outer"><span class="Inner"><span class="Link"><a href="javascript:" class="Link" onclick2="this.parentNode.parentNode.parentNode.parentNode._skip=true;$hoverOver(this, 4);$find(&quot;{0}&quot).select({1},this);return false;" onfocus2="$showHover(this,&quot;{0}_{1}&quot;,&quot;{4}&quot;, 4)" onblur2="$hideHover(this)" tabIndex="{6}" {5}>{2}<\/a><\/span><\/span><\/span><\/td>',this.get_id(),u,$appfactory.htmlEncode(r.title),(r.children?" Parent":"")+(r.selected?" Selected":""),this.get_cssClass(),String.isNullOrEmpty(r.description)||this.get_itemDescriptionStyle()==n.ItemDescriptionStyle.None?"":String.format(' title="{0}"',$appfactory.htmlAttributeEncode(r.description)),$nextTabIndex(),r.hidden=="true"?' style="display:none"':""),this.get_orientation()==n.MenuOrientation.Vertical&&i.append("<\/tr>");this.get_orientation()==n.MenuOrientation.Horizontal&&i.append("<\/tr>");i.append("<\/table>");this.get_showSiteActions()&&(i.appendFormat('<table class="Menu SiteActions" cellpadding="0" cellspacing="0" style="float:right"><tr><td class="Item Parent" onmouseover2="$showHover(this,&quot;{0}_SiteActions&quot;,&quot;SiteActions&quot;)" onmouseout2="$hideHover(this)" onclick2="if(this._skip)this._skip=false;else $toggleHover()"><span class="Outer"><span class="Inner"><span class="Link"><a href="javascript:" class="Link" onclick2="this.parentNode.parentNode.parentNode.parentNode._skip=true;$toggleHover();$hoverOver(this, 4);return false" onfocus2="$showHover(this,&quot;{0}_SiteActions&quot;,&quot;SiteActions&quot;, 4)" onblur2="$hideHover(this)" tabIndex="{1}">{2}<\/a><\/span><\/span><\/span><\/td><\/tr><\/table>',this.get_id(),$nextTabIndex(),n.DataViewResources.Menu.SiteActions),f=document.createElement("div"),this._element.parentNode.appendChild(f));this._element.innerHTML=i.toString();$("td.Item",this._element).mouseover(function(){return __evalEvent.call(this,"mouseover")}).mouseout(function(){return __evalEvent.call(this,"mouseout")}).click(function(n){return n.preventDefault(),__evalEvent.call(this,"click")});$("td.Item a.Link",this._element).click(function(n){return n.preventDefault(),__evalEvent.call(this,"click")}).focus(function(){return __evalEvent.call(this,"focus")}).blur(function(){return __evalEvent.call(this,"blur")});i.clear()},select:function(i,r){var f,e,u;if(_body_createPageContext(),f=this.get_nodes()[i],String.isNullOrEmpty(f.elementId))t.navigate(f.url);else{for(n.PageState.write(this.get_id(),i),e=$get(f.elementId),u=0;u<this.get_nodes().length;u++)f=this.get_nodes()[u],String.isNullOrEmpty(f.elementId)||Sys.UI.DomElement.setVisible($get(f.elementId),!1);for(Sys.UI.DomElement.setVisible(e,!0);!Sys.UI.DomElement.containsCssClass(r,"Item");)r=r.parentNode;for(u=0;u<r.parentNode.childNodes.length;u++)Sys.UI.DomElement.removeCssClass(r.parentNode.childNodes[u],"Selected");Sys.UI.DomElement.addCssClass(r,"Selected");_body_performResize();try{r.focus()}catch(o){}}}};t.Nodes=[];t.findNode=function(n,i){var u,r,f;for(i||(i=this.Nodes[this.MainMenuId]),u=0;u<i.length;u++){if(r=i[u],r.url.match(n))return r;if(r.children&&(f=t.findNode(n,r.children),f))return f}return null};t.get_siteActionsFamily=function(){return t._siteActionsFamily};t.get_siteActions=function(){return n.HoverMonitor.Families[this._siteActionsFamily].items};t.set_siteActions=function(t){n.HoverMonitor.Families[this._siteActionsFamily].items=t};t.UrlRegex=/^(_.+?):(.+?)$/;t.navigate=function(n){if(!String.isNullOrEmpty(n)){var i=n.match(t.UrlRegex);i?window.open(i[2],i[1]):($appfactory._navigated=!0,location.href=n)}};t.registerClass("Web.Menu",Sys.UI.Behavior);n.HoverStyle={None:0,Auto:1,Click:2,ClickAndStay:3};n.PopupPosition={Left:0,Right:1};n.MenuOrientation={Horizontal:0,Vertical:1};n.ItemDescriptionStyle={None:0,Inline:1,ToolTip:2};n.HoverMonitor=function(){n.HoverMonitor.initializeBase(this);this._popups=[]};n.HoverMonitor.prototype={initialize:function(){n.HoverMonitor.callBaseMethod(this,"initialize");this._hoverArrowHandlers={click:this._hoverArrow_click,mouseover:this._hoverArrow_mouseover,mouseout:this._hoverArrow_mouseout};this._hoverMenuHandlers={mouseover:this._hoverMenu_mouseover,mouseout:this._hoverMenu_mouseout};this._documentKeydownHandler=Function.createDelegate(this,this._document_keydown);this._documentClickHandler=Function.createDelegate(this,this._document_click);$addHandler(document,"keydown",this._documentKeydownHandler);$addHandler(document,"click",this._documentClickHandler);this._tabIndex=1},dispose:function(){delete this._factory;for(var t=0;t<n.HoverMonitor.Families.length;t++)$unregisterItems(n.HoverMonitor.Families[t].family);for($removeHandler(document,"click",this._documentClickHandler),$removeHandler(document,"keydown",this._documentKeydownHanlder),this.stopClose(),this.stopCloseItem(),this.stopOpen(),t=0;t<this._popups.length;t++)this._destroyPopup(t);this._destroyFrame(this._hoverFrame);this._destroyFrame(this._openFrame);n.HoverMonitor.callBaseMethod(this,"dispose")},nextTabIndex:function(){return this._tabIndex++},_createPopup:function(n){var t,i,r;return this._popups[n]||(t=document.createElement("div"),document.body.appendChild(t),t.className="HoverMenu",Sys.UI.DomElement.setVisible(t,!1),i=$create(AjaxControlToolkit.PopupBehavior,{id:"HoverMonitorPopup"+n},null,null,t),r={behavior:i,container:t},this._popups[n]=r,$addHandlers(t,this._hoverMenuHandlers,this)),this._popups[n]},_destroyPopup:function(n){var t=this._popups[n];t&&(t.behavior.dispose(),$clearHandlers(t.container),t.container.parentNode.removeChild(t.container),delete t.container,delete this._popups[n])},_renderPopup:function(t,i,r,f){var e=new Sys.StringBuilder,p,s,h,a,c,l,v,o,w;t.container.style.width="";t.container.style.height="";t.container.style.overflow="";t.container.className=String.format("HoverMenu {0}_HoverMenu",f);var b=!1,y=this.get_itemDescriptionStyle(i),k=n.HoverMonitor.Families[i];if(k){for(p=r?r.get_children():k.items,s=null,h=0;h<p.length;h++)r=p[h],r.get_group()!=s&&(s!=null&&e.append("<\/div>"),s=r.get_group(),s!=null&&e.append('<div class="Group">')),r.get_text()?(a=r.get_selected(),e.append('<a href="javascript:" class="Item'),r.get_cssClass()&&e.append(" "+u(r.get_cssClass())),a&&e.append(" Selected"),r.get_disabled()&&e.appendFormat(" {0}Disabled Disabled",u(r.get_cssClass())),e.append('"'),r.get_disabled()?e.append(' onclick2="return false"'):(path=r.get_path(),e.appendFormat(' onclick2="$selectItem(&quot;{0}&quot;,&quot;{1}&quot);return false"',i,path),e.appendFormat(' onmouseover2="$activateItem(&quot;{0}&quot;,&quot;{1}&quot;)" onmouseout2="$deactivateItem(&quot;{0}&quot;,&quot;{1}&quot;)"',i,path)),c=y==n.ItemDescriptionStyle.None?null:r.get_description(),r.get_children()||c==null||y!=n.ItemDescriptionStyle.ToolTip||e.appendFormat(' title="{0}"',$appfactory.htmlAttributeEncode(c)),e.appendFormat(' id="{0}"',r.get_id()),e.append(">"),a&&r.get_children()&&e.append('<div class="Parent">'),l=String.htmlEncode(r.get_text()),v=$app.cssToIcon(r.get_cssClass()),v&&v.match(/glyphicon /)&&(l='<span class="'+v+'"> <\/span>'+l),String.isNullOrEmpty(c)||y!=n.ItemDescriptionStyle.Inline?e.appendFormat('<span class="Outer"><span class="Inner"><span class="Self">{0}<\/span><\/span><\/span>',l):(b=!0,e.appendFormat('<span class="Outer"><span class="Inner"><span class="Self"><span class="Text">{0}<\/span><span class="Description">{1}<\/span><\/span><\/span><\/span>',l,c)),a&&r.get_children()&&e.append("<\/div>"),e.append("<\/a>"),r.get_dynamic()&&window.setTimeout(r.get_script(),50)):e.append('<div class="Break"><\/div>');s!=null&&e.append("<\/div>")}else return null;for(o=this._factory,o||(o=this._factory=document.createElement("div")),$("a.Item",t.container).unbind("click mouseover mouseout"),o.innerHTML=e.toString(),t.container.innerHTML="",h=0;o.childNodes.length>0;)w=o.childNodes[0],o.removeChild(w),t.container.appendChild(w);return e.clear(),b&&(t.container.className=t.container.className+" "+t.container.className.replace(/(\w+)/g,"$1Ex")),$("a.Item",t.container).mouseover(function(){return __evalEvent.call(this,"mouseover")}).mouseout(function(){return __evalEvent.call(this,"mouseout")}).click(function(){return __evalEvent.call(this,"click")}),t},_createFrame:function(n){var t={top:document.createElement("div"),right:document.createElement("div"),bottom:document.createElement("div"),left:document.createElement("div"),arrow:document.createElement("div")};return t.top.style.position="absolute",t.top.style.display="none",t.top.style.zIndex=n,t.top.className="HoverMonitor_TopLine",document.body.appendChild(t.top),t.right.style.position="absolute",t.right.style.display="none",t.right.style.zIndex=n,t.right.className="HoverMonitor_RightLine",document.body.appendChild(t.right),t.bottom.style.position="absolute",t.bottom.style.display="none",t.bottom.style.zIndex=n,t.bottom.className="HoverMonitor_BottomLine",document.body.appendChild(t.bottom),t.left.style.position="absolute",t.left.style.display="none",t.left.style.zIndex=n,t.left.className="HoverMonitor_LeftLine",document.body.appendChild(t.left),t.arrow.style.position="absolute",t.arrow.style.display="none",t.arrow.style.zIndex=n,t.arrow.className="HoverMonitor_Arrow",document.body.appendChild(t.arrow),t.arrow.innerHTML=String.format('<div style="z-index:{0}"><\/div>',n+1),t},_destroyFrame:function(n){n&&(document.body.removeChild(n.top),delete n.top,document.body.removeChild(n.right),delete n.right,document.body.removeChild(n.bottom),delete n.bottom,document.body.removeChild(n.left),delete n.left,$clearHandlers(n.arrow),document.body.removeChild(n.arrow),delete n.arrow,delete n.element)},get_hoverFrame:function(){return this._hoverFrame||(this._hoverFrame=this._createFrame(n.HoverMonitor.HoverFrameZIndex),$addHandlers(this._hoverFrame.arrow,this._hoverArrowHandlers,this)),this._hoverFrame},get_openFrame:function(){return this._openFrame||(this._openFrame=this._createFrame(n.HoverMonitor.OpenFrameZIndex)),this._openFrame},get_hoverItems:function(t){var i=n.HoverMonitor.Families[t.family];return i?i.items:null},get_hoverStyle:function(t){var i=n.HoverMonitor.Families[t.family];return i?i.style:n.HoverStyle.None},get_PopupPosition:function(t){var i=n.HoverMonitor.Families[t.family];return i?i.position:n.HoverStyle.Left},get_itemDescriptionStyle:function(t){var i=n.HoverMonitor.Families[t];return i?i.itemDescriptionStyle:n.HoverStyle.Inline},get_hoverBounds:function(n){return $appfactory.bounds(n.element)},deactivate:function(t,i){var r=n.Item.find(t,i),u;r&&(u=$get(r.get_id()),Sys.UI.DomElement.removeCssClass(u,"Active"),this.cancelAutoShow())},get_activeFamily:function(){return this._activeFamily},get_activePath:function(){return this._activePath},get_activeItem:function(){return n.Item.find(this.get_activeFamily(),this.get_activePath())},get_hoverFamily:function(){var t=this.get_hoverFrame().family;return n.HoverMonitor.Families[t]},get_openFamily:function(){var t=this.get_openFrame().family;return n.HoverMonitor.Families[t]},get_isVisible:function(){return this.get_hoverFrame().visible},get_isOpen:function(){return this.get_openFrame()._open},showFrame:function(t,i,r,u){var f,s,o,e,h;u.cssClass=r;u.family=i;u.element=t;Sys.UI.DomElement.addCssClass(t,u.cssClass+"_Hover");f=this.get_hoverBounds(u);Sys.UI.DomElement.setVisible(u.top,!0);u.top.style.width=f.width+"px";u.top.style.left=f.x+"px";u.top.style.top=f.y+"px";u.top.className="HoverMonitor_TopLine "+r+"_TopLine";Sys.UI.DomElement.setVisible(u.right,!0);u.right.style.left=f.x+f.width-1+"px";u.right.style.top=f.y+"px";u.right.style.height=f.height+"px";u.right.className="HoverMonitor_RightLine "+r+"_RightLine";Sys.UI.DomElement.setVisible(u.bottom,!0);u.bottom.style.left=f.x+"px";u.bottom.style.top=f.y+f.height-1+"px";u.bottom.style.width=f.width+"px";u.bottom.className="HoverMonitor_BottomLine "+r+"_BottomLine";Sys.UI.DomElement.setVisible(u.left,!0);u.left.style.left=f.x+"px";u.left.style.top=f.y+"px";u.left.style.height=f.height+"px";u.left.className="HoverMonitor_LeftLine "+r+"_LeftLine";s=n.HoverMonitor.Families[u.family];s&&(Sys.UI.DomElement.setVisible(u.arrow,!0),u.arrow.className="HoverMonitor_Arrow "+r+"_Arrow",o=Sys.UI.DomElement.getVisible(u.arrow),o||Sys.UI.DomElement.setVisible(u.arrow,!0),e=$appfactory.borderBox(u.arrow),f.width-=e.horizontal,f.height-=e.vertical,h=u.arrow.offsetWidth-e.horizontal,u.arrow.style.top=f.y+1+"px",u.arrow.style.left=f.x+f.width-1-h+"px",u.arrow.style.height=f.height-2+"px",o||Sys.UI.DomElement.setVisible(u.arrow,!1));u.visible=!0},hideFrame:function(n){n.element&&(n.top.className="HoverMonitor_TopLine",Sys.UI.DomElement.setVisible(n.top,!1),n.right.className="HoverMonitor_RightLine",Sys.UI.DomElement.setVisible(n.right,!1),n.bottom.className="HoverMonitor_BottomLine",Sys.UI.DomElement.setVisible(n.bottom,!1),n.left.className="HoverMonitor_LeftLine",Sys.UI.DomElement.setVisible(n.left,!1),n.arrow.className="HoverMonitor_Arrow",n.arrow.style.width="",Sys.UI.DomElement.setVisible(n.arrow,!1),Sys.UI.DomElement.removeCssClass(n.element,n.cssClass+"_Hover"),n.visible=!1)},hidePopups:function(n){var i,r,t;for(n==null&&(n=0),i=n;i<this._popups.length;i++)r=this._popups[i],r&&r.behavior.hide();n==0&&(t=this.get_openFrame(),t._open=!1,t.family=null,t.cssClass=null,delete t.element,this._activeFamily=null,this._activePath=null)},showPopup:function(t,i){var a,l,f,r,p,c,w,tt,k,b,o,v,rt,y;this.stopOpen();a=i?i.get_depth()+1:0;this.hidePopups(a);var s=$appfactory.clientBounds(),e=$appfactory.scrolling(),u=this._renderPopup(this._createPopup(a),t.family,i,t.cssClass);if(u){if(l=i?$get(i.get_id()):null,f=l?$appfactory.bounds(l):this.get_hoverBounds(t),i&&(f.x=f.x+f.width+2,f.y=f.y-(f.height-2)),u.behavior.set_x(f.x),u.behavior.set_y(f.y+f.height),u.behavior.show(),l){if(r=$appfactory.bounds(u.container),p=e.x+s.width<r.x+r.width,!p)for(c=a-2;c>=0;c--)if(w=$appfactory.bounds(this._popups[c].container),tt=w.x<r.x&&w.x+w.width>r.x,tt){p=!0;break}f=$appfactory.bounds(l);p&&(f.x=f.x-r.width,f.x>=0&&(u.container.style.left=f.x+"px"))}if(a==0&&n.PopupPosition.Right==this.get_PopupPosition(t)&&(u.container.style.left=f.x+f.width-$(u.container).outerWidth()+"px"),r=$appfactory.bounds(u.container),r.x+r.width>=e.x+s.width?u.container.style.left=e.x+s.width-r.width+"px":r.x<e.x&&(u.container.style.left=e.x+"px"),r.y+r.height>=e.y+s.height){for(k=!0,b=u.container.getElementsByTagName("div"),c=0;c<b.length;c++)if(o=b[c],o.className=="Group"){var ut=Math.ceil((e.y+s.height-f.y)/5*4),h=$appfactory.bounds(o),it=h.height<100?h.height:100;if(h.height=ut-(h.y-r.y),h.height<it?h.height=it:k=!1,o.offsetHeight>h.height&&(o._autoScrolling=!0,o.style.height=h.height+"px",o.style.overflow="auto",o.style.overflowX="hidden",o.offsetWidth<h.width&&window.external)){var d=o.childNodes[o.childNodes.length-1],g=$appfactory.paddingBox(d),nt=$appfactory.borderBox(d);d.style.width=h.width-g.horizontal-nt.horizontal+"px"}r=$appfactory.bounds(u.container);break}b=null;k&&(v=f.y+f.height-r.height,v<e.y&&(v=e.y),u.container.style.top=v+"px",v+r.height>e.y+s.height&&(u.container.style.top=e.y+s.height-r.height-2+"px",r=$appfactory.bounds(u.container),r.y<e.y&&(u.container.style.top=e.y+"px",r.height>s.height&&(nt=$appfactory.borderBox(u.container),g=$appfactory.paddingBox(u.container),u.container.style.height=s.height-nt.vertical-g.vertical+"px",u.container.style.overflow="auto",u.container.style.overflowX="hidden"))),l||(r=$appfactory.bounds(u.container),r.y=f.y-r.height,r.y<e.y&&(rt=e.x+s.width-(f.x+f.width),rt>=r.width?u.container.style.left=f.x+f.width+"px":(r.x=f.x-r.width,r.x<0&&(r.x=0),u.container.style.left=r.x+"px"),r.y=e.y),u.container.style.top=r.y+"px"))}u.container.style.zIndex=n.HoverMonitor.HoverMenuZIndex;y=this.get_openFrame();y.family=t.family;y.cssClass=t.cssClass;y.element=t.element;y._open=!0}},hover:function(t,i,r,u){var f=this,o,s,e,h;if(f._hoverElement!=t){for(u==null&&(u=0),f.stopOpen(),f.stopClose();u-->0&&t;)t=t.parentNode;if(o=f.get_hoverFrame(),o.arrow.className="HoverMonitor_Arrow",s=f.get_hoverStyle(f.get_openFrame()),f.hideFrame(f.get_openFrame()),f.showFrame(t,i,r,o),e=f.get_isOpen(),e&&(f.get_hoverFrame().element!=f.get_openFrame().element&&s==n.HoverStyle.Auto||s==n.HoverStyle.ClickAndStay)&&f.hidePopups(),f._skipOpen){f._skipOpen=!1;return}h=f.get_hoverStyle(f.get_hoverFrame());h==n.HoverStyle.Auto?f._hoverTimeout=setTimeout(function(){f._hoverElement=null;f.showPopup(f.get_hoverFrame())},200):e&&h==n.HoverStyle.ClickAndStay?f.showPopup(f.get_hoverFrame()):e&&f._showOpenFrame()}},_showOpenFrame:function(){var n=this.get_openFrame();this.get_isOpen()&&(n.element||(n=this.get_hoverFrame()),this.showFrame(n.element,n.family,n.cssClass,n))},cancelAutoShow:function(){var n=this;clearTimeout(n._hoverTimeout);n._hoverTimeout=null;n._hoverElement=null},unhover:function(){this._skipUnhover?this._skipUnhover=!1:(this.cancelAutoShow(),this.hideFrame(this.get_hoverFrame()),this.get_isOpen()&&(this.startClose(),this.get_hoverStyle(this.get_openFrame())!=n.HoverStyle.Click&&this._showOpenFrame()))},select:function(i,r){var e,u,f;try{e=new Sys.UI.DomEvent(window.event);e.stopPropagation();e.preventDefault()}catch(o){}(u=n.Item.find(i,r),!u.get_confirmation()||confirm(u.get_confirmation()))&&(f=u.get_script(),f?(typeof f=="string"?eval(u.get_script()):f(u.context()),this.close()):String.isNullOrEmpty(u.get_url())||(t.navigate(u.get_url()),this.close()))},stopClose:function(){this._closeInterval&&window.clearInterval(this._closeInterval);this._closeInterval=null},startClose:function(){this.stopClose();this._closeInterval=setInterval(function(){var t=n.HoverMonitor._instance;t.stopClose();t.close()},1e3)},closeItem:function(t,i){this.stopCloseItem();var u=t!=null&&i!=null?n.Item.find(t,i):this.get_activeItem(),r=this.get_activeItem();u&&r&&(u!=r||!r.get_children())&&this.hidePopups(r.get_depth()+1)},stopCloseItem:function(){this._closeItemInterval&&window.clearInterval(this._closeItemInterval);this._closeItemInterval=null},startCloseItem:function(t,i){this.stopCloseItem();this._closeItemInterval=setInterval(function(){n.HoverMonitor._instance.closeItem(t,i)},1e3)},stopOpen:function(){this._openInterval&&window.clearInterval(this._openInterval);this._openInterval=null},startOpen:function(t,i){this.stopOpen();this.stopCloseItem();this.stopClose();this._skipStartOpen||(this._openInterval=setInterval(function(){n.HoverMonitor._instance.open(t,i)},n.HoverMonitor._instance._tempOpenDelay!=null?n.HoverMonitor._instance._tempOpenDelay:500),n.HoverMonitor._instance._tempOpenDelay=null);this._skipStartOpen=!1},open:function(t,i){this.stopOpen();var r=n.Item.find(t,i);if(r){if(this.hidePopups(r.get_depth()+1),r==null||!r.get_children())return;this.showPopup(this.get_openFrame(),r)}},toggle:function(){if(n.HoverMonitor._preventToggleHover){n.HoverMonitor._preventToggleHover=!1;return}if(this.get_isOpen()&&this.get_hoverFrame().family==this.get_openFrame().family){this.hideFrame(this.get_openFrame());this.hidePopups();var t=this.get_hoverFrame();this.showFrame(t.element,t.family,t.cssClass,t)}else this.hideFrame(this.get_openFrame()),this.showPopup(this.get_hoverFrame());this.stopClose()},refresh:function(n){this.get_isOpen()&&this.get_openFrame().family==n&&(this.toggle(),this.toggle())},_hoverArrow_click:function(n){n.preventDefault();n.stopPropagation();this.toggle()},_hoverArrow_mouseover:function(){var n=this.get_hoverFrame();this.showFrame(n.element,n.family,n.cssClass,n)},_hoverArrow_mouseout:function(){this.hideFrame(this.get_hoverFrame());this._showOpenFrame()},close:function(){this.hideFrame(this.get_openFrame());this.hideFrame(this.get_hoverFrame());this.hidePopups()},activate:function(t,i,r){var f,l,u,e,o,s,h,c;for(this._activeFamily=t,this._activePath=i,f=n.Item.find(t,i),!f||f.get_children()?this.startOpen(t,i):f&&(this.stopOpen(),this.startCloseItem(t,i)),l=!0;f;){if(u=$get(f.get_id()),l&&(l=!1,u)){for(e=u.parentNode,e.className=="Group"&&(e=e.parentNode),o=e.getElementsByTagName("a"),s=0;s<o.length;s++)Sys.UI.DomElement.removeCssClass(o[s],"Active");o=null}u&&Sys.UI.DomElement.addCssClass(u,"Active");r&&u.parentNode._autoScrolling&&(h=$appfactory.bounds(u.parentNode),c=$appfactory.bounds(u),(c.y<h.y||c.y+c.height>h.y+h.height-1)&&u.scrollIntoView(!(r=="down"||r=="end")),u.parentNode.scrollLeft=0);f=f.get_parent()}},_moveToItem:function(t,i){var e;if(t){var f=t.get_parent()?t.get_parent().get_children():n.HoverMonitor.Families[t.get_family()].items,r=Array.indexOf(f,t),u=null;switch(i){case"down":r=r<f.length-1?r+1:0;break;case"up":r=r>0?r-1:f.length-1;break;case"home":r=0;break;case"end":r=f.length-1}if(u=f[r],u)for(e=r;String.isNullOrEmpty(u.get_text())||u.get_disabled();)if(r+=i=="down"||i=="home"?1:-1,r<0?r=f.length:r>f.length-1&&(r=0),r==e){u=null;break}else u=f[r];u&&($activateItem(u.get_family(),u.get_path(),i),u.get_children()||this.startCloseItem(u.get_family(),u.get_path()))}},_openItem:function(n){n&&n.get_children()&&(this.open(n.get_family(),n.get_path()),n=n.get_children()[0],$activateItem(n.get_family(),n.get_path()))},_openFirstItem:function(){var n=this.get_openFamily();n&&this._moveToItem(n.items[0],"home")},_document_keydown:function(t){var i,u,r,f;if(this.get_isOpen())if(this.stopOpen(),$appfactory._focusedItemIndex=null,i=this.get_activeItem(),i||t.keyCode!=Sys.UI.Key.down&&t.keyCode!=Sys.UI.Key.up){if(t.keyCode==Sys.UI.Key.tab&&!i){if(this.get_hoverStyle(this.get_hoverFrame())==n.HoverStyle.Auto)return;t.preventDefault();this._openFirstItem()}switch(t.keyCode){case Sys.UI.Key.enter:i&&(String.isNullOrEmpty(i.get_url())&&i.get_children()?this._openItem(i):this.select(i.get_family(),i.get_path()));break;case Sys.UI.Key.esc:if(i&&i.get_parent())this.hidePopups(i.get_depth()),i=i.get_parent(),$activateItem(i.get_family(),i.get_path()),this.stopOpen();else{if(u=this.get_hoverFrame(),r=u.element,this.close(),r){r.tagName.toLowerCase()!="a"&&(f=r.getElementsByTagName("a"),f&&f.length>0&&(r=f[0]),delete f);try{r.focus()}catch(t){}}this._skipOpen=!0;$showHover(u.element,u.family,u.cssClass)}break;case Sys.UI.Key.down:this._moveToItem(i,"down");break;case Sys.UI.Key.up:this._moveToItem(i,"up");break;case Sys.UI.Key.tab:this._moveToItem(i,t.shiftKey?"up":"down");break;case Sys.UI.Key.home:this._moveToItem(i,"home");break;case Sys.UI.Key.end:this._moveToItem(i,"end");break;case Sys.UI.Key.right:case Sys.UI.Key.left:this._openItem(i);break;default:return}t.preventDefault();t.stopPropagation()}else t.preventDefault(),this._openFirstItem();else if(this.get_isVisible())switch(t.keyCode){case Sys.UI.Key.down:case Sys.UI.Key.up:this.get_hoverFamily()&&this.showPopup(this.get_hoverFrame());t.preventDefault()}},_document_click:function(n){if(this._openFrame&&this._openFrame._open){for(var t=n.target;t;){if(!String.isNullOrEmpty(t.className)&&t.className.match(/\s+\w+_Hover/))return;t=t.parentNode}this.close()}},_hoverMenu_mouseover:function(){this.stopClose();this.get_isOpen()&&this.get_hoverStyle(this.get_openFrame())==n.HoverStyle.Click&&this._showOpenFrame()},_hoverMenu_mouseout:function(){this.startClose()}};n.HoverMonitor.Families=[];i.$closeHovers=function(){var t=n.HoverMonitor._instance;t&&t.close()};i.$hoverOver=function(n,t){while(t-->0)n=n.parentNode;n.focus();$skipUnhover()};i.$skipUnhover=function(){n.HoverMonitor._instance._skipUnhover=!0};i.$nextTabIndex=function(){var t=n.HoverMonitor._instance;return t?t.nextTabIndex():-1};i.$showHover=function(t,i,r,u){n.HoverMonitor._instance.hover(t,i,r,u)};i.$hideHover=function(){r&&event.fromElement&&event.fromElement.tagName=="A"&&event.fromElement.parentNode.tagName=="DIV"||n.HoverMonitor._instance.unhover()};i.$selectItem=function(t,i){n.HoverMonitor._instance.select(t,i)};i.$toggleHover=function(){n.HoverMonitor._instance.toggle()};i.$preventToggleHover=function(){n.HoverMonitor._preventToggleHover=!0};i.$refreshHoverMenu=function(t){n.HoverMonitor._instance.refresh(t)};i.$activateItem=function(t,i,r){n.HoverMonitor._instance.activate(t,i,r)};i.$deactivateItem=function(t,i){n.HoverMonitor._instance.deactivate(t,i)};i.$registerItems=function(t,i,r,u,f){r==null&&(r=n.HoverStyle.Auto);u==null&&(u=n.PopupPosition.Left);f==null&&(f=n.ItemDescriptionStyle.Inline);$unregisterItems(t);n.HoverMonitor.Families[t]={items:i,style:r,position:u,itemDescriptionStyle:f}};i.$unregisterItems=function(t){var i=n.HoverMonitor.Families[t],r;if(i&&i.items){for(r=0;r<i.items.length;r++)i.items[r].dispose();Array.clear(i.items)}delete n.HoverMonitor.Families[t]};n.HoverMonitor.registerClass("Web.HoverMonitor",Sys.Component);$.mobile||(n.HoverMonitor._instance=$create(n.HoverMonitor,{id:"GlobalHoverMonitor"}));n.HoverMonitor.OpenFrameZIndex=101001;n.HoverMonitor.HoverFrameZIndex=101002;n.HoverMonitor.HoverMenuZIndex=101003;typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded()})();